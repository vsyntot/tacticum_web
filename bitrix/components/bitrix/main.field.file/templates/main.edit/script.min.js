this.BX=this.BX||{};this.BX.Main=this.BX.Main||{};this.BX.Main.Field=this.BX.Main.Field||{};(function(e,t,n,i,l){"use strict";var r={components:{TileWidgetComponent:l.TileWidgetComponent},data:function e(){return{deletedValues:[],uploadedValues:[],uploadInProgress:false}},props:{fieldName:{type:String,required:true},controlId:{type:String,required:true},context:{type:Object,required:true},values:{type:Object}},computed:{sessionInputName:function e(){return"".concat(this.context.fieldName,"_session_id")},valueInputName:function e(){return this.context.fieldName+(this.context.multiple?"[]":"")},deletedValueInputName:function e(){return"".concat(this.context.fieldName,"_del").concat(this.context.multiple?"[]":"")},sessionId:function e(){return this.context.sessionId},currentValues:function e(){var t=[].concat(babelHelpers.toConsumableArray(this.values),babelHelpers.toConsumableArray(this.uploadedValues));return this.context.multiple?t:t.slice(-1)},uploaderOptions:function e(){var t=this,l;return{controller:"main.fileUploader.fieldFileUploaderController",controllerOptions:this.context.controllerOptions,files:this.values,events:(l={},babelHelpers.defineProperty(l,i.UploaderEvent.FILE_UPLOAD_COMPLETE,(function(e){var n,i,l;var r=(n=e.getData())===null||n===void 0?void 0:(i=n.file)===null||i===void 0?void 0:(l=i.getCustomData())===null||l===void 0?void 0:l.realFileId;if(r){t.uploadedValues.push(r)}t.emitChangeEvent()})),babelHelpers.defineProperty(l,i.UploaderEvent.FILE_REMOVE,(function(e){var i,l,r,o,a;var u=(i=e.getData())===null||i===void 0?void 0:(l=i.file)===null||l===void 0?void 0:(r=l.getCustomData())===null||r===void 0?void 0:r.realFileId;if(u&&t.uploadedValues.includes(u)){t.uploadedValues=t.uploadedValues.filter((function(e){return e!==u}))}var s=(o=e.getData())===null||o===void 0?void 0:(a=o.file)===null||a===void 0?void 0:a.getServerFileId();if(s&&n.Type.isInteger(s)){t.deletedValues.push(s)}t.emitChangeEvent()})),babelHelpers.defineProperty(l,i.UploaderEvent.FILE_STATUS_CHANGE,(function(e){var n;var l=(n=e.getTarget())===null||n===void 0?void 0:n.getFiles();if(!l){return}var r=l.some((function(e){var t=e.getStatus();return t===i.FileStatus.UPLOADING||t===i.FileStatus.PREPARING||t===i.FileStatus.PENDING||t===i.FileStatus.UPLOADING}));if(t.uploadInProgress!==r){t.uploadInProgress=r;if(r){t.emitUploadStartEvent()}else{t.emitUploadCompleteEvent()}}})),l),multiple:this.context.multiple,autoUpload:true,treatOversizeImageAsFile:true}},widgetOptions:function e(){return{}}},methods:{emitChangeEvent:function e(){BX.onCustomEvent(window,"onUIEntityEditorUserFieldExternalChanged",[this.fieldName]);BX.onCustomEvent(window,"onCrmEntityEditorUserFieldExternalChanged",[this.fieldName])},emitUploadStartEvent:function e(){n.Event.EventEmitter.emit("BX.UI.EntityEditor:onUserFieldFileUploadStart",{fieldName:this.fieldName})},emitUploadCompleteEvent:function e(){n.Event.EventEmitter.emit("BX.UI.EntityEditor:onUserFieldFileUploadComplete",{fieldName:this.fieldName})}},template:'\n\t\t<div class="main-field-file-wrapper">\n\t\t\t<input type="hidden" :name="sessionInputName" :value="sessionId" />\n\t\t\t<input v-if="currentValues.length" v-for="(value, index) in currentValues" :key="index" type="hidden" :name="valueInputName" :value="value"/>\n\t\t\t<input v-else type="hidden" :name="valueInputName" />\n\n\t\t\t<input v-for="(value, index) in deletedValues" :key="index" type="hidden" :name="deletedValueInputName" :value="value"/>\n\n\t\t\t<TileWidgetComponent\n\t\t\t\tref="uploader"\n\t\t\t\t:uploaderOptions="uploaderOptions"\n\t\t\t\t:widgetOptions="widgetOptions"\n\t\t\t/>\n\t\t</div>\n\t'};function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){s(e,t);t.set(e,n)}function s(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var d=new WeakMap;var p=function e(i){babelHelpers.classCallCheck(this,e);u(this,d,{writable:true,value:null});var l=document.getElementById(i.containerId);if(!n.Type.isDomNode(l)){throw new Error("container not found")}babelHelpers.classPrivateFieldSet(this,d,t.BitrixVue.createApp(a({},r),{fieldName:i.fieldName,controlId:i.controlId,context:i.context,values:i.value.map((function(e){return parseInt(e,10)}))}));babelHelpers.classPrivateFieldGet(this,d).mount(l)};e.App=p})(this.BX.Main.Field.File=this.BX.Main.Field.File||{},BX.Vue3,BX,BX.UI.Uploader,BX.UI.Uploader);
//# sourceMappingURL=script.map.js