(function(){"use strict";BX.namespace("BX.Landing.UI.Panel");var t=BX.Landing.Utils.proxy;var e=BX.Landing.Utils.getSelectedElement;BX.Landing.UI.Panel.EditorPanel=function(){BX.Landing.UI.Panel.BaseButtonPanel.apply(this,arguments);this.layout.classList.add("landing-ui-panel-editor");this.position="absolute";this.currentElement=null;this.outOfFrame=true;this.onKeydown=this.onKeydown.bind(this);this.onTabDown=this.onTabDown.bind(this);this.onScroll=this.onScroll.bind(this)};BX.Landing.UI.Panel.EditorPanel.instance=null;BX.Landing.UI.Panel.EditorPanel.getInstance=function(){if(!BX.Landing.UI.Panel.EditorPanel.instance){BX.Landing.UI.Panel.EditorPanel.instance=new BX.Landing.UI.Panel.EditorPanel;BX.Landing.UI.Panel.EditorPanel.instance.init()}return BX.Landing.UI.Panel.EditorPanel.instance};var n=null;var i=null;function o(t){var e=new BX.Landing.UI.Button.EditorAction("drag",{html:'<strong class="landing-ui-drag">&nbsp;</strong>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_DRAG")}});e.layout.onbxdrag=s.bind(this);e.layout.onbxdragstop=l.bind(this);jsDD.registerObject(e.layout);t.prependButton(e);var n;var i;var o;var a;function s(e,s){if(!n){var l=BX.pos(jsDD.current_node);i=Math.max(Math.abs(e-l.left),0);o=Math.max(Math.abs(s-l.top),0);n=true}BX.DOM.write(function(){t.layout.classList.remove("landing-ui-transition");if(BX.Landing.PageObject.getEditorWindow().scrollY>0){a=s-o}else{a=s+o}t.layout.style.top=a+"px";t.layout.style.left=e-i+"px"}.bind(this))}function l(){n=false;t.layout.classList.add("landing-ui-transition")}}function a(e){e.addButton(new BX.Landing.UI.Button.EditorAction("bold",{html:'<span class="landing-ui-icon-editor-bold"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_BOLD")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("italic",{html:'<span class="landing-ui-icon-editor-italic"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ITALIC")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("underline",{html:'<span class="landing-ui-icon-editor-underline"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_UNDERLINE")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("strikeThrough",{html:'<span class="landing-ui-icon-editor-strike"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_STRIKE")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("justifyLeft",{html:'<span class="landing-ui-icon-editor-left"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ALIGN_LEFT")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("justifyCenter",{html:'<span class="landing-ui-icon-editor-center"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ALIGN_CENTER")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("justifyRight",{html:'<span class="landing-ui-icon-editor-right"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ALIGN_RIGHT")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("justifyFull",{html:'<span class="landing-ui-icon-editor-justify"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ALIGN_JUSTIFY")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.CreateLink("createLink",{html:'<span class="landing-ui-icon-editor-link"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_CREATE_LINK")},onClick:t(e.adjustButtonsState,e)}));var n=BX.Landing.Env.getInstance().getOptions().rights;if(n&&n.includes("edit")&&BX.Landing.Env.getInstance().getType()!=="MAINPAGE"){e.addButton(new BX.Landing.UI.Button.CreatePage("createPage",{html:'<span class="landing-ui-icon-editor-new-page"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_CREATE_PAGE")},onClick:t(e.adjustButtonsState,e)}))}e.addButton(new BX.Landing.UI.Button.EditorAction("unlink",{html:'<span class="landing-ui-icon-editor-unlink"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_UNLINK")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("insertUnorderedList",{html:'<span class="fa fa-list-ul"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_UL")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("insertOrderedList",{html:'<span class="fa fa-list-ol"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_OL")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.EditorAction("removeFormat",{html:'<span class="landing-ui-icon-editor-eraser"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_CLEAR")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.ColorAction("foreColor",{text:BX.Landing.Loc.getMessage("EDITOR_ACTION_SET_FORE_COLOR"),attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_COLOR")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.TextBackgroundAction("hiliteColor",{html:'<span class="landing-ui-icon-editor-text-background"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_TEXT_BACKGROUND")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.CreateTable("createTable",{html:'<span class="landing-ui-icon-editor-table"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_CREATE_TABLE")},onClick:t(e.adjustButtonsState,e)}));e.addButton(new BX.Landing.UI.Button.PasteTable("pasteTable",{html:'<span class="landing-ui-icon-editor-copy"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_PASTE_TABLE")},onClick:t(e.adjustButtonsState,e)}));if(BX.Landing.Main.getInstance()["options"]["copilot_available"]){e.addButton(new BX.Landing.UI.Button.AiCopilot.getInstance("ai_copilot",{html:"CoPilot",editor:e,onReplace(t){const n=e.currentElement.querySelector(".landing-ui-field-input");if(n){n.innerHTML=`<div>${t}</div>`}else if(e.currentElement){e.currentElement.innerHTML=`<div>${t}</div>`}},onReplaceContext(t){const e=window.getSelection().getRangeAt(0);e.deleteContents();e.insertNode(document.createTextNode(t))},onAddBelow(t){const n=e.currentElement.querySelector(".landing-ui-field-input");if(n){n.innerHTML=`${n.innerHTML}<div>${t}</div>`}else if(e.currentElement){e.currentElement.innerHTML=`${e.currentElement.innerHTML}<div>${t}</div>`}}}))}}var s={top:0,left:0};function l(t,e,n){var i=e.getBoundingClientRect();var o=i.left+i.width/2-t.rect.width/2;var a=i.top-t.rect.height-4;var l="absolute";var d=t.outOfFrame?window.parent:window;var r=e.closest(".landing-ui-panel-content-body-content");if(r){if(e.classList.contains("landing-ui-field")){a+=d.pageYOffset}else{a=r.getBoundingClientRect().top+5;l="fixed"}}else if(BX.Landing.Main.getInstance().isControlsExternal()){a+=71}else{if(a<=5&&(i.bottom>d.innerHeight||i.height>d.innerHeight/1.5)){a=5;l="fixed"}else{if(t.simpleScrollMode===true){if(t.placementType){if(t.placementType==="top"){a+=d.pageYOffset+66}if(t.placementType==="bottom"){a=i.bottom+4+d.pageYOffset}}else{if(a>5){t.placementType="top";a+=d.pageYOffset+66}else{t.placementType="bottom";a=i.bottom+4+d.pageYOffset}}}else{if(a>5){a+=d.pageYOffset+66}else{a=i.bottom+4+d.pageYOffset}}}}if(t.outOfFrame&&t.contextDocument!==a.document&&t.contextDocument.defaultView.frameElement){o+=t.contextDocument.defaultView.frameElement.getBoundingClientRect().left}if(o+t.rect.width>d.innerWidth-20){o-=o+t.rect.width-(d.innerWidth-20)}o=Math.max(20,o);if(s.top!==a||s.left!==o||n){BX.DOM.write((function(){t.layout.style.position=l;t.layout.style.top=a+"px";t.layout.style.left=o+"px"}));s.top=a;s.left=o;B(t)}}function d(t){if(t.outOfFrame){window.parent.document.body.appendChild(t.layout)}else{window.document.body.appendChild(t.layout)}}var r=null;function u(t){r=t.target}var c=false;function g(t){c=r!==t.target}function h(t){if(c){t.preventDefault();t.stopPropagation()}}function f(t){if(t.popup){t.popup.close()}if(t.menu){t.menu.close()}}function B(t){t.buttons.forEach(f);if(t.additionalButtons){t.additionalButtons.forEach(f)}BX.Landing.UI.Tool.ColorPicker.hideAll()}BX.Landing.UI.Panel.EditorPanel.prototype={constructor:BX.Landing.UI.Panel.EditorPanel,__proto__:BX.Landing.UI.Panel.BaseButtonPanel.prototype,init:function(){o(this);a(this);d(this);this.rect=this.layout.getBoundingClientRect()},show:function(e,n,i,o,a){if(o){if(a){if(a.length>0){this.showBaseButtons();this.hideBaseButtons(a)}else{this.hideAllBaseButtons()}}else{this.hideAllBaseButtons()}}else{if(!this.isShown()){this.sendAnalytics("open")}this.showBaseButtons()}this.currentElement=e;this.setContextDocument(this.currentElement?this.currentElement.ownerDocument:document);if(this.additionalButtons){this.additionalButtons.forEach((function(t){this.buttons.remove(t);f(t);BX.remove(t.layout)}),this);this.additionalButtons=null}if(i){this.additionalButtons=i;this.additionalButtons.forEach((function(t){t.layout.hidden=false;if(t.insertAfter){var e=this.layout.querySelector('[data-id="'+t.insertAfter+'"]');if(e){BX.insertAfter(t.layout,e);this.buttons.add(t)}}else{this.addButton(t)}if(t.insertBefore){const e=this.layout.querySelector(`[data-id="${t.insertBefore}"]`);if(e){BX.insertBefore(t.layout,e);this.buttons.add(t)}else{this.addButton(t)}}}),this)}if(!this.isShown()){BX.onCustomEvent("BX.Landing.Editor:enable",[e]);this.contextDocument.addEventListener("mousedown",u,true);this.contextDocument.addEventListener("mouseup",g,true);this.contextDocument.addEventListener("click",h,true);this.currentElement.addEventListener("click",t(this.adjustButtonsState,this),true);setTimeout(function(){this.layout.classList.add("landing-ui-transition")}.bind(this),100)}BX.Landing.UI.Panel.BaseButtonPanel.prototype.show.call(this,arguments);BX.DOM.write(function(){this.rect=this.layout.getBoundingClientRect();this.adjustPosition(e,n,true)}.bind(this));this.onShow(e);this.adjustButtonsState();this.adjustButtonsContextDocument()},onShow:function(t){i=t;n=n||this.onScroll.bind(null,t);this.contextDocument.addEventListener("keydown",this.onKeydown);this.contextWindow.addEventListener("resize",n);try{this.contextDocument.addEventListener("scroll",n,{passive:true})}catch(t){this.contextDocument.addEventListener("scroll",n)}},hide:function(){if(this.isShown()){BX.onCustomEvent("BX.Landing.Editor:disable",[null]);this.contextDocument.removeEventListener("mousedown",u,true);this.contextDocument.removeEventListener("mouseup",g,true);this.contextDocument.removeEventListener("click",h,true);this.currentElement.removeEventListener("click",t(this.adjustButtonsState,this),true);setTimeout(function(){this.rect=this.layout.getBoundingClientRect();this.layout.classList.remove("landing-ui-transition")}.bind(this),100)}BX.Landing.UI.Panel.BaseButtonPanel.prototype.hide.call(this,arguments);this.onHide()},onHide:function(){this.contextDocument.removeEventListener("keydown",this.onKeydown);this.contextWindow.removeEventListener("resize",n);try{this.contextDocument.removeEventListener("scroll",n,{passive:true})}catch(t){this.contextDocument.removeEventListener("scroll",n)}},onKeydown:function(t){if(t.key==="Tab"&&t.target.nodeName!=="LI"){t.preventDefault();if(!t.shiftKey){if(t.code==="Tab"){this.onTabDown()}else{this.contextDocument.execCommand("indent")}}else{this.contextDocument.execCommand("outdent")}}if(t.key==="Enter"&&t.target.nodeName!=="LI"&&t.target.nodeName!=="UL"&&t.metaKey===true){t.preventDefault();const e=this.contextWindow.getSelection().getRangeAt(0);const n=BX.create("br");e.deleteContents();e.insertNode(n);const i=this.contextDocument.createRange();i.setStartAfter(n);i.collapse(true);const o=this.contextWindow.getSelection();o.removeAllRanges();o.addRange(i)}setTimeout((function(){BX.Landing.UI.Panel.EditorPanel.getInstance().adjustPosition(i)}),10)},onTabDown:function(){var t=10;var e=true;var n=this.contextWindow.getSelection().focusNode.parentNode.parentNode;while(n.tagName==="DIV"){n=n.parentNode}var i=0;var o=[];var a=["UL","LI","BLOCKQUOTE","DIV"];while(a.indexOf(n.tagName)!==-1){if(n.tagName!=="DIV"){i++;o.push(n)}n=n.parentNode}if(i>t){if(o[o.length-1].tagName==="BLOCKQUOTE"){var s=o[o.length-1].previousSibling;while(s!==null&&s.nodeType!==1){s=s.previousSibling}var l=0;while(s&&s.tagName==="BLOCKQUOTE"){s=s.firstChild;l++}if(i-l>0){e=false}}else{for(var d=1;d<o.length;d++){if(o[d].childNodes.length<2){e=false;break}}if(o[0].firstChild.nextSibling===null){e=false}}}if(e){this.contextDocument.execCommand("indent")}},onScroll:function(){BX.Landing.UI.Panel.EditorPanel.getInstance().adjustPosition(i)},enableSimpleScrollMode:function(){this.layout.classList.remove("landing-ui-transition");this.simpleScrollMode=true},disableSimpleScrollMode:function(){this.layout.classList.add("landing-ui-transition");this.simpleScrollMode=false},resetPlacementType:function(){this.placementType=null},adjustButtonsState:function(){var t=function(t){return(!t?"de":"")+"activate"};var e=function(t){return this.buttons.get(t)}.bind(this);requestAnimationFrame(function(){var n=this.getFormat();void(e("bold")&&e("bold")[t(n.bold)]());void(e("italic")&&e("italic")[t(n.italic)]());void(e("underline")&&e("underline")[t(n.underline)]());void(e("strikeThrough")&&e("strikeThrough")[t(n.strike)]());void(e("justifyLeft")&&e("justifyLeft")[t(n.align==="left")]());void(e("justifyCenter")&&e("justifyCenter")[t(n.align==="center")]());void(e("justifyRight")&&e("justifyRight")[t(n.align==="right")]());void(e("justifyFull")&&e("justifyFull")[t(n.align==="justify")]())}.bind(this))},adjustButtonsContextDocument:function(){this.buttons.forEach((t=>{if("setContextDocument"in t){t.setContextDocument(this.contextDocument)}}))},getFormat:function(){var t=e(this.contextDocument);var n={};if(t){var i=getComputedStyle(t);switch(i.getPropertyValue("font-weight")){case"bold":case"bolder":case"500":case"600":case"700":case"800":case"900":n["bold"]=true;break}if(t.tagName==="B"){n["bold"]=true}if(i.getPropertyValue("font-style")==="italic"){n["italic"]=true}if(i.getPropertyValue("text-decoration").includes("underline")||i.getPropertyValue("text-decoration-line").includes("underline")){n["underline"]=true}if(i.getPropertyValue("text-decoration").includes("line-through")||i.getPropertyValue("text-decoration-line").includes("line-through")){n["strike"]=true}var o=i.getPropertyValue("text-align")||"left";if(o.match(/[left|center|rigth|custiffy]/)){n["align"]=o}if(this.currentElement.nodeName==="A"||this.currentElement.closest("a")){n["link"]=true}}return n},adjustPosition:function(t,e,n){l(this,t,n)},isFixed:function(){return this.position==="fixed-top"||this.position==="fixed-right"},hideAllBaseButtons:function(){this.layout.childNodes.forEach((function(t){if(t.dataset.id!=="drag"){t.hidden=true}}))},hideBaseButtons:function(t){this.layout.childNodes.forEach((function(e){if(t.indexOf(e.dataset.id)!==-1){e.hidden=true}}))},showBaseButtons:function(){this.layout.childNodes.forEach((t=>{if(t.dataset.id==="pasteTable"){if(top.window.copiedTable){t.hidden=false}else{t.hidden=true}}else{t.hidden=false}}))},isOutOfFrame:function(){return this.outOfFrame},sendAnalytics:function(t){const e={tool:BX.Landing.Main.getAnalyticsCategoryByType(),category:"inline_editor",event:t};BX.UI.Analytics.sendData(e)}}})();
//# sourceMappingURL=editor_panel.map.js