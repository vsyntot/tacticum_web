this.BX=this.BX||{};(function(e,t,i,n,s,l,o,a){"use strict";function r(e,t,i){u(e,t);t.set(e,i)}function u(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var h=new WeakMap;let d=function(){function e(t){babelHelpers.classCallCheck(this,e);r(this,h,{writable:true,value:null});if(!s.Type.isPlainObject(t)){throw new TypeError("The argument must be a plain object.")}babelHelpers.classPrivateFieldSet(this,h,t)}babelHelpers.createClass(e,[{key:"set",value:function e(t,i){if(!s.Type.isStringFilled(t)){throw new Error("The 'key' must be a string.")}babelHelpers.classPrivateFieldGet(this,h)[t]=i}},{key:"get",value:function e(t){return babelHelpers.classPrivateFieldGet(this,h)[t]}},{key:"delete",value:function e(t){delete babelHelpers.classPrivateFieldGet(this,h)[t]}},{key:"has",value:function e(t){return t in babelHelpers.classPrivateFieldGet(this,h)}},{key:"clear",value:function e(){babelHelpers.classPrivateFieldSet(this,h,{})}},{key:"entries",value:function e(){return babelHelpers.classPrivateFieldGet(this,h)}}]);return e}();function c(e,t){f(e,t);t.add(e)}function f(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function m(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var p=new WeakSet;let g=function(){function e(t,i){babelHelpers.classCallCheck(this,e);c(this,p);babelHelpers.defineProperty(this,"slider",null);babelHelpers.defineProperty(this,"color",null);babelHelpers.defineProperty(this,"bgColor",null);babelHelpers.defineProperty(this,"className","");babelHelpers.defineProperty(this,"iconClass","");babelHelpers.defineProperty(this,"iconTitle","");babelHelpers.defineProperty(this,"onclick",null);babelHelpers.defineProperty(this,"text",null);babelHelpers.defineProperty(this,"hidden",false);babelHelpers.defineProperty(this,"visible",true);babelHelpers.defineProperty(this,"cache",new s.Cache.MemoryCache);this.slider=t;const n=s.Type.isPlainObject(i)?i:{};this.hidden=s.Type.isBoolean(n.hidden)?n.hidden:this.hidden;this.visible=s.Type.isBoolean(n.visible)?n.visible:this.visible;this.setColor(n.color);this.setBgColor(n.bgColor);this.setText(n.text);this.setClassName(n.className);this.setIconClass(n.iconClass);this.setIconTitle(n.iconTitle);this.setOnclick(n.onclick)}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){return this.cache.remember("container",(()=>{const e=["side-panel-label"];if(this.getClassName()){e.push(this.getClassName())}if(this.isHidden()){e.push("--hidden")}if(this.isVisible()){e.push("--visible")}return s.Dom.create("div",{props:{className:e.join(" ")},children:[this.getIconBox(),this.getTextContainer()],events:{click:m(this,p,y).bind(this)}})}))}},{key:"adjustLayout",value:function e(){const t=this.getSlider().getOverlay().getBoundingClientRect();const i=this.getSlider().getContainer().getBoundingClientRect();const n=i.left-t.left;if(n<=this.getSlider().getMinLeftBoundary()){this.hideText()}else{this.showText()}s.Dom.style(this.getContainer(),"max-width",`${n-this.constructor.MIN_LEFT_OFFSET}px`)}},{key:"getIconBox",value:function e(){return this.cache.remember("icon-box",(()=>s.Dom.create("div",{props:{className:"side-panel-label-icon-box"},children:[this.getIconContainer()]})))}},{key:"getIconContainer",value:function e(){return this.cache.remember("icon-container",(()=>s.Dom.create("div",{props:{className:`side-panel-label-icon ${this.getIconClass()}`}})))}},{key:"showIcon",value:function e(){s.Dom.removeClass(this.getContainer(),"side-panel-label-icon--hide")}},{key:"hideIcon",value:function e(){s.Dom.addClass(this.getContainer(),"side-panel-label-icon--hide")}},{key:"darkenIcon",value:function e(){s.Dom.addClass(this.getContainer(),"side-panel-label-icon--darken")}},{key:"lightenIcon",value:function e(){s.Dom.removeClass(this.getContainer(),"side-panel-label-icon--darken")}},{key:"hideText",value:function e(){s.Dom.addClass(this.getTextContainer(),"side-panel-label-text-hidden")}},{key:"showText",value:function e(){s.Dom.removeClass(this.getTextContainer(),"side-panel-label-text-hidden")}},{key:"isTextHidden",value:function e(){return s.Dom.hasClass(this.getTextContainer(),"side-panel-label-text-hidden")}},{key:"getTextContainer",value:function e(){return this.cache.remember("text-container",(()=>s.Dom.create("span",{props:{className:"side-panel-label-text"}})))}},{key:"setColor",value:function e(t){if(s.Type.isStringFilled(t)||t===null){this.color=t;s.Dom.style(this.getTextContainer(),"color",this.color);s.Dom.style(this.getIconContainer(),"--ui-icon-set__icon-color",this.color)}}},{key:"getColor",value:function e(){return this.color}},{key:"setBgColor",value:function e(t,i){let n=s.Type.isArray(t)?t[0]:t;let l=s.Type.isArray(t)?t[1]:i;if(s.Type.isStringFilled(n)){const e=n.match(/^#([\dA-Fa-f]{6}|[\dA-Fa-f]{3})$/);if(e){let t=e[1];if(t.length===3){t=t.replaceAll(/([\da-f])/gi,"$1$1")}l=s.Type.isNumber(l)&&l>=0&&l<=100?l:95;const i=`0${Math.round(255*(l/100)).toString(16)}`.slice(-2).toUpperCase();n=`#${t}${i}`}this.bgColor=n;s.Dom.style(this.getContainer(),"--ui-color",n);if(this.getColor()===null){s.Dom.style(this.getIconContainer(),"--ui-icon-set__icon-color","#fff")}}else if(n===null){this.bgColor=null;s.Dom.style(this.getContainer(),"--ui-color",null);s.Dom.style(this.getIconContainer(),"--ui-icon-set__icon-color",null)}}},{key:"getBgColor",value:function e(){return this.bgColor}},{key:"setText",value:function e(t){if(s.Type.isStringFilled(t)){this.text=t;this.getTextContainer().textContent=t}else if(t===null){this.text=t;this.getTextContainer().textContent=""}}},{key:"getText",value:function e(){return this.text}},{key:"setClassName",value:function e(t){if(s.Type.isStringFilled(t)){s.Dom.removeClass(this.getContainer(),this.className);this.className=t;s.Dom.addClass(this.getContainer(),this.className)}else if(t===null){s.Dom.removeClass(this.getContainer(),this.className);this.className=t}}},{key:"getClassName",value:function e(){return this.className}},{key:"setIconClass",value:function e(t){if(s.Type.isStringFilled(t)){s.Dom.removeClass(this.getIconContainer(),this.iconClass);this.iconClass=t;s.Dom.addClass(this.getIconContainer(),this.iconClass)}else if(t===null){s.Dom.removeClass(this.getIconContainer(),this.iconClass);this.iconClass=t}}},{key:"getIconClass",value:function e(){return this.iconClass}},{key:"setIconTitle",value:function e(t){if(s.Type.isStringFilled(t)||t===null){s.Dom.attr(this.getIconBox(),"title",t);this.iconTitle=t}}},{key:"getIconTitle",value:function e(){return this.iconTitle}},{key:"isHidden",value:function e(){return this.hidden}},{key:"hide",value:function e(){this.hidden=true;s.Dom.addClass(this.getContainer(),"--hidden")}},{key:"show",value:function e(){this.hidden=false;s.Dom.removeClass(this.getContainer(),"--hidden")}},{key:"isVisible",value:function e(){return this.visible}},{key:"setVisible",value:function e(t=true){s.Dom.toggleClass(this.getContainer(),"--visible",t)}},{key:"setOnclick",value:function e(t){if(s.Type.isFunction(t)||t===null){this.onclick=t}}},{key:"getOnclick",value:function e(){return this.onclick}},{key:"getSlider",value:function e(){return this.slider}},{key:"moveAt",value:function e(t){if(s.Type.isNumber(t)&&t>=0){s.Dom.style(this.getSlider().getLabelsContainer(),"top",`${this.constructor.MIN_TOP_OFFSET+t*this.constructor.INTERVAL_TOP_OFFSET}px`)}}}]);return e}();function y(e){e.stopPropagation();const t=this.getOnclick();if(t){t(this,this.getSlider())}}babelHelpers.defineProperty(g,"MIN_LEFT_OFFSET",25);babelHelpers.defineProperty(g,"MIN_TOP_OFFSET",17);babelHelpers.defineProperty(g,"INTERVAL_TOP_OFFSET",50);let v=function(){function e(){babelHelpers.classCallCheck(this,e);this.slider=null;this.action=true;this.name=null}babelHelpers.createClass(e,[{key:"allowAction",value:function e(){this.action=true}},{key:"denyAction",value:function e(){this.action=false}},{key:"isActionAllowed",value:function e(){return this.action}},{key:"getSliderPage",value:function e(){return this.slider}},{key:"getSlider",value:function e(){return this.slider}},{key:"setSlider",value:function e(t){if(t instanceof U){this.slider=t}}},{key:"getName",value:function e(){return this.name}},{key:"setName",value:function e(t){if(s.Type.isStringFilled(t)){this.name=t}}},{key:"getFullName",value:function e(){return U.getEventFullName(this.getName())}}]);return e}();let b=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));const n=s.Type.isPlainObject(e)?e:{};if(!(n.sender instanceof U)){throw new TypeError("'sender' is not an instance of BX.SidePanel.Slider")}i.setName("onMessage");i.setSlider(n.slider);i.sender=n.sender;i.data="data"in n?n.data:null;i.eventId=s.Type.isStringFilled(n.eventId)?n.eventId:null;return i}babelHelpers.createClass(t,[{key:"getSlider",value:function e(){return this.slider}},{key:"getSender",value:function e(){return this.sender}},{key:"getData",value:function e(){return this.data}},{key:"getEventId",value:function e(){return this.eventId}}]);return t}(v);let C=e=>e,S,k,w;function T(e,t){A(e,t);t.add(e)}function E(e,t,i){A(e,t);t.set(e,i)}function A(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function O(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var F=new WeakMap;var P=new WeakMap;var B=new WeakMap;var D=new WeakMap;var M=new WeakMap;var L=new WeakMap;var I=new WeakMap;var x=new WeakMap;var N=new WeakMap;var H=new WeakMap;var W=new WeakSet;var R=new WeakSet;var z=new WeakSet;let U=function(){function e(i,n){babelHelpers.classCallCheck(this,e);T(this,z);T(this,R);T(this,W);E(this,F,{writable:true,value:new t.MemoryCache});E(this,P,{writable:true,value:"right"});E(this,B,{writable:true,value:null});E(this,D,{writable:true,value:null});E(this,M,{writable:true,value:null});E(this,L,{writable:true,value:{}});E(this,I,{writable:true,value:false});E(this,x,{writable:true,value:"--ui-context-content-light"});E(this,N,{writable:true,value:null});E(this,H,{writable:true,value:true});const l=s.Type.isPlainObject(n)?n:{};this.contentCallback=s.Type.isFunction(l.contentCallback)?l.contentCallback:null;this.contentCallbackInvoved=false;this.contentClassName=s.Type.isStringFilled(l.contentClassName)?l.contentClassName:null;this.containerClassName=s.Type.isStringFilled(l.containerClassName)?l.containerClassName:null;this.overlayClassName=s.Type.isStringFilled(l.overlayClassName)?l.overlayClassName:null;this.url=this.contentCallback?i:this.refineUrl(i);this.offset=null;this.hideControls=l.hideControls===true;this.width=s.Type.isNumber(l.width)?l.width:null;this.cacheable=l.cacheable!==false;this.autoFocus=l.autoFocus!==false;this.printable=l.printable===true;this.allowChangeHistory=s.Type.isBoolean(l.allowChangeHistory)?l.allowChangeHistory:null;this.allowChangeTitle=s.Type.isBoolean(l.allowChangeTitle)?l.allowChangeTitle:null;this.allowCrossOrigin=l.allowCrossOrigin===true;this.data=new d(s.Type.isPlainObject(l.data)?l.data:{});this.customLeftBoundary=null;this.customRightBoundary=null;this.setCustomLeftBoundary(l.customLeftBoundary);this.setCustomRightBoundary(l.customRightBoundary);this.title=null;this.setTitle(l.title);this.iframe=null;this.iframeSrc=null;this.iframeId=null;this.requestMethod=s.Type.isStringFilled(l.requestMethod)&&l.requestMethod.toLowerCase()==="post"?"post":"get";this.requestParams=s.Type.isPlainObject(l.requestParams)?l.requestParams:{};this.opened=false;this.hidden=false;this.destroyed=false;this.loaded=false;this.loadedCnt=0;this.minimizing=false;this.maximizing=false;this.handleFrameKeyDown=this.handleFrameKeyDown.bind(this);this.handleFrameFocus=this.handleFrameFocus.bind(this);this.handleFrameUnload=this.handleFrameUnload.bind(this);this.handlePopupInit=this.handlePopupInit.bind(this);this.handleCrossOriginWindowMessage=this.handleCrossOriginWindowMessage.bind(this);this.layout={overlay:null,container:null,loader:null,content:null};this.skeleton=l.skeleton;this.loader=s.Type.isStringFilled(l.loader)||s.Type.isElementNode(l.loader)?l.loader:s.Type.isStringFilled(l.typeLoader)?l.typeLoader:"default-loader";this.animation=null;this.animationDuration=s.Type.isNumber(l.animationDuration)?l.animationDuration:200;this.overlayBgColor=s.Type.isStringFilled(l.overlayBgColor)&&/^#[\dA-Za-f]{6}$/.test(l.overlayBgColor)?l.overlayBgColor:"#000000";this.overlayOpacity=s.Type.isNumber(l.overlayOpacity)?Math.min(Math.max(l.overlayOpacity,0),100):40;this.overlayBgCallback=s.Type.isFunction(l.overlayBgCallback)?l.overlayBgCallback:null;babelHelpers.classPrivateFieldSet(this,P,["right","bottom","top"].includes(l.startPosition)?l.startPosition:babelHelpers.classPrivateFieldGet(this,P));babelHelpers.classPrivateFieldSet(this,L,s.Type.isPlainObject(l.outerBoundary)?l.outerBoundary:{});babelHelpers.classPrivateFieldSet(this,B,O(this,R,j).call(this,"start"));babelHelpers.classPrivateFieldSet(this,D,O(this,R,j).call(this,"end"));babelHelpers.classPrivateFieldSet(this,M,null);this.overlayAnimation=false;this.animationName="sliding";this.animationOptions={};this.minimizeOptions=null;this.setMinimizeOptions(l.minimizeOptions);this.setToolbarOnOpen(l.hideToolbarOnOpen);this.setDesignSystemContext(l.designSystemContext);this.setAutoOffset(l.autoOffset);this.label=new g(this,{className:"--close-label --ui-hoverable",iconClass:"side-panel-label-icon-close ui-icon-set --cross-l",iconTitle:s.Loc.getMessage("MAIN_SIDEPANEL_CLOSE"),onclick(e,t){t.close()}});const o=s.Type.isPlainObject(l.label)?l.label:{};this.label.setText(o.text);this.label.setColor(o.color);this.label.setBgColor(o.bgColor,o.opacity);this.minimizeLabel=new g(this,{className:"--ui-hoverable",iconClass:"side-panel-label-icon-minimize ui-icon-set --o-minimize",iconTitle:s.Loc.getMessage("MAIN_SIDEPANEL_MINIMIZE"),onclick:(e,t)=>{if(this.isLoaded()){this.minimize()}},visible:this.areMinimizeOptionsValid(this.minimizeOptions)});this.newWindowLabel=null;this.copyLinkLabel=null;this.printLabel=null;if(l.newWindowLabel===true&&(this.canChangeHistory()||s.Type.isStringFilled(l.newWindowUrl))){this.newWindowLabel=new g(this,{className:"--ui-hoverable",iconClass:"side-panel-label-icon-new-window ui-icon-set --go-to-l",iconTitle:s.Loc.getMessage("MAIN_SIDEPANEL_NEW_WINDOW"),onclick(e,t){const i=s.Type.isStringFilled(l.newWindowUrl)?l.newWindowUrl:t.getUrl();Object.assign(document.createElement("a"),{target:"_blank",href:i}).click()}})}if(l.copyLinkLabel===true&&(this.canChangeHistory()||s.Type.isStringFilled(l.newWindowUrl))){this.copyLinkLabel=new g(this,{className:"--ui-hoverable",iconClass:"side-panel-label-icon-copy-link ui-icon-set --o-link",iconTitle:s.Loc.getMessage("MAIN_SIDEPANEL_COPY_LINK")});BX.clipboard.bindCopyClick(this.copyLinkLabel.getIconBox(),{text:()=>{const e=document.createElement("a");e.href=s.Type.isStringFilled(l.newWindowUrl)?l.newWindowUrl:this.getUrl();return e.href}})}this.printLabel=new g(this,{hidden:!this.isPrintable(),className:"--side-panel-label-print --ui-hoverable",iconClass:"side-panel-label-icon-print ui-icon-set --o-printer",iconTitle:s.Loc.getMessage("MAIN_SIDEPANEL_PRINT"),onclick:this.handlePrintBtnClick.bind(this)});if(this.url.includes("crm.activity.planner/slider.php")&&l.events&&s.Type.isFunction(l.events.onOpen)&&l.events.compatibleEvents!==false){const e=l.events.onOpen;delete l.events.onOpen;l.events.onLoad=function(t){e(t.getSlider())}}[l.events].flat().forEach((e=>O(this,W,$).call(this,e)))}babelHelpers.createClass(e,[{key:"open",value:function e(){if(this.isOpen()){return false}if(!this.canOpen()){return false}if(this.isDestroyed()){return false}if(this.maximizing){this.fireEvent("onMaximizeStart")}this.createLayout();s.Dom.removeClass(this.getOverlay(),"--closing");s.Dom.addClass(this.getOverlay(),"--opening");this.adjustLayout();i.ZIndexManager.bringToFront(this.getOverlay());this.opened=true;this.fireEvent("onOpenStart");this.animateOpening();return true}},{key:"close",value:function e(t,i){if(!this.isOpen()){return false}if(!this.canClose()){return false}if(this.minimizing){this.fireEvent("onMinimizeStart")}this.fireEvent("onCloseStart");this.opened=false;if(this.isDestroyed()){return false}if(this.animation){this.animation.stop()}s.Dom.removeClass(this.getOverlay(),"--opening");s.Dom.addClass(this.getOverlay(),"--closing");this.fireEvent("onClosing");if(t===true||s.Browser.isMobile()){babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,B));this.completeAnimation(i)}else{this.animation=new s.Easing({duration:this.animationDuration,start:babelHelpers.classPrivateFieldGet(this,M),finish:babelHelpers.classPrivateFieldGet(this,B),step:e=>{babelHelpers.classPrivateFieldSet(this,M,e);this.animateStep(e)},complete:()=>{this.completeAnimation(i)}});s.Dom.style(this.getContainer(),"opacity",.96);if(this.animationName==="scale"&&s.Type.isStringFilled(this.animationOptions.origin)){s.Dom.style(this.getContainer(),"transform-origin",this.animationOptions.origin)}this.animation.animate()}return true}},{key:"minimize",value:function e(t,i){this.minimizing=true;const n=this.close(t,i);if(!n){this.minimizing=false}return n}},{key:"isMinimizing",value:function e(){return this.minimizing}},{key:"maximize",value:function e(){this.maximizing=true;const t=this.open();if(!t){this.maximizing=false}return t}},{key:"isMaximizing",value:function e(){return this.maximizing}},{key:"setAnimation",value:function e(t,i){this.animationName=t==="scale"?t:"sliding";this.animationOptions=s.Type.isPlainObject(i)?i:{}}},{key:"setMinimizeOptions",value:function e(t){var i;const n=this.areMinimizeOptionsValid(t);this.minimizeOptions=t;(i=this.minimizeLabel)===null||i===void 0?void 0:i.setVisible(n)}},{key:"areMinimizeOptionsValid",value:function e(t){return s.Type.isPlainObject(t)&&s.Type.isStringFilled(t.entityType)&&(s.Type.isStringFilled(t.entityId)||s.Type.isNumber(t.entityId))&&s.Type.isStringFilled(t.url)}},{key:"getMinimizeOptions",value:function e(){return this.minimizeOptions}},{key:"setToolbarOnOpen",value:function e(t){if(s.Type.isBoolean(t)){babelHelpers.classPrivateFieldSet(this,I,t)}}},{key:"shouldHideToolbarOnOpen",value:function e(){return babelHelpers.classPrivateFieldGet(this,I)}},{key:"getDesignSystemContext",value:function e(){return babelHelpers.classPrivateFieldGet(this,x)}},{key:"setDesignSystemContext",value:function e(t){if(s.Type.isString(t)){if(this.layout.container!==null){s.Dom.removeClass(this.layout.container,babelHelpers.classPrivateFieldGet(this,x));s.Dom.addClass(this.layout.container,t)}babelHelpers.classPrivateFieldSet(this,x,t)}}},{key:"getUrl",value:function e(){return this.url}},{key:"setUrl",value:function e(t){if(s.Type.isStringFilled(t)){this.url=t}}},{key:"focus",value:function e(){this.getWindow().focus()}},{key:"isOpen",value:function e(){return this.opened}},{key:"getStartPosition",value:function e(){return babelHelpers.classPrivateFieldGet(this,P)}},{key:"setZindex",value:function e(t){}},{key:"getZindex",value:function e(){return this.getZIndexComponent().getZIndex()}},{key:"getZIndexComponent",value:function e(){return babelHelpers.classPrivateFieldGet(this,N)}},{key:"setOffset",value:function e(t){if(s.Type.isNumber(t)||t===null){this.offset=t}}},{key:"getOffset",value:function e(){return this.offset}},{key:"setAutoOffset",value:function e(t){if(s.Type.isBoolean(t)){babelHelpers.classPrivateFieldSet(this,H,t)}}},{key:"shouldUseAutoOffset",value:function e(){return babelHelpers.classPrivateFieldGet(this,H)}},{key:"setWidth",value:function e(t){if(s.Type.isNumber(t)){this.width=t}}},{key:"getWidth",value:function e(){return this.width}},{key:"setTitle",value:function e(t){if(s.Type.isStringFilled(t)){this.title=t}}},{key:"getTitle",value:function e(){return this.title}},{key:"getData",value:function e(){return this.data}},{key:"isSelfContained",value:function e(){return this.contentCallback!==null}},{key:"isPostMethod",value:function e(){return this.requestMethod==="post"}},{key:"getRequestParams",value:function e(){return this.requestParams}},{key:"getFrameId",value:function e(){if(this.iframeId===null){this.iframeId=`iframe_${s.Text.getRandom(10).toLowerCase()}`}return this.iframeId}},{key:"getWindow",value:function e(){return this.iframe?this.iframe.contentWindow:window}},{key:"getFrameWindow",value:function e(){return this.iframe?this.iframe.contentWindow:null}},{key:"isHidden",value:function e(){return this.hidden}},{key:"isCacheable",value:function e(){return this.cacheable}},{key:"isFocusable",value:function e(){return this.autoFocus}},{key:"isPrintable",value:function e(){return this.printable}},{key:"isDestroyed",value:function e(){return this.destroyed}},{key:"isLoaded",value:function e(){return this.loaded}},{key:"canChangeHistory",value:function e(){if(this.allowCrossOrigin||/^\/bitrix\/(components|tools)\//i.test(this.getUrl())){return false}if(this.allowChangeHistory===null){return!this.isSelfContained()}return this.allowChangeHistory}},{key:"canChangeTitle",value:function e(){if(this.allowChangeTitle===null){if(this.getTitle()!==null){return true}return this.canChangeHistory()}return this.allowChangeTitle}},{key:"setCacheable",value:function e(t=true){this.cacheable=t!==false}},{key:"setAutoFocus",value:function e(t=true){this.autoFocus=t!==false}},{key:"setPrintable",value:function e(t=true){this.printable=t!==false;if(this.printable){this.showPrintBtn()}else{this.hidePrintBtn()}}},{key:"getLoader",value:function e(){return this.loader}},{key:"showLoader",value:function e(){if(!this.layout.loader){this.createLoader(this.loader,this.skeleton)}s.Dom.style(this.layout.loader,{opacity:1,display:"block"})}},{key:"closeLoader",value:function e(){if(this.layout.loader){s.Dom.style(this.layout.loader,{opacity:0,display:"none"})}}},{key:"showCloseBtn",value:function e(){this.getLabel().show()}},{key:"hideCloseBtn",value:function e(){this.getLabel().hide()}},{key:"showOrLightenCloseBtn",value:function e(){if(s.Type.isStringFilled(this.getLabel().getText())){this.getLabel().showIcon()}else{this.getLabel().lightenIcon()}}},{key:"hideOrDarkenCloseBtn",value:function e(){if(s.Type.isStringFilled(this.getLabel().getText())){this.getLabel().hideIcon()}else{this.getLabel().darkenIcon()}}},{key:"showPrintBtn",value:function e(){if(this.printLabel!==null){this.printLabel.show()}}},{key:"hidePrintBtn",value:function e(){if(this.printLabel!==null){this.printLabel.hide()}}},{key:"showExtraLabels",value:function e(){s.Dom.removeClass(this.getExtraLabelsContainer(),"--hidden")}},{key:"hideExtraLabels",value:function e(){s.Dom.addClass(this.getExtraLabelsContainer(),"--hidden")}},{key:"setContentClass",value:function e(t){if(s.Type.isStringFilled(t)){this.removeContentClass();this.contentClassName=t;s.Dom.addClass(this.getContentContainer(),t)}}},{key:"removeContentClass",value:function e(){if(this.contentClassName!==null){s.Dom.removeClass(this.getContentContainer(),this.contentClassName);this.contentClassName=null}}},{key:"setContainerClass",value:function e(t){if(s.Type.isStringFilled(t)){this.removeContainerClass();this.containerClassName=t;s.Dom.addClass(this.getContainer(),t)}}},{key:"removeContainerClass",value:function e(){if(this.containerClassName!==null){s.Dom.removeClass(this.getContainer(),this.containerClassName);this.containerClassName=null}}},{key:"setOverlayClass",value:function e(t){if(s.Type.isStringFilled(t)){this.removeOverlayClass();this.overlayClassName=t;s.Dom.addClass(this.getOverlay(),t)}}},{key:"removeOverlayClass",value:function e(){if(this.overlayClassName!==null){s.Dom.removeClass(this.getOverlay(),this.overlayClassName);this.overlayClassName=null}}},{key:"applyHacks",value:function e(){}},{key:"applyPostHacks",value:function e(){}},{key:"resetHacks",value:function e(){}},{key:"resetPostHacks",value:function e(){}},{key:"getTopBoundary",value:function e(){return 0}},{key:"calculateLeftBoundary",value:function e(){const t=this.getCustomLeftBoundary();if(t!==null){return t}return this.getLeftBoundary()}},{key:"getLeftBoundary",value:function e(){const t=s.Browser.isMobile()?window.innerWidth:document.documentElement.clientWidth;return t<1160?this.getMinLeftBoundary():300}},{key:"getMinLeftBoundary",value:function e(){return this.hideControls&&this.getCustomLeftBoundary()!==null?0:65}},{key:"getLeftBoundaryOffset",value:function e(){const t=this.getOffset()===null?0:this.getOffset();return Math.max(this.calculateLeftBoundary(),this.getMinLeftBoundary())+t}},{key:"setCustomLeftBoundary",value:function e(t){if(s.Type.isNumber(t)||t===null){this.customLeftBoundary=t}}},{key:"getCustomLeftBoundary",value:function e(){return this.customLeftBoundary}},{key:"setCustomRightBoundary",value:function e(t){if(s.Type.isNumber(t)||t===null){this.customRightBoundary=t}}},{key:"getCustomRightBoundary",value:function e(){return this.customRightBoundary}},{key:"calculateRightBoundary",value:function e(){const t=this.getCustomRightBoundary();if(t!==null){return-window.pageXOffset+t}return this.getRightBoundary()}},{key:"getRightBoundary",value:function e(){return-window.pageXOffset}},{key:"getOuterBoundary",value:function e(){return babelHelpers.classPrivateFieldGet(this,L)}},{key:"calculateOuterBoundary",value:function e(){}},{key:"destroy",value:function e(){if(this.isDestroyed()){return false}this.firePageEvent("onDestroy");this.fireFrameEvent("onDestroy");const t=this.getFrameWindow();if(t&&!this.allowCrossOrigin){s.Event.unbind(t,"keydown",this.handleFrameKeyDown);s.Event.unbind(t,"focus",this.handleFrameFocus);s.Event.unbind(t,"unload",this.handleFrameUnload)}else if(this.allowCrossOrigin){s.Event.unbind(window,"message",this.handleCrossOriginWindowMessage)}l.EventEmitter.unsubscribe("BX.Main.Popup:onInit",this.handlePopupInit);i.ZIndexManager.unregister(this.layout.overlay);babelHelpers.classPrivateFieldSet(this,N,null);s.Dom.remove(this.layout.overlay);this.layout.container=null;this.layout.overlay=null;this.layout.content=null;this.layout.closeBtn=null;this.layout.loader=null;babelHelpers.classPrivateFieldSet(this,F,null);this.iframe=null;this.destroyed=true;l.EventEmitter.unsubscribeAll(this);this.firePageEvent("onDestroyComplete");return true}},{key:"hide",value:function e(){this.hidden=true;s.Dom.style(this.getContainer(),"display","none");s.Dom.style(this.getOverlay(),"display","none")}},{key:"unhide",value:function e(){this.hidden=false;s.Dom.style(this.getContainer(),"display",null);s.Dom.style(this.getOverlay(),"display",null)}},{key:"reload",value:function e(){this.loaded=false;if(this.isSelfContained()){this.contentCallbackInvoved=false;this.showLoader();this.setContent()}else{this.showLoader();this.getFrameWindow().location.reload()}}},{key:"adjustLayout",value:function e(){const t=window.pageYOffset||document.documentElement.scrollTop;const i=s.Browser.isMobile()?window.innerHeight:document.documentElement.clientHeight;let n=this.getTopBoundary();const l=n-t>0;n=l?n:t;const o=l>0?i-n+t:i;const a=this.getLeftBoundaryOffset();const r=this.calculateRightBoundary();s.Dom.style(this.getOverlay(),{left:`${window.pageXOffset}px`,top:`${n}px`,right:`${r}px`,height:`${o}px`});const{right:u=null,top:h=null,bottom:d=null}=O(this,z,X).call(this);s.Dom.style(this.getContainer(),{width:`calc(100% - ${a+(u===null?0:u)}px)`,maxWidth:this.getWidth()===null?null:`${this.getWidth()}px`,right:u===null?null:`${u}px`,top:h===null?null:`${h}px`,bottom:d===null?null:`${d}px`});this.getLabel().adjustLayout()}},{key:"createLayout",value:function e(){if(this.layout.overlay!==null&&this.layout.overlay.parentNode){return}if(this.isSelfContained()){s.Dom.addClass(this.getOverlay(),"--self-contained");s.Dom.append(this.getOverlay(),document.body);this.setContent();l.EventEmitter.subscribe("BX.Main.Popup:onInit",this.handlePopupInit)}else{s.Dom.append(this.getFrame(),this.getContentContainer());s.Dom.append(this.getOverlay(),document.body);this.setFrameSrc()}babelHelpers.classPrivateFieldSet(this,N,i.ZIndexManager.register(this.getOverlay()))}},{key:"getFrame",value:function e(){if(this.iframe!==null){return this.iframe}this.iframe=s.Dom.create("iframe",{attrs:{referrerpolicy:this.allowCrossOrigin?"strict-origin":false,src:"about:blank",frameborder:"0"},props:{className:"side-panel-iframe",name:this.getFrameId(),id:this.getFrameId()},events:{load:this.handleFrameLoad.bind(this)}});return this.iframe}},{key:"getOverlay",value:function e(){if(this.layout.overlay!==null){return this.layout.overlay}const t=this.overlayClassName===null?"":` ${this.overlayClassName}`;this.layout.overlay=s.Dom.create("div",{props:{className:`side-panel side-panel-overlay${t}`},events:{mousedown:this.handleOverlayClick.bind(this)},children:[this.getContainer()]});return this.layout.overlay}},{key:"unhideOverlay",value:function e(){s.Dom.removeClass(this.getOverlay(),"--hidden")}},{key:"hideOverlay",value:function e(){s.Dom.addClass(this.getOverlay(),"--hidden")}},{key:"hideShadow",value:function e(){s.Dom.removeClass(this.getContainer(),"side-panel-show-shadow")}},{key:"showShadow",value:function e(){s.Dom.addClass(this.getContainer(),"side-panel-show-shadow")}},{key:"setOverlayBackground",value:function e(){if(this.overlayBgCallback===null){const e=parseInt(this.overlayOpacity/100*255,10).toString(16).padStart(2,0);s.Dom.style(this.getOverlay(),"background-color",`${this.overlayBgColor}${e}`)}else{const e=O(this,R,j).call(this,"end");s.Dom.style(this.getOverlay(),"background",this.overlayBgCallback(e,this))}}},{key:"setOverlayAnimation",value:function e(t){if(s.Type.isBoolean(t)){this.overlayAnimation=t}}},{key:"getOverlayAnimation",value:function e(){return this.overlayAnimation}},{key:"getOverlayBgColor",value:function e(){return this.overlayBgColor}},{key:"getOverlayOpacity",value:function e(){return this.overlayOpacity}},{key:"getContainer",value:function e(){if(this.layout.container!==null){return this.layout.container}const t=s.Tag.render(S||(S=C`
			<div class="side-panel-content-wrapper">${0}</div>
		`),this.getContentContainer());this.layout.container=s.Tag.render(k||(k=C`
			<div class="side-panel side-panel-container">
				${0}
			</div>
		`),this.hideControls?t:[t,this.getLabelsContainer()]);s.Dom.addClass(this.layout.container,this.getDesignSystemContext());s.Dom.addClass(this.layout.container,this.containerClassName);return this.layout.container}},{key:"getContentContainer",value:function e(){if(this.layout.content!==null){return this.layout.content}const t=this.contentClassName===null?"":` ${this.contentClassName}`;this.layout.content=s.Dom.create("div",{props:{className:`side-panel-content-container${t}`}});return this.layout.content}},{key:"getLabelsContainer",value:function e(){return babelHelpers.classPrivateFieldGet(this,F).remember("labels-container",(()=>s.Dom.create("div",{props:{className:"side-panel-labels"},children:[this.getLabel().getContainer(),this.getExtraLabelsContainer()]})))}},{key:"getExtraLabelsContainer",value:function e(){return babelHelpers.classPrivateFieldGet(this,F).remember("icon-labels",(()=>s.Dom.create("div",{props:{className:"side-panel-extra-labels"},children:[this.copyLinkLabel?this.copyLinkLabel.getContainer():null,this.minimizeLabel.getContainer(),this.newWindowLabel?this.newWindowLabel.getContainer():null,this.printLabel?this.printLabel.getContainer():null]})))}},{key:"getCloseBtn",value:function e(){return this.getLabel().getIconBox()}},{key:"getLabel",value:function e(){return this.label}},{key:"getNewWindowLabel",value:function e(){return this.newWindowLabel}},{key:"getCopyLinkLabel",value:function e(){return this.copyLinkLabel}},{key:"getMinimizeLabel",value:function e(){return this.minimizeLabel}},{key:"getPrintLabel",value:function e(){return this.printLabel}},{key:"setContent",value:function e(){if(this.contentCallbackInvoved){return}this.contentCallbackInvoved=true;s.Dom.clean(this.getContentContainer());let t=this.contentCallback(this);const i=t&&(Object.prototype.toString.call(t)==="[object Promise]"||t.toString()==="[object BX.Promise]");if(!i){t=Promise.resolve(t)}t.then((e=>{if(this.isDestroyed()){return}if(s.Type.isPlainObject(e)&&s.Type.isStringFilled(e.html)){s.Runtime.html(this.getContentContainer(),e.html).then((()=>{this.removeLoader();this.loaded=true;this.firePageEvent("onLoad")})).catch((e=>{this.removeLoader();this.getContentContainer().innerHTML=e}))}else{if(s.Type.isDomNode(e)){s.Dom.append(e,this.getContentContainer())}else if(s.Type.isStringFilled(e)){this.getContentContainer().innerHTML=e}this.removeLoader();this.loaded=true;this.firePageEvent("onLoad")}})).catch((e=>{this.removeLoader();this.getContentContainer().innerHTML=e}))}},{key:"setFrameSrc",value:function e(){if(this.iframeSrc===this.getUrl()){return}const t=s.Uri.addParam(this.getUrl(),{IFRAME:"Y",IFRAME_TYPE:"SIDE_SLIDER"});if(this.isPostMethod()){const e=document.createElement("form");e.method="POST";e.action=t;e.target=this.getFrameId();s.Dom.style(e,"display","none");BX.util.addObjectToForm(this.getRequestParams(),e);s.Dom.append(e,document.body);e.submit();s.Dom.remove(e)}else{this.iframeSrc=this.getUrl();this.iframe.src=t}this.loaded=false;this.listenIframeLoading()}},{key:"createLoader",value:function e(t,i){s.Dom.remove(this.layout.loader);const l=s.Type.isStringFilled(t)||s.Type.isElementNode(t)?t:"default-loader";const o=["task-new-loader","task-edit-loader","task-view-loader","crm-entity-details-loader","crm-button-view-loader","crm-webform-view-loader","create-mail-loader","view-mail-loader"];if(s.Type.isStringFilled(i)){this.layout.loader=s.Tag.render(w||(w=C`<div style="height: 100%;"></div>`));void n.renderSkeleton(i,this.layout.loader)}else if(s.Type.isElementNode(l)){this.layout.loader=this.createHTMLLoader(l)}else if(o.includes(l)&&this.loaderExists(l)){this.layout.loader=this.createOldLoader(l)}else if(l.charAt(0)==="/"){this.layout.loader=this.createSvgLoader(l)}else{const e=l.match(/^([\w.-]+):([\w.-]+)$/i);if(e){const t=e[1];const i=e[2];const n=`/bitrix/images/${t}/slider/${i}.svg`;this.layout.loader=this.createSvgLoader(n)}else{this.layout.loader=this.createDefaultLoader()}}s.Dom.append(this.layout.loader,this.getContainer())}},{key:"createSvgLoader",value:function e(t){return s.Dom.create("div",{props:{className:"side-panel-loader"},children:[s.Dom.create("div",{props:{className:"side-panel-loader-container"},style:{backgroundImage:`url("${t}")`}})]})}},{key:"createDefaultLoader",value:function e(){return s.Dom.create("div",{props:{className:"side-panel-loader"},children:[s.Dom.create("div",{props:{className:"side-panel-default-loader-container"},html:'<svg class="side-panel-default-loader-circular" viewBox="25 25 50 50">'+"<circle "+'class="side-panel-default-loader-path" '+'cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"'+"/>"+"</svg>"})]})}},{key:"createOldLoader",value:function e(t){if(t==="crm-entity-details-loader"){return s.Dom.create("div",{props:{className:`side-panel-loader ${t}`},children:[s.Dom.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX"+"///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"side-panel-loader-mask top"}}),s.Dom.create("div",{props:{className:"side-panel-loader-bg left"},children:[s.Dom.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1B"+"MVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"side-panel-loader-mask left"}})]}),s.Dom.create("div",{props:{className:"side-panel-loader-bg right"},children:[s.Dom.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BM"+"VEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"side-panel-loader-mask right"}})]})]})}return s.Dom.create("div",{props:{className:`side-panel-loader ${t}`},children:[s.Dom.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX"+"///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"side-panel-loader-mask left"}}),s.Dom.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA"+"1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"side-panel-loader-mask right"}})]})}},{key:"createHTMLLoader",value:function e(t){return s.Dom.create("div",{children:[t]})}},{key:"loaderExists",value:function e(t){if(!s.Type.isStringFilled(t)){return false}for(let e=0;e<document.styleSheets.length;e++){const i=document.styleSheets[e];if(!s.Type.isStringFilled(i.href)||!i.href.includes("sidepanel")){continue}let n=null;try{n=i.rules||i.cssRules}catch{try{n=i.cssRules}catch{n=[]}}for(const e of n){if(s.Type.isStringFilled(e.selectorText)&&e.selectorText.includes(t)){return true}}}return false}},{key:"removeLoader",value:function e(){s.Dom.remove(this.layout.loader);this.layout.loader=null}},{key:"animateOpening",value:function e(){if(this.animation){this.animation.stop()}this.fireEvent("onOpening");if(s.Browser.isMobile()){babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,D));this.animateStep(babelHelpers.classPrivateFieldGet(this,M));this.completeAnimation();return}babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,M)===null?babelHelpers.classPrivateFieldGet(this,B):babelHelpers.classPrivateFieldGet(this,M));if(this.skeleton){this.showLoader()}this.animation=new s.Easing({duration:this.animationDuration,start:babelHelpers.classPrivateFieldGet(this,M),finish:babelHelpers.classPrivateFieldGet(this,D),step:e=>{babelHelpers.classPrivateFieldSet(this,M,e);this.animateStep(e)},complete:()=>{this.completeAnimation()}});if(this.animationName==="scale"&&s.Type.isStringFilled(this.animationOptions.origin)){s.Dom.style(this.getContainer(),"transform-origin",this.animationOptions.origin)}this.animation.animate()}},{key:"animateStep",value:function e(t){if(this.animationName==="scale"){s.Dom.style(this.getContainer(),"transform",`scale(${t.scale/100})`)}else{s.Dom.style(this.getContainer(),"transform",`translate(${t.translateX}%, ${t.translateY}%)`)}if(this.getOverlayAnimation()){if(this.overlayBgCallback===null){const e=parseInt(t.opacity/100*255,10).toString(16).padStart(2,0);s.Dom.style(this.getOverlay(),"background-color",`${this.overlayBgColor}${e}`)}else{s.Dom.style(this.getOverlay(),"background",this.overlayBgCallback(t,this))}}}},{key:"completeAnimation",value:function e(t){this.animation=null;if(this.isOpen()){babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,D));this.maximizing=false;s.Dom.removeClass(this.getOverlay(),"--opening");s.Dom.addClass(this.getOverlay(),"--open");if(this.animationName==="scale"){const e=O(this,R,j).call(this,"end");s.Dom.style(this.getContainer(),{"transform-origin":null,transform:`translate(${e.translateX}%, ${e.translateY}%)`})}this.firePageEvent("onBeforeOpenComplete");this.fireFrameEvent("onBeforeOpenComplete");this.firePageEvent("onOpenComplete");this.fireFrameEvent("onOpenComplete");if(!this.isLoaded()){this.showLoader()}if(this.isFocusable()){this.focus()}}else{babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,B));this.minimizing=false;s.Dom.removeClass(this.getOverlay(),"--open --opening --closing");if(this.animationName==="scale"){const e=O(this,R,j).call(this,"start");s.Dom.style(this.getContainer(),{"transform-origin":null,transform:`translate(${e.translateX}%, ${e.translateY}%)`})}s.Dom.style(this.getContainer(),{width:null,right:null,opacity:null,"max-width":null,"min-width":null});s.Dom.style(this.getCloseBtn(),"opacity",null);this.firePageEvent("onBeforeCloseComplete");this.fireFrameEvent("onBeforeCloseComplete");this.firePageEvent("onCloseComplete");this.fireFrameEvent("onCloseComplete");if(s.Type.isFunction(t)){t(this)}if(!this.isCacheable()){this.destroy()}}}},{key:"firePageEvent",value:function e(t){const i=this.getEvent(t);if(i===null){throw new Error("'eventName' is invalid.")}l.EventEmitter.emit(this,i.getFullName().toLowerCase(),new l.BaseEvent({data:[i],compatData:[i]}));if(["onClose","onOpen"].includes(t)){l.EventEmitter.emit(`BX.Bitrix24.PageSlider:${t}`,new l.BaseEvent({data:[this],compatData:[this]}));l.EventEmitter.emit(`Bitrix24.Slider:${t}`,new l.BaseEvent({data:[this],compatData:[this]}))}return i}},{key:"fireFrameEvent",value:function e(t){const i=this.getEvent(t);if(i===null){throw new Error("'eventName' is invalid.")}if(this.allowCrossOrigin){return null}const n=this.getFrameWindow();if(n&&n.BX&&n.BX.onCustomEvent){n.BX.onCustomEvent(this,i.getFullName(),[i]);if(["onClose","onOpen"].includes(t)){n.BX.onCustomEvent(`BX.Bitrix24.PageSlider:${t}`,[this]);n.BX.onCustomEvent(`Bitrix24.Slider:${t}`,[this])}}return i}},{key:"fireEvent",value:function e(t){this.firePageEvent(t);this.fireFrameEvent(t)}},{key:"getEvent",value:function e(t){let i=null;if(s.Type.isStringFilled(t)){i=new v;i.setSlider(this);i.setName(t)}else if(t instanceof v){i=t}return i}},{key:"canOpen",value:function e(){return this.canAction("open")}},{key:"canClose",value:function e(){return this.canAction("close")}},{key:"canCloseByEsc",value:function e(){return this.canAction("closeByEsc")}},{key:"canAction",value:function e(t){if(!s.Type.isStringFilled(t)){return false}const i=`on${t.charAt(0).toUpperCase()}${t.slice(1)}`;const n=this.firePageEvent(i);const l=this.fireFrameEvent(i);return n.isActionAllowed()&&(!l||l.isActionAllowed())}},{key:"handleCrossOriginWindowMessage",value:function e(t){const i=new URL(this.url);const n=new URL(t.origin);if(n.origin!==i.origin){return}const l={type:"",data:undefined};if(s.Type.isString(t.data)){l.type=t.data}else if(s.Type.isPlainObject(t.data)){l.type=t.data.type;l.data=t.data.data}switch(l.type){case"BX:SidePanel:close":{this.close();break}case"BX:SidePanel:load:force":{if(!this.isLoaded()&&!this.isDestroyed()){this.handleFrameLoad()}break}case"BX:SidePanel:data:send":{const e=new b({sender:this,data:l.data});e.setName("onXDomainMessage");this.firePageEvent(e);break}default:}}},{key:"handleFrameLoad",value:function e(t){if(this.loaded){return}const i=this.iframe.contentWindow;const n=i.location;if(this.allowCrossOrigin){s.Event.bind(window,"message",this.handleCrossOriginWindowMessage)}try{if(n.toString()==="about:blank"){return}}catch(e){if(this.allowCrossOrigin){this.loaded=true;this.closeLoader();return}console.warn('SidePanel: Try to use "allowCrossOrigin: true" option.');throw e}s.Event.bind(i,"keydown",this.handleFrameKeyDown);s.Event.bind(i,"focus",this.handleFrameFocus);s.Event.bind(i,"unload",this.handleFrameUnload);if(s.Browser.isMobile()){i.document.body.style.paddingBottom=`${window.innerHeight*2/3}px`}const l=n.pathname+n.search+n.hash;this.iframeSrc=this.refineUrl(l);this.url=this.iframeSrc;if(this.isPrintable()){this.injectPrintStyles()}this.loaded=true;this.loadedCnt++;if(this.loadedCnt>1){this.firePageEvent("onLoad");this.fireFrameEvent("onLoad");this.firePageEvent("onReload");this.fireFrameEvent("onReload")}else{this.firePageEvent("onLoad");this.fireFrameEvent("onLoad")}if(this.isFocusable()){this.focus()}this.closeLoader()}},{key:"listenIframeLoading",value:function e(){if(this.allowCrossOrigin){return}const t=setInterval((()=>{if(this.isLoaded()||this.isDestroyed()){clearInterval(t);return}if(this.iframe.contentWindow.location.toString()==="about:blank"){return}if(this.iframe.contentWindow.document.readyState==="complete"||this.iframe.contentWindow.document.readyState==="interactive"){clearInterval(t);this.handleFrameLoad()}}),200)}},{key:"handleFrameUnload",value:function e(t){this.loaded=false;this.listenIframeLoading()}},{key:"handleFrameKeyDown",value:function e(t){var i,n;if(t.keyCode!==27){return}const l=(i=this.getWindow().BX)===null||i===void 0?void 0:(n=i.Main)===null||n===void 0?void 0:n.PopupManager;if(l){const e=l.getPopups();for(const t of e){if(t.isShown()){return}}}const o=this.getWindow().document.documentElement.clientWidth/2;const a=this.getWindow().document.documentElement.clientHeight/2;const r=this.getWindow().document.elementFromPoint(o,a);if(s.Dom.hasClass(r,"bx-core-dialog-overlay")||s.Dom.hasClass(r,"bx-core-window")){return}if(r.closest(".bx-core-window")){return}this.firePageEvent("onEscapePress");this.fireFrameEvent("onEscapePress")}},{key:"isOnTopOfPopup",value:function e(t){const i=this.getZIndexComponent().getStack()===t.getZIndexComponent().getStack();const n=i&&t.getZindex()>this.getZindex();let s=this.getContainer().contains(t.getPopupContainer());if(this.getFrameWindow()){s=this.getFrameWindow().document.contains(t.getPopupContainer())}return!(t.isShown()&&(n||s))}},{key:"handlePopupInit",value:function e(t){const i=t.getCompatData();const n=i[1];const l=i[2];if(!s.Type.isElementNode(l.targetContainer)&&s.Type.isElementNode(n)&&this.getContentContainer().contains(n)){l.targetContainer=this.getContentContainer()}}},{key:"handleFrameFocus",value:function e(t){this.firePageEvent("onFrameFocus")}},{key:"handleOverlayClick",value:function e(t){if(t.target===this.getOverlay()){if(this.animation===null){this.close();t.stopPropagation()}else{t.preventDefault()}}}},{key:"handlePrintBtnClick",value:function e(t){if(this.isSelfContained()){const e=document.createElement("iframe");e.src="about:blank";e.name="sidepanel-print-frame";s.Dom.style(e,"display","none");s.Dom.append(e,document.body);const t=e.contentWindow;const i=t.document;i.open();i.write("<html><head>");let n="";const l=document.head.querySelectorAll("link, style");for(const e of l){n+=e.outerHTML}n+="<style>html, body { background: #fff !important; height: 100%; }</style>";i.write(n);i.write("</head><body>");i.write(this.getContentContainer().innerHTML);i.write("</body></html>");i.close();t.focus();t.print();setTimeout((()=>{s.Dom.remove(e);window.focus()}),1e3)}else{this.focus();this.getFrameWindow().print()}}},{key:"injectPrintStyles",value:function e(){const t=this.getFrameWindow().document;let i="";const n=t.body.classList;for(const e of n){i+=`.${e}`}const s=`@media print { body${i} { `+"background: #fff !important; "+"-webkit-print-color-adjust: exact;"+"color-adjust: exact; "+"} }";const l=t.createElement("style");l.type="text/css";if(l.styleSheet){l.styleSheet.cssText=s}else{l.appendChild(t.createTextNode(s))}t.head.appendChild(l)}},{key:"refineUrl",value:function e(t){if(s.Type.isStringFilled(t)&&/IFRAME/.test(t)){return s.Uri.removeParam(t,["IFRAME","IFRAME_TYPE"])}return t}}],[{key:"getEventFullName",value:function e(t){return`SidePanel.Slider:${t}`}}]);return e}();function $(e){if(s.Type.isPlainObject(e)){for(const[t,i]of Object.entries(e)){if(s.Type.isFunction(i)){l.EventEmitter.subscribe(this,U.getEventFullName(t),i,{compatMode:true})}}}}function j(e){const t={right:{start:{translateX:100,translateY:0,opacity:0,scale:0,progress:0,intensity:0},end:{translateX:0,translateY:0,opacity:this.overlayOpacity,scale:100,progress:100,intensity:255}},bottom:{start:{translateX:0,translateY:100,opacity:0,scale:0,progress:0,intensity:0},end:{translateX:0,translateY:0,opacity:this.overlayOpacity,scale:100,progress:100,intensity:255}},top:{start:{translateX:0,translateY:-100,opacity:0,scale:0,progress:0,intensity:0},end:{translateX:0,translateY:0,opacity:this.overlayOpacity,scale:100,progress:100,intensity:255}}};return t[babelHelpers.classPrivateFieldGet(this,P)][e]}function X(){const e=this.calculateOuterBoundary();return s.Runtime.merge(s.Type.isPlainObject(e)?e:{},this.getOuterBoundary())}let _=e=>e,G,V,q;let K=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));i.setEventNamespace("BX.Main.SidePanel.ToolbarItem");const n=s.Type.isPlainObject(e)?e:{};i.id=s.Type.isStringFilled(n.id)?n.id:`toolbar-item-${s.Text.getRandom().toLowerCase()}`;i.title="";i.url="";i.entityType="";i.entityId="0";i.entityName="";i.refs=new s.Cache.MemoryCache;i.rendered=false;i.setTitle(n.title);i.setUrl(n.url);i.setEntityType(n.entityType);i.setEntityId(n.entityId);return i}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.id}},{key:"getUrl",value:function e(){return this.url}},{key:"setUrl",value:function e(t){if(s.Type.isStringFilled(t)){this.url=t;if(this.rendered){this.getContainer().href=t}}}},{key:"getTitle",value:function e(){return this.title}},{key:"setTitle",value:function e(t){if(s.Type.isStringFilled(t)){this.title=t;if(this.rendered){this.getTitleContainer().textContent=t}}}},{key:"getEntityType",value:function e(){return this.entityType}},{key:"setEntityType",value:function e(t){if(s.Type.isStringFilled(t)){this.entityType=t}}},{key:"getEntityId",value:function e(){return this.entityId}},{key:"setEntityId",value:function e(t){if(s.Type.isNumber(t)||s.Type.isStringFilled(t)){this.entityId=String(t)}}},{key:"getEntityName",value:function e(){return this.entityName}},{key:"setEntityName",value:function e(t){if(s.Type.isStringFilled(t)){this.entityName=t}}},{key:"getContainer",value:function e(){return this.refs.remember("container",(()=>s.Tag.render(G||(G=_`
				<div 
					class="side-panel-toolbar-item"
					onmouseenter="${0}"
					onmouseleave="${0}"
				>
					${0}
					<div class="side-panel-toolbar-item-remove-btn" onclick="${0}">
						<div class="ui-icon-set --cross-20" style="--ui-icon-set__icon-size: 100%;"></div>
					</div>
				</div>
			`),this.handleMouseEnter.bind(this),this.handleMouseLeave.bind(this),this.getTitleContainer(),this.handleRemoveBtnClick.bind(this))))}},{key:"isRendered",value:function e(){return this.rendered}},{key:"getTitleContainer",value:function e(){return this.refs.remember("title",(()=>s.Tag.render(V||(V=_`
				<a 
					class="side-panel-toolbar-item-title"
					href="${0}"
					data-slider-maximize="true"
				>${0}</a>
			`),encodeURI(this.getUrl()),s.Text.encode(this.getTitle()))))}},{key:"prependTo",value:function e(t){if(s.Type.isDomNode(t)){s.Dom.prepend(this.getContainer(),t);this.rendered=true}}},{key:"appendTo",value:function e(t){if(s.Type.isDomNode(t)){s.Dom.append(this.getContainer(),t);this.rendered=true}}},{key:"insertBefore",value:function e(t){if(s.Type.isDomNode(t)){s.Dom.insertBefore(this.getContainer(),t);this.rendered=true}}},{key:"insertAfter",value:function e(t){if(s.Type.isDomNode(t)){s.Dom.insertAfter(this.getContainer(),t);this.rendered=true}}},{key:"remove",value:function e(){s.Dom.remove(this.getContainer());this.rendered=false}},{key:"showTooltip",value:function e(){const t=this.getContainer();const i=t.getBoundingClientRect();const n=i.width;const l=Math.min(Math.max(100,this.getTitleContainer().scrollWidth+20),300);const a=o.PopupManager.create({id:"sidepanel-toolbar-item-hint",cacheable:false,bindElement:i,bindOptions:{forceBindPosition:true,forceTop:true,position:"top"},width:l,content:s.Tag.render(q||(q=_`
				<div class="sidepanel-toolbar-item-hint">
					<div class="sidepanel-toolbar-item-hint-title">${0}</div>
					<div class="sidepanel-toolbar-item-hint-content">${0}</div>
				</div>
			`),s.Text.encode(this.getEntityName()),s.Text.encode(this.getTitle())),darkMode:true,fixed:true,offsetTop:0,events:{onShow:e=>{const t=e.getTarget();const i=n/2-l/2;const s=o.Popup.getOption("angleLeftOffset")-o.Popup.getOption("angleMinTop");t.setAngle({offset:l/2-s});t.setOffset({offsetLeft:i+o.Popup.getOption("angleLeftOffset")})}}});a.show();a.adjustPosition()}},{key:"hideTooltip",value:function e(){const t=o.PopupManager.getPopupById("sidepanel-toolbar-item-hint");if(t){t.close()}}},{key:"handleMouseEnter",value:function e(){this.showTooltip()}},{key:"handleMouseLeave",value:function e(){this.hideTooltip()}},{key:"handleRemoveBtnClick",value:function e(t){t.stopPropagation();this.emit("onRemove")}},{key:"toJSON",value:function e(){return{title:this.getTitle(),url:this.getUrl(),entityType:this.getEntityType(),entityId:this.getEntityId()}}}]);return t}(l.EventEmitter);let Y=null;function Z(){const e=a.PageObject.getRootWindow();if(e!==window){return e.BX.SidePanel.Instance}if(Y===null){Y=new ke}return Y}let Q=e=>e,J,ee,te,ie,ne,se,le;let oe=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));i.setEventNamespace("BX.Main.SidePanel.Toolbar");const n=s.Type.isPlainObject(e)?e:{};if(!s.Type.isStringFilled(n.context)){throw new Error('BX.Main.SidePanel.Toolbar: "context" parameter is required.')}i.context=n.context;i.items=[];i.rendered=false;i.refs=new s.Cache.MemoryCache;i.container=null;i.lsKey="bx.sidepanel.toolbar.item";i.initialPosition={right:"5px",bottom:"20px"};i.shiftedPosition={right:"5px",bottom:"20px"};if(s.Type.isPlainObject(n.position)){i.initialPosition=n.position}if(s.Type.isPlainObject(n.shiftedPosition)){i.shiftedPosition=n.shiftedPosition}i.collapsed=n.collapsed!==false;i.muted=false;i.shifted=false;i.maxVisibleItems=s.Type.isNumber(n.maxVisibleItems)?Math.max(n.maxVisibleItems,1):5;i.addItems(n.items);const l=i.restoreItemFromLocalStorage();if(l!==null){const{entityType:e,entityId:t}=l;if(i.getItem(e,t)){i.clearLocalStorage()}else{i.minimizeItem(l)}}return i}babelHelpers.createClass(t,[{key:"show",value:function e(){s.Dom.addClass(this.getContainer(),"--show")}},{key:"isShown",value:function e(){return s.Dom.hasClass(this.getContainer(),"--show")}},{key:"hide",value:function e(){s.Dom.removeClass(this.getContainer(),"--show")}},{key:"mute",value:function e(){if(this.muted){return false}this.muted=true;s.Dom.addClass(this.getContainer(),"--muted");return true}},{key:"unmute",value:function e(){if(!this.muted){return false}this.muted=false;s.Dom.removeClass(this.getContainer(),"--muted");return true}},{key:"isMuted",value:function e(){return this.muted}},{key:"toggleMuteness",value:function e(){if(this.canShowOnTop()){return this.unmute()}return this.mute()}},{key:"shift",value:function e(){if(this.shifted){return false}this.shifted=true;s.Dom.addClass(this.getContainer(),"--shifted");s.Dom.style(document.body,"--side-panel-toolbar-shifted",1);this.setPosition(this.getContainer(),this.shiftedPosition);return true}},{key:"unshift",value:function e(){if(!this.shifted){return false}this.shifted=false;s.Dom.removeClass(this.getContainer(),"--shifted");s.Dom.style(document.body,"--side-panel-toolbar-shifted",null);this.setPosition(this.getContainer(),this.initialPosition);return true}},{key:"isShifted",value:function e(){return this.shifted}},{key:"toggleShift",value:function e(){const t=Z().getOpenSliders();if(t.length===0||t.length===1&&!t[0].isOpen()){return this.unshift()}return this.shift()}},{key:"setPosition",value:function e(t,i){for(const e of["top","right","bottom","left"]){s.Dom.style(t,e,null);if(s.Type.isStringFilled(i[e])){s.Dom.style(t,e,i[e])}}}},{key:"collapse",value:function e(t=false){if(this.collapsed){return}if(t===true){s.Dom.addClass(this.getContainer(),"--collapsed");s.Dom.style(this.getContentContainer(),"width",null)}else{const e=this.getContentContainer().scrollWidth;s.Dom.style(this.getContentContainer(),"width",`${e}px`);s.Event.unbindAll(this.getContentContainer(),"transitionend");requestAnimationFrame((()=>{requestAnimationFrame((()=>{s.Dom.style(this.getContentContainer(),"width",0);s.Event.bindOnce(this.getContentContainer(),"transitionend",(()=>{s.Dom.addClass(this.getContainer(),"--collapsed");s.Dom.style(this.getContentContainer(),"width",null)}))}))}))}this.collapsed=true}},{key:"expand",value:function e(t=false){if(!this.collapsed){return}if(t===true){s.Dom.removeClass(this.getContainer(),"--collapsed");s.Dom.style(this.getContentContainer(),"width",null)}else{s.Dom.removeClass(this.getContainer(),"--collapsed");const e=this.getContentContainer().scrollWidth;s.Dom.style(this.getContentContainer(),"width",0);s.Event.unbindAll(this.getContentContainer(),"transitionend");requestAnimationFrame((()=>{requestAnimationFrame((()=>{s.Dom.style(this.getContentContainer(),"width",`${e}px`);s.Event.bindOnce(this.getContentContainer(),"transitionend",(()=>{s.Dom.style(this.getContentContainer(),"width",null)}))}))}))}this.collapsed=false}},{key:"toggle",value:function e(){if(this.collapsed){this.request("expand");this.expand()}else{this.request("collapse");this.collapse()}}},{key:"isCollapsed",value:function e(){return this.collapsed}},{key:"getItems",value:function e(){return this.items}},{key:"getItemsCount",value:function e(){return this.items.length}},{key:"addItems",value:function e(t){if(s.Type.isArrayFilled(t)){t.forEach((e=>{this.addItem(e)}))}}},{key:"addItem",value:function e(t){const i=this.createItem(t);if(i===null){return null}this.items.push(i);if(this.rendered){this.redraw()}return i}},{key:"prependItem",value:function e(t){const i=this.createItem(t);if(i===null){return null}this.items.unshift(i);if(this.rendered){this.redraw()}return i}},{key:"createItem",value:function e(t){const i=s.Type.isPlainObject(t)?t:{};if(!s.Type.isStringFilled(i.entityType)||!(s.Type.isStringFilled(i.entityId)||s.Type.isNumber(i.entityId))||!s.Type.isStringFilled(i.title)||!s.Type.isStringFilled(i.url)){return null}const n=new K(i);if(!s.Type.isStringFilled(n.getEntityName())){const e=Z().getMinimizeOptions(n.getUrl());if(s.Type.isPlainObject(e)&&s.Type.isStringFilled(e.entityName)){n.setEntityName(e.entityName)}}n.subscribe("onRemove",this.handleItemRemove.bind(this));return n}},{key:"minimizeItem",value:function e(t){const{entityType:i,entityId:n}=t;let s=this.getItem(i,n);const l=s!==null;if(!l){s=this.prependItem(t)}if(s!==null){if(!l){this.saveItemToLocalStorage(s)}this.request("minimize",s).then((e=>{if(e.status==="success"){this.clearLocalStorage()}})).catch((()=>{this.clearLocalStorage();this.removeItem(s)}))}return s}},{key:"saveItemToLocalStorage",value:function e(t){const i={item:t,ttl:Date.now()};localStorage.setItem(this.lsKey,JSON.stringify(i))}},{key:"restoreItemFromLocalStorage",value:function e(){const t=localStorage.getItem(this.lsKey);if(s.Type.isStringFilled(t)){const{item:e,ttl:i}=JSON.parse(t);if(Date.now()-i>1e4){this.clearLocalStorage();return null}if(s.Type.isPlainObject(e)){return e}}return null}},{key:"clearLocalStorage",value:function e(){localStorage.removeItem(this.lsKey)}},{key:"getContext",value:function e(){return this.context}},{key:"request",value:function e(t,i,n){const l=s.Type.isPlainObject(n)?n:{};return s.ajax.runAction(`main.api.sidepanel.toolbar.${t}`,{json:{toolbar:{context:this.getContext()},item:i?i.toJSON():null,...l}})}},{key:"handleItemRemove",value:function e(t){const i=t.getTarget();i.hideTooltip();this.removeItem(i)}},{key:"handleMenuItemRemove",value:function e(t){t.preventDefault();t.stopPropagation();const i=t.currentTarget.dataset.menuItemId;const n=this.getItemById(i);if(n){this.removeItem(n)}const s=this.getMenu();if(s){s.removeMenuItem(i);const e=this.getItems().reduce(((e,t)=>t.isRendered()?e:e+1),0);if(e>0){s.getPopupWindow().adjustPosition()}else{s.close()}}}},{key:"removeItem",value:function e(t){t.remove();this.items=this.items.filter((e=>e!==t));const i=this.restoreItemFromLocalStorage();if(i!==null){const{entityType:e,entityId:n}=i;if(t.getEntityType()===e&&t.getEntityId()===n){this.clearLocalStorage()}}if(this.rendered){this.redraw();this.request("remove",t);if(this.getItemsCount()===0){this.hide()}}}},{key:"redraw",value:function e(){let t=0;for(let e=0;e<this.getItems().length;e++){const i=this.getItems()[e];if(t>=this.maxVisibleItems){if(i.isRendered()){i.remove()}}else{if(!i.isRendered()){const t=this.getItems()[e-1]||null;const n=this.getItems()[e+1]||null;if(t){i.insertAfter(t.getContainer())}else if(n){i.insertBefore(n.getContainer())}else{i.appendTo(this.getItemsContainer())}}t++}}}},{key:"removeAll",value:function e(){this.getItemsContainer().innerHTML="";this.items=[];this.clearLocalStorage()}},{key:"getItem",value:function e(t,i){return this.items.find((e=>e.getEntityType()===t&&e.getEntityId()===String(i)))||null}},{key:"getItemByUrl",value:function e(t){return this.items.find((e=>e.getUrl()===t))||null}},{key:"getItemById",value:function e(t){return this.items.find((e=>e.getId()===t))||null}},{key:"getContainer",value:function e(){return this.refs.remember("container",(()=>{const e=[];if(this.collapsed){e.push("--collapsed")}const t=s.Tag.render(J||(J=Q`
				<div class="side-panel-toolbar ${0}">
					${0}
					<div class="side-panel-toolbar-toggle" onclick="${0}"></div>
				</div>
			`),e.join(" "),this.getContentContainer(),this.handleToggleClick.bind(this));this.setPosition(t,this.initialPosition);s.Dom.append(t,document.body);s.ZIndexManager.register(t,{alwaysOnTop:true});this.rendered=true;const i=s.Runtime.debounce(this.toggleMuteness,50,this);l.EventEmitter.subscribe("BX.Main.Popup:onShow",i);l.EventEmitter.subscribe("BX.Main.Popup:onClose",i);l.EventEmitter.subscribe("BX.Main.Popup:onDestroy",i);l.EventEmitter.subscribe("onWindowClose",i);l.EventEmitter.subscribe("onWindowRegister",i);let n=false;const o=()=>{this.toggleMuteness();if(this.isMuted()){return}this.toggleShift();if(!this.isShifted()&&n){n=false;this.expand()}};l.EventEmitter.subscribe("SidePanel.Slider:onClosing",o);l.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",o);l.EventEmitter.subscribe("SidePanel.Slider:onDestroyComplete",o);l.EventEmitter.subscribe("SidePanel.Slider:onOpening",(()=>{this.toggleMuteness();if(this.isMuted()){return}if(!this.isCollapsed()){n=true;this.collapse()}this.toggleShift()}));l.EventEmitter.subscribe("BX.UI.Viewer.Controller:onBeforeShow",i);l.EventEmitter.subscribe("BX.UI.Viewer.Controller:onClose",s.Runtime.debounce(this.toggleMuteness,500,this));s.Event.bind(window,"resize",s.Runtime.throttle((()=>{const e=this.getMenu();if(e!==null){e.close()}}),300));return t}))}},{key:"getContentContainer",value:function e(){return this.refs.remember("content-container",(()=>s.Tag.render(ee||(ee=Q`
				<div class="side-panel-toolbar-content">
					<div class="side-panel-toolbar-collapse-btn" onclick="${0}">
						<div class="ui-icon-set --chevron-right"></div>
					</div>
					${0}
					${0}
				</div>
			`),this.handleToggleClick.bind(this),this.getItemsContainer(),this.getMoreButton())))}},{key:"getItemsContainer",value:function e(){return this.refs.remember("items-container",(()=>{const e=s.Tag.render(te||(te=Q`<div class="side-panel-toolbar-items"></div>`));[...this.items].slice(0,this.maxVisibleItems).forEach((t=>{t.appendTo(e)}));return e}))}},{key:"getMoreButton",value:function e(){return this.refs.remember("more-button",(()=>s.Tag.render(ie||(ie=Q`
				<div class="side-panel-toolbar-more-btn" onclick="${0}">
					<div class="ui-icon-set --more"></div>
				</div>
			`),this.handleMoreBtnClick.bind(this))))}},{key:"handleMoreBtnClick",value:function e(t){const i=this.getMoreButton();const n=i.getBoundingClientRect();const l=n.width;const a=[...this.items].filter((e=>!e.isRendered())).map((e=>{const t=s.Type.isStringFilled(e.getEntityName())?`${e.getEntityName()}\n${e.getTitle()}`:e.getTitle();return{id:e.getId(),html:this.createMenuItemText(e),title:t,href:e.getUrl(),onclick:()=>{r.close()}}}));if(a.length>0){a.push({delimiter:true})}a.push({text:s.Loc.getMessage("MAIN_SIDEPANEL_REMOVE_ALL"),onclick:()=>{this.removeAll();this.hide();r.close();this.request("removeAll")}});const r=o.MenuManager.create({id:"sidepanel-toolbar-more-btn",cacheable:false,bindElement:n,bindOptions:{forceBindPosition:true,forceTop:true,position:"top"},maxWidth:260,fixed:true,offsetTop:0,maxHeight:305,items:a,events:{onShow:e=>{const t=e.getTarget();const i=t.getPopupContainer().offsetWidth;const n=l/2-i/2;const s=o.Popup.getOption("angleLeftOffset")-o.Popup.getOption("angleMinTop");t.setAngle({offset:i/2-s});t.setOffset({offsetLeft:n+o.Popup.getOption("angleLeftOffset")})}}});r.show()}},{key:"canShowOnTop",value:function e(){const t=o.PopupManager.getPopups();for(const e of t){if(!e.isShown()){continue}if(e.getId().startsWith("timeman_weekly_report_popup_")||e.getId().startsWith("timeman_daily_report_popup_")||s.Dom.hasClass(e.getPopupContainer(),"b24-whatsnew__popup")){return false}}if(s.Reflection.getClass("BX.UI.Viewer.Instance")&&BX.UI.Viewer.Instance.isOpen()){return false}const i=Z().getOpenSliders();for(const e of i){const t=e.getUrl().toString();if(e.shouldHideToolbarOnOpen()||t.startsWith("im:slider")||t.startsWith("release-slider")||t.startsWith("main:helper")||t.startsWith("ui:info_helper")){return false}}const n=s.ZIndexManager.getStack(document.body);const l=n===null?[]:n.getComponents();for(const e of l){if(e.getOverlay()!==null&&e.getOverlay().offsetWidth>0){return false}}return true}},{key:"getMenu",value:function e(){return o.MenuManager.getMenuById("sidepanel-toolbar-more-btn")}},{key:"createMenuItemText",value:function e(t){return s.Tag.render(ne||(ne=Q`
			<span class="side-panel-toolbar-menu-item">${0}</span>
		`),[s.Tag.render(se||(se=Q`
					<span class="side-panel-toolbar-menu-item-title">${0}</span>
				`),s.Text.encode(t.getTitle())),s.Tag.render(le||(le=Q`
					<span
						class="side-panel-toolbar-menu-item-remove"
						data-slider-ignore-autobinding="true"
						data-menu-item-id="${0}"
						onclick="${0}"
					>
						<span class="ui-icon-set --cross-20" data-slider-ignore-autobinding="true"></span>
					</span>
				`),t.getId(),this.handleMenuItemRemove.bind(this))])}},{key:"handleToggleClick",value:function e(){this.toggle()}}]);return t}(l.EventEmitter);function ae(e,t){re(e,t);t.add(e)}function re(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ue(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}let he=null;let de=null;let ce=null;var fe=new WeakSet;var me=new WeakSet;var pe=new WeakSet;var ge=new WeakSet;var ye=new WeakSet;var ve=new WeakSet;var be=new WeakSet;var Ce=new WeakSet;var Se=new WeakSet;let ke=function(){function e(){babelHelpers.classCallCheck(this,e);ae(this,Se);ae(this,Ce);ae(this,be);ae(this,ve);ae(this,ye);ae(this,ge);ae(this,pe);ae(this,me);ae(this,fe);this.anchorRules=[];this.anchorBinding=true;this.openSliders=[];this.lastOpenSlider=null;this.opened=false;this.hidden=false;this.hacksApplied=false;this.pageUrl=this.getCurrentUrl();this.pageTitle=this.getCurrentTitle();this.titleChanged=false;this.toolbar=null;this.fullScreenSlider=null;this.handleAnchorClick=this.handleAnchorClick.bind(this);this.handleDocumentKeyDown=this.handleDocumentKeyDown.bind(this);this.handleWindowResize=s.Runtime.throttle(this.handleWindowResize,300,this);this.handleWindowScroll=this.handleWindowScroll.bind(this);this.handleTouchMove=this.handleTouchMove.bind(this);this.handleSliderOpenStart=this.handleSliderOpenStart.bind(this);this.handleSliderOpenComplete=this.handleSliderOpenComplete.bind(this);this.handleSliderMaximizeStart=this.handleSliderMaximizeStart.bind(this);this.handleSliderCloseStart=this.handleSliderCloseStart.bind(this);this.handleSliderCloseComplete=this.handleSliderCloseComplete.bind(this);this.handleSliderMinimizeStart=this.handleSliderMinimizeStart.bind(this);this.handleSliderLoad=this.handleSliderLoad.bind(this);this.handleSliderDestroy=this.handleSliderDestroy.bind(this);this.handleEscapePress=this.handleEscapePress.bind(this);this.handleFullScreenChange=this.handleFullScreenChange.bind(this);l.EventEmitter.subscribe("SidePanel:open",this.open.bind(this),{compatMode:true});l.EventEmitter.subscribe("SidePanel:close",this.close.bind(this),{compatMode:true});l.EventEmitter.subscribe("SidePanel:closeAll",this.closeAll.bind(this),{compatMode:true});l.EventEmitter.subscribe("SidePanel:destroy",this.destroy.bind(this),{compatMode:true});l.EventEmitter.subscribe("SidePanel:hide",this.hide.bind(this),{compatMode:true});l.EventEmitter.subscribe("SidePanel:unhide",this.unhide.bind(this),{compatMode:true});l.EventEmitter.subscribe("SidePanel:postMessage",this.postMessage.bind(this),{compatMode:true});l.EventEmitter.subscribe("SidePanel:postMessageAll",this.postMessageAll.bind(this),{compatMode:true});l.EventEmitter.subscribe("SidePanel:postMessageTop",this.postMessageTop.bind(this),{compatMode:true});l.EventEmitter.subscribe("BX.Bitrix24.PageSlider:close",this.close.bind(this),{compatMode:true});l.EventEmitter.subscribe("Bitrix24.Slider:postMessage",this.handlePostMessageCompatible.bind(this),{compatMode:true})}babelHelpers.createClass(e,[{key:"open",value:function e(t,i){const n=ue(this,fe,we).call(this,t,i);if(n===null){return false}return this.tryApplyHacks(n,(()=>n.open()))}},{key:"getMinimizeOptions",value:function e(t){const i=this.getUrlRule(t);const n=i!==null&&s.Type.isPlainObject(i.options)?i.options:{};return s.Type.isPlainObject(n.minimizeOptions)?n.minimizeOptions:null}},{key:"maximize",value:function e(t,i){const n=ue(this,fe,we).call(this,t,i);if(n===null){return false}return this.tryApplyHacks(n,(()=>n.maximize()))}},{key:"tryApplyHacks",value:function e(t,i){if(!this.isOpen()){this.applyHacks(t)}const n=i();if(!n){this.resetHacks(t)}return n}},{key:"isOpen",value:function e(){return this.opened}},{key:"close",value:function e(t,i){const n=this.getTopSlider();if(n){n.close(t,i)}}},{key:"closeAll",value:function e(t){const i=this.getOpenSliders();for(let e=i.length-1;e>=0;e--){const n=i[e];const s=n.close(t);if(!s){break}}}},{key:"minimize",value:function e(t,i){const n=this.getTopSlider();if(n){n.minimize(t,i)}}},{key:"hide",value:function e(){if(this.hidden){return false}const t=this.getTopSlider();this.getOpenSliders().forEach((e=>{e.hide()}));this.hidden=true;this.resetHacks(t);return true}},{key:"unhide",value:function e(){if(!this.hidden){return false}this.getOpenSliders().forEach((e=>{e.unhide()}));this.hidden=false;setTimeout((()=>{this.applyHacks(this.getTopSlider())}),0);return true}},{key:"isHidden",value:function e(){return this.hidden}},{key:"destroy",value:function e(t){if(!s.Type.isStringFilled(t)){return}const i=this.refineUrl(t);const n=this.getSlider(i);if(this.getLastOpenSlider()&&(n||this.getLastOpenSlider().getUrl()===i)){this.getLastOpenSlider().destroy()}if(n!==null){const e=this.getOpenSliders();for(let t=e.length-1;t>=0;t--){const i=e[t];i.destroy();if(i===n){break}}}}},{key:"reload",value:function e(){const t=this.getTopSlider();if(t){t.reload()}}},{key:"getTopSlider",value:function e(){const t=this.openSliders.length;return this.openSliders[t-1]||null}},{key:"getPreviousSlider",value:function e(t){let i=null;const n=this.getOpenSliders();t=t||this.getTopSlider();for(let e=n.length-1;e>=0;e--){const s=n[e];if(s===t){i=n[e-1]||null;break}}return i}},{key:"getSlider",value:function e(t){const i=this.refineUrl(t);const n=this.getOpenSliders();for(const e of n){if(e.getUrl()===i){return e}}return null}},{key:"getSliderByWindow",value:function e(t){const i=this.getOpenSliders();for(const e of i){if(e.getFrameWindow()===t){return e}}return null}},{key:"getOpenSliders",value:function e(){return this.openSliders}},{key:"getOpenSlidersCount",value:function e(){return this.openSliders.length}},{key:"getLastOpenSlider",value:function e(){return this.lastOpenSlider}},{key:"adjustLayout",value:function e(){this.getOpenSliders().forEach((e=>{e.adjustLayout()}))}},{key:"createToolbar",value:function e(t){if(this.toolbar===null){this.toolbar=new oe(t)}return this.toolbar}},{key:"getToolbar",value:function e(){return this.toolbar}},{key:"refineUrl",value:function e(t){if(s.Type.isStringFilled(t)&&/IFRAME/.test(t)){return s.Uri.removeParam(t,["IFRAME","IFRAME_TYPE"])}return t}},{key:"getPageUrl",value:function e(){return this.pageUrl}},{key:"getCurrentUrl",value:function e(){return window.location.pathname+window.location.search+window.location.hash}},{key:"getPageTitle",value:function e(){return this.pageTitle}},{key:"getCurrentTitle",value:function e(){let t=document.title;if(!s.Type.isUndefined(window.BXIM)){t=t.replace(/^\(\d+\) /,"")}return t}},{key:"enterFullScreen",value:function e(){if(!this.getTopSlider()||this.getFullScreenSlider()){return}const t=document.body;if(t.requestFullscreen){s.Event.bind(document,"fullscreenchange",this.handleFullScreenChange);t.requestFullscreen()}else if(t.webkitRequestFullScreen){s.Event.bind(document,"webkitfullscreenchange",this.handleFullScreenChange);t.webkitRequestFullScreen()}else if(t.msRequestFullscreen){s.Event.bind(document,"MSFullscreenChange",this.handleFullScreenChange);t.msRequestFullscreen()}else if(t.mozRequestFullScreen){s.Event.bind(document,"mozfullscreenchange",this.handleFullScreenChange);t.mozRequestFullScreen()}else{console.log("Slider: Full Screen mode is not supported.")}}},{key:"exitFullScreen",value:function e(){if(!this.getFullScreenSlider()){return}if(document.exitFullscreen){document.exitFullscreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}}},{key:"getFullScreenElement",value:function e(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null}},{key:"getFullScreenSlider",value:function e(){return this.fullScreenSlider}},{key:"handleFullScreenChange",value:function e(t){if(this.getFullScreenElement()){this.fullScreenSlider=this.getTopSlider();s.Dom.addClass(this.fullScreenSlider.getOverlay(),"side-panel-fullscreen");this.fullScreenSlider.fireEvent("onFullScreenEnter")}else{if(this.getFullScreenSlider()){s.Dom.removeClass(this.getFullScreenSlider().getOverlay(),"side-panel-fullscreen");this.fullScreenSlider.fireEvent("onFullScreenExit");this.fullScreenSlider=null}s.Event.unbind(document,t.type,this.handleFullScreenChange);window.scrollTo(0,this.pageScrollTop);setTimeout((()=>{this.adjustLayout();const e=document.createEvent("Event");e.initEvent("resize",true,true);window.dispatchEvent(e)}),1e3)}}},{key:"postMessage",value:function e(t,i,n){const s=this.getSliderFromSource(t);if(!s){return}let o=null;const a=this.getOpenSliders();for(let e=a.length-1;e>=0;e--){const t=a[e];if(t===s){o=a[e-1]||null;break}}const r=o?o.getWindow():window;r.BX.onCustomEvent("Bitrix24.Slider:onMessage",[s,n]);const u=new b({sender:s,slider:o||null,data:n,eventId:i});if(o){o.firePageEvent(u);o.fireFrameEvent(u)}else{l.EventEmitter.emit(u.getFullName().toLowerCase(),new l.BaseEvent({data:[u],compatData:[u]}))}}},{key:"postMessageAll",value:function e(t,i,n){const s=this.getSliderFromSource(t);if(!s){return}let o=null;const a=this.getOpenSliders();for(let e=a.length-1;e>=0;e--){const t=a[e];if(t===s){continue}o=new b({sender:s,slider:t,data:n,eventId:i});t.firePageEvent(o);t.fireFrameEvent(o)}o=new b({sender:s,slider:null,data:n,eventId:i});l.EventEmitter.emit(o.getFullName().toLowerCase(),new l.BaseEvent({data:[o],compatData:[o]}))}},{key:"postMessageTop",value:function e(t,i,n){const s=this.getSliderFromSource(t);if(!s){return}const o=new b({sender:s,slider:null,data:n,eventId:i});l.EventEmitter.emit(o.getFullName().toLowerCase(),new l.BaseEvent({data:[o],compatData:[o]}))}},{key:"bindAnchors",value:function e(t){if(!s.Type.isPlainObject(t)||!s.Type.isArray(t.rules)||t.rules.length===0){return}if(this.anchorRules.length===0){this.registerAnchorListener(window.document)}if(!(t.rules instanceof Object)){console.error("BX.SitePanel: anchor rules were created in a different context. "+"This might be a reason for a memory leak.");console.trace()}t.rules.forEach((e=>{var t;if(s.Type.isArray(e.condition)){for(let t=0;t<e.condition.length;t++){if(s.Type.isString(e.condition[t])){e.condition[t]=new RegExp(e.condition[t],"i")}}}(t=e.options)!==null&&t!==void 0?t:e.options={};this.anchorRules.push(e)}))}},{key:"isAnchorBinding",value:function e(){return this.anchorBinding}},{key:"enableAnchorBinding",value:function e(){this.anchorBinding=true}},{key:"disableAnchorBinding",value:function e(){this.anchorBinding=false}},{key:"registerAnchorListener",value:function e(t){s.Event.bind(t,"click",this.handleAnchorClick,true)}},{key:"unregisterAnchorListener",value:function e(t){s.Event.unbind(t,"click",this.handleAnchorClick,true)}},{key:"handleSliderOpenStart",value:function e(t){if(!t.isActionAllowed()){return}const i=t.getSlider();if(i.isDestroyed()){return}if(this.getTopSlider()){this.exitFullScreen();this.getTopSlider().hideOverlay();i.setOverlayBackground();const e=this.getTopSlider().getOffset()===i.getOffset()&&this.getTopSlider().getWidth()===i.getWidth()&&this.getTopSlider().getCustomLeftBoundary()===i.getCustomLeftBoundary();if(!e){this.getTopSlider().showShadow()}this.getTopSlider().hideCloseBtn();this.getTopSlider().hideExtraLabels()}else{i.setOverlayAnimation(true)}ue(this,me,Te).call(this,i);this.losePageFocus();if(!this.opened){this.pageUrl=this.getCurrentUrl();this.pageTitle=this.getCurrentTitle()}this.opened=true;ue(this,ye,Oe).call(this)}},{key:"handleSliderOpenComplete",value:function e(t){this.setBrowserHistory(t.getSlider());this.updateBrowserTitle();t.getSlider().setAnimation("sliding");const i=this.getOpenSliders();const n=t.getSlider();for(let e=i.length-1;e>=0;e--){const t=i[e];if(n===t){continue}if(n.getContainer().offsetLeft<=t.getContainer().offsetLeft){s.Dom.addClass(t.getOverlay(),"--invisible")}else{break}}}},{key:"handleSliderCloseStart",value:function e(t){if(!t.isActionAllowed()){return}if(t.getSlider()&&t.getSlider().isDestroyed()){return}const i=this.getPreviousSlider();const n=this.getTopSlider();this.exitFullScreen();let l=null;const o=this.getOpenSliders();for(let e=o.length-1;e>=0;e--){const i=o[e];if(t.getSlider()===i){continue}if(l===null||i.getContainer().offsetLeft<l.getContainer().offsetLeft){s.Dom.removeClass(i.getOverlay(),"--invisible");l=i}}if(i){i.unhideOverlay();i.hideShadow();i.showCloseBtn();i.showExtraLabels();if(n){n.hideOverlay();n.hideShadow()}}}},{key:"handleSliderMaximizeStart",value:function e(t){if(!t.isActionAllowed()||this.getToolbar()===null){return}const i=t.getSlider();if(i&&i.isDestroyed()){return}const{entityType:n,entityId:s}=i.getMinimizeOptions()||{};const l=this.getToolbar().getItem(n,s);this.getToolbar().request("maximize",l);const o=ue(this,Se,De).call(this,i,l);i.setAnimation("scale",{origin:o})}},{key:"handleSliderMinimizeStart",value:function e(t){if(!t.isActionAllowed()||this.getToolbar()===null){return}const i=t.getSlider();if(i&&i.isDestroyed()){return}if(!this.getToolbar().isShown()){this.getToolbar().show()}let n=i.getTitle();if(!n){n=i.getFrameWindow()?i.getFrameWindow().document.title:null}this.getToolbar().expand(true);const l=this.getMinimizeOptions(i.getUrl());const{entityType:o,entityId:a,url:r}=i.getMinimizeOptions()||l||{};const u=this.getToolbar().minimizeItem({title:n,url:s.Type.isStringFilled(r)?r:i.getUrl(),entityType:o,entityId:a});const h=ue(this,Se,De).call(this,i,u);i.setAnimation("scale",{origin:h})}},{key:"handleSliderCloseComplete",value:function e(t){const i=t.getSlider();if(i===this.getTopSlider()){ue(this,ge,Ae).call(this,i)}t.getSlider().setAnimation("sliding");this.cleanUpClosedSlider(i)}},{key:"handleSliderDestroy",value:function e(t){const i=t.getSlider();l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onOpenStart",this.handleSliderOpenStart);l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onBeforeOpenComplete",this.handleSliderOpenComplete);l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onMaximizeStart",this.handleSliderMaximizeStart);l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onCloseStart",this.handleSliderCloseStart);l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onBeforeCloseComplete",this.handleSliderCloseComplete);l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onMinimizeStart",this.handleSliderMinimizeStart);l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onLoad",this.handleSliderLoad);l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onDestroy",this.handleSliderDestroy);l.EventEmitter.unsubscribe(i,"SidePanel.Slider:onEscapePress",this.handleEscapePress);const n=t.getSlider().getFrameWindow();if(n&&!t.getSlider().allowCrossOrigin){this.unregisterAnchorListener(n.document)}if(i===this.getLastOpenSlider()){this.lastOpenSlider=null}this.cleanUpClosedSlider(i)}},{key:"handleEscapePress",value:function e(t){const i=this.getTopSlider();if(i!==null&&i!==void 0&&i.canCloseByEsc()&&this.isOnTop(i)){i.close()}}},{key:"cleanUpClosedSlider",value:function e(t){ue(this,pe,Ee).call(this,t);t.unhideOverlay();t.hideShadow();if(this.getTopSlider()){this.getTopSlider().unhideOverlay();this.getTopSlider().hideShadow();this.getTopSlider().showCloseBtn();this.getTopSlider().showExtraLabels();this.getTopSlider().focus()}else{window.focus()}if(!this.getOpenSlidersCount()){this.resetHacks(t);this.opened=false}this.resetBrowserHistory();this.updateBrowserTitle()}},{key:"handleSliderLoad",value:function e(t){const i=t.getSlider().getFrameWindow();if(i){this.registerAnchorListener(i.document)}this.setBrowserHistory(t.getSlider());this.updateBrowserTitle()}},{key:"handlePostMessageCompatible",value:function e(t,i){this.postMessage(t,"",i)}},{key:"getSliderFromSource",value:function e(t){if(t instanceof U){return t}if(s.Type.isStringFilled(t)){return this.getSlider(t)}if(t!==null&&t===t.window&&window!==t){return this.getSliderByWindow(t)}return null}},{key:"applyHacks",value:function e(t){if(this.hacksApplied){return false}if(t){t.applyHacks()}this.disablePageScrollbar();this.bindEvents();if(t){t.applyPostHacks()}this.hacksApplied=true;return true}},{key:"resetHacks",value:function e(t){if(!this.hacksApplied){return false}if(t){t.resetPostHacks()}this.enablePageScrollbar();this.unbindEvents();if(t){t.resetHacks()}this.hacksApplied=false;return true}},{key:"bindEvents",value:function e(){s.Event.bind(document,"keydown",this.handleDocumentKeyDown);s.Event.bind(window,"resize",this.handleWindowResize);s.Event.bind(window,"scroll",this.handleWindowScroll);if(s.Browser.isMobile()){s.Event.bind(document.body,"touchmove",this.handleTouchMove)}}},{key:"unbindEvents",value:function e(){s.Event.unbind(document,"keydown",this.handleDocumentKeyDown);s.Event.unbind(window,"resize",this.handleWindowResize);s.Event.unbind(window,"scroll",this.handleWindowScroll);if(s.Browser.isMobile()){s.Event.unbind(document.body,"touchmove",this.handleTouchMove)}}},{key:"disablePageScrollbar",value:function e(){const t=window.innerWidth-document.documentElement.clientWidth;document.body.style.paddingRight=t+"px";s.Dom.style(document.body,"--scroll-shift-width",`${t}px`);s.Dom.addClass(document.body,"side-panel-disable-scrollbar");this.pageScrollTop=window.pageYOffset||document.documentElement.scrollTop}},{key:"enablePageScrollbar",value:function e(){document.body.style.removeProperty("padding-right");s.Dom.style(document.body,"--scroll-shift-width",null);s.Dom.removeClass(document.body,"side-panel-disable-scrollbar")}},{key:"losePageFocus",value:function e(){if(s.Type.isDomNode(document.activeElement)){document.activeElement.blur()}}},{key:"handleDocumentKeyDown",value:function e(t){if(t.keyCode!==27){return}t.preventDefault();this.handleEscapePress()}},{key:"handleWindowResize",value:function e(){this.adjustLayout()}},{key:"handleWindowScroll",value:function e(){window.scrollTo(0,this.pageScrollTop);this.adjustLayout()}},{key:"handleTouchMove",value:function e(t){t.preventDefault()}},{key:"isOnTop",value:function e(t){if(t){const e=o.PopupManager.getPopups();const i=e.every((e=>t.isOnTopOfPopup(e)));if(!i){return false}}const i=document.documentElement.clientWidth/2;const n=document.documentElement.clientHeight/2;const l=document.elementFromPoint(i,n);return s.Dom.hasClass(l,"side-panel")||l.closest(".side-panel")!==null}},{key:"extractLinkFromEvent",value:function e(t){const i=t.target;if(t.which!==1||!s.Type.isDomNode(i)||t.ctrlKey||t.metaKey){return null}let n=i;if(i.nodeName!=="A"&&s.Type.isElementNode(i)){n=i.closest("a")}if(!s.Type.isDomNode(n)){return null}const l=n.getAttribute("href");if(l){return{url:l,anchor:n,target:n.getAttribute("target")}}return null}},{key:"handleAnchorClick",value:function e(t){if(!this.isAnchorBinding()){return}const i=this.extractLinkFromEvent(t);if(!i||s.Dom.attr(i.anchor,"data-slider-ignore-autobinding")!==null){return}if(s.Dom.attr(t.target,"data-slider-ignore-autobinding")!==null){return}const n=this.getUrlRule(i.url,i);if(!this.isValidLink(n,i)){return}if(s.Type.isFunction(n.handler)){n.handler(t,i)}else{t.preventDefault();if(s.Dom.attr(t.target,"data-slider-maximize")===null){this.open(i.url,n.options)}else{this.maximize(i.url,n.options)}}}},{key:"emulateAnchorClick",value:function e(t){const i={url:t,anchor:null,target:null};const n=this.getUrlRule(t,i);if(!this.isValidLink(n,i)){BX.reload(t)}else if(s.Type.isFunction(n.handler)){n.handler(new MouseEvent("slider",{bubbles:false,cancelable:true}),i)}else{this.open(i.url,n.options)}}},{key:"getUrlRule",value:function e(t,i){if(!s.Type.isStringFilled(t)){return null}if(!s.Type.isPlainObject(i)){const e=document.createElement("a");e.href=t;i={url:t,anchor:e,target:""}}for(let e=0;e<this.anchorRules.length;e++){const n=this.anchorRules[e];if(!s.Type.isArray(n.condition)){continue}for(let e=0;e<n.condition.length;e++){const l=t.match(n.condition[e]);if(l&&!this.hasStopParams(t,n.stopParameters)){i.matches=l;let e=s.Type.isFunction(n.options)?n.options(i):n.options;const t=s.Type.isFunction(n.minimizeOptions)?n.minimizeOptions(i):null;if(s.Type.isPlainObject(t)){if(s.Type.isPlainObject(e)){e.minimizeOptions=t}else{e={minimizeOptions:t}}}if(s.Type.isStringFilled(n.loader)&&!s.Type.isStringFilled(e.loader)){e.loader=n.loader;delete n.loader}return{...n,options:e}}}}return null}},{key:"isValidLink",value:function e(t,i){if(!t){return false}if(t.allowCrossDomain!==true&&s.ajax.isCrossDomain(i.url)){return false}if(t.mobileFriendly!==true&&s.Browser.isMobile()){return false}return!s.Type.isFunction(t.validate)||t.validate(i)}},{key:"setBrowserHistory",value:function e(t){if(!(t instanceof U)){return}if(t.canChangeHistory()&&t.isOpen()&&t.isLoaded()){window.history.replaceState({},"",t.getUrl())}}},{key:"resetBrowserHistory",value:function e(){let t=null;const i=this.getOpenSliders();for(let e=i.length-1;e>=0;e--){const n=i[e];if(n.canChangeHistory()&&n.isOpen()&&n.isLoaded()){t=n;break}}const n=t?t.getUrl():this.getPageUrl();if(n){window.history.replaceState({},"",n)}}},{key:"updateBrowserTitle",value:function e(){let t=null;const i=this.getOpenSliders();for(let e=i.length-1;e>=0;e--){t=this.getBrowserTitle(i[e]);if(s.Type.isStringFilled(t)){break}}if(s.Type.isStringFilled(t)){document.title=t;this.titleChanged=true}else if(this.titleChanged){document.title=this.getPageTitle();this.titleChanged=false}}},{key:"getBrowserTitle",value:function e(t){if(!t||!t.canChangeTitle()||!t.isOpen()||!t.isLoaded()){return null}let i=t.getTitle();if(!i&&!t.isSelfContained()){i=t.getFrameWindow()?t.getFrameWindow().document.title:null}return s.Type.isStringFilled(i)?i:null}},{key:"hasStopParams",value:function e(t,i){if(!i||!s.Type.isArray(i)||!s.Type.isStringFilled(t)){return false}const n=t.indexOf("?");if(n===-1){return false}const l=t.slice(Math.max(0,n));for(const e of i){if(new RegExp(`[?&]${e}=`,"i").test(l)){return true}}return false}},{key:"getLastOpenPage",value:function e(){return this.getLastOpenSlider()}},{key:"getCurrentPage",value:function e(){return this.getTopSlider()}}],[{key:"registerSliderClass",value:function e(t,i=null,n=null){if(s.Type.isStringFilled(t)){he=t}if(s.Type.isPlainObject(i)){de=i}if(s.Type.isPlainObject(n)){ce=n}}},{key:"getSliderClass",value:function e(){const t=he===null?null:s.Reflection.getClass(he);return t===null?U:t}},{key:"getSliderDefaultOptions",value:function e(){return de===null?{}:de}},{key:"getSliderPriorityOptions",value:function e(){return ce===null?{}:ce}}]);return e}();function we(e,t){var i,n;if(!s.Type.isStringFilled(e)){return null}const o=this.refineUrl(e);if(this.isHidden()){this.unhide()}const a=this.getTopSlider();if(a&&a.isOpen()&&a.getUrl()===o){return null}if(this.getLastOpenSlider()&&this.getLastOpenSlider().getUrl()===o){return this.getLastOpenSlider()}const r=this.getUrlRule(o);const u=r!==null&&s.Type.isPlainObject(r.options)?r.options:{};const h=(i=(n=t===null||t===void 0?void 0:t.useGlobalOptions)!==null&&n!==void 0?n:u.useGlobalOptions)!==null&&i!==void 0?i:true;const d=t!==u&&h;const c={...d?u:{},...t,events:[d&&u.events,t===null||t===void 0?void 0:t.events]};const f=ke.getSliderDefaultOptions();const m=ke.getSliderPriorityOptions();const p=ke.getSliderClass();const g=new p(o,s.Runtime.merge(f,c,m));let y=null;if(g.shouldUseAutoOffset()&&g.getWidth()===null&&g.getCustomLeftBoundary()===null){y=0;const e=ue(this,ve,Fe).call(this);if(a&&e!==null){y=Math.min(e+ue(this,be,Pe).call(this),ue(this,Ce,Be).call(this))}}g.setOffset(y);if(a&&a.getCustomRightBoundary()!==null){const e=g.calculateRightBoundary();if(e>a.getCustomRightBoundary()){g.setCustomRightBoundary(a.getCustomRightBoundary())}}l.EventEmitter.subscribe(g,"SidePanel.Slider:onOpenStart",this.handleSliderOpenStart,{compatMode:true});l.EventEmitter.subscribe(g,"SidePanel.Slider:onBeforeOpenComplete",this.handleSliderOpenComplete,{compatMode:true});l.EventEmitter.subscribe(g,"SidePanel.Slider:onMaximizeStart",this.handleSliderMaximizeStart,{compatMode:true});l.EventEmitter.subscribe(g,"SidePanel.Slider:onCloseStart",this.handleSliderCloseStart,{compatMode:true});l.EventEmitter.subscribe(g,"SidePanel.Slider:onBeforeCloseComplete",this.handleSliderCloseComplete,{compatMode:true});l.EventEmitter.subscribe(g,"SidePanel.Slider:onMinimizeStart",this.handleSliderMinimizeStart,{compatMode:true});l.EventEmitter.subscribe(g,"SidePanel.Slider:onLoad",this.handleSliderLoad,{compatMode:true});l.EventEmitter.subscribe(g,"SidePanel.Slider:onDestroy",this.handleSliderDestroy,{compatMode:true});l.EventEmitter.subscribe(g,"SidePanel.Slider:onEscapePress",this.handleEscapePress,{compatMode:true});return g}function Te(e){if(!(e instanceof U)){throw new TypeError("Slider is not an instance of BX.SidePanel.Slider")}this.openSliders.push(e)}function Ee(e){const t=[...this.getOpenSliders()];for(const[i,n]of t.entries()){if(n===e){this.openSliders.splice(i,1);return true}}return false}function Ae(e){if(this.lastOpenSlider!==e){if(this.lastOpenSlider){this.lastOpenSlider.destroy()}this.lastOpenSlider=e}}function Oe(){if(this.lastOpenSlider&&this.getTopSlider()!==this.lastOpenSlider){this.lastOpenSlider.destroy()}this.lastOpenSlider=null}function Fe(){const e=this.getOpenSliders();for(let t=e.length-1;t>=0;t--){const i=e[t];if(i.getOffset()!==null){return i.getOffset()}}return null}function Pe(){return 63}function Be(){return ue(this,be,Pe).call(this)*3}function De(e,t){if(t&&t.getContainer().offsetWidth>0){const i=t.getContainer().getBoundingClientRect();const n=e.getContainer().getBoundingClientRect().left;const s=i.left-n+i.width/2;return`${s}px ${i.top}px`}return"50% 100%"}const Me={};Object.defineProperty(Me,"Instance",{enumerable:false,get:Z});const Le=s.Reflection.namespace("BX.SidePanel");Object.defineProperty(Le,"Instance",{enumerable:false,get:Z});e.SidePanel=Me;e.Slider=U;e.SliderManager=ke;e.Manager=ke;e.SliderEvent=v;e.Event=v;e.MessageEvent=b;e.Toolbar=oe;e.ToolbarItem=K;e.Label=g;e.Dictionary=d})(this.BX.SidePanel=this.BX.SidePanel||{},BX.Cache,BX,BX.UI.System,BX,BX.Event,BX.Main,BX);
//# sourceMappingURL=side-panel.bundle.map.js