this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,s,i,r,a,o,l,n,d,c,h,b,u,p,g,v,f,P,m,L,y,F){"use strict";const H=L.createCommand("HIDE_DIALOG_COMMAND");const B=L.createCommand("DIALOG_VISIBILITY_COMMAND");const C=L.createCommand("DRAG_START_COMMAND");const O=L.createCommand("DRAG_END_COMMAND");var T=Object.freeze({HIDE_DIALOG_COMMAND:H,DIALOG_VISIBILITY_COMMAND:B,DRAG_START_COMMAND:C,DRAG_END_COMMAND:O});const E=1;const N={LINE_BREAK:"line-break",PARAGRAPH:"paragraph",MIXED:"mixed"};var _=Object.freeze({UNFORMATTED:E,NewLineMode:N});const M=Object.freeze({"\t":"\\t","\n":"\\n"});const D=new RegExp(Object.keys(M).join("|"),"g");const S=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"\u251c",isLastChild:"\u2514",selectedChar:"^",selectedLine:">"});const R=[e=>e.hasFormat("bold")&&"Bold",e=>e.hasFormat("code")&&"Code",e=>e.hasFormat("italic")&&"Italic",e=>e.hasFormat("strikethrough")&&"Strikethrough",e=>e.hasFormat("subscript")&&"Subscript",e=>e.hasFormat("superscript")&&"Superscript",e=>e.hasFormat("underline")&&"Underline"];const I=[e=>e.isDirectionless()&&"Directionless",e=>e.isUnmergeable()&&"Unmergeable"];const x=[e=>e.isToken()&&"Token",e=>e.isSegmented()&&"Segmented"];function w(e){const t=e.anchor;const s=e.focus;const i=e.anchor.getNode();const r=e.focus.getNode();if(i===r){return i}const a=e.isBackward();if(a){return d.$isAtNodeEnd(s)?i:r}return d.$isAtNodeEnd(t)?i:r}const A={b:"bold",strong:"bold",i:"italic",em:"italic",s:"strikethrough",del:"strikethrough",u:"underline",sub:"subscript",sup:"superscript"};function $(e){const t=A[e.getName()];if(t===undefined){return{node:null}}return{forChild:e=>{if(L.$isTextNode(e)&&!e.hasFormat(t)){e.toggleFormat(t)}return e},node:null}}function K(e,t,i=true){const r=t.getBBCodeScheme();const a=new s.BBCodeParser({scheme:r});const o=a.parse(e);const l=o.getChildren();let n=[];for(const e of l){const s=j(e,t);if(s!==null){n=[...n,...s]}}return i?U(n):n}function j(e,t,s=new Map,i=null){if(e instanceof n.BBCodeNewLineNode){return[L.$createLineBreakNode()]}if(e instanceof n.BBCodeTabNode){return[L.$createTabNode()]}let r=[];let a=null;const o=Y(e,t);const l=o?o(e):null;let d=null;if(l!==null){d=l.after;const t=l.node;a=Array.isArray(t)?t[t.length-1]:t;if(a!==null){for(const[,e]of s){a=e(a,i);if(!a){break}}if(a){r.push(...Array.isArray(t)?t:[a])}}if(F.Type.isFunction(l.forChild)){s.set(e.getName(),l.forChild)}}const c=e.getChildren();let h=[];for(const e of c){h.push(...j(e,t,new Map(s),a))}if(F.Type.isFunction(d)){h=d(h)}if(l===null){if(e.getType()===n.BBCodeNode.ELEMENT_NODE){const t=e;if(t.isVoid()){h=[L.$createTextNode(t.getOpeningTag()),...h]}else{h=[L.$createTextNode(t.getOpeningTag()),...h,L.$createTextNode(t.getClosingTag())]}}else{h=[L.$createTextNode(e.toString()),...h]}}if(a===null){r=[...r,...h]}else if(L.$isElementNode(a)){a.append(...h)}return r}function k(e){if(L.$isElementNode(e)&&e.isInline()===false){return false}return!(L.$isDecoratorNode(e)&&e.isInline()===false)}function U(e){const t=[];let s=null;let i=0;for(const r of e){if(L.$isLineBreakNode(r)){i++;continue}if(k(r)){if(s===null||i>=2){t.push(...W(i-2));s=L.$createParagraphNode();t.push(s)}else if(i===1){s.append(L.$createLineBreakNode())}s.append(r)}else{if(i>2){t.push(...W(i-2))}t.push(r);s=null}i=0}if(t.length===0){return[L.$createParagraphNode()]}return t}function W(e=1){const t=[];for(let s=0;s<e;s++){t.push(L.$createParagraphNode())}return t}function Y(e,t){const s=e.getName();let i=null;const r=t.getBBCodeImportMap();const a=r.get(s.toLowerCase());if(a!==undefined){for(const t of a){const s=t(e);if(s!==null&&(i===null||i.priority<s.priority)){i=s}}}if(i===null){if(s==="#text"){return z}return null}return i.conversion}function z(e){let t=e.getContent();t=t.replaceAll(/\r?\n|\t/gm," ").replace("\r","");if(t===""){return{node:null}}return{node:L.$createTextNode(t)}}function X(e){if(!L.$isParagraphNode(e)){return false}if(e.isEmpty()){return true}return e.getChildren().every((e=>L.$isLineBreakNode(e)||L.$isTextNode(e)&&/^\s*$/.test(e.getTextContent())))}function G(e){const t=[...e];while(t.length>0&&X(t[0])){t.splice(0,1)}while(t.length>0&&X(t[t.length-1])){t.splice(-1,1)}return t}function V(e,t){const s=t.getBBCodeScheme();const i=s.createRoot();const r=G(e.getChildren());for(const e of r){J(e,i,t)}return i}function J(e,t,s){const{node:i,after:r}=Q(e,s);if(!i){return}const a=s.getBBCodeScheme();const o=a.createFragment();const l=L.$isElementNode(e)?e.getChildren():[];for(const e of l){J(e,o,s)}i.appendChild(o);t.appendChild(i);if(F.Type.isFunction(r)){const t=r.call(e,i);if(t){i.getParent().replaceChild(i,t)}}}const q=["bold","italic","strikethrough","underline"];function Q(e,t){const s=e.getType();const i=t.getBBCodeExportMap();const r=i.get(s);if(F.Type.isFunction(r)){return r(e)}const a=t.getBBCodeScheme();if(L.$isTextNode(e)&&e.getType()==="text"){const t=a.createText({encode:false,content:e.getTextContent()});if(e.getFormat()===0){return{node:t}}let s=t;q.forEach((t=>{const r=i.get(`text:${t}`);if(F.Type.isFunction(r)){s=r(e,s)||s}}));return{node:s}}if(L.$isLineBreakNode(e)){return{node:a.createNewLine()}}if(L.$isTabNode(e)){return{node:a.createTab()}}if(L.$isTextNode(e)||L.$isElementNode(e)){const t=a.createText({encode:false,content:e.getTextContent()});return{node:t}}return{node:null}}function Z(e,t,s){const i=s.getBBCodeScheme();const r=i.createElement({name:t});r.appendChild(e);return r}var ee=babelHelpers.classPrivateFieldLooseKey("textEditor");var te=babelHelpers.classPrivateFieldLooseKey("destroyed");var se=babelHelpers.classPrivateFieldLooseKey("removeListeners");class ie{constructor(e){Object.defineProperty(this,ee,{writable:true,value:null});Object.defineProperty(this,te,{writable:true,value:false});Object.defineProperty(this,se,{writable:true,value:()=>{}});babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=e}static getName(){throw new Error("getName must be implemented in a child class")}static getNodes(e){return[]}importBBCode(){return null}exportBBCode(){return null}validateScheme(){return null}afterInit(){}getName(){return this.constructor.getName()}getEditor(){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]}getLexicalEditor(){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].getLexicalEditor()}cleanUpRegister(...e){babelHelpers.classPrivateFieldLooseBase(this,se)[se]=y.mergeRegister(babelHelpers.classPrivateFieldLooseBase(this,se)[se],...e)}isDestroyed(){return babelHelpers.classPrivateFieldLooseBase(this,te)[te]}destroy(){babelHelpers.classPrivateFieldLooseBase(this,te)[te]=true;babelHelpers.classPrivateFieldLooseBase(this,se)[se]();babelHelpers.classPrivateFieldLooseBase(this,se)[se]=null}}class re extends b.EventEmitter{constructor(){super();this.setEventNamespace("BX.UI.TextEditor.ToolbarItem")}getContainer(){throw new Error("You must implement getContainer() method.")}render(){throw new Error("You must implement render() method.")}}let ae=e=>e,oe;var le=babelHelpers.classPrivateFieldLooseKey("format");var ne=babelHelpers.classPrivateFieldLooseKey("blockType");var de=babelHelpers.classPrivateFieldLooseKey("active");var ce=babelHelpers.classPrivateFieldLooseKey("disabled");var he=babelHelpers.classPrivateFieldLooseKey("disableInsideUnformatted");var be=babelHelpers.classPrivateFieldLooseKey("disableCallback");var ue=babelHelpers.classPrivateFieldLooseKey("container");var pe=babelHelpers.classPrivateFieldLooseKey("handleClick");class ge extends re{constructor(...e){super(...e);Object.defineProperty(this,pe,{value:ve});Object.defineProperty(this,le,{writable:true,value:null});Object.defineProperty(this,ne,{writable:true,value:null});Object.defineProperty(this,de,{writable:true,value:false});Object.defineProperty(this,ce,{writable:true,value:false});Object.defineProperty(this,he,{writable:true,value:false});Object.defineProperty(this,be,{writable:true,value:null});Object.defineProperty(this,ue,{writable:true,value:null})}setContent(e){if(F.Type.isString(e)){this.getContainer().innerHTML=e}else if(F.Type.isElementNode(e)){this.getContainer().append(e)}}setFormat(e){babelHelpers.classPrivateFieldLooseBase(this,le)[le]=e}getFormat(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le]}hasFormat(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le]}setBlockType(e){babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=e}getBlockType(){return babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]}setTooltip(e){if(F.Type.isStringFilled(e)){F.Dom.attr(this.getContainer(),"title",F.Text.encode(e))}else if(e===null){F.Dom.attr(this.getContainer(),"title",null)}}disableInsideUnformatted(){babelHelpers.classPrivateFieldLooseBase(this,he)[he]=true}enableInsideUnformatted(){babelHelpers.classPrivateFieldLooseBase(this,he)[he]=false}shouldDisableInsideUnformatted(){return babelHelpers.classPrivateFieldLooseBase(this,he)[he]}setActive(e=true){if(e===babelHelpers.classPrivateFieldLooseBase(this,de)[de]){return}babelHelpers.classPrivateFieldLooseBase(this,de)[de]=e;if(e){F.Dom.addClass(this.getContainer(),"--active")}else{F.Dom.removeClass(this.getContainer(),"--active")}}isActive(){return babelHelpers.classPrivateFieldLooseBase(this,de)[de]}setDisabled(e=true){if(e===babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]){return}babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=e;if(e){F.Dom.attr(this.getContainer(),{disabled:true})}else{F.Dom.attr(this.getContainer(),{disabled:null})}}disable(){this.setDisabled(true)}enable(){this.setDisabled(false)}isDisabled(){return babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]}hasOwnDisableCallback(){return babelHelpers.classPrivateFieldLooseBase(this,be)[be]!==null}setDisableCallback(e){if(F.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,be)[be]=e}}invokeDisableCallback(){return babelHelpers.classPrivateFieldLooseBase(this,be)[be]()}getContainer(){if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]===null){babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=F.Tag.render(oe||(oe=ae`
				<button 
					type="button" 
					class="ui-text-editor-toolbar-button"
					onclick="${0}"
				>
				</button>
			`),babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]}render(){return this.getContainer()}}function ve(){this.emit("onClick")}function fe(e){let t="";const s=e.split(/((?:\r?\n){2})/);for(const e of s){if(e==="\n\n"||e==="\r\n\r\n"){continue}t+=`<p>${e.replaceAll(/(\r?\n)/g,"<br>")}</p>`}return t}class Pe extends L.ElementNode{static getType(){return"quote"}static clone(e){return new Pe(e.__key)}createDOM(e,t){var s;const i=document.createElement("blockquote");i.setAttribute("spellcheck","false");if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:s.quote)){F.Dom.addClass(i,e.theme.quote)}return i}updateDOM(e,t,s){return false}static importDOM(){return{blockquote:e=>({conversion:e=>({node:me()}),priority:0})}}static importJSON(e){const t=me();t.setFormat(e.format);t.setIndent(e.indent);t.setDirection(e.direction);return t}exportJSON(){return{...super.exportJSON(),type:"quote"}}canIndent(){return false}isInline(){return false}canReplaceWith(e){return false}collapseAtStart(e){ye(this);return true}canBeEmpty(){return false}isShadowRoot(){return true}}function me(){return L.$applyNodeReplacement(new Pe)}function Le(e){return e instanceof Pe}function ye(e){if(!Le(e)){return false}let t=e;for(const s of e.getChildren()){if(L.$isElementNode(s)||L.$isDecoratorNode(s)){t=t.insertAfter(s)}else{t=t.insertAfter(L.$createParagraphNode().append(s))}}e.remove();return true}function Fe(e,t){let s=e;while(s!==null&&s.getParent()!==null&&!t(s)){s=s.getParentOrThrow()}return t(s)?s:null}function He(e){return(L.$isElementNode(e)||L.$isDecoratorNode(e))&&!e.isInline()&&!e.isParentRequired()}function Be(e,t){if(e===null){return null}const s=e.anchor;const i=s.getNode();const r=t();if(L.$isRootOrShadowRoot(i)){const e=i.getFirstChild();if(e){e.replace(r,true)}else{i.append(r)}return r}const a=new Set;const o=e.getNodes();const l=Fe(e.anchor.getNode(),He);if(l&&!o.includes(l)){o.unshift(l)}a.add(r.getKey());let n=true;for(const e of o){if(!He(e)||a.has(e.getKey())){continue}const t=Fe(e.getParent(),(e=>a.has(e.getKey())));if(t){continue}if(n){n=false;e.replace(r);r.append(e)}else{r.append(e)}a.add(e.getKey())}return r}const Ce=L.createCommand("INSERT_QUOTE_COMMAND");const Oe=L.createCommand("FORMAT_QUOTE_COMMAND");const Te=L.createCommand("REMOVE_QUOTE_COMMAND");const Ee=L.createCommand("TOGGLE_QUOTE_COMMAND");var Ne=babelHelpers.classPrivateFieldLooseKey("registerCommands");var _e=babelHelpers.classPrivateFieldLooseKey("registerComponents");class Me extends ie{constructor(e){super(e);Object.defineProperty(this,_e,{value:Se});Object.defineProperty(this,Ne,{value:De});babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]();babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]()}static getName(){return"Quote"}static getNodes(e){return[Pe]}importBBCode(){return{quote:()=>({conversion:e=>({node:me(),after:e=>U(e)}),priority:0})}}exportBBCode(){return{quote:e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createElement({name:"quote"})}}}}validateScheme(){return{nodes:[{nodeClass:Pe,validate:e=>{let t=null;e.getChildren().forEach((e=>{if(k(e)){if(t===null){const s=L.$createParagraphNode();e.replace(s);s.append(e);t=s}else{t.append(e)}}else{t=null}}));return false}}],bbcodeMap:{quote:"quote"}}}}function De(){this.cleanUpRegister(this.getEditor().registerCommand(Ce,(e=>{const t=me();if(F.Type.isPlainObject(e)&&F.Type.isStringFilled(e.content)){const s=K(e.content,this.getEditor(),false);t.append(...U(s));y.$insertNodeToNearestRoot(t)}else{t.append(L.$createParagraphNode());y.$insertNodeToNearestRoot(t)}t.selectStart();return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(Oe,(()=>{const e=L.$getSelection()||L.$getPreviousSelection();if(L.$isRangeSelection(e)){const t=me();Be(e,(()=>t));if(t.isEmpty()){t.append(L.$createParagraphNode())}t.selectStart()}return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(Te,(()=>{const e=L.$getSelection()||L.$getPreviousSelection();if(!L.$isRangeSelection(e)){return false}let t=y.$findMatchingParent(e.anchor.getNode(),Le);if(!t){t=y.$findMatchingParent(e.focus.getNode(),Le)}ye(t);return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(Ee,(()=>{const e=L.$getSelection()||L.$getPreviousSelection();if(!L.$isRangeSelection(e)){return false}let t=y.$findMatchingParent(e.anchor.getNode(),Le);if(!t){t=y.$findMatchingParent(e.focus.getNode(),Le)}if(t){this.getEditor().dispatchCommand(Te)}else if(this.getEditor().getNewLineMode()===N.LINE_BREAK){this.getEditor().dispatchCommand(Ce)}else{this.getEditor().dispatchCommand(Oe)}return true}),L.COMMAND_PRIORITY_LOW))}function Se(){this.getEditor().getComponentRegistry().register("quote",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --quote"></span>');e.setBlockType("quote");e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_QUOTE"));e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{if(e.isActive()){this.getEditor().dispatchCommand(Te)}else if(this.getEditor().getNewLineMode()===N.LINE_BREAK){this.getEditor().dispatchCommand(Ce)}else{this.getEditor().dispatchCommand(Oe)}}))}));return e}))}var Re=Object.freeze({QuoteNode:Pe,$createQuoteNode:me,$isQuoteNode:Le,$removeQuote:ye,INSERT_QUOTE_COMMAND:Ce,FORMAT_QUOTE_COMMAND:Oe,REMOVE_QUOTE_COMMAND:Te,TOGGLE_QUOTE_COMMAND:Ee,QuotePlugin:Me});function Ie(e){const t=we();return{node:t}}class xe extends L.ElementNode{static getType(){return"spoiler-content"}static clone(e){return new xe(e.__key)}createDOM(e,t){var s,i;const r=document.createElement("div");if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:(i=s.spoiler)==null?void 0:i.content)){F.Dom.addClass(r,e.theme.spoiler.content)}return r}updateDOM(e,t,s){return false}static importDOM(){return{div:e=>{if(!e.hasAttribute("data-spoiler-content")){return null}return{conversion:Ie,priority:2}}}}static importJSON(e){return we()}exportDOM(){const e=document.createElement("div");e.setAttribute("data-spoiler-content","true");return{element:e}}exportJSON(){return{...super.exportJSON(),type:"spoiler-content",version:1}}isShadowRoot(){return true}isParentRequired(){return true}createParentElementNode(){return ut()}canIndent(){return false}canInsertAfter(e){return false}canReplaceWith(e){return false}insertBefore(e){const t=this.getFirstChild();const s=L.$isElementNode(e)||L.$isDecoratorNode(e)?e:L.$createParagraphNode().append(e);if(t===null){this.append(s)}else if(t!==s){t.insertBefore(s)}return s}insertAfter(e){const t=L.$isElementNode(e)||L.$isDecoratorNode(e)?e:L.$createParagraphNode().append(e);this.append(t);return t}}function we(){return new xe}function Ae(e){return e instanceof xe}class $e extends L.TextNode{static getType(){return"spoiler-title-text"}static clone(e){return new $e(e.__text,e.__key)}createDOM(e){return super.createDOM(e)}static importJSON(e){return Ke(e.text)}exportJSON(){return{...super.exportJSON(),type:"spoiler-title-text"}}}function Ke(e=""){return L.$applyNodeReplacement(new $e(e))}function je(e){return e instanceof $e}const ke=L.createCommand("INSERT_SPOILER_COMMAND");const Ue=L.createCommand("REMOVE_SPOILER_COMMAND");const We=L.createCommand("TOGGLE_SPOILER_COMMAND");var Ye=babelHelpers.classPrivateFieldLooseKey("registerComponents");var ze=babelHelpers.classPrivateFieldLooseKey("registerCommands");var Xe=babelHelpers.classPrivateFieldLooseKey("registerNodeTransforms");var Ge=babelHelpers.classPrivateFieldLooseKey("handleDeleteCharacter");var Ve=babelHelpers.classPrivateFieldLooseKey("handleEnter");var Je=babelHelpers.classPrivateFieldLooseKey("handlePaste");class qe extends ie{constructor(e){super(e);Object.defineProperty(this,Je,{value:it});Object.defineProperty(this,Ve,{value:st});Object.defineProperty(this,Ge,{value:tt});Object.defineProperty(this,Xe,{value:et});Object.defineProperty(this,ze,{value:Ze});Object.defineProperty(this,Ye,{value:Qe});babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]();babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]();babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]()}static getName(){return"Spoiler"}static getNodes(e){return[ht,lt,xe,$e]}importBBCode(){return{spoiler:()=>({conversion:e=>{const t=F.Type.isStringFilled(e.getValue())?at(e.getValue()):F.Loc.getMessage("TEXT_EDITOR_SPOILER_TITLE");return{node:ut(false),after:e=>[nt().append(Ke(t)),we().append(...U(e))]}},priority:0})}}exportBBCode(){return{spoiler:e=>{const t=this.getEditor().getBBCodeScheme();const s=e.getChildren()[0];const i=at(s.getTextContent());const r=i===F.Loc.getMessage("TEXT_EDITOR_SPOILER_TITLE")?"":i;return{node:t.createElement({name:"spoiler",value:r})}},"spoiler-title":e=>({node:null}),"spoiler-content":e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createFragment()}}}}validateScheme(){return{nodes:[{nodeClass:ht},{nodeClass:xe,validate:e=>{e.getChildren().forEach((e=>{if(k(e)){const t=L.$createParagraphNode();e.replace(t);t.append(e)}}));return false}}],bbcodeMap:{spoiler:"spoiler","spoiler-content":"spoiler","spoiler-title":"spoiler"}}}}function Qe(){this.getEditor().getComponentRegistry().register("spoiler",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --insert-spoiler"></span>');e.setBlockType("spoiler");e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_SPOILER"));e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{if(e.isActive()){this.getEditor().dispatchCommand(Ue)}else{this.getEditor().dispatchCommand(ke)}}))}));return e}))}function Ze(){this.cleanUpRegister(this.getEditor().registerCommand(L.DELETE_CHARACTER_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge].bind(this),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_ENTER_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].bind(this),L.COMMAND_PRIORITY_NORMAL),this.getEditor().registerCommand(L.INSERT_PARAGRAPH_COMMAND,(e=>{const t=L.$getSelection();if(L.$isRangeSelection(t)){const e=y.$findMatchingParent(t.anchor.getNode(),(e=>dt(e)));if(e){const s=e.insertNewAfter(t);if(s){s.selectStart()}return true}}return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.PASTE_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].bind(this),L.COMMAND_PRIORITY_NORMAL),this.getEditor().registerCommand(ke,(e=>{this.getEditor().update((()=>{const t=F.Type.isPlainObject(e)&&F.Type.isStringFilled(e.title)?e.title:undefined;let s=L.$getSelection()||L.$getPreviousSelection();if(s===null){s=L.$getRoot().selectEnd()}const i=rt(s,t);if(i!==null){var r,a;(r=i.getContentNode())==null?void 0:(a=r.getChildren()[0])==null?void 0:a.select()}}));return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(Ue,(()=>{this.getEditor().update((()=>{const e=L.$getSelection();if(!L.$isRangeSelection(e)){return}let t=y.$findMatchingParent(e.anchor.getNode(),pt);if(!t){t=y.$findMatchingParent(e.focus.getNode(),pt)}ct(t)}));return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(We,(()=>{const e=L.$getSelection()||L.$getPreviousSelection();if(!L.$isRangeSelection(e)){return false}let t=y.$findMatchingParent(e.anchor.getNode(),pt);if(!t){t=y.$findMatchingParent(e.focus.getNode(),pt)}if(t){this.getEditor().dispatchCommand(Ue)}else{this.getEditor().dispatchCommand(ke)}return true}),L.COMMAND_PRIORITY_LOW))}function et(){this.cleanUpRegister(this.getEditor().registerNodeTransform(ht,(e=>{const t=e.getChildren();if(t.length!==2||!dt(t[0])||!Ae(t[1])){for(const s of t){if(L.$isElementNode(s)||L.$isDecoratorNode(s)){e.insertBefore(s)}else{e.insertBefore(L.$createParagraphNode().append(s))}}e.remove()}})),this.getEditor().registerNodeTransform(lt,(e=>{const t=e.getParent();if(!pt(t)){e.replace(L.$createParagraphNode().append(...e.getChildren()))}else if(e.getChildrenSize()===1&&!je(e.getFirstChild())||e.getChildrenSize()>1){L.$setSelection(null);const t=at(e.getTextContent());e.clear();e.append(Ke(t));e.select()}})),this.getEditor().registerNodeTransform($e,(e=>{const t=e.getParent();if(!dt(t)){e.replace(L.$createParagraphNode().append(L.$createTextNode(e.getTextContent())))}})),this.getEditor().registerNodeTransform(xe,(e=>{const t=e.getParent();if(!pt(t)){const t=e.getChildren();for(const s of t){if(L.$isElementNode(s)||L.$isDecoratorNode(s)){e.insertBefore(s)}else{e.insertBefore(L.$createParagraphNode().append(s))}}e.remove()}})))}function tt(){const e=L.$getSelection();if(!L.$isRangeSelection(e)||!e.isCollapsed()||e.anchor.offset!==0){return false}const t=e.anchor.getNode();const s=t.getTopLevelElement();if(s===null){return false}const i=s.getPreviousSibling();if(!pt(i)||i.getOpen()){return false}i.setOpen(true);return true}function st(e){if(e&&(e.ctrlKey||e.metaKey)){const e=L.$getPreviousSelection();if(L.$isRangeSelection(e)&&e.isCollapsed()){const t=y.$findMatchingParent(e.anchor.getNode(),(e=>L.$isElementNode(e)&&!e.isInline()));if(dt(t)){const s=t.getParent();if(pt(s)){s.toggleOpen();L.$setSelection(e.clone());return true}}}}return false}function it(e){const t=L.$getSelection();if(!L.$isRangeSelection(t)||!(e instanceof ClipboardEvent)||e.clipboardData===null){return false}const s=y.$findMatchingParent(t.anchor.getNode(),(e=>dt(e)));if(s){e.preventDefault();this.getEditor().update((()=>{r.$insertDataTransferForPlainText(e.clipboardData,t)}),{tag:"paste"});return true}return false}function rt(e,t){if(!L.$isRangeSelection(e)){return null}const s=e.anchor;const i=s.getNode();const r=bt(true,t);if(L.$isRootOrShadowRoot(i)){const e=i.getFirstChild();if(e){e.replace(r,true)}else{i.append(r)}return r}const a=new Set;const o=e.getNodes();const l=Fe(e.anchor.getNode(),He);if(l&&!o.includes(l)){o.unshift(l)}a.add(r.getKey());a.add(r.getTitleNode().getKey());a.add(r.getContentNode().getKey());let n=true;for(const e of o){if(!He(e)||a.has(e.getKey())){continue}const t=Fe(e.getParent(),(e=>a.has(e.getKey())));if(t){continue}if(n){n=false;e.replace(r);r.getContentNode().append(e)}else{r.getContentNode().append(e)}a.add(e.getKey())}return r}function at(e){return e.trim().replaceAll(/\r?\n|\t/gm,"").replace("\r","").replaceAll(/\s+/g," ")}function ot(e){const t=nt();return{node:t}}class lt extends L.ElementNode{constructor(...e){super(...e);this.__language="hack";this.__flags=E}static getType(){return"spoiler-title"}static clone(e){return new lt(e.__key)}createDOM(e,t){var s,i;const r=document.createElement("summary");r.tabIndex=-1;if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:(i=s.spoiler)==null?void 0:i.title)){F.Dom.addClass(r,e.theme.spoiler.title)}F.Dom.addClass(r,"ui-icon-set__scope");return r}updateDOM(e,t,s){return false}static importDOM(){return{summary:e=>({conversion:ot,priority:1})}}static importJSON(e){return nt()}exportDOM(){const e=document.createElement("summary");return{element:e}}exportJSON(){return{...super.exportJSON(),type:"spoiler-title",version:1}}collapseAtStart(e){const t=this.getParent();if(!pt(t)){return false}return ct(t)}insertNewAfter(e,t=true){const s=this.getParentOrThrow();if(!pt(s)){throw new Error("SpoilerTitleNode expects to be child of SpoilerNode")}if(s.getOpen()){const e=this.getNextSibling();if(!Ae(e)){throw new Error("SpoilerTitleNode expects to have SpoilerContentNode sibling")}const t=e.getFirstChild();if(L.$isElementNode(t)||L.$isDecoratorNode(t)){return t}const s=L.$createParagraphNode();e.append(s);return s}const i=L.$createParagraphNode();s.insertAfter(i,t);return i}isParentRequired(){return true}createParentElementNode(){return ut()}canIndent(){return false}insertAfter(e){const t=e.getTextContent();this.clear();this.append(Ke(at(t)));return this}}function nt(){return new lt}function dt(e){return e instanceof lt}function ct(e){if(!pt(e)){return false}const t=e.getContentNode();let s=e;if(t!==null){for(const e of t.getChildren()){if(L.$isElementNode(e)||L.$isDecoratorNode(e)){s=s.insertAfter(e)}else{s=s.insertAfter(L.$createParagraphNode().append(e))}}}e.remove();return true}class ht extends L.ElementNode{constructor(e,t){super(t);this.__open=e}static getType(){return"spoiler"}static clone(e){return new ht(e.__open,e.__key)}createDOM(e,t){var s,i;const r=document.createElement("details");if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:(i=s.spoiler)==null?void 0:i.container)){F.Dom.addClass(r,e.theme.spoiler.container)}r.open=this.__open;F.Event.bind(r,"toggle",(()=>{const e=t.getEditorState().read((()=>this.getOpen()));if(e!==r.open){t.update((()=>this.toggleOpen()))}}));return r}updateDOM(e,t,s){if(e.__open!==this.__open){t.open=this.__open}return false}static importDOM(){return{details:e=>({conversion:e=>{const t=F.Type.isBoolean(e.open)?e.open:true;return{node:bt(t)}},priority:1})}}static importJSON(e){return ut(e.open)}exportDOM(e){const t=document.createElement("details");if(this.__open){t.setAttribute("open",true)}return{element:t}}exportJSON(){return{...super.exportJSON(),open:this.__open,type:"spoiler",version:1}}canBeEmpty(){return false}append(...e){for(const t of e){if(dt(t)){const e=t;if(this.getTitleNode()===null){super.append(e)}else{this.getTitleNode().clear();this.getTitleNode().append(Ke(t.getTextContent()))}}else if(Ae(t)){const e=t;if(this.getContentNode()===null){super.append(e)}else{this.getContentNode().append(...e.getChildren())}}else if(L.$isElementNode(t)||L.$isDecoratorNode(t)){this.getContentNode().append(t)}else{this.getContentNode().append(L.$createParagraphNode().append(t))}}return this}getTitleNode(){return this.getChildren()[0]||null}getContentNode(){return this.getChildren()[1]||null}setOpen(e){const t=this.getWritable();t.__open=e}getOpen(){return this.getLatest().__open}toggleOpen(){this.setOpen(!this.getOpen())}}function bt(e,t=F.Loc.getMessage("TEXT_EDITOR_SPOILER_TITLE")){return ut(e).append(nt().append(Ke(t)),we())}function ut(e){return new ht(e)}function pt(e){return e instanceof ht}var gt=Object.freeze({SpoilerNode:ht,$createSpoiler:bt,$createSpoilerNode:ut,$isSpoilerNode:pt,convertSummaryElement:ot,SpoilerTitleNode:lt,$createSpoilerTitleNode:nt,$isSpoilerTitleNode:dt,$removeSpoiler:ct,convertSpoilerContentElement:Ie,SpoilerContentNode:xe,$createSpoilerContentNode:we,$isSpoilerContentNode:Ae,INSERT_SPOILER_COMMAND:ke,REMOVE_SPOILER_COMMAND:Ue,TOGGLE_SPOILER_COMMAND:We,SpoilerPlugin:qe,insertSpoiler:rt,trimSpoilerTitle:at});class vt extends L.ParagraphNode{constructor(e,t){super(t);this.__mode=N.MIXED;this.__mode=e}static getType(){return"custom-paragraph"}static clone(e){return new vt(e.__mode,e.__key)}insertNewAfter(e,t){if(this.__mode===N.PARAGRAPH){return super.insertNewAfter(e,t)}if(this.__mode===N.MIXED){const s=this.getChildren();const i=s.length;if(i>=1&&s[i-1].getTextContent()==="\n"&&e.isCollapsed()&&e.anchor.key===this.__key&&e.anchor.offset===i){s[i-1].remove();const e=L.$createParagraphNode();this.insertAfter(e,t);return e}if(L.$hasUpdateTag("paste")){return super.insertNewAfter(e,t)}}e.insertLineBreak();return null}exportJSON(){return{...super.exportJSON(),mode:this.__mode,type:"custom-paragraph",version:1}}static importDOM(){return{p:e=>({conversion:e=>({node:L.$createParagraphNode()}),priority:1}),h1:e=>({conversion:ft,priority:1}),h2:e=>({conversion:ft,priority:1}),h3:e=>({conversion:ft,priority:1}),h4:e=>({conversion:ft,priority:1}),h5:e=>({conversion:ft,priority:1}),h6:e=>({conversion:ft,priority:1})}}collapseAtStart(){const e=this.getChildren();if(e.length===0||L.$isTextNode(e[0])&&e[0].getTextContent().trim()===""){const e=this.getNextSibling();if(e!==null){this.selectNext();this.remove();return true}const t=this.getPreviousSibling();if(t!==null){this.selectPrevious();this.remove();return true}const s=this.getParent();if(s!==null&&!L.$isRootNode(s)&&Object.getPrototypeOf(s).hasOwnProperty("collapseAtStart")){return s.collapseAtStart()}}return false}static importJSON(e){return super.importJSON(e)}}function ft(e){return{node:L.$createParagraphNode(),forChild:e=>{if(L.$isTextNode(e)){e.toggleFormat("bold")}return e}}}const Pt=L.createCommand("FORMAT_PARAGRAPH_COMMAND");var mt=babelHelpers.classPrivateFieldLooseKey("registerCommands");var Lt=babelHelpers.classPrivateFieldLooseKey("registerListeners");var yt=babelHelpers.classPrivateFieldLooseKey("isBlockNode");var Ft=babelHelpers.classPrivateFieldLooseKey("handlePaste");var Ht=babelHelpers.classPrivateFieldLooseKey("handleEscapeUp");var Bt=babelHelpers.classPrivateFieldLooseKey("handleEscapeDown");class Ct extends ie{constructor(e){super(e);Object.defineProperty(this,Bt,{value:Mt});Object.defineProperty(this,Ht,{value:_t});Object.defineProperty(this,Ft,{value:Nt});Object.defineProperty(this,yt,{value:Et});Object.defineProperty(this,Lt,{value:Tt});Object.defineProperty(this,mt,{value:Ot});babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]();babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]()}static getName(){return"Paragraph"}static getNodes(e){return[vt,{replace:L.ParagraphNode,with:t=>new vt(e.getNewLineMode()),withClass:vt}]}importBBCode(){return{p:()=>({conversion:e=>Dt(e),priority:0}),left:()=>({conversion:e=>Dt(e),priority:0}),right:()=>({conversion:e=>Dt(e),priority:0}),center:()=>({conversion:e=>Dt(e),priority:0}),justify:()=>({conversion:e=>Dt(e),priority:0})}}exportBBCode(){return{paragraph:e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createElement({name:"p"})}},"custom-paragraph":e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createElement({name:"p"})}}}}validateScheme(){return{nodes:[{nodeClass:vt}],bbcodeMap:{root:"#root",tab:"#tab",text:"#text",paragraph:"p","custom-paragraph":"p",linebreak:"#linebreak"}}}}function Ot(){this.cleanUpRegister(this.getEditor().registerCommand(Pt,(()=>{const e=L.$getSelection();if(L.$isRangeSelection(e)){d.$setBlocksType(e,(()=>L.$createParagraphNode()))}return true}),L.COMMAND_PRIORITY_EDITOR))}function Tt(){this.cleanUpRegister(this.getEditor().registerNodeTransform(L.RootNode,(e=>{const t=L.$getSelection();if(L.$isRangeSelection(t)){const s=t.anchor.getNode();const i=t.focus.getNode();if(!s.isAttached()||!i.isAttached()){e.selectEnd();console.warn("TextEditor: selection has been moved to the end of the editor because the previously "+"selected nodes have been removed and selection wasn't moved to another node. "+"Ensure selection changes after removing/replacing a selected node.")}}const s=e.getLastChild();if(!L.$isParagraphNode(s)){e.append(L.$createParagraphNode())}})),this.getEditor().registerCommand(L.KEY_ARROW_UP_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].bind(this),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_ARROW_LEFT_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].bind(this),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_ARROW_DOWN_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt].bind(this),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_ARROW_RIGHT_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt].bind(this),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.PASTE_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft].bind(this),L.COMMAND_PRIORITY_LOW))}function Et(e){return Le(e)||Kt(e)||pt(e)}function Nt(e){if(this.getEditor().getNewLineMode()===N.LINE_BREAK){e.preventDefault();this.getEditor().update((()=>{const t=L.$getSelection();const{clipboardData:s}=e;if(s!==null&&L.$isRangeSelection(t)){r.$insertDataTransferForPlainText(s,t)}}),{tag:"paste"});return true}const t=e.clipboardData;if(!t||t.items.length!==1||t.items[0].type!=="text/plain"&&t.items[0].type!=="text/uri-list"){return false}const s=t.getData("text/plain")||t.getData("text/uri-list");const i=/\n/.test(s);if(!i){return false}e.preventDefault();e.stopPropagation();const a=fe(s);const o=new DataTransfer;o.setData("text/plain",t.getData("text/plain"));o.setData("text/html",a);const l=new ClipboardEvent("paste",{clipboardData:o,bubbles:true,cancelable:true});if(l.clipboardData.items.length===0){l.clipboardData.setData("text/plain",t.getData("text/plain"));l.clipboardData.setData("text/html",a)}this.getEditor().getEditableContainer().dispatchEvent(l);return true}function _t(){const e=L.$getSelection();if(L.$isRangeSelection(e)&&e.isCollapsed()&&e.anchor.offset===0){const s=y.$findMatchingParent(e.anchor.getNode(),babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]);if(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt](s)){var t;const i=s.getParent();if(i!==null&&i.getFirstChild()===s&&(e.anchor.key===((t=s.getFirstDescendant())==null?void 0:t.getKey())||e.anchor.key===s.getKey())){s.insertBefore(L.$createParagraphNode())}}}return false}function Mt(){const e=L.$getSelection();if(L.$isRangeSelection(e)&&e.isCollapsed()){const t=y.$findMatchingParent(e.anchor.getNode(),babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]);if(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt](t)){const s=t.getParent();if(s!==null&&s.getLastChild()===t){const s=t.getFirstDescendant();const i=t.getLastDescendant();if(i!==null&&e.anchor.key===i.getKey()&&e.anchor.offset===i.getTextContentSize()||s!==null&&e.anchor.key===s.getKey()&&e.anchor.offset===s.getTextContentSize()||e.anchor.key===t.getKey()&&e.anchor.offset===t.getTextContentSize()){t.insertAfter(L.$createParagraphNode())}}}}return false}function Dt(e){return{node:L.$createParagraphNode()}}var St=Object.freeze({FORMAT_PARAGRAPH_COMMAND:Pt,ParagraphPlugin:Ct});class Rt extends L.TextNode{constructor(e,t,s){super(e,s);this.__flags=E;this.__highlightType=t}static getType(){return"code-token"}static clone(e){return new Rt(e.__text,e.__highlightType||undefined,e.__key)}getHighlightType(){const e=this.getLatest();return e.__highlightType}createDOM(e){const t=super.createDOM(e);const s=It(e.theme,this.__highlightType);y.addClassNamesToElement(t,s);return t}updateDOM(e,t,s){const i=super.updateDOM(e,t,s);const r=It(s.theme,e.__highlightType);const a=It(s.theme,this.__highlightType);if(r!==a){if(r){y.removeClassNamesFromElement(t,r)}if(a){y.addClassNamesToElement(t,a)}}return i}static importJSON(e){const t=xt(e.text,e.highlightType);t.setFormat(e.format);t.setDetail(e.detail);t.setMode(e.mode);t.setStyle(e.style);return t}exportJSON(){return{...super.exportJSON(),highlightType:this.getHighlightType(),type:"code-token",version:1}}setFormat(e){return this}isParentRequired(){return true}createParentElementNode(){return $t()}}function It(e,t){return t&&e&&e.codeHighlight&&e.codeHighlight[t]}function xt(e,t){return L.$applyNodeReplacement(new Rt(e,t))}function wt(e){return e instanceof Rt}class At extends L.ElementNode{constructor(...e){super(...e);this.__language="lexical-hack";this.__flags=E}static getType(){return"code"}static clone(e){return new At(e.__key)}createDOM(e,t){var s;const i=document.createElement("code");i.setAttribute("spellcheck","false");if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:s.code)){F.Dom.addClass(i,e.theme.code)}return i}updateDOM(e,t,s){return false}exportDOM(e){var t,s;const i=document.createElement("pre");i.setAttribute("spellcheck","false");if(F.Type.isStringFilled((t=e._config)==null?void 0:(s=t.theme)==null?void 0:s.code)){F.Dom.addClass(i,e._config.theme.code)}return{element:i}}static importDOM(){return{code:e=>{const t=e.textContent!==null&&(/\r?\n/.test(e.textContent)||Jt(e,"BR"));return t?{conversion:jt,priority:1}:null},div:e=>({conversion:kt,priority:1}),pre:e=>({conversion:jt,priority:0}),table:e=>{const t=e;if(Vt(t)){return{conversion:Ut,priority:3}}return null},td:e=>{const t=e;const s=t.closest("table");if(Gt(t)){return{conversion:Yt,priority:3}}if(s&&Vt(s)){return{conversion:Wt,priority:3}}return null},tr:e=>{const t=e;const s=t.closest("table");if(s&&Vt(s)){return{conversion:Wt,priority:3}}return null}}}static importJSON(e){const t=$t();t.setFormat(e.format);t.setIndent(e.indent);t.setDirection(e.direction);return t}exportJSON(){return{...super.exportJSON(),type:"code"}}canIndent(){return false}canReplaceWith(e){return false}isInline(){return false}collapseAtStart(e){const t=L.$createParagraphNode();const s=this.getChildren();s.forEach((e=>t.append(e)));this.replace(t);return true}insertNewAfter(e,t=true){const s=this.getChildren();const i=s.length;if(i>=2&&s[i-1].getTextContent()==="\n"&&s[i-2].getTextContent()==="\n"&&e.isCollapsed()&&e.anchor.key===this.__key&&e.anchor.offset===i){s[i-1].remove();s[i-2].remove();const e=L.$createParagraphNode();this.insertAfter(e,t);return e}const{anchor:r,focus:a}=e;const o=r.isBefore(a)?r:a;const l=o.getNode();if(L.$isTextNode(l)){let e=ms(l);const t=[];while(true){if(L.$isTabNode(e)){t.push(L.$createTabNode());e=e.getNextSibling()}else if(wt(e)){let s=0;const i=e.getTextContent();const r=e.getTextContentSize();while(s<r&&i[s]===" "){s++}if(s!==0){t.push(xt(" ".repeat(s)))}if(s!==r){break}e=e.getNextSibling()}else{break}}const s=l.splitText(r.offset)[0];const i=r.offset===0?0:1;const a=s.getIndexWithinParent()+i;const o=l.getParentOrThrow();const d=[L.$createLineBreakNode(),...t];o.splice(a,0,d);const c=t[t.length-1];if(c){c.select()}else if(r.offset===0){s.selectPrevious()}else{var n;(n=s.getNextSibling())==null?void 0:n.selectNext(0,0)}}if(Kt(l)){const{offset:t}=e.anchor;l.splice(t,0,[L.$createLineBreakNode()]);l.select(t+1,t+1)}return null}}function $t(){return L.$applyNodeReplacement(new At)}function Kt(e){return e instanceof At}function jt(e){return{node:$t()}}function kt(e){const t=e;const s=zt(t);if(!s&&!Xt(t)){return{node:null}}return{after:t=>{const s=e.parentNode;if(s!==null&&e!==s.lastChild){t.push(L.$createLineBreakNode())}return t},node:s?$t():null}}function Ut(){return{node:$t()}}function Wt(){return{node:null}}function Yt(e){const t=e;return{after:e=>{if(t.parentNode&&t.parentNode.nextSibling){e.push(L.$createLineBreakNode())}return e},node:null}}function zt(e){return e.style.fontFamily.match("monospace")!==null}function Xt(e){let t=e.parentElement;while(t!==null){if(zt(t)){return true}t=t.parentElement}return false}function Gt(e){return e.classList.contains("js-file-line")}function Vt(e){return e.classList.contains("js-file-line-container")}function Jt(e,t){let s=false;for(const i of e.childNodes){if(F.Type.isElementNode(i)&&i.tagName===t){return true}s=Jt(i,t)}return s}const qt=L.createCommand("FORMAT_CODE_COMMAND");const Qt=L.createCommand("TOGGLE_CODE_COMMAND");const Zt=L.createCommand("INSERT_CODE_COMMAND");var es=babelHelpers.classPrivateFieldLooseKey("nodesCurrentlyHighlighting");var ts=babelHelpers.classPrivateFieldLooseKey("codeParser");var ss=babelHelpers.classPrivateFieldLooseKey("registerComponents");var is=babelHelpers.classPrivateFieldLooseKey("registerListeners");var rs=babelHelpers.classPrivateFieldLooseKey("registerCommands");var as=babelHelpers.classPrivateFieldLooseKey("handleCodeNodeTransform");var os=babelHelpers.classPrivateFieldLooseKey("handleTextNodeTransform");var ls=babelHelpers.classPrivateFieldLooseKey("handleTab");var ns=babelHelpers.classPrivateFieldLooseKey("handleMultilineIndent");class ds extends ie{constructor(e){super(e);Object.defineProperty(this,ns,{value:vs});Object.defineProperty(this,ls,{value:gs});Object.defineProperty(this,os,{value:ps});Object.defineProperty(this,as,{value:us});Object.defineProperty(this,rs,{value:bs});Object.defineProperty(this,is,{value:hs});Object.defineProperty(this,ss,{value:cs});Object.defineProperty(this,es,{writable:true,value:new Set});Object.defineProperty(this,ts,{writable:true,value:new t.CodeParser});babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]();babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]();babelHelpers.classPrivateFieldLooseBase(this,is)[is]()}static getName(){return"Code"}static getNodes(e){return[At,Rt]}importBBCode(){return{code:()=>({conversion:e=>({node:$t(),after:e=>{const t=e.map((e=>e.getTextContent())).join("");return[L.$createTextNode(t)]}}),priority:0})}}exportBBCode(){return{code:e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createElement({name:"code"})}},"code-token":e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createText({content:e.getTextContent(),encode:false})}}}}validateScheme(){return{nodes:[{nodeClass:At}],bbcodeMap:{code:"code"}}}}function cs(){this.getEditor().getComponentRegistry().register("code",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --enclose-text-in-code-tag"></span>');e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_CODE"));e.setBlockType("code");e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{if(e.isActive()){this.getEditor().dispatchCommand(Pt)}else{this.getEditor().dispatchCommand(qt)}}))}));return e}))}function hs(){const e=babelHelpers.classPrivateFieldLooseBase(this,os)[os].bind(this);this.cleanUpRegister(this.getEditor().registerNodeTransform(At,babelHelpers.classPrivateFieldLooseBase(this,as)[as].bind(this)),this.getEditor().registerNodeTransform(L.TextNode,e),this.getEditor().registerNodeTransform(Rt,e),this.getEditor().registerCommand(L.FORMAT_TEXT_COMMAND,(()=>{const e=L.$getSelection();if(!L.$isRangeSelection(e)){return false}const t=w(e);return wt(t)||Kt(t)}),L.COMMAND_PRIORITY_HIGH),this.getEditor().registerCommand(L.KEY_TAB_COMMAND,(e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,ls)[ls](e.shiftKey);if(t===null){return false}e.preventDefault();this.getEditor().dispatchCommand(t);return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.INSERT_TAB_COMMAND,(()=>{const e=L.$getSelection();if(!fs(e)){return false}L.$insertNodes([L.$createTabNode()]);return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.INDENT_CONTENT_COMMAND,(e=>babelHelpers.classPrivateFieldLooseBase(this,ns)[ns](L.INDENT_CONTENT_COMMAND)),L.COMMAND_PRIORITY_NORMAL),this.getEditor().registerCommand(L.OUTDENT_CONTENT_COMMAND,(e=>babelHelpers.classPrivateFieldLooseBase(this,ns)[ns](L.OUTDENT_CONTENT_COMMAND)),L.COMMAND_PRIORITY_NORMAL),this.getEditor().registerCommand(L.PASTE_COMMAND,(e=>{const t=L.$getSelection();if(!L.$isRangeSelection(t)||!(e instanceof ClipboardEvent)||e.clipboardData===null){return false}const s=y.$findMatchingParent(t.anchor.getNode(),(e=>Kt(e)));if(s){e.preventDefault();this.getEditor().update((()=>{r.$insertDataTransferForPlainText(e.clipboardData,t)}),{tag:"paste"});return true}return false}),L.COMMAND_PRIORITY_NORMAL))}function bs(){this.cleanUpRegister(this.getEditor().registerCommand(Zt,(e=>{const t=$t();if(F.Type.isPlainObject(e)&&F.Type.isStringFilled(e.content)){const s=Hs(babelHelpers.classPrivateFieldLooseBase(this,ts)[ts].parse(e.content));t.append(...s);y.$insertNodeToNearestRoot(t)}else{y.$insertNodeToNearestRoot(t);t.selectEnd()}return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(qt,(()=>{const e=L.$getSelection()||L.$getPreviousSelection();if(L.$isRangeSelection(e)){if(e.isCollapsed()){d.$setBlocksType(e,(()=>$t()))}else{const t=e.getTextContent();const s=$t();e.insertNodes([s]);const i=L.$getSelection();if(L.$isRangeSelection(i)){i.insertRawText(t)}}}return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(Qt,(()=>{const e=L.$getSelection()||L.$getPreviousSelection();if(!L.$isRangeSelection(e)){return false}const t=y.$findMatchingParent(e.anchor.getNode(),(e=>Kt(e)||wt(e)));if(t){this.getEditor().dispatchCommand(Pt)}else{this.getEditor().dispatchCommand(qt)}return true}),L.COMMAND_PRIORITY_EDITOR))}function us(e){const t=e.getKey();if(babelHelpers.classPrivateFieldLooseBase(this,es)[es].has(t)){return}babelHelpers.classPrivateFieldLooseBase(this,es)[es].add(t);this.getEditor().update((()=>{Bs(t,(()=>{const s=L.$getNodeByKey(t);if(!Kt(s)||!s.isAttached()){return false}const i=s.getTextContent();const r=Hs(babelHelpers.classPrivateFieldLooseBase(this,ts)[ts].parse(i));const a=ys(s.getChildren(),r);const{from:o,to:l,nodesForReplacement:n}=a;if(o!==l||n.length>0){e.splice(o,l-o,n);return true}return false}))}),{onUpdate:()=>{babelHelpers.classPrivateFieldLooseBase(this,es)[es].delete(t)},skipTransforms:true})}function ps(e){const t=e.getParent();if(Kt(t)){babelHelpers.classPrivateFieldLooseBase(this,as)[as](t)}else if(wt(e)){e.replace(L.$createTextNode(e.__text))}}function gs(e){const t=L.$getSelection();if(!L.$isRangeSelection(t)||!fs(t)){return null}const s=e?L.OUTDENT_CONTENT_COMMAND:L.INDENT_CONTENT_COMMAND;const i=e?L.OUTDENT_CONTENT_COMMAND:L.INSERT_TAB_COMMAND;const r=Ps(t);if(r.length>1){return s}const a=t.getNodes();const o=a[0];if(Kt(o)){return s}const l=ms(o);const n=Ls(o);const d=t.anchor;const c=t.focus;let h=null;let b=null;if(c.isBefore(d)){h=c;b=d}else{h=d;b=c}if(l!==null&&n!==null&&h.key===l.getKey()&&h.offset===0&&b.key===n.getKey()&&b.offset===n.getTextContentSize()){return s}return i}function vs(e){const t=L.$getSelection();if(!L.$isRangeSelection(t)||!fs(t)){return false}const s=Ps(t);const i=s.length;if(s.length>1){for(let t=0;t<i;t++){const i=s[t];if(i.length>0){let s=i[0];if(t===0){s=ms(s)}if(s!==null){if(e===L.INDENT_CONTENT_COMMAND){s.insertBefore(L.$createTabNode())}else if(L.$isTabNode(s)){s.remove()}}}}return true}const r=t.getNodes();const a=r[0];if(Kt(a)){if(e===L.INDENT_CONTENT_COMMAND){t.insertNodes([L.$createTabNode()])}return true}const o=ms(a);if(e===L.INDENT_CONTENT_COMMAND){if(L.$isLineBreakNode(o)){o.insertAfter(L.$createTabNode())}else{o.insertBefore(L.$createTabNode())}}else if(L.$isTabNode(o)){o.remove()}return true}function fs(e){if(!L.$isRangeSelection(e)){return false}const t=e.anchor.getNode();const s=e.focus.getNode();if(t.is(s)&&Kt(t)){return true}const i=t.getParent();return Kt(i)&&i.is(s.getParent())}function Ps(e){const t=e.getNodes();const s=[[]];if(t.length===1&&Kt(t[0])){return s}let i=s[0];for(const[e,r]of t.entries()){if(L.$isLineBreakNode(r)){if(e!==0&&i.length>0){i=[];s.push(i)}}else{i.push(r)}}return s}function ms(e){let t=e;let s=e;while(wt(s)||L.$isTabNode(s)){t=s;s=s.getPreviousSibling()}return t}function Ls(e){let t=e;let s=e;while(wt(s)||L.$isTabNode(s)){t=s;s=s.getNextSibling()}return t}function ys(e,t){let s=0;while(s<e.length){if(!Fs(e[s],t[s])){break}s++}const i=e.length;const r=t.length;const a=Math.min(i,r)-s;let o=0;while(o<a){o++;if(!Fs(e[i-o],t[r-o])){o--;break}}const l=s;const n=i-o;const d=t.slice(s,r-o);return{from:l,nodesForReplacement:d,to:n}}function Fs(e,t){return wt(e)&&wt(t)&&e.__text===t.__text&&e.__highlightType===t.__highlightType||L.$isTabNode(e)&&L.$isTabNode(t)||L.$isLineBreakNode(e)&&L.$isLineBreakNode(t)}function Hs(e){const t=[];e.forEach((e=>{const s=e.content.split(/([\t\n])/);const i=s.length;for(let r=0;r<i;r++){const i=s[r];if(i==="\n"||i==="\r\n"){t.push(L.$createLineBreakNode())}else if(i==="\t"){t.push(L.$createTabNode())}else if(i.length>0){t.push(xt(i,e.type))}}}));return t}function Bs(e,t){const s=L.$getNodeByKey(e);if(!Kt(s)||!s.isAttached()){return}const i=L.$getSelection();if(!L.$isRangeSelection(i)){t();return}const r=i.anchor;const a=r.offset;const o=r.type==="element"&&L.$isLineBreakNode(s.getChildAtIndex(r.offset-1));let l=0;if(!o){const e=r.getNode();l=a+e.getPreviousSiblings().reduce(((e,t)=>e+t.getTextContentSize()),0)}const n=t();if(!n){return}if(o){r.getNode().select(a,a);return}s.getChildren().some((e=>{const t=L.$isTextNode(e);if(t||L.$isLineBreakNode(e)){const s=e.getTextContentSize();if(t&&s>=l){e.select(l,l);return true}l-=s}return false}))}var Cs=Object.freeze({FORMAT_CODE_COMMAND:qt,TOGGLE_CODE_COMMAND:Qt,INSERT_CODE_COMMAND:Zt,CodePlugin:ds,getFirstCodeNodeOfLine:ms,getLastCodeNodeOfLine:Ls,CodeNode:At,$createCodeNode:$t,$isCodeNode:Kt,CodeTokenNode:Rt,$createCodeTokenNode:xt,$isCodeTokenNode:wt});function Os(e,t){return e.getEditorState().read((()=>{const e=L.$getNodeByKey(t);if(e===null){return false}return e.isSelected()}))}function Ts(e,t){let s=false;const i=new Set;const r=e=>{i.add(e)};const a=y.mergeRegister(e.registerUpdateListener((()=>{s=Os(e,t);for(const e of i){e(s)}})),e.registerEditableListener((r=>{s=Os(e,t);for(const e of i){e(s&&r)}})));const o=s=>{e.update((()=>{let e=L.$getSelection();if(!L.$isNodeSelection(e)){e=L.$createNodeSelection();L.$setSelection(e)}if(s){e.add(t)}else{e.delete(t)}}))};const l=()=>{e.update((()=>{const e=L.$getSelection();if(L.$isNodeSelection(e)){e.clear()}}))};return{isSelected:()=>s,dispose:()=>{a()},onSelect:r,setSelected:o,clearSelection:l}}var Es=babelHelpers.classPrivateFieldLooseKey("textEditor");var Ns=babelHelpers.classPrivateFieldLooseKey("target");var _s=babelHelpers.classPrivateFieldLooseKey("nodeKey");var Ms=babelHelpers.classPrivateFieldLooseKey("options");var Ds=babelHelpers.classPrivateFieldLooseKey("nodeSelection");var Ss=babelHelpers.classPrivateFieldLooseKey("unregisterCommands");var Rs=babelHelpers.classPrivateFieldLooseKey("registerCommands");var Is=babelHelpers.classPrivateFieldLooseKey("handleDelete");class xs{constructor(e){Object.defineProperty(this,Is,{value:As});Object.defineProperty(this,Rs,{value:ws});Object.defineProperty(this,Es,{writable:true,value:null});Object.defineProperty(this,Ns,{writable:true,value:null});Object.defineProperty(this,_s,{writable:true,value:null});Object.defineProperty(this,Ms,{writable:true,value:{}});Object.defineProperty(this,Ds,{writable:true,value:null});Object.defineProperty(this,Ss,{writable:true,value:null});const{textEditor:t,target:s,nodeKey:i,options:r}=e;babelHelpers.classPrivateFieldLooseBase(this,Es)[Es]=t;babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]=s;babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]=i;babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]=r;babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds]=Ts(this.getEditor(),this.getNodeKey());babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].onSelect((e=>{if(e){F.Dom.addClass(this.getTarget(),"--selected")}else{F.Dom.removeClass(this.getTarget(),"--selected")}}));babelHelpers.classPrivateFieldLooseBase(this,Ss)[Ss]=babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs]()}update(e){}destroy(){babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].dispose();babelHelpers.classPrivateFieldLooseBase(this,Ss)[Ss]()}getEditor(){return babelHelpers.classPrivateFieldLooseBase(this,Es)[Es]}getNodeKey(){return babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]}getTarget(){return babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]}getNodeSelection(){return babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds]}isSelected(){return babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].isSelected()}setSelected(e){babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].setSelected(e)}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]}getOption(e,t){if(!F.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms][e])){return babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms][e]}if(!F.Type.isUndefined(t)){return t}return null}}function ws(){return y.mergeRegister(this.getEditor().registerCommand(L.CLICK_COMMAND,(e=>{if(!this.getEditor().isEditable()){return false}if(this.getTarget().contains(e.target)){if(e.shiftKey){babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].setSelected(!babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].isSelected())}else{babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].clearSelection();babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].setSelected(true)}return true}return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_DELETE_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Is)[Is].bind(this),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_BACKSPACE_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,Is)[Is].bind(this),L.COMMAND_PRIORITY_LOW))}function As(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].isSelected()&&L.$isNodeSelection(L.$getSelection())){e.preventDefault();const t=L.$getNodeByKey(this.getNodeKey());babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].setSelected(false);if(t){t.remove();return true}}return false}let $s=e=>e,Ks,js;function ks(e,t,s){return Math.min(Math.max(e,t),s)}const Us={EAST:1,SOUTH:2,WEST:4,NORTH:8};var Ws=babelHelpers.classPrivateFieldLooseKey("positioning");var Ys=babelHelpers.classPrivateFieldLooseKey("freeTransform");var zs=babelHelpers.classPrivateFieldLooseKey("onPointerDownHandler");var Xs=babelHelpers.classPrivateFieldLooseKey("onPointerMoveHandler");var Gs=babelHelpers.classPrivateFieldLooseKey("onPointerUpHandler");var Vs=babelHelpers.classPrivateFieldLooseKey("container");var Js=babelHelpers.classPrivateFieldLooseKey("target");var qs=babelHelpers.classPrivateFieldLooseKey("editor");var Qs=babelHelpers.classPrivateFieldLooseKey("maxWidth");var Zs=babelHelpers.classPrivateFieldLooseKey("maxHeight");var ei=babelHelpers.classPrivateFieldLooseKey("minWidth");var ti=babelHelpers.classPrivateFieldLooseKey("minHeight");var si=babelHelpers.classPrivateFieldLooseKey("handlePointerDown");var ii=babelHelpers.classPrivateFieldLooseKey("handlePointerMove");var ri=babelHelpers.classPrivateFieldLooseKey("handlePointerUp");var ai=babelHelpers.classPrivateFieldLooseKey("getMaxContainerWidth");var oi=babelHelpers.classPrivateFieldLooseKey("getMaxContainerHeight");class li extends b.EventEmitter{constructor({target:e,editor:t,originalWidth:s,originalHeight:i,minWidth:r,minHeight:a,maxWidth:o,maxHeight:l,events:n,freeTransform:d}){super();Object.defineProperty(this,oi,{value:bi});Object.defineProperty(this,ai,{value:hi});Object.defineProperty(this,ri,{value:ci});Object.defineProperty(this,ii,{value:di});Object.defineProperty(this,si,{value:ni});Object.defineProperty(this,Ws,{writable:true,value:{currentHeight:0,currentWidth:0,direction:0,isResizing:false,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}});Object.defineProperty(this,Ys,{writable:true,value:false});Object.defineProperty(this,zs,{writable:true,value:null});Object.defineProperty(this,Xs,{writable:true,value:null});Object.defineProperty(this,Gs,{writable:true,value:null});Object.defineProperty(this,Vs,{writable:true,value:null});Object.defineProperty(this,Js,{writable:true,value:null});Object.defineProperty(this,qs,{writable:true,value:null});Object.defineProperty(this,Qs,{writable:true,value:"none"});Object.defineProperty(this,Zs,{writable:true,value:"none"});Object.defineProperty(this,ei,{writable:true,value:16});Object.defineProperty(this,ti,{writable:true,value:16});this.setEventNamespace("BX.UI.TextEditor.FigureResizer");babelHelpers.classPrivateFieldLooseBase(this,Js)[Js]=e;babelHelpers.classPrivateFieldLooseBase(this,qs)[qs]=t;babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]=Math.min(Math.max(babelHelpers.classPrivateFieldLooseBase(this,ei)[ei],F.Type.isNumber(r)?r:babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]),F.Type.isNumber(s)?s:Infinity);babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]=Math.min(Math.max(babelHelpers.classPrivateFieldLooseBase(this,ti)[ti],F.Type.isNumber(a)?a:babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]),F.Type.isNumber(i)?i:Infinity);babelHelpers.classPrivateFieldLooseBase(this,Qs)[Qs]=F.Type.isNumber(o)?o:"none";babelHelpers.classPrivateFieldLooseBase(this,Zs)[Zs]=F.Type.isNumber(l)?l:"none";babelHelpers.classPrivateFieldLooseBase(this,Ys)[Ys]=d===true;babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]=babelHelpers.classPrivateFieldLooseBase(this,si)[si].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs]=babelHelpers.classPrivateFieldLooseBase(this,ii)[ii].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs]=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].bind(this);this.subscribeFromOptions(n)}show(){F.Dom.addClass(this.getContainer(),"--shown")}hide(){F.Dom.removeClass(this.getContainer(),"--shown")}getContainer(){if(babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs]===null){const e=F.Tag.render(Ks||(Ks=$s`
				<div
					class="ui-text-editor-figure-resizer-handle --north"
					data-direction="${0}"
					onpointerdown="${0}"
					></div>
				<div
					class="ui-text-editor-figure-resizer-handle --east"
					data-direction="${0}"
					onpointerdown="${0}"
					></div>
				<div
					class="ui-text-editor-figure-resizer-handle --south"
					data-direction="${0}"
					onpointerdown="${0}"
					></div>
				<div
					class="ui-text-editor-figure-resizer-handle --west"
					data-direction="${0}"
					onpointerdown="${0}"
					></div>
			`),Us.NORTH,babelHelpers.classPrivateFieldLooseBase(this,zs)[zs],Us.EAST,babelHelpers.classPrivateFieldLooseBase(this,zs)[zs],Us.SOUTH,babelHelpers.classPrivateFieldLooseBase(this,zs)[zs],Us.WEST,babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]);babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs]=F.Tag.render(js||(js=$s`
				<div class="ui-text-editor-figure-resizer">
					<div
						class="ui-text-editor-figure-resizer-handle --north-east"
						data-direction="${0}" 
						onpointerdown="${0}"
					></div>
					<div
						class="ui-text-editor-figure-resizer-handle --south-east"
						data-direction="${0}" 
						onpointerdown="${0}"
						></div>
					<div
						class="ui-text-editor-figure-resizer-handle --south-west"
						data-direction="${0}" 
						onpointerdown="${0}"
						></div>
					<div 
						class="ui-text-editor-figure-resizer-handle --north-west"
						data-direction="${0}" 
						onpointerdown="${0}"
						></div>
					${0}
				</div>
			`),Us.NORTH|Us.EAST,babelHelpers.classPrivateFieldLooseBase(this,zs)[zs],Us.SOUTH|Us.EAST,babelHelpers.classPrivateFieldLooseBase(this,zs)[zs],Us.SOUTH|Us.WEST,babelHelpers.classPrivateFieldLooseBase(this,zs)[zs],Us.NORTH|Us.WEST,babelHelpers.classPrivateFieldLooseBase(this,zs)[zs],babelHelpers.classPrivateFieldLooseBase(this,Ys)[Ys]?e:null)}return babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs]}getTarget(){return babelHelpers.classPrivateFieldLooseBase(this,Js)[Js]}setTarget(e){babelHelpers.classPrivateFieldLooseBase(this,Js)[Js]=e}getEditor(){return babelHelpers.classPrivateFieldLooseBase(this,qs)[qs]}isResizing(){return babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].isResizing}}function ni(e){if(!this.getEditor().isEditable()){return}e.preventDefault();const t=Number(e.target.dataset.direction);const s=this.getTarget();const{width:i,height:r}=s.getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startWidth=i;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startHeight=r;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].ratio=i/r;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentWidth=i;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentHeight=r;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startX=e.clientX;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startY=e.clientY;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].isResizing=true;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].direction=t;this.emit("onResizeStart");F.Dom.addClass(this.getContainer(),"--resizing");F.Dom.style(s,{width:`${i}px`,height:`${r}px`});F.Event.bind(document,"pointermove",babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs]);F.Event.bind(document,"pointerup",babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs])}function di(e){const t=this.getTarget();const s=babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].direction&(Us.EAST|Us.WEST);const i=babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].direction&(Us.SOUTH|Us.NORTH);if(babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].isResizing){if(s&&i){let s=Math.floor(babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startX-e.clientX);s=babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].direction&Us.EAST?-s:s;const i=Math.round(ks(babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startWidth+s,babelHelpers.classPrivateFieldLooseBase(this,ei)[ei],babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]()));const r=Math.ceil(i/babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].ratio);F.Dom.style(t,{width:`${i}px`,height:`${r}px`});this.emit("onResize",{width:i,height:r});babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentHeight=r;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentWidth=i}else if(i){let s=Math.floor(babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startY-e.clientY);s=babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].direction&Us.SOUTH?-s:s;const i=Math.round(Math.max(babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startHeight+s,babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]));F.Dom.style(t,"height",`${i}px`);this.emit("onResize",{width:babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentWidth,height:i});babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentHeight=i}else{let s=Math.floor(babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startX-e.clientX);s=babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].direction&Us.EAST?-s:s;const i=Math.round(ks(babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startWidth+s,babelHelpers.classPrivateFieldLooseBase(this,ei)[ei],babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]()));F.Dom.style(t,"width",`${i}px`);this.emit("onResize",{width:i,height:babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentHeight});babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentWidth=i}}}function ci(){if(babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].isResizing){setTimeout((()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentWidth;const t=babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentHeight;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startWidth=0;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startHeight=0;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].ratio=0;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startX=0;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].startY=0;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentWidth=0;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].currentHeight=0;babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].isResizing=false;F.Dom.removeClass(this.getContainer(),"--resizing");this.emit("onResizeEnd",{width:e,height:t});F.Event.unbind(document,"pointermove",babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs]);F.Event.unbind(document,"pointerup",babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs])}),200)}}function hi(){const e=F.Type.isNumber(babelHelpers.classPrivateFieldLooseBase(this,Qs)[Qs])?babelHelpers.classPrivateFieldLooseBase(this,Qs)[Qs]:Infinity;const t=this.getEditor().getRootElement();if(t!==null){return Math.min(t.getBoundingClientRect().width-20,e)}return 100}function bi(){if(F.Type.isNumber(babelHelpers.classPrivateFieldLooseBase(this,Zs)[Zs])){return babelHelpers.classPrivateFieldLooseBase(this,Zs)[Zs]}const e=this.getEditor().getRootElement();if(e!==null){return e.getBoundingClientRect().height-20}return 100}let ui=e=>e,pi,gi;var vi=babelHelpers.classPrivateFieldLooseKey("refs");var fi=babelHelpers.classPrivateFieldLooseKey("figureResizer");var Pi=babelHelpers.classPrivateFieldLooseKey("render");var mi=babelHelpers.classPrivateFieldLooseKey("getContainer");var Li=babelHelpers.classPrivateFieldLooseKey("getImageContainer");var yi=babelHelpers.classPrivateFieldLooseKey("setDraggable");var Fi=babelHelpers.classPrivateFieldLooseKey("handleResizeStart");var Hi=babelHelpers.classPrivateFieldLooseKey("handleResizeEnd");class Bi extends xs{constructor(e){super(e);Object.defineProperty(this,Hi,{value:_i});Object.defineProperty(this,Fi,{value:Ni});Object.defineProperty(this,yi,{value:Ei});Object.defineProperty(this,Li,{value:Ti});Object.defineProperty(this,mi,{value:Oi});Object.defineProperty(this,Pi,{value:Ci});Object.defineProperty(this,vi,{writable:true,value:new g.MemoryCache});Object.defineProperty(this,fi,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=new li({target:this.getImage(),editor:this.getEditor(),originalWidth:this.getOption("width"),originalHeight:this.getOption("height"),events:{onResizeStart:babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi].bind(this),onResizeEnd:babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].bind(this)}});this.getNodeSelection().onSelect((e=>{if(e||babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].isResizing()){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,mi)[mi](),"--selected");babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].show()}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,mi)[mi](),"--selected");babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].hide()}const t=e&&!babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].isResizing();babelHelpers.classPrivateFieldLooseBase(this,yi)[yi](t)}));this.update(this.getOptions());babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi]()}getImage(){return babelHelpers.classPrivateFieldLooseBase(this,vi)[vi].remember("image",(()=>{var e,t;const s=document.createElement("img");s.draggable=false;s.src=this.getOption("src");const i=this.getOption("config",{});if(i!=null&&(e=i.theme)!=null&&(t=e.image)!=null&&t.img){s.className=i.theme.image.img}return s}))}update(e){const t=e.width>0?`${e.width}px`:"inherit";const s=e.width>0&&e.height>0?`${e.width} / ${e.height}`:"auto";F.Dom.style(this.getImage(),{width:t,height:"auto",aspectRatio:s})}}function Ci(){F.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,mi)[mi](),this.getTarget())}function Oi(){return babelHelpers.classPrivateFieldLooseBase(this,vi)[vi].remember("container",(()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].getContainer();return F.Tag.render(pi||(pi=ui`
				<div class="ui-text-editor-file-image-component">
					${0}
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,Li)[Li](),e)}))}function Ti(){return babelHelpers.classPrivateFieldLooseBase(this,vi)[vi].remember("image-container",(()=>F.Tag.render(gi||(gi=ui`
				<div class="ui-text-editor-file-image-container">
					${0}
				</div>
			`),this.getImage())))}function Ei(e){F.Dom.attr(babelHelpers.classPrivateFieldLooseBase(this,Li)[Li](),{draggable:e});if(e){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,mi)[mi](),"--draggable")}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,mi)[mi](),"--draggable")}}function Ni(e){babelHelpers.classPrivateFieldLooseBase(this,yi)[yi](false);this.setSelected(true)}function _i(e){this.setSelected(true);this.getEditor().update((()=>{const t=L.$getNodeByKey(this.getNodeKey());if(Si(t)){const{width:s,height:i}=e.getData();t.setWidthAndHeight(s,i)}}))}class Mi extends L.DecoratorNode{constructor(e,t,s,i,r){super(r);this.__serverFileId=e;this.__info=F.Type.isPlainObject(t)?t:{};this.__width=F.Type.isNumber(s)&&s>0?Math.round(s):this.__info.previewWidth;this.__height=F.Type.isNumber(i)&&i>0?Math.round(i):this.__info.previewHeight}static getType(){return"file-image"}static clone(e){return new Mi(e.__serverFileId,e.__info,e.__width,e.__height,e.__key)}getId(){return this.__serverFileId}getServerFileId(){return this.__serverFileId}getInfo(){return this.__info}setWidthAndHeight(e,t){const s=this.getWritable();if(F.Type.isNumber(e)){s.__width=Math.round(e)}if(F.Type.isNumber(t)){s.__height=Math.round(t)}}getWidth(){const e=this.getLatest();return e.__width}getHeight(){const e=this.getLatest();return e.__height}isResized(){return this.__info.previewWidth!==this.getWidth()||this.__info.previewHeight!==this.getHeight()}static importJSON(e){return Di(e.serverFileId,e.info,e.width,e.height)}static importDOM(){return{img:e=>{if(!e.hasAttribute("data-file-image-id")){return null}return{conversion:e=>{const{fileImageId:t,fileImageInfo:s}=e.dataset;let i=null;try{i=JSON.parse(s)}catch{return null}const r=Di(t,i);return{node:r}},priority:1}}}}exportDOM(){return{element:null}}exportJSON(){return{info:this.__info,serverFileId:this.__serverFileId,width:this.getWidth(),height:this.getHeight(),type:"file-image",version:1}}createDOM(e,t){var s,i;const r=document.createElement("span");if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:(i=s.image)==null?void 0:i.container)){F.Dom.addClass(r,e.theme.image.container)}return r}updateDOM(e,t,s){return false}decorate(e,t){return{componentClass:Bi,options:{src:this.__info.previewUrl,width:this.getWidth(),height:this.getHeight(),maxWidth:this.getWidth(),maxHeight:this.getHeight(),config:t}}}isInline(){return true}}Mi.useDecoratorComponent=true;function Di(e,t={},s=null,i=null){return new Mi(e,t,s,i)}function Si(e){return e instanceof Mi}class Ri extends L.TextNode{constructor(e,t,s){const i=F.Type.isPlainObject(t)?t:{};super(i.name||"",s);this.__serverFileId=e;this.__info=i}static getType(){return"file"}static clone(e){return new Ri(e.__serverFileId,e.__info,e.__key)}getId(){return this.__serverFileId}getServerFileId(){return this.__serverFileId}getInfo(){return this.__info}getName(){return this.__info.name||"unknown"}static importJSON(e){return Ii(e.serverFileId,e.info)}static importDOM(){return{span:e=>{if(!e.hasAttribute("data-file-id")){return null}return{conversion:t=>{const{fileId:s,fileInfo:i}=e.dataset;let r=null;try{r=JSON.parse(i)}catch{return null}const a=Ii(s,r);return{node:a}},priority:1}}}}exportDOM(){const e=document.createElement("span");e.textContent=this.getName();e.setAttribute("data-file-id",this.__serverFileId);e.setAttribute("data-file-info",JSON.stringify(this.__info));return{element:e}}exportJSON(){return{...super.exportJSON(),info:this.__info,serverFileId:this.__serverFileId,type:"file",version:1}}createDOM(e,t){var s;const i=document.createElement("span");if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:s.file)){F.Dom.addClass(i,e.theme.file)}i.textContent=this.getName();return i}updateDOM(e,t,s){return false}}function Ii(e,t={}){return new Ri(e,t).setMode("token")}function xi(e){return e instanceof Ri}function wi(e,t,s,i){const r=s/e;const a=i/t;const o=Math.min(r,a);const l=o>1;const n=l?e:e*o;const d=l?t:t*o;return[n,d]}let Ai=e=>e,$i;var Ki=babelHelpers.classPrivateFieldLooseKey("refs");var ji=babelHelpers.classPrivateFieldLooseKey("figureResizer");var ki=babelHelpers.classPrivateFieldLooseKey("render");var Ui=babelHelpers.classPrivateFieldLooseKey("getContainer");var Wi=babelHelpers.classPrivateFieldLooseKey("getVideo");var Yi=babelHelpers.classPrivateFieldLooseKey("handleResize");var zi=babelHelpers.classPrivateFieldLooseKey("handleResizeEnd");var Xi=babelHelpers.classPrivateFieldLooseKey("setDraggable");class Gi extends xs{constructor(e){super(e);Object.defineProperty(this,Xi,{value:er});Object.defineProperty(this,zi,{value:Zi});Object.defineProperty(this,Yi,{value:Qi});Object.defineProperty(this,Wi,{value:qi});Object.defineProperty(this,Ui,{value:Ji});Object.defineProperty(this,ki,{value:Vi});Object.defineProperty(this,Ki,{writable:true,value:new g.MemoryCache});Object.defineProperty(this,ji,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,ji)[ji]=new li({target:babelHelpers.classPrivateFieldLooseBase(this,Wi)[Wi](),editor:this.getEditor(),minWidth:120,minHeight:120,events:{onResize:babelHelpers.classPrivateFieldLooseBase(this,Yi)[Yi].bind(this),onResizeEnd:babelHelpers.classPrivateFieldLooseBase(this,zi)[zi].bind(this)}});this.getNodeSelection().onSelect((e=>{if(e||babelHelpers.classPrivateFieldLooseBase(this,ji)[ji].isResizing()){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui](),"--selected");babelHelpers.classPrivateFieldLooseBase(this,ji)[ji].show()}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui](),"--selected");babelHelpers.classPrivateFieldLooseBase(this,ji)[ji].hide()}babelHelpers.classPrivateFieldLooseBase(this,Xi)[Xi](e)}));this.update(this.getOptions());babelHelpers.classPrivateFieldLooseBase(this,ki)[ki]()}update(e){const t=F.Type.isNumber(e.width)&&e.width>0?e.width:null;const s=F.Type.isNumber(e.height)&&e.height>0?e.height:null;const i=t>0&&s>0?`${t} / ${s}`:"auto";F.Dom.adjust(babelHelpers.classPrivateFieldLooseBase(this,Wi)[Wi](),{attrs:{width:t,height:null},style:{width:t,height:"auto",aspectRatio:i}})}}function Vi(){F.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui](),this.getTarget())}function Ji(){return babelHelpers.classPrivateFieldLooseBase(this,Ki)[Ki].remember("container",(()=>F.Tag.render($i||($i=Ai`
				<div class="ui-text-editor-video-component">
					<div class="ui-text-editor-video-object-container">${0}</div>
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,Wi)[Wi](),babelHelpers.classPrivateFieldLooseBase(this,ji)[ji].getContainer())))}function qi(){return babelHelpers.classPrivateFieldLooseBase(this,Ki)[Ki].remember("video",(()=>{var e,t;const s=F.Dom.create({tag:"video",attrs:{controls:true,preload:"metadata",playsinline:true,src:this.getOption("src")},events:{loadedmetadata:e=>{this.getEditor().update((()=>{const t=L.$getNodeByKey(this.getNodeKey());if(ir(t)&&t.getWidth()===0){const[s,i]=wi(e.target.videoWidth,e.target.videoHeight,600,600);t.setWidthAndHeight(s,i)}}))}}});const i=this.getOption("config",{});if(i!=null&&(e=i.theme)!=null&&(t=e.video)!=null&&t.object){s.className=i.theme.video.object}return s}))}function Qi(e){this.update(e.getData())}function Zi(e){this.setSelected(true);this.getEditor().update((()=>{const t=L.$getNodeByKey(this.getNodeKey());if(ir(t)){const{width:s,height:i}=e.getData();t.setWidthAndHeight(s,i)}}))}function er(e){F.Dom.attr(babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui](),{draggable:e});if(e){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui](),"--draggable")}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui](),"--draggable")}}class tr extends L.DecoratorNode{constructor(e,t,s,i,r){super(r);this.__width=0;this.__height=0;this.__serverFileId=e;this.__info=F.Type.isPlainObject(t)?t:{};this.__width=F.Type.isNumber(s)&&s>0?Math.round(s):this.__info.previewWidth>0?this.__info.previewWidth:this.__width;this.__height=F.Type.isNumber(i)&&i>0?Math.round(i):this.__info.previewHeight>0?this.__info.previewHeight:this.__height}static getType(){return"file-video"}static clone(e){return new tr(e.__serverFileId,e.__info,e.__width,e.__height,e.__key)}getId(){return this.__serverFileId}getServerFileId(){return this.__serverFileId}getInfo(){return this.__info}setWidthAndHeight(e,t){const s=this.getWritable();if(F.Type.isNumber(e)){s.__width=Math.round(e)}if(F.Type.isNumber(t)){s.__height=Math.round(t)}}getWidth(){const e=this.getLatest();return e.__width}getHeight(){const e=this.getLatest();return e.__height}static importJSON(e){return sr(e.serverFileId,e.info,e.width,e.height)}static importDOM(){return null}exportDOM(){return{element:null}}exportJSON(){return{info:this.__info,serverFileId:this.__serverFileId,width:this.getWidth(),height:this.getHeight(),type:"file-video",version:1}}createDOM(e,t){var s,i;const r=document.createElement("span");if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:(i=s.video)==null?void 0:i.container)){F.Dom.addClass(r,e.theme.video.container)}return r}updateDOM(e,t,s){return false}decorate(e,t){return{componentClass:Gi,options:{src:this.__info.downloadUrl,width:this.getWidth(),height:this.getHeight(),maxWidth:this.getWidth(),maxHeight:this.getHeight(),config:t}}}isInline(){return true}}tr.useDecoratorComponent=true;function sr(e,t={},s=null,i=null){const r=new tr(e,t,s,i);return L.$applyNodeReplacement(r)}function ir(e){return e instanceof tr}function rr(e){const t=e.target;let s=null;if(t!==null){s=t.nodeType===9?t.defaultView:t.ownerDocument.defaultView}let i=null;const r=(s||window).getSelection();if(document.caretRangeFromPoint){i=document.caretRangeFromPoint(e.clientX,e.clientY)}else if(e.rangeParent&&r!==null){r.collapse(e.rangeParent,e.rangeOffset||0);i=r.getRangeAt(0)}else{throw new Error("Cannot get the selection when dragging")}return i}function ar(e){const t=L.$getSelection();if(!L.$isNodeSelection(t)){return null}const s=t.getNodes();const i=s[0];return e(i)?i:null}let or=e=>e,lr;const nr="application/x-lexical-drag-image";const dr=F.Tag.render(lr||(lr=or`<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">`));function cr(e,t,s){const i=e=>e instanceof t;const r=()=>ar((e=>i(e)));return y.mergeRegister(e.registerCommand(L.DRAGSTART_COMMAND,(t=>{const s=r();if(!s){return false}const i=hr(t,s);if(i){e.dispatchCommand(C)}return i}),L.COMMAND_PRIORITY_HIGH),e.registerCommand(L.DRAGOVER_COMMAND,(t=>{const s=r();if(!s){return false}return br(t,e)}),L.COMMAND_PRIORITY_LOW),e.registerCommand(L.DROP_COMMAND,(t=>{const i=r();if(!i){return false}e.dispatchCommand(O);return ur(t,e,i,s)}),L.COMMAND_PRIORITY_HIGH))}function hr(e,t){const s=e.dataTransfer;if(!s){return false}s.setData("text/plain","_");s.setDragImage(dr,0,0);s.setData(nr,JSON.stringify({data:t.exportJSON(),type:t.getType()}));return true}function br(e,t){if(!pr(e,t)){e.preventDefault()}return true}function ur(e,t,s,i){var r;const a=(r=e.dataTransfer)==null?void 0:r.getData(nr);if(!a){return false}const{type:o,data:l}=JSON.parse(a);if(o!==s.getType()||!F.Type.isPlainObject(l)){return false}e.preventDefault();if(pr(e,t)&&F.Type.isFunction(i)){const t=rr(e);s.remove();const r=L.$createRangeSelection();if(t!==null&&t!==undefined){r.applyDOMRange(t)}L.$setSelection(r);i(l)}return true}function pr(e,t){const s=e.target;const i=["code",".ui-text-editor__file-image"];const r=t.getThemeClass("image");if(F.Type.isStringFilled(r)){i.push(`.${r}`)}return s instanceof HTMLElement&&s.closest(i.join(","))===null&&t.getEditableContainer().contains(s.parentElement)}const gr={FILE:"file",IMAGE:"image",VIDEO:"video"};const vr=L.createCommand("ADD_FILE_COMMAND");const fr=L.createCommand("ADD_FILES_COMMAND");const Pr=L.createCommand("INSERT_FILE_COMMAND");const mr=L.createCommand("REMOVE_FILE_COMMAND");const Lr=L.createCommand("GET_INSERTED_FILES_COMMAND");var yr=babelHelpers.classPrivateFieldLooseKey("enabled");var Fr=babelHelpers.classPrivateFieldLooseKey("mode");var Hr=babelHelpers.classPrivateFieldLooseKey("files");var Br=babelHelpers.classPrivateFieldLooseKey("registerListeners");class Cr extends ie{constructor(e){super(e);Object.defineProperty(this,Br,{value:Or});Object.defineProperty(this,yr,{writable:true,value:false});Object.defineProperty(this,Fr,{writable:true,value:"file"});Object.defineProperty(this,Hr,{writable:true,value:new Map});const t=e.getOption("file.mode");babelHelpers.classPrivateFieldLooseBase(this,yr)[yr]=["file","disk"].includes(t);if(!babelHelpers.classPrivateFieldLooseBase(this,yr)[yr]){return}babelHelpers.classPrivateFieldLooseBase(this,Fr)[Fr]=t;const s=e.getOption("file.files",[]);this.addFiles(s);babelHelpers.classPrivateFieldLooseBase(this,Br)[Br]();this.cleanUpRegister(cr(this.getEditor(),Mi,(e=>{this.getEditor().dispatchCommand(Pr,e)})),cr(this.getEditor(),tr,(e=>{this.getEditor().dispatchCommand(Pr,e)})))}static getName(){return"File"}static getNodes(e){return[Ri,Mi,tr]}importBBCode(){if(!this.isEnabled()){return null}return{[this.getMode()]:()=>({conversion:e=>{let t=e.getAttribute("id");const s=()=>({node:L.$createTextNode(e.toString())});if(!F.Type.isStringFilled(t)||this.getMode()==="disk"&&!/^n?\d+$/i.test(t)||this.getMode()==="file"&&!/^(\d+|[\da-f-]{36}\.[\da-f]{32,})$/i.test(t)){return s()}const i=this.getFile(t);if(i===null){return s()}if(i.serverFileId.toString()!==t.toString()){t=i.serverFileId.toString()}const r=this.getFileType(i);if(r===gr.IMAGE){const s=F.Text.toInteger(e.getAttribute("width"));const r=F.Text.toInteger(e.getAttribute("height"));return{node:Di(t,i,s,r)}}if(r===gr.VIDEO){const s=F.Text.toInteger(e.getAttribute("width"));const r=F.Text.toInteger(e.getAttribute("height"));return{node:sr(t,i,s,r)}}return{node:Ii(t,i)}},priority:0})}}exportBBCode(){if(!this.isEnabled()){return null}return{file:e=>{const t=this.getEditor().getBBCodeScheme();const s=this.getMode()==="disk"?{file:""}:{};s.id=e.getServerFileId();return{node:t.createElement({name:this.getMode(),attributes:s,inline:true})}},"file-video":e=>{const t=this.getEditor().getBBCodeScheme();const s=this.getMode()==="disk"?{file:""}:{};s.id=e.getServerFileId();const i=t.createElement({name:this.getMode(),attributes:s,inline:false});i.setAttribute("width",e.getWidth());i.setAttribute("height",e.getHeight());return{node:i}},"file-image":e=>{const t=this.getEditor().getBBCodeScheme();const s=this.getMode()==="disk"?{file:""}:{};s.id=e.getServerFileId();const i=t.createElement({name:this.getMode(),attributes:s,inline:true});if(e.isResized()){i.setAttribute("width",e.getWidth());i.setAttribute("height",e.getHeight())}return{node:i}}}}validateScheme(){if(!this.isEnabled()){return null}return{bbcodeMap:{file:this.getMode(),"file-image":this.getMode(),"file-video":this.getMode()}}}isEnabled(){return babelHelpers.classPrivateFieldLooseBase(this,yr)[yr]}getMode(){return babelHelpers.classPrivateFieldLooseBase(this,Fr)[Fr]}addFile(e){if(F.Type.isPlainObject(e)&&(F.Type.isStringFilled(e.serverFileId)||F.Type.isNumber(e.serverFileId))){const t=e.serverFileId.toString();if(!babelHelpers.classPrivateFieldLooseBase(this,Hr)[Hr].has(t)){babelHelpers.classPrivateFieldLooseBase(this,Hr)[Hr].set(e.serverFileId.toString(),e)}}}addFiles(e){if(F.Type.isArrayFilled(e)){e.forEach((e=>{this.addFile(e)}))}}getFile(e){if(F.Type.isStringFilled(e)||F.Type.isNumber(e)){const s=babelHelpers.classPrivateFieldLooseBase(this,Hr)[Hr].get(e.toString())||null;if(s){return s}for(const s of babelHelpers.classPrivateFieldLooseBase(this,Hr)[Hr].values()){var t;if(s.serverFileId.toString()===e.toString()||(t=s.customData)!=null&&t.objectId&&`n${s.customData.objectId.toString()}`===e.toString()){return s}}}return null}getFileType(e){if(e!=null&&e.isImage){return gr.IMAGE}if(e!=null&&e.isVideo){return gr.VIDEO}return gr.FILE}removeFile(e,t=true){if(F.Type.isStringFilled(e)||F.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,Hr)[Hr].delete(e.toString());this.getEditor().update((()=>{const t=[...L.$nodesOfType(Ri),...L.$nodesOfType(Mi),...L.$nodesOfType(tr)];t.forEach((t=>{if(t.getServerFileId().toString()===e.toString()){t.remove()}}))}),t?{tag:"history-merge"}:{})}}}function Or(){this.cleanUpRegister(this.getEditor().registerCommand(Pr,(e=>{if(!F.Type.isPlainObject(e)||!F.Type.isPlainObject(e.info)||!F.Type.isNumber(e.serverFileId)&&!F.Type.isStringFilled(e.serverFileId)){return false}this.addFile(e.info);const t=this.getFileType(e.info);let s=null;const i=e.info.previewWidth;const r=e.info.previewHeight;const a=e.width;const o=e.height;if(t===gr.IMAGE){const[t,l]=wi(i,r,a,o);s=Di(e.serverFileId,e.info,t,l)}else if(t===gr.VIDEO){let t=0;let l=0;if(i>0&&r>0){[t,l]=wi(i,r,a,o)}s=sr(e.serverFileId,e.info,t,l)}else{s=Ii(e.serverFileId,e.info)}const l=L.$getSelection();if(L.$isRangeSelection(l)&&t!==gr.FILE&&e.inline!==true){const e=l.focus;const t=e.getNode();if(!l.isCollapsed()){t.selectEnd()}const i=y.$findMatchingParent(t,(e=>L.$isParagraphNode(e)));if(i===null){L.$insertNodes([s]);if(L.$isRootOrShadowRoot(s.getParentOrThrow())){y.$wrapNodeInElement(s,L.$createParagraphNode).selectEnd()}}else if(i.isEmpty()){i.append(s);s.selectEnd()}else{if(this.getEditor().getNewLineMode()===N.LINE_BREAK){i.append(L.$createLineBreakNode());i.append(s)}else{const e=L.$createParagraphNode();e.append(s);i.insertAfter(e)}s.selectEnd()}}else{L.$insertNodes([s]);if(L.$isRootOrShadowRoot(s.getParentOrThrow())){y.$wrapNodeInElement(s,L.$createParagraphNode).selectEnd()}}return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(mr,(e=>{if(!F.Type.isPlainObject(e)||!F.Type.isNumber(e.serverFileId)&&!F.Type.isStringFilled(e.serverFileId)){return false}this.removeFile(e.serverFileId,e.skipHistoryStack);return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(Lr,(e=>{if(!F.Type.isFunction(e)){return false}const t=[...L.$nodesOfType(Ri),...L.$nodesOfType(Mi),...L.$nodesOfType(tr)];e(t);return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(vr,(e=>{this.addFile(e);return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(fr,(e=>{this.addFiles(e);return true}),L.COMMAND_PRIORITY_EDITOR))}var Tr=Object.freeze({FileImageNode:Mi,$createFileImageNode:Di,$isFileImageNode:Si,FileImageComponent:Bi,FileNode:Ri,$createFileNode:Ii,$isFileNode:xi,FileVideoNode:tr,$createFileVideoNode:sr,$isFileVideoNode:ir,FileType:gr,ADD_FILE_COMMAND:vr,ADD_FILES_COMMAND:fr,INSERT_FILE_COMMAND:Pr,REMOVE_FILE_COMMAND:mr,GET_INSERTED_FILES_COMMAND:Lr,FilePlugin:Cr});function Er(e){return/^(http:|https:|ftp:|blob:|\/)/i.test(e)}let Nr=e=>e,_r,Mr;var Dr=babelHelpers.classPrivateFieldLooseKey("refs");var Sr=babelHelpers.classPrivateFieldLooseKey("figureResizer");var Rr=babelHelpers.classPrivateFieldLooseKey("maxWidth");var Ir=babelHelpers.classPrivateFieldLooseKey("render");var xr=babelHelpers.classPrivateFieldLooseKey("getContainer");var wr=babelHelpers.classPrivateFieldLooseKey("getImageContainer");var Ar=babelHelpers.classPrivateFieldLooseKey("setDraggable");var $r=babelHelpers.classPrivateFieldLooseKey("handleResizeStart");var Kr=babelHelpers.classPrivateFieldLooseKey("handleResizeEnd");class jr extends xs{constructor(e){super(e);Object.defineProperty(this,Kr,{value:Xr});Object.defineProperty(this,$r,{value:zr});Object.defineProperty(this,Ar,{value:Yr});Object.defineProperty(this,wr,{value:Wr});Object.defineProperty(this,xr,{value:Ur});Object.defineProperty(this,Ir,{value:kr});Object.defineProperty(this,Dr,{writable:true,value:new g.MemoryCache});Object.defineProperty(this,Sr,{writable:true,value:null});Object.defineProperty(this,Rr,{writable:true,value:"none"});babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr]=new li({target:this.getImage(),editor:this.getEditor(),originalWidth:this.getOption("width"),originalHeight:this.getOption("height"),maxWidth:this.getMaxWidth(),events:{onResizeStart:babelHelpers.classPrivateFieldLooseBase(this,$r)[$r].bind(this),onResizeEnd:babelHelpers.classPrivateFieldLooseBase(this,Kr)[Kr].bind(this)}});this.getNodeSelection().onSelect((e=>{if(e||babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr].isResizing()){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,xr)[xr](),"--selected");babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr].show()}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,xr)[xr](),"--selected");babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr].hide()}const t=e&&!babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr].isResizing();babelHelpers.classPrivateFieldLooseBase(this,Ar)[Ar](t)}));this.update(this.getOptions());babelHelpers.classPrivateFieldLooseBase(this,Ir)[Ir]()}getImage(){return babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr].remember("image",(()=>{var e,t;const s=document.createElement("img");s.draggable=false;s.src=this.getOption("src");const i=this.getOption("config",{});if(i!=null&&(e=i.theme)!=null&&(t=e.image)!=null&&t.img){s.className=i.theme.image.img}s.onerror=e=>{s.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";F.Dom.addClass(this.getTarget(),"--error ui-icon-set__scope")};return s}))}getMaxWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Rr)[Rr]}update(e){const t=e.width>0?`${e.width}px`:"inherit";const s=e.width>0&&e.height>0?`${e.width} / ${e.height}`:"auto";babelHelpers.classPrivateFieldLooseBase(this,Rr)[Rr]=e.maxWidth;F.Dom.style(this.getImage(),{width:t,height:"auto",aspectRatio:s})}}function kr(){F.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,xr)[xr](),this.getTarget())}function Ur(){return babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr].remember("container",(()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr].getContainer();return F.Tag.render(_r||(_r=Nr`
				<div class="ui-text-editor-image-component">
					${0}
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,wr)[wr](),e)}))}function Wr(){return babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr].remember("image-container",(()=>F.Tag.render(Mr||(Mr=Nr`
				<div class="ui-text-editor-image-container">
					${0}
				</div>
			`),this.getImage())))}function Yr(e){F.Dom.attr(babelHelpers.classPrivateFieldLooseBase(this,wr)[wr](),{draggable:e});if(e){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,xr)[xr](),"--draggable")}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,xr)[xr](),"--draggable")}}function zr(e){babelHelpers.classPrivateFieldLooseBase(this,Ar)[Ar](false);this.setSelected(true)}function Xr(e){this.setSelected(true);this.getEditor().update((()=>{const t=L.$getNodeByKey(this.getNodeKey());if(Jr(t)){const{width:s,height:i}=e.getData();t.setWidthAndHeight(s,i)}}))}class Gr extends L.DecoratorNode{constructor(e,t,s,i,r){super(r);this.__width="inherit";this.__height="inherit";this.__maxWidth="none";if(Er(e)){this.__src=e}else{this.__src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}if(F.Type.isNumber(t)){this.__width=Math.round(t)}if(F.Type.isNumber(s)){this.__height=Math.round(s)}if(F.Type.isNumber(i)){this.__maxWidth=Math.round(i)}}static getType(){return"image"}static clone(e){return new Gr(e.__src,e.__width,e.__height,e.__maxWidth,e.__key)}static importJSON(e){const{width:t,height:s,src:i,maxWidth:r}=e;return Vr({src:i,width:t,height:s,maxWidth:r})}exportDOM(){const e=document.createElement("img");e.setAttribute("src",this.__src);e.setAttribute("width",this.__width.toString());e.setAttribute("height",this.__height.toString());return{element:e}}static importDOM(){return{img:e=>({conversion:e=>{if(e instanceof HTMLImageElement&&Er(e.src)){const{src:t,width:s,height:i}=e;const r=Vr({src:t,width:s,height:i});return{node:r}}return null},priority:0})}}exportJSON(){return{src:this.getSrc(),width:this.getWidth(),height:this.getHeight(),maxWidth:this.getMaxWidth(),type:"image",version:1}}setWidthAndHeight(e,t){const s=this.getWritable();if(F.Type.isNumber(e)){s.__width=Math.round(e)}else if(e==="inherit"){s.__width=e}if(F.Type.isNumber(t)){s.__height=Math.round(t)}else if(t==="inherit"){s.__height=t}}setMaxWidth(e){if(F.Type.isNumber(e)||e==="none"){const t=this.getWritable();t.__maxWidth=F.Type.isNumber(e)?Math.round(e):e}}createDOM(e){var t;const s=document.createElement("span");const i=e.theme;const r=i==null?void 0:(t=i.image)==null?void 0:t.container;if(r!==undefined){s.className=r}return s}updateDOM(){return false}getSrc(){return this.__src}getWidth(){const e=this.getLatest();return e.__width}getHeight(){const e=this.getLatest();return e.__height}getMaxWidth(){const e=this.getLatest();return e.__maxWidth}decorate(e,t){return{componentClass:jr,options:{src:this.getSrc(),width:this.getWidth(),height:this.getHeight(),maxWidth:this.getMaxWidth(),config:t}}}isInline(){return true}}Gr.useDecoratorComponent=true;function Vr({src:e,width:t,height:s,maxWidth:i,key:r}){return L.$applyNodeReplacement(new Gr(e,t,s,i,r))}function Jr(e){return e instanceof Gr}const qr=new WeakMap;function Qr(e){if(qr.has(e)){return qr.get(e)}const t=e.getEditableContainer();const s=window.getComputedStyle(t);const i=parseFloat(s.paddingLeft)||0;const r=parseFloat(s.paddingRight)||0;const a={left:i,right:r};qr.set(e,a);return a}function Zr(e,t,s){const i=ea(t,e);if(i===null){return null}const r=i.getClientRects();const a=r.length>1;const o=t.isBackward();let l=o?r[0]:r[r.length-1];if(t.isCollapsed()&&(!l||l.left===0&&l.top===0)){let s=e.getElementByKey(t.anchor.key);let r=t.anchor.offset;if(s===null){s=i.startContainer;r=i.startOffset}const a=s.childNodes[r]||s;const o=a.getBoundingClientRect();l=new DOMRect(o.left,o.top,1,o.height)}if(!l){return null}const n=10;const d=s===document.body;const c=d?window.pageXOffset:s.scrollLeft;const h=d?window.pageYOffset:s.scrollTop;let b=(o?l.left:l.right)+c;let u=l.top+h;let p=l.bottom+h+n;if(!d){const e=s.getBoundingClientRect();u-=e.top;b-=e.left;p-=e.top}return{left:b,top:u,bottom:p,isBackward:o,isMultiline:a}}function ea(e,t){if(!L.$isRangeSelection(e)){return null}const s=document.createRange();const i=e.anchor.getNode();const r=e.focus.getNode();const a=i.getKey();const o=r.getKey();let l=t.getElementByKey(a);let n=t.getElementByKey(o);let d=e.anchor.offset;let c=e.focus.offset;if(L.$isTextNode(i)){l=ta(l)}if(L.$isTextNode(r)){n=ta(n)}if(l===null||n===null){return null}if(l.nodeName==="BR"){[l,d]=sa(l)}if(n.nodeName==="BR"){[n,c]=sa(n)}const h=l.firstChild;if(l===n&&h!==null&&h.nodeName==="BR"&&d===0&&c===0){c=1}try{s.setStart(l,d);s.setEnd(n,c)}catch{return null}if(s.collapsed&&(d!==c||a!==o)){s.setStart(n,c);s.setEnd(l,d)}return s}function ta(e){let t=e;while(t!==null){if(t.nodeType===Node.TEXT_NODE){return t}t=t.firstChild}return null}function sa(e){const t=e.parentNode;if(t===null){throw new Error("Should never happen")}return[t,[...t.childNodes].indexOf(e)]}const ia=new WeakMap;function ra(e,t,s){const i=L.$getSelection();if(!L.$isRangeSelection(i)){return false}const r=Zr(t,i,document.body);if(r===null){return false}const{top:a,left:o,bottom:l,isBackward:n}=r;const d=F.Dom.getPosition(t.getScrollerContainer());const c=F.Dom.getPosition(e.getPopupContainer());const h=c.width;let b=h/2;const u=Qr(t);if(o-b<d.left){const e=d.left-(o-b);b-=e+u.left}else if(d.right<o+h-b){b+=o+h-b-d.right+u.right}e.setOffset({offsetLeft:-b});if(l<d.top||a>d.bottom){F.Dom.style(e.getPopupContainer(),{left:"-9999px",top:"-9999px"})}else{const t=F.Type.isFunction(s)?s(r):n?"top":"bottom";const i=ia.get(e)||null;let h=i===null?t:i;if(a+c.height>d.bottom&&d.top<a-c.height){h="top"}else if(a-c.height<d.top){h="bottom"}ia.set(e,h);e.setBindElement({left:o,top:a,bottom:l});e.adjustPosition({position:h,forceBindPosition:true})}return true}function aa(e){ia.delete(e)}function oa(e){const t=L.$getSelection();if(!L.$isRangeSelection(t)&&e!==null){const t=L.$getNodeByKey(e.anchor.key)!==null&&L.$getNodeByKey(e.focus.key)!==null;if(t){L.$setSelection(e);return true}return false}return false}const la=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;const na=/^(?:(?:https?|ftps?|mailto):|[^a-z]|[+.a-z-]+(?:[^+.:a-z-]|$))/i;function da(e){if(!F.Type.isStringFilled(e)){return""}const t=e.replaceAll(la,"");return na.test(t)?t:""}let ca=e=>e,ha,ba;var ua=babelHelpers.classPrivateFieldLooseKey("popup");var pa=babelHelpers.classPrivateFieldLooseKey("imageUrl");var ga=babelHelpers.classPrivateFieldLooseKey("targetContainer");var va=babelHelpers.classPrivateFieldLooseKey("refs");var fa=babelHelpers.classPrivateFieldLooseKey("handleSaveBtnClick");var Pa=babelHelpers.classPrivateFieldLooseKey("handleTextBoxKeyDown");var ma=babelHelpers.classPrivateFieldLooseKey("handleCancelBtnClick");class La extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,ma,{value:Ha});Object.defineProperty(this,Pa,{value:Fa});Object.defineProperty(this,fa,{value:ya});Object.defineProperty(this,ua,{writable:true,value:null});Object.defineProperty(this,pa,{writable:true,value:""});Object.defineProperty(this,ga,{writable:true,value:null});Object.defineProperty(this,va,{writable:true,value:new g.MemoryCache});this.setEventNamespace("BX.UI.TextEditor.ImageDialog");const t=F.Type.isPlainObject(e)?e:{};this.setTargetContainer(t.targetContainer);this.subscribeFromOptions(t.events)}show(e={}){var t;const s=(t=e.target)!=null?t:undefined;const i=F.Type.isPlainObject(e.targetOptions)?e.targetOptions:{};if(!F.Type.isUndefined(s)){this.getPopup().setBindElement(s)}this.getPopup().adjustPosition({...i,forceBindPosition:true});this.getPopup().show()}hide(){this.getPopup().close()}isShown(){return babelHelpers.classPrivateFieldLooseBase(this,ua)[ua]!==null&&babelHelpers.classPrivateFieldLooseBase(this,ua)[ua].isShown()}destroy(){this.getPopup().destroy()}setImageUrl(e){if(F.Type.isString(e)){babelHelpers.classPrivateFieldLooseBase(this,pa)[pa]=da(e)}}getImageUrl(){return babelHelpers.classPrivateFieldLooseBase(this,pa)[pa]}setTargetContainer(e){if(F.Type.isElementNode(e)){babelHelpers.classPrivateFieldLooseBase(this,ga)[ga]=e}}getTargetContainer(){return babelHelpers.classPrivateFieldLooseBase(this,ga)[ga]}getPopup(){if(babelHelpers.classPrivateFieldLooseBase(this,ua)[ua]===null){babelHelpers.classPrivateFieldLooseBase(this,ua)[ua]=new p.Popup({autoHide:true,cacheable:false,padding:0,closeByEsc:true,targetContainer:this.getTargetContainer(),content:this.getContainer(),events:{onClose:()=>{this.emit("onClose")},onDestroy:()=>{this.emit("onDestroy")},onShow:()=>{this.emit("onShow")},onAfterShow:()=>{this.emit("onAfterShow")}}})}return babelHelpers.classPrivateFieldLooseBase(this,ua)[ua]}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,va)[va].remember("container",(()=>F.Tag.render(ha||(ha=ca`
				<div class="ui-text-editor-image-dialog">
					<div class="ui-text-editor-image-dialog-form">
						<div class="ui-ctl ui-ctl-textbox ui-ctl-s ui-ctl-inline ui-ctl-w100 ui-text-editor-image-dialog-textbox">
							<div class="ui-ctl-tag">${0}</div>
							${0}
						</div>
						<button type="button" 
							class="ui-text-editor-image-dialog-button" 
							onclick="${0}"
							data-testid="image-dialog-save-btn"
						>
							<span class="ui-icon-set --check"></span>
						</button>
						<button 
							type="button" 
							class="ui-text-editor-image-dialog-button"
							onclick="${0}"
							data-testid="image-dialog-cancel-btn"
						>
							<span class="ui-icon-set --cross-60"></span>
						</button>
					</div>
				</div>
			`),F.Loc.getMessage("TEXT_EDITOR_IMAGE_URL"),this.getUrlTextBox(),babelHelpers.classPrivateFieldLooseBase(this,fa)[fa].bind(this),babelHelpers.classPrivateFieldLooseBase(this,ma)[ma].bind(this))))}getUrlTextBox(){return babelHelpers.classPrivateFieldLooseBase(this,va)[va].remember("url-textbox",(()=>F.Tag.render(ba||(ba=ca`
				<input 
					type="text"
					class="ui-ctl-element"
					placeholder="https://example.com/image.jpeg"
					value="${0}"
					onkeydown="${0}"
					data-testid="image-dialog-textbox"
				>
			`),this.getImageUrl(),babelHelpers.classPrivateFieldLooseBase(this,Pa)[Pa].bind(this))))}}function ya(){const e=this.getUrlTextBox().value.trim();if(e.length>0){this.setImageUrl(e);this.emit("onSave")}else{this.getUrlTextBox().focus()}}function Fa(e){if(e.key==="Enter"){e.preventDefault();babelHelpers.classPrivateFieldLooseBase(this,fa)[fa]()}}function Ha(){this.emit("onCancel")}const Ba=L.createCommand("INSERT_IMAGE_COMMAND");const Ca=L.createCommand("INSERT_IMAGE_DIALOG_COMMAND");var Oa=babelHelpers.classPrivateFieldLooseKey("imageDialog");var Ta=babelHelpers.classPrivateFieldLooseKey("onEditorScroll");var Ea=babelHelpers.classPrivateFieldLooseKey("lastSelection");var Na=babelHelpers.classPrivateFieldLooseKey("registerCommands");var _a=babelHelpers.classPrivateFieldLooseKey("restoreSelection");var Ma=babelHelpers.classPrivateFieldLooseKey("handleDialogDestroy");var Da=babelHelpers.classPrivateFieldLooseKey("handleEditorScroll");var Sa=babelHelpers.classPrivateFieldLooseKey("registerComponents");class Ra extends ie{constructor(e){super(e);Object.defineProperty(this,Sa,{value:$a});Object.defineProperty(this,Da,{value:Aa});Object.defineProperty(this,Ma,{value:wa});Object.defineProperty(this,_a,{value:xa});Object.defineProperty(this,Na,{value:Ia});Object.defineProperty(this,Oa,{writable:true,value:null});Object.defineProperty(this,Ta,{writable:true,value:babelHelpers.classPrivateFieldLooseBase(this,Da)[Da].bind(this)});Object.defineProperty(this,Ea,{writable:true,value:null});this.cleanUpRegister(babelHelpers.classPrivateFieldLooseBase(this,Na)[Na](),cr(this.getEditor(),Gr,(e=>{this.getEditor().dispatchCommand(Ba,e)})));babelHelpers.classPrivateFieldLooseBase(this,Sa)[Sa]()}static getName(){return"Image"}static getNodes(e){return[Gr]}importBBCode(){return{img:()=>({conversion:e=>{const t=e.getContent().trim();const s=Number(e.getAttribute("width"));const i=Number(e.getAttribute("height"));if(Er(t)){return{node:Vr({src:t,width:s,height:i})}}return{node:L.$createTextNode(e.toString())}},priority:0})}}exportBBCode(){return{image:e=>{const t={};const s=e.getWidth();const i=e.getHeight();if(F.Type.isNumber(s)&&F.Type.isNumber(i)){t.width=s;t.height=i}const r=this.getEditor().getBBCodeScheme();return{node:r.createElement({name:"img",inline:true,attributes:t}),after:t=>{t.setChildren([r.createText(e.getSrc())])}}}}}validateScheme(){return{nodes:[{nodeClass:Gr}],bbcodeMap:{image:"img"}}}destroy(){super.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]!==null){babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].destroy()}}}function Ia(){return y.mergeRegister(this.getEditor().registerCommand(Ba,(e=>{if(!Er(e==null?void 0:e.src)){return false}const t=Vr(e);L.$insertNodes([t]);if(L.$isRootOrShadowRoot(t.getParentOrThrow())){y.$wrapNodeInElement(t,L.$createParagraphNode).selectEnd()}return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(Ca,(()=>{const e=L.$getSelection();if(!L.$isRangeSelection(e)){return false}babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea]=e.clone();if(babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]!==null){babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].destroy()}this.getEditor().dispatchCommand(H,{sender:"image-dialog"});babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]=new La({targetContainer:document.body,events:{onSave:()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].getImageUrl();if(!F.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].hide();return}this.getEditor().dispatchCommand(Ba,{src:e});babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].hide()},onCancel:()=>{babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].hide()},onClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ma)[Ma]()},onDestroy:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ma)[Ma]()},onShow:()=>{if(ra(babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].getPopup(),this.getEditor())){F.Event.bind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta]);this.getEditor().highlightSelection()}},onAfterShow:()=>{babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].getUrlTextBox().focus()}}});babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].show();return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(H,(e=>{if((e==null?void 0:e.sender)==="image-dialog"){return false}babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea]=null;if(babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]!==null){babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].destroy()}return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(B,(()=>babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].isShown()),L.COMMAND_PRIORITY_LOW))}function xa(){const e=oa(babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea]);babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea]=null;return e}function wa(){if(babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]===null){return}babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]=null;F.Event.unbind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta]);this.getEditor().resetHighlightSelection();this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,_a)[_a]()}))}function Aa(){this.getEditor().update((()=>{ra(babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].getPopup(),this.getEditor())}))}function $a(){this.getEditor().getComponentRegistry().register("image",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --incert-image"></span>');e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_IMAGE"));e.disableInsideUnformatted();e.subscribe("onClick",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa].isShown()){return}this.getEditor().focus((()=>{this.getEditor().dispatchCommand(Ca)}))}));return e}))}var Ka=Object.freeze({ImageNode:Gr,$createImageNode:Vr,$isImageNode:Jr,INSERT_IMAGE_COMMAND:Ba,INSERT_IMAGE_DIALOG_COMMAND:Ca,ImagePlugin:Ra});class ja extends L.ElementNode{constructor(e,t,s){super(s);this.__entityId=e;this.__id=t}static getType(){return"mention"}static clone(e){return new ja(e.__entityId,e.__id,e.__key)}getId(){const e=this.getLatest();return e.__id}getEntityId(){const e=this.getLatest();return e.__entityId}static importJSON(e){const t=Ua(e.entityId,e.id);t.setFormat(e.format);t.setDirection(e.direction);return t}static importDOM(){return{span:e=>{if(!e.hasAttribute("data-mention-id")){return null}return{conversion:ka,priority:1}},a:e=>{if(!e.hasAttribute("data-mention-id")){return null}return{conversion:ka,priority:1}}}}exportDOM(){const e=document.createElement("span");e.setAttribute("data-mention-entity-id",this.__entityId);e.setAttribute("data-mention-id",this.__id.toString());return{element:e}}exportJSON(){return{...super.exportJSON(),entityId:this.__entityId,id:this.__id,type:"mention",version:1}}createDOM(e,t){var s;const i=document.createElement("span");if(F.Type.isStringFilled(e==null?void 0:(s=e.theme)==null?void 0:s.mention)){F.Dom.addClass(i,e.theme.mention)}return i}updateDOM(e,t,s){return false}canInsertTextBefore(){return false}canInsertTextAfter(){return false}canBeEmpty(){return false}isInline(){return true}insertNewAfter(e,t){const s=L.$createParagraphNode();const i=this.getDirection();s.setDirection(i);this.insertAfter(s,t);return s}extractWithChild(e,t,s){if(!L.$isRangeSelection(t)){return false}const i=t.anchor;const r=t.focus;const a=i.getNode();const o=r.getNode();const l=t.isBackward();const n=l?i.offset-r.offset:r.offset-i.offset;return this.isParentOf(a)&&this.isParentOf(o)&&this.getTextContent().length===n}}function ka(e){const t=e.textContent;if(t!==null){const{mentionEntityId:t,mentionId:s}=e.dataset;const i=Ua(t,s);return{node:i}}return null}function Ua(e,t){const s=new ja(e,t);return L.$applyNodeReplacement(s)}function Wa(e){return e instanceof ja}const Ya="\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>_:;";const za=["@","+"].join("");const Xa=`[^${za}${Ya}\\s]`;const Ga="(?:"+"\\.[ |$]|"+" |"+`[${Ya}]|`+")";const Va=25;const Ja=new RegExp("(^|\\s|\\()("+`[${za}]`+`((?:${Xa}${Ga}){0,${Va}})`+")$");const qa=L.createCommand("INSERT_MENTION_COMMAND");const Qa=L.createCommand("INSERT_MENTION_DIALOG_COMMAND");var Za=babelHelpers.classPrivateFieldLooseKey("dialog");var eo=babelHelpers.classPrivateFieldLooseKey("lastQueryMatch");var to=babelHelpers.classPrivateFieldLooseKey("mentionListening");var so=babelHelpers.classPrivateFieldLooseKey("removeKeyboardCommandsLock");var io=babelHelpers.classPrivateFieldLooseKey("removeUpdateListener");var ro=babelHelpers.classPrivateFieldLooseKey("onEditorScroll");var ao=babelHelpers.classPrivateFieldLooseKey("lastPosition");var oo=babelHelpers.classPrivateFieldLooseKey("timeoutId");var lo=babelHelpers.classPrivateFieldLooseKey("triggerByAtSign");var no=babelHelpers.classPrivateFieldLooseKey("dialogOptions");var co=babelHelpers.classPrivateFieldLooseKey("entities");var ho=babelHelpers.classPrivateFieldLooseKey("registerCommands");var bo=babelHelpers.classPrivateFieldLooseKey("registerComponents");var uo=babelHelpers.classPrivateFieldLooseKey("convertMentionElement");var po=babelHelpers.classPrivateFieldLooseKey("registerKeyDownListener");var go=babelHelpers.classPrivateFieldLooseKey("registerTextContentListener");var vo=babelHelpers.classPrivateFieldLooseKey("unregisterTextContentListener");var fo=babelHelpers.classPrivateFieldLooseKey("textContentListener");var Po=babelHelpers.classPrivateFieldLooseKey("startMentionListening");var mo=babelHelpers.classPrivateFieldLooseKey("stopMentionListening");var Lo=babelHelpers.classPrivateFieldLooseKey("getQueryMatch");var yo=babelHelpers.classPrivateFieldLooseKey("getTextUpToAnchor");var Fo=babelHelpers.classPrivateFieldLooseKey("isSelectionOnEntityBoundary");var Ho=babelHelpers.classPrivateFieldLooseKey("matchMention");var Bo=babelHelpers.classPrivateFieldLooseKey("splitNodeContainingQuery");var Co=babelHelpers.classPrivateFieldLooseKey("getFullMatchOffset");var Oo=babelHelpers.classPrivateFieldLooseKey("openDialog");var To=babelHelpers.classPrivateFieldLooseKey("adjustDialogPosition");var Eo=babelHelpers.classPrivateFieldLooseKey("handleEditorScroll");var No=babelHelpers.classPrivateFieldLooseKey("handleHideOrDestroy");var _o=babelHelpers.classPrivateFieldLooseKey("hideDialog");var Mo=babelHelpers.classPrivateFieldLooseKey("lockKeyboardCommands");var Do=babelHelpers.classPrivateFieldLooseKey("unlockKeyboardCommands");class So extends ie{constructor(e){super(e);Object.defineProperty(this,Do,{value:tl});Object.defineProperty(this,Mo,{value:el});Object.defineProperty(this,_o,{value:Zo});Object.defineProperty(this,No,{value:Qo});Object.defineProperty(this,Eo,{value:qo});Object.defineProperty(this,To,{value:Jo});Object.defineProperty(this,Oo,{value:Vo});Object.defineProperty(this,Co,{value:Go});Object.defineProperty(this,Bo,{value:Xo});Object.defineProperty(this,Ho,{value:zo});Object.defineProperty(this,Fo,{value:Yo});Object.defineProperty(this,yo,{value:Wo});Object.defineProperty(this,Lo,{value:Uo});Object.defineProperty(this,mo,{value:ko});Object.defineProperty(this,Po,{value:jo});Object.defineProperty(this,fo,{value:Ko});Object.defineProperty(this,vo,{value:$o});Object.defineProperty(this,go,{value:Ao});Object.defineProperty(this,po,{value:wo});Object.defineProperty(this,uo,{value:xo});Object.defineProperty(this,bo,{value:Io});Object.defineProperty(this,ho,{value:Ro});Object.defineProperty(this,Za,{writable:true,value:null});Object.defineProperty(this,eo,{writable:true,value:null});Object.defineProperty(this,to,{writable:true,value:false});Object.defineProperty(this,so,{writable:true,value:null});Object.defineProperty(this,io,{writable:true,value:null});Object.defineProperty(this,ro,{writable:true,value:babelHelpers.classPrivateFieldLooseBase(this,Eo)[Eo].bind(this)});Object.defineProperty(this,ao,{writable:true,value:null});Object.defineProperty(this,oo,{writable:true,value:null});Object.defineProperty(this,lo,{writable:true,value:false});Object.defineProperty(this,no,{writable:true,value:null});Object.defineProperty(this,co,{writable:true,value:new Set});const t=e.getOption("mention.entities",[]);babelHelpers.classPrivateFieldLooseBase(this,co)[co]=F.Type.isArrayFilled(t)?new Set(t):new Set;const s=e.getOption("mention.dialogOptions");if(F.Type.isPlainObject(s)){babelHelpers.classPrivateFieldLooseBase(this,no)[no]=s;if(F.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,no)[no].entities)){for(const e of babelHelpers.classPrivateFieldLooseBase(this,no)[no].entities){if(F.Type.isPlainObject(e)&&F.Type.isStringFilled(e.id)){babelHelpers.classPrivateFieldLooseBase(this,co)[co].add(e.id)}}}babelHelpers.classPrivateFieldLooseBase(this,po)[po]()}if(babelHelpers.classPrivateFieldLooseBase(this,co)[co].size>0){babelHelpers.classPrivateFieldLooseBase(this,ho)[ho]();babelHelpers.classPrivateFieldLooseBase(this,bo)[bo]()}}static getName(){return"Mention"}static getNodes(e){return[ja]}importBBCode(){if(babelHelpers.classPrivateFieldLooseBase(this,co)[co].size>0){const e={};for(const t of babelHelpers.classPrivateFieldLooseBase(this,co)[co]){e[t]=()=>({conversion:babelHelpers.classPrivateFieldLooseBase(this,uo)[uo],priority:0})}return e}return null}exportBBCode(){return{mention:e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createElement({name:e.getEntityId(),value:e.getId(),inline:true})}}}}validateScheme(){return{nodes:[{nodeClass:ja}],bbcodeMap:{mention:"#mention"}}}shouldTriggerByAtSign(){return babelHelpers.classPrivateFieldLooseBase(this,lo)[lo]}isDialogVisible(){return babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].isRendered()&&babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].getPopup().isShown()}destroy(){super.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,oo)[oo]!==null){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,oo)[oo]);babelHelpers.classPrivateFieldLooseBase(this,oo)[oo]=null}if(babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]!==null){babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].destroy()}babelHelpers.classPrivateFieldLooseBase(this,vo)[vo]();babelHelpers.classPrivateFieldLooseBase(this,Do)[Do]()}}function Ro(){this.cleanUpRegister(this.getEditor().registerCommand(qa,(e=>{if(!F.Type.isPlainObject(e)||!F.Type.isStringFilled(e.entityId)||!F.Type.isStringFilled(e.text)||!F.Type.isStringFilled(e.id)&&!F.Type.isNumber(e.id)){return false}if(!babelHelpers.classPrivateFieldLooseBase(this,co)[co].has(e.entityId)){console.error(`TextEditor: MentionPlugin: entity id "${e.entityId}" was not found.`);return false}const t=Ua(e.entityId,e.id);t.append(L.$createTextNode(e.text));const s=[];if(F.Type.isStringFilled(e.before)){s.push(L.$createTextNode(e.before))}s.push(t);if(F.Type.isStringFilled(e.after)){s.push(L.$createTextNode(e.after))}L.$insertNodes(s);if(L.$isRootOrShadowRoot(t.getParentOrThrow())){y.$wrapNodeInElement(t,L.$createParagraphNode).selectEnd()}return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(Qa,(e=>{const t=L.$getSelection();if(!L.$isRangeSelection(t)){return false}this.getEditor().update((()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,yo)[yo](t);let s=e!==null&&!/(\s|\()$/.test(e);if(s){const e=t.anchor;const i=e.getNode();if(i.getIndexWithinParent()===0&&e.offset===0){s=false}}t.insertText(s?" @":"@")}),{onUpdate:()=>{this.getEditor().update((()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo](L.$getSelection());if(e!==null&&!babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo](e.leadOffset)){babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo](e)}}))}});return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(H,(e=>{if((e==null?void 0:e.sender)==="mention"||(e==null?void 0:e.context)==="resize"&&babelHelpers.classPrivateFieldLooseBase(this,to)[to]){return false}babelHelpers.classPrivateFieldLooseBase(this,_o)[_o]();return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(B,(()=>this.isDialogVisible()),L.COMMAND_PRIORITY_LOW))}function Io(){this.getEditor().getComponentRegistry().register("mention",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --mention"></span>');e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_MENTION"));e.disableInsideUnformatted();e.subscribe("onClick",(()=>{if(this.isDialogVisible()){return}this.getEditor().focus((()=>{this.getEditor().dispatchCommand(Qa)}))}));return e}))}function xo(e){return{node:Ua(e.getName(),e.getValue())}}function wo(){babelHelpers.classPrivateFieldLooseBase(this,lo)[lo]=true;const e=e=>{if(babelHelpers.classPrivateFieldLooseBase(this,to)[to]){if(e.key==="Escape"||e.key==="Enter"){babelHelpers.classPrivateFieldLooseBase(this,mo)[mo]()}}else if(!babelHelpers.classPrivateFieldLooseBase(this,to)[to]&&(e.key==="+"||e.key==="@")){babelHelpers.classPrivateFieldLooseBase(this,oo)[oo]=setTimeout((()=>{this.getEditor().update((()=>{const e=L.$getSelection();const t=babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo](e);if(t!==null&&!babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo](t.leadOffset)){babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo](t)}}))}),300)}return false};this.cleanUpRegister(this.getEditor().registerCommand(L.KEY_DOWN_COMMAND,e,L.COMMAND_PRIORITY_LOW))}function Ao(){babelHelpers.classPrivateFieldLooseBase(this,vo)[vo]();babelHelpers.classPrivateFieldLooseBase(this,io)[io]=this.getEditor().registerTextContentListener(babelHelpers.classPrivateFieldLooseBase(this,fo)[fo].bind(this))}function $o(){if(babelHelpers.classPrivateFieldLooseBase(this,io)[io]!==null){babelHelpers.classPrivateFieldLooseBase(this,io)[io]();babelHelpers.classPrivateFieldLooseBase(this,io)[io]=null}}function Ko(){this.getEditor().getEditorState().read((()=>{const e=L.$getSelection();const t=babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo](e);if(t!==null&&!babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo](t.leadOffset)){babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo](t)}else{babelHelpers.classPrivateFieldLooseBase(this,_o)[_o]()}}))}function jo(){babelHelpers.classPrivateFieldLooseBase(this,to)[to]=true;babelHelpers.classPrivateFieldLooseBase(this,go)[go]()}function ko(){babelHelpers.classPrivateFieldLooseBase(this,to)[to]=false;babelHelpers.classPrivateFieldLooseBase(this,vo)[vo]()}function Uo(e,t=0){if(!L.$isRangeSelection(e)||!e.isCollapsed()){return null}const s=e.anchor;const i=s.getNode();if(!L.$isTextNode(i)||!i.isSimpleText()){return null}const r=babelHelpers.classPrivateFieldLooseBase(this,yo)[yo](e);if(!F.Type.isStringFilled(r)){return null}return babelHelpers.classPrivateFieldLooseBase(this,Ho)[Ho](r,t)}function Wo(e){const t=e.anchor;if(t.type!=="text"){return null}const s=t.getNode();if(!s.isSimpleText()){return null}const i=t.offset;return s.getTextContent().slice(0,i)}function Yo(e){if(e!==0){return false}return this.getEditor().getEditorState().read((()=>{const e=L.$getSelection();if(L.$isRangeSelection(e)){const t=e.anchor;const s=t.getNode();const i=s.getPreviousSibling();return L.$isTextNode(i)&&i.isTextEntity()}return false}))}function zo(e,t){const s=Ja.exec(e);if(s!==null){const e=s[1];const i=s[3];if(i.length>=t){return{leadOffset:s.index+e.length,matchingString:i,replaceableString:s[2]}}}return null}function Xo(e){const t=L.$getSelection();if(!L.$isRangeSelection(t)||!t.isCollapsed()){return null}const s=t.anchor;if(s.type!=="text"){return null}const i=s.getNode();if(!i.isSimpleText()){return null}const r=s.offset;const a=i.getTextContent().slice(0,r);const o=e.replaceableString.length;const l=babelHelpers.classPrivateFieldLooseBase(this,Co)[Co](a,e.matchingString,o);const n=r-l;if(n<0){return null}let d=null;if(n===0){[d]=i.splitText(r)}else{[,d]=i.splitText(n,r)}return d}function Go(e,t,s){let i=s;for(let s=i;s<=t.length;s++){if(e.slice(-s)===t.slice(0,Math.max(0,s))){i=s}}return i}function Vo(e){if(this.isDestroyed()){return}babelHelpers.classPrivateFieldLooseBase(this,eo)[eo]=e;if(babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]===null){const t=F.Type.isPlainObject(babelHelpers.classPrivateFieldLooseBase(this,no)[no])?{...babelHelpers.classPrivateFieldLooseBase(this,no)[no]}:{};const s=t.events;F.Runtime.loadExtension("ui.entity-selector").then((i=>{if(this.isDestroyed()){return}const{Dialog:r}=i;const a={multiple:false,enableSearch:false,clearSearchOnSelect:true,hideOnSelect:true,hideByEsc:true,autoHide:true,height:300,width:400,offsetAnimation:false,compactView:true,...t,events:{onShow:()=>{babelHelpers.classPrivateFieldLooseBase(this,Mo)[Mo]();babelHelpers.classPrivateFieldLooseBase(this,Po)[Po]();F.Event.bind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,ro)[ro])},onHide:()=>{babelHelpers.classPrivateFieldLooseBase(this,No)[No]()},onDestroy:()=>{babelHelpers.classPrivateFieldLooseBase(this,No)[No]()},"Item:onBeforeSelect":e=>{const t=e.getData().item;e.preventDefault();this.getEditor().update((()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,Bo)[Bo](babelHelpers.classPrivateFieldLooseBase(this,eo)[eo]);const s=Ua(t.getEntityId(),t.getId());s.append(L.$createTextNode(t.getTitle()));if(e){e.replace(s);s.select()}babelHelpers.classPrivateFieldLooseBase(this,_o)[_o]()}))}}};babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]=new r(a);this.getEditor().dispatchCommand(H,{sender:"mention"});babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].subscribeFromOptions(s);babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].show();babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].search(e.matchingString);babelHelpers.classPrivateFieldLooseBase(this,To)[To]()})).catch((e=>{console.error('TextEditor: MentionPlugin: cannot load "ui.entity-selector"',e)}))}else{this.getEditor().dispatchCommand(H,{sender:"mention"});babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].show();babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].search(e.matchingString);babelHelpers.classPrivateFieldLooseBase(this,To)[To]()}}function Jo(){this.getEditor().update((()=>{const e=Zr(this.getEditor(),L.$getSelection(),document.body);if(e===null){return}const{top:t,left:s,bottom:i}=e;const r=F.Dom.getPosition(this.getEditor().getScrollerContainer());const a=400;const o=Qr(this.getEditor());let l=10;if(s-l<r.left){const e=r.left-(s-l);l-=e+o.left}else if(r.right<s+a-l){l+=s+a-l-r.right+o.right}if(i<r.top||t>r.bottom){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].getPopup().getPopupContainer(),"ui-text-editor-mention-popup__hidden")}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].getPopup().getPopupContainer(),"ui-text-editor-mention-popup__hidden");babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].show();if(babelHelpers.classPrivateFieldLooseBase(this,ao)[ao]===null||babelHelpers.classPrivateFieldLooseBase(this,ao)[ao].top!==i){babelHelpers.classPrivateFieldLooseBase(this,ao)[ao]={left:s-l,top:i}}babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].getPopup().setBindElement(babelHelpers.classPrivateFieldLooseBase(this,ao)[ao]);babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].getPopup().adjustPosition({forceBindPosition:true,forceTop:true})}}))}function qo(){babelHelpers.classPrivateFieldLooseBase(this,To)[To]()}function Qo(){babelHelpers.classPrivateFieldLooseBase(this,ao)[ao]=null;babelHelpers.classPrivateFieldLooseBase(this,Do)[Do]();babelHelpers.classPrivateFieldLooseBase(this,mo)[mo]();F.Event.unbind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,ro)[ro])}function Zo(){if(babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]!==null){babelHelpers.classPrivateFieldLooseBase(this,Za)[Za].hide()}}function el(){if(babelHelpers.classPrivateFieldLooseBase(this,so)[so]===null){babelHelpers.classPrivateFieldLooseBase(this,so)[so]=y.mergeRegister(this.getEditor().registerCommand(L.KEY_ARROW_DOWN_COMMAND,(()=>true),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_ARROW_UP_COMMAND,(()=>true),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_ESCAPE_COMMAND,(()=>true),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_TAB_COMMAND,(()=>true),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.KEY_ENTER_COMMAND,(()=>true),L.COMMAND_PRIORITY_LOW))}}function tl(){if(babelHelpers.classPrivateFieldLooseBase(this,so)[so]!==null){babelHelpers.classPrivateFieldLooseBase(this,so)[so]();babelHelpers.classPrivateFieldLooseBase(this,so)[so]=null}}var sl=Object.freeze({INSERT_MENTION_COMMAND:qa,INSERT_MENTION_DIALOG_COMMAND:Qa,MentionPlugin:So,MentionNode:ja,$createMentionNode:Ua,$isMentionNode:Wa});class il extends L.DecoratorNode{static getType(){return"smiley"}static clone(e){return new il(e.__src,e.__typing,e.__width,e.__height,e.__key)}constructor(e,t,s,i,r){super(r);this.__width=null;this.__height=null;this.__src=e;this.__typing=t;if(F.Type.isNumber(s)){this.__width=s}if(F.Type.isNumber(i)){this.__height=i}}getSrc(){return this.__src}getTyping(){return this.__typing}getWidth(){return this.__width}getHeight(){return this.__height}createDOM(e){var t;const s=document.createElement("img");s.src=encodeURI(this.__src);if(this.getWidth()>0&&this.getHeight()>0){F.Dom.style(s,{width:`${this.getWidth()}px`,height:`${this.getHeight()}px`})}if(F.Type.isStringFilled(e==null?void 0:(t=e.theme)==null?void 0:t.smiley)){F.Dom.addClass(s,e.theme.smiley)}F.Dom.attr(s,{draggable:false});return s}updateDOM(e,t,s){return false}static importJSON(e){const{src:t,typing:s,width:i,height:r}=e;return al(t,s,i,r)}exportDOM(){const e=document.createElement("span");e.textContent=this.getTyping();return{element:e}}exportJSON(){return{src:this.getSrc(),typing:this.getTyping(),width:this.getWidth(),height:this.getHeight(),type:"smiley",version:1}}decorate(e,t){return{}}getTextContent(){return this.getTyping()}isInline(){return true}isKeyboardSelectable(){return false}isIsolated(){return false}}function rl(e){return e instanceof il}function al(e,t,s,i){const r=new il(e,t,s,i);return L.$applyNodeReplacement(r)}var ol=babelHelpers.classPrivateFieldLooseKey("popup");var ll=babelHelpers.classPrivateFieldLooseKey("targetNode");class nl extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,ol,{writable:true,value:null});Object.defineProperty(this,ll,{writable:true,value:null});this.setEventNamespace("BX.UI.TextEditor.SmileyDialog");const t=F.Type.isPlainObject(e)?e:{};this.setTargetNode(t.targetNode);this.subscribeFromOptions(t.events)}show(){this.getPopup().adjustPosition({forceBindPosition:true});this.getPopup().show()}hide(){this.getPopup().close()}isShown(){return babelHelpers.classPrivateFieldLooseBase(this,ol)[ol]!==null&&babelHelpers.classPrivateFieldLooseBase(this,ol)[ol].isShown()}destroy(){this.getPopup().destroy()}setTargetNode(e){if(F.Type.isElementNode(e)){babelHelpers.classPrivateFieldLooseBase(this,ll)[ll]=e}}getTargetNode(){return babelHelpers.classPrivateFieldLooseBase(this,ll)[ll]}getPopup(){if(babelHelpers.classPrivateFieldLooseBase(this,ol)[ol]===null){const e=360;const t=this.getTargetNode();const s=t.getBoundingClientRect();const i=s.width;babelHelpers.classPrivateFieldLooseBase(this,ol)[ol]=new p.Popup({autoHide:true,padding:0,closeByEsc:true,width:e,height:250,bindElement:this.getTargetNode(),events:{onClose:()=>{this.emit("onClose")},onDestroy:()=>{this.emit("onDestroy")},onFirstShow:()=>{const e=this;F.Runtime.loadExtension("ui.vue3","ui.vue3.components.smiles").then((t=>{const{BitrixVue:s,Smiles:i}=t;const r=s.createApp({methods:{handleSelect(t){e.emit("onSelect",{smiley:t.trim()})}},components:{Smiles:i},template:'<Smiles @selectSmile="handleSelect($event.text)"/>'});r.mount(babelHelpers.classPrivateFieldLooseBase(this,ol)[ol].getContentContainer())})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,ol)[ol].close()}))},onShow:t=>{const s=t.getTarget();const r=i/2-e/2;const a=p.Popup.getOption("angleLeftOffset")-p.Popup.getOption("angleMinTop");s.setAngle({offset:e/2-a});s.setOffset({offsetLeft:r+p.Popup.getOption("angleLeftOffset")})}}})}return babelHelpers.classPrivateFieldLooseBase(this,ol)[ol]}}const dl=L.createCommand("INSERT_SMILEY_COMMAND");const cl=L.createCommand("INSERT_SMILEY_DIALOG_COMMAND");var hl=babelHelpers.classPrivateFieldLooseKey("smileyParser");var bl=babelHelpers.classPrivateFieldLooseKey("smileyDialog");var ul=babelHelpers.classPrivateFieldLooseKey("registerListeners");var pl=babelHelpers.classPrivateFieldLooseKey("registerInsertSmileyCommand");var gl=babelHelpers.classPrivateFieldLooseKey("registerComponents");class vl extends ie{constructor(e){super(e);Object.defineProperty(this,gl,{value:ml});Object.defineProperty(this,pl,{value:Pl});Object.defineProperty(this,ul,{value:fl});Object.defineProperty(this,hl,{writable:true,value:null});Object.defineProperty(this,bl,{writable:true,value:null});if(a.SmileyManager.getSize()>0){babelHelpers.classPrivateFieldLooseBase(this,hl)[hl]=new a.SmileyParser(a.SmileyManager.getAll());babelHelpers.classPrivateFieldLooseBase(this,ul)[ul]();babelHelpers.classPrivateFieldLooseBase(this,pl)[pl]();babelHelpers.classPrivateFieldLooseBase(this,gl)[gl]()}}static getName(){return"Smiley"}static getNodes(e){return[il]}importBBCode(){return null}exportBBCode(){return{smiley:e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createText(e.getTyping())}}}}validateScheme(){return{bbcodeMap:{smiley:"#text"}}}destroy(){super.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,bl)[bl]!==null){babelHelpers.classPrivateFieldLooseBase(this,bl)[bl].destroy()}}}function fl(){const e=new Set;this.cleanUpRegister(this.getEditor().registerNodeTransform(L.TextNode,(t=>{if(!t.isSimpleText()||e.has(t.getKey())){return}const s=y.$findMatchingParent(t,(e=>(e.__flags&E)!==0));if(s){return}const i=babelHelpers.classPrivateFieldLooseBase(this,hl)[hl].parse(t.getTextContent());if(i.length>0){const s=i.reduce(((e,t)=>{e.push(t.start,t.end);return e}),[]);const r=t.splitText(...s);for(const t of r){const s=a.SmileyManager.get(t.getTextContent())||null;if(s){const e=al(s.getImage(),s.getTyping(),s.getWidth(),s.getHeight());t.replace(e)}else{e.add(t.getKey())}}}})),this.getEditor().registerUpdateListener((()=>{e.clear()})),this.getEditor().registerMutationListener(il,(e=>{for(const[t,s]of e){if(s==="created"){const e=this.getEditor().getElementByKey(t);e.contentEditable=true}}})),this.getEditor().registerCommand(H,(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,bl)[bl]!==null){babelHelpers.classPrivateFieldLooseBase(this,bl)[bl].hide()}return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(B,(()=>babelHelpers.classPrivateFieldLooseBase(this,bl)[bl]!==null&&babelHelpers.classPrivateFieldLooseBase(this,bl)[bl].isShown()),L.COMMAND_PRIORITY_LOW))}function Pl(){this.cleanUpRegister(this.getEditor().registerCommand(dl,(e=>{const t=a.SmileyManager.get(e)||null;if(!t){return false}const s=al(t.getImage(),t.getTyping(),t.getWidth(),t.getHeight());L.$insertNodes([L.$createTextNode(" "),s,L.$createTextNode(" ")]);if(L.$isRootOrShadowRoot(s.getParentOrThrow())){y.$wrapNodeInElement(s,L.$createParagraphNode).selectEnd()}return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(cl,(e=>{if(!F.Type.isPlainObject(e)||!F.Type.isElementNode(e.targetNode)){return false}if(babelHelpers.classPrivateFieldLooseBase(this,bl)[bl]!==null){if(babelHelpers.classPrivateFieldLooseBase(this,bl)[bl].getTargetNode()===e.targetNode){babelHelpers.classPrivateFieldLooseBase(this,bl)[bl].show();return true}babelHelpers.classPrivateFieldLooseBase(this,bl)[bl].destroy()}babelHelpers.classPrivateFieldLooseBase(this,bl)[bl]=new nl({targetNode:e.targetNode,events:{onSelect:e=>{this.getEditor().dispatchCommand(dl,e.getData().smiley);babelHelpers.classPrivateFieldLooseBase(this,bl)[bl].hide()},onDestroy:()=>{babelHelpers.classPrivateFieldLooseBase(this,bl)[bl]=null}}});babelHelpers.classPrivateFieldLooseBase(this,bl)[bl].show();return true}),L.COMMAND_PRIORITY_LOW))}function ml(){this.getEditor().getComponentRegistry().register("smileys",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --insert-emoji"></span>');e.disableInsideUnformatted();e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_SMILEYS"));e.subscribe("onClick",(()=>{this.getEditor().update((()=>{this.getEditor().dispatchCommand(cl,{targetNode:e.getContainer()})}))}));return e}))}var Ll=Object.freeze({INSERT_SMILEY_COMMAND:dl,INSERT_SMILEY_DIALOG_COMMAND:cl,SmileyPlugin:vl,SmileyNode:il,$isSmileyNode:rl,$createSmileyNode:al,SmileyDialog:nl});let yl=e=>e,Fl,Hl;var Bl=babelHelpers.classPrivateFieldLooseKey("refs");var Cl=babelHelpers.classPrivateFieldLooseKey("figureResizer");var Ol=babelHelpers.classPrivateFieldLooseKey("trusted");var Tl=babelHelpers.classPrivateFieldLooseKey("render");var El=babelHelpers.classPrivateFieldLooseKey("getContainer");var Nl=babelHelpers.classPrivateFieldLooseKey("getVideo");var _l=babelHelpers.classPrivateFieldLooseKey("handleResize");var Ml=babelHelpers.classPrivateFieldLooseKey("handleResizeEnd");class Dl extends xs{constructor(e){super(e);Object.defineProperty(this,Ml,{value:wl});Object.defineProperty(this,_l,{value:xl});Object.defineProperty(this,Nl,{value:Il});Object.defineProperty(this,El,{value:Rl});Object.defineProperty(this,Tl,{value:Sl});Object.defineProperty(this,Bl,{writable:true,value:new g.MemoryCache});Object.defineProperty(this,Cl,{writable:true,value:null});Object.defineProperty(this,Ol,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,Ol)[Ol]=F.Type.isStringFilled(this.getOption("provider"));babelHelpers.classPrivateFieldLooseBase(this,Cl)[Cl]=new li({target:babelHelpers.classPrivateFieldLooseBase(this,Nl)[Nl](),editor:this.getEditor(),minWidth:120,minHeight:120,freeTransform:true,events:{onResize:babelHelpers.classPrivateFieldLooseBase(this,_l)[_l].bind(this),onResizeEnd:babelHelpers.classPrivateFieldLooseBase(this,Ml)[Ml].bind(this)}});this.getNodeSelection().onSelect((e=>{if(e||babelHelpers.classPrivateFieldLooseBase(this,Cl)[Cl].isResizing()){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,El)[El](),"--selected");babelHelpers.classPrivateFieldLooseBase(this,Cl)[Cl].show()}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,El)[El](),"--selected");babelHelpers.classPrivateFieldLooseBase(this,Cl)[Cl].hide()}}));this.update(this.getOptions());babelHelpers.classPrivateFieldLooseBase(this,Tl)[Tl]()}update(e){const t=F.Type.isNumber(e.width)&&e.width>0?e.width:null;const s=F.Type.isNumber(e.height)&&e.height>0?e.height:null;const i=t>0&&s>0?`${t} / ${s}`:"auto";F.Dom.adjust(babelHelpers.classPrivateFieldLooseBase(this,Nl)[Nl](),{attrs:{width:t},style:{width:t,height:"auto",aspectRatio:i}})}}function Sl(){F.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,El)[El](),this.getTarget())}function Rl(){return babelHelpers.classPrivateFieldLooseBase(this,Bl)[Bl].remember("container",(()=>F.Tag.render(Fl||(Fl=yl`
				<div class="ui-text-editor-video-component">
					<div class="ui-text-editor-video-object-container">${0}</div>
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,Nl)[Nl](),babelHelpers.classPrivateFieldLooseBase(this,Cl)[Cl].getContainer())))}function Il(){return babelHelpers.classPrivateFieldLooseBase(this,Bl)[Bl].remember("video",(()=>{var e,t;let s=null;const i=this.getOption("src");if(babelHelpers.classPrivateFieldLooseBase(this,Ol)[Ol]){s=F.Tag.render(Hl||(Hl=yl`<iframe frameborder="0" src="about:blank" draggable="false" tabindex="-1"></iframe>`));s.src=i}else{s=F.Dom.create({tag:"video",attrs:{controls:true,preload:"metadata",playsinline:true,tabIndex:-1,src:i},events:{loadedmetadata:e=>{this.getEditor().update((()=>{const t=L.$getNodeByKey(this.getNodeKey());if(Kl(t)&&t.getWidth()===0){const[s,i]=wi(e.target.videoWidth,e.target.videoHeight,600,600);t.setWidthAndHeight(s,i)}}))}}})}const r=this.getOption("config",{});if(r!=null&&(e=r.theme)!=null&&(t=e.video)!=null&&t.object){s.className=r.theme.video.object}return s}))}function xl(e){this.update(e.getData())}function wl(e){this.setSelected(true);this.getEditor().update((()=>{const t=L.$getNodeByKey(this.getNodeKey());if(Kl(t)){const{width:s,height:i}=e.getData();t.setWidthAndHeight(s,i)}}))}class Al extends L.DecoratorNode{constructor(e,t,s,i){super(i);this.__width=560;this.__height=315;this.__provider=null;this.__src=e;if(F.Type.isNumber(t)){this.__width=Math.round(t)}if(F.Type.isNumber(s)){this.__height=Math.round(s)}const r=/^https?:/.test(e)?e:`https://${e.replace(/^\/\//,"")}`;const a=new F.Uri(r);const l=o.VideoService.createByHost(a.getHost());if(l){this.__provider=l.getId()}}static getType(){return"video"}static clone(e){return new Al(e.__src,e.__width,e.__height,e.__key)}static importJSON(e){const{width:t,height:s,src:i}=e;return $l({src:i,width:t,height:s})}exportDOM(){return{element:null}}static importDOM(){return null}exportJSON(){return{src:this.getSrc(),width:this.getWidth(),height:this.getHeight(),type:"video",version:1}}setWidthAndHeight(e,t){const s=this.getWritable();if(F.Type.isNumber(e)){s.__width=Math.round(e)}if(F.Type.isNumber(t)){s.__height=Math.round(t)}}createDOM(e){var t;const s=document.createElement("span");const i=e.theme;const r=i==null?void 0:(t=i.video)==null?void 0:t.container;if(r!==undefined){s.className=r}return s}updateDOM(){return false}getSrc(){return this.__src}getWidth(){const e=this.getLatest();return e.__width}getHeight(){const e=this.getLatest();return e.__height}getProvider(){const e=this.getLatest();return e.__provider}decorate(e,t){return{componentClass:Dl,options:{src:this.getSrc(),width:this.getWidth(),height:this.getHeight(),provider:this.getProvider(),config:t}}}isInline(){return true}}Al.useDecoratorComponent=true;function $l({src:e,width:t,height:s,key:i}){return L.$applyNodeReplacement(new Al(e,t,s,i))}function Kl(e){return e instanceof Al}let jl=e=>e,kl,Ul,Wl;var Yl=babelHelpers.classPrivateFieldLooseKey("popup");var zl=babelHelpers.classPrivateFieldLooseKey("videoUrl");var Xl=babelHelpers.classPrivateFieldLooseKey("targetContainer");var Gl=babelHelpers.classPrivateFieldLooseKey("refs");var Vl=babelHelpers.classPrivateFieldLooseKey("handleSaveBtnClick");var Jl=babelHelpers.classPrivateFieldLooseKey("handleTextBoxKeyDown");var ql=babelHelpers.classPrivateFieldLooseKey("handleTextBoxInput");var Ql=babelHelpers.classPrivateFieldLooseKey("handleCancelBtnClick");class Zl extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,Ql,{value:rn});Object.defineProperty(this,ql,{value:sn});Object.defineProperty(this,Jl,{value:tn});Object.defineProperty(this,Vl,{value:en});Object.defineProperty(this,Yl,{writable:true,value:null});Object.defineProperty(this,zl,{writable:true,value:""});Object.defineProperty(this,Xl,{writable:true,value:null});Object.defineProperty(this,Gl,{writable:true,value:new g.MemoryCache});this.setEventNamespace("BX.UI.TextEditor.VideoDialog");const t=F.Type.isPlainObject(e)?e:{};this.setTargetContainer(t.targetContainer);this.subscribeFromOptions(t.events)}show(e={}){var t;const s=(t=e.target)!=null?t:undefined;const i=F.Type.isPlainObject(e.targetOptions)?e.targetOptions:{};if(!F.Type.isUndefined(s)){this.getPopup().setBindElement(s)}this.getPopup().adjustPosition({...i,forceBindPosition:true});this.getPopup().show()}hide(){this.getPopup().close()}isShown(){return babelHelpers.classPrivateFieldLooseBase(this,Yl)[Yl]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Yl)[Yl].isShown()}destroy(){this.getPopup().destroy()}setVideoUrl(e){if(F.Type.isString(e)){babelHelpers.classPrivateFieldLooseBase(this,zl)[zl]=da(e)}}getVideoUrl(){return babelHelpers.classPrivateFieldLooseBase(this,zl)[zl]}setTargetContainer(e){if(F.Type.isElementNode(e)){babelHelpers.classPrivateFieldLooseBase(this,Xl)[Xl]=e}}getTargetContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Xl)[Xl]}getPopup(){if(babelHelpers.classPrivateFieldLooseBase(this,Yl)[Yl]===null){babelHelpers.classPrivateFieldLooseBase(this,Yl)[Yl]=new p.Popup({autoHide:true,cacheable:false,padding:0,closeByEsc:true,targetContainer:this.getTargetContainer(),content:this.getContainer(),events:{onShow:()=>{this.emit("onShow")},onClose:()=>{this.emit("onClose")},onDestroy:()=>{this.emit("onDestroy")},onAfterShow:()=>{this.getUrlTextBox().focus()}}})}return babelHelpers.classPrivateFieldLooseBase(this,Yl)[Yl]}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Gl)[Gl].remember("container",(()=>F.Tag.render(kl||(kl=jl`
				<div class="ui-text-editor-video-dialog">
					<div class="ui-text-editor-video-dialog-form">
						<div class="ui-ctl ui-ctl-textbox ui-ctl-s ui-ctl-inline ui-ctl-w100 ui-text-editor-video-dialog-textbox">
							<div class="ui-ctl-tag">${0}</div>
							${0}
						</div>
						<button type="button" 
							class="ui-text-editor-video-dialog-button" 
							onclick="${0}"
							data-testid="video-dialog-save-btn"
						>
							<span class="ui-icon-set --check"></span>
						</button>
						<button 
							type="button" 
							class="ui-text-editor-video-dialog-button"
							onclick="${0}"
							data-testid="video-dialog-cancel-btn"
						>
							<span class="ui-icon-set --cross-60"></span>
						</button>
					</div>
					${0}
				</div>
			`),F.Loc.getMessage("TEXT_EDITOR_VIDEO_INSERT_TITLE"),this.getUrlTextBox(),babelHelpers.classPrivateFieldLooseBase(this,Vl)[Vl].bind(this),babelHelpers.classPrivateFieldLooseBase(this,Ql)[Ql].bind(this),this.getStatusContainer())))}getUrlTextBox(){return babelHelpers.classPrivateFieldLooseBase(this,Gl)[Gl].remember("url-textbox",(()=>F.Tag.render(Ul||(Ul=jl`
				<input 
					type="text"
					class="ui-ctl-element"
					placeholder="https://"
					value="${0}"
					onkeydown="${0}"
					oninput="${0}"
					data-testid="video-dialog-textbox"
				>
			`),this.getVideoUrl(),babelHelpers.classPrivateFieldLooseBase(this,Jl)[Jl].bind(this),babelHelpers.classPrivateFieldLooseBase(this,ql)[ql].bind(this))))}getStatusContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Gl)[Gl].remember("status",(()=>F.Tag.render(Wl||(Wl=jl`
				<div class="ui-text-editor-video-dialog-status">${0}</div>
			`),F.Loc.getMessage("TEXT_EDITOR_VIDEO_INSERT_HINT"))))}showError(e){F.Dom.addClass(this.getStatusContainer(),"--error");F.Dom.addClass(this.getUrlTextBox().parentNode,"ui-ctl-warning");if(F.Type.isStringFilled(e)){this.getStatusContainer().textContent=e}}clearError(){F.Dom.removeClass(this.getStatusContainer(),"--error");F.Dom.removeClass(this.getUrlTextBox().parentNode,"ui-ctl-warning");this.getStatusContainer().textContent=F.Loc.getMessage("TEXT_EDITOR_VIDEO_INSERT_HINT")}}function en(){const e=this.getUrlTextBox().value.trim();if(e.length>0){this.setVideoUrl(e);this.emit("onSave")}else{this.getUrlTextBox().focus()}}function tn(e){if(e.key==="Enter"){e.preventDefault();babelHelpers.classPrivateFieldLooseBase(this,Vl)[Vl]()}}function sn(e){this.emit("onInput")}function rn(){this.emit("onCancel")}function an(e){return/^(http:|https:|\/)/i.test(e)}const on=L.createCommand("INSERT_VIDEO_COMMAND");const ln=L.createCommand("INSERT_VIDEO_DIALOG_COMMAND");var nn=babelHelpers.classPrivateFieldLooseKey("videoDialog");var dn=babelHelpers.classPrivateFieldLooseKey("onEditorScroll");var cn=babelHelpers.classPrivateFieldLooseKey("lastSelection");var hn=babelHelpers.classPrivateFieldLooseKey("registerCommands");var bn=babelHelpers.classPrivateFieldLooseKey("restoreSelection");var un=babelHelpers.classPrivateFieldLooseKey("handleDialogDestroy");var pn=babelHelpers.classPrivateFieldLooseKey("handleEditorScroll");var gn=babelHelpers.classPrivateFieldLooseKey("registerComponents");class vn extends ie{constructor(e){super(e);Object.defineProperty(this,gn,{value:yn});Object.defineProperty(this,pn,{value:Ln});Object.defineProperty(this,un,{value:mn});Object.defineProperty(this,bn,{value:Pn});Object.defineProperty(this,hn,{value:fn});Object.defineProperty(this,nn,{writable:true,value:null});Object.defineProperty(this,dn,{writable:true,value:babelHelpers.classPrivateFieldLooseBase(this,pn)[pn].bind(this)});Object.defineProperty(this,cn,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,hn)[hn]();babelHelpers.classPrivateFieldLooseBase(this,gn)[gn]()}static getName(){return"Video"}static getNodes(e){return[Al]}importBBCode(){return{video:()=>({conversion:e=>{const t=e.getContent().trim();const s=Number(e.getAttribute("width"));const i=Number(e.getAttribute("height"));if(an(t)){return{node:$l({src:da(t),width:s,height:i})}}return{node:L.$createTextNode(e.toString())}},priority:0})}}exportBBCode(){return{video:e=>{const t={};const s=e.getWidth();const i=e.getHeight();if(F.Type.isNumber(s)&&F.Type.isNumber(i)){t.width=s;t.height=i}const r=e.getProvider();if(F.Type.isStringFilled(r)){t.type=r}const a=this.getEditor().getBBCodeScheme();return{node:a.createElement({name:"video",inline:false,attributes:t}),after:t=>{t.setChildren([a.createText(e.getSrc())])}}}}}validateScheme(){return{nodes:[{nodeClass:Al}],bbcodeMap:{video:"video"}}}destroy(){super.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,nn)[nn]!==null){babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].destroy()}}}function fn(){this.cleanUpRegister(this.getEditor().registerCommand(on,(e=>{if(F.Type.isPlainObject(e)&&an(e.src)){const t=$l({src:o.VideoService.getEmbeddedUrl(e.src)||e.src,width:e.width,height:e.height});y.$insertNodeToNearestRoot(t);return true}return false}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(ln,(()=>{const e=L.$getSelection();if(!L.$isRangeSelection(e)){return false}babelHelpers.classPrivateFieldLooseBase(this,cn)[cn]=e.clone();if(babelHelpers.classPrivateFieldLooseBase(this,nn)[nn]!==null){babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].destroy()}this.getEditor().dispatchCommand(H,{sender:"video-dialog"});babelHelpers.classPrivateFieldLooseBase(this,nn)[nn]=new Zl({targetContainer:document.body,events:{onSave:()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].getVideoUrl();if(!F.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].hide();return}if(!an(e)){babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].showError(F.Loc.getMessage("TEXT_EDITOR_INVALID_URL"));return}this.getEditor().dispatchCommand(on,{src:e});babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].hide()},onInput:()=>{babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].clearError()},onCancel:()=>{babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].hide()},onShow:()=>{if(ra(babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].getPopup(),this.getEditor())){F.Event.bind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,dn)[dn]);this.getEditor().highlightSelection()}},onClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,un)[un]()},onDestroy:()=>{babelHelpers.classPrivateFieldLooseBase(this,un)[un]()}}});babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].show();return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(H,(e=>{if((e==null?void 0:e.sender)==="video-dialog"){return false}babelHelpers.classPrivateFieldLooseBase(this,cn)[cn]=null;if(babelHelpers.classPrivateFieldLooseBase(this,nn)[nn]!==null){babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].hide()}return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(B,(()=>babelHelpers.classPrivateFieldLooseBase(this,nn)[nn]!==null&&babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].isShown()),L.COMMAND_PRIORITY_LOW))}function Pn(){const e=oa(babelHelpers.classPrivateFieldLooseBase(this,cn)[cn]);babelHelpers.classPrivateFieldLooseBase(this,cn)[cn]=null;return e}function mn(){if(babelHelpers.classPrivateFieldLooseBase(this,nn)[nn]===null){return}babelHelpers.classPrivateFieldLooseBase(this,nn)[nn]=null;F.Event.unbind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,dn)[dn]);this.getEditor().resetHighlightSelection();this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,bn)[bn]()}))}function Ln(){this.getEditor().update((()=>{ra(babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].getPopup(),this.getEditor())}))}function yn(){this.getEditor().getComponentRegistry().register("video",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --insert-video"></span>');e.disableInsideUnformatted();e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_VIDEO"));e.subscribe("onClick",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,nn)[nn]!==null&&babelHelpers.classPrivateFieldLooseBase(this,nn)[nn].isShown()){return}this.getEditor().focus((()=>{this.getEditor().dispatchCommand(ln)}))}));return e}))}var Fn=Object.freeze({VideoNode:Al,$createVideoNode:$l,$isVideoNode:Kl,INSERT_VIDEO_COMMAND:on,INSERT_VIDEO_DIALOG_COMMAND:ln,VideoPlugin:vn});function Hn(e){let t=R.map((t=>t(e))).filter(Boolean).join(", ").toLocaleLowerCase();if(t!==""){t=`format: ${t}`}return t}function Bn(e){if(wt(e)){const t=e;return`{ ${t.__highlightType}: "${Cn(t.getTextContent())}" }`}if(Kt(e)){const t=e;return`{ children: ${t.getChildrenSize()} }`}if(L.$isTextNode(e)){const t=e.getTextContent();const s=t.length===0?"(empty)":`"${Cn(t)}"`;const i=On(e);return[s,i.length>0?`{ ${i} }`:null].filter(Boolean).join(" ").trim()}if(Si(e)){const t=e;return`{ id: ${t.getId()}, width: ${t.getWidth()}, height: ${t.getHeight()} }`}if(xi(e)){const t=e;return`{ id: ${t.getId()} }`}if(ir(e)){const t=e;return`{ id: ${t.getId()} }`}if(rl(e)){const t=e;return`{ typing: ${t.getTyping()}, width: ${t.getWidth()}, height: ${t.getHeight()} }`}if(Kl(e)){const t=e;return`{ width: ${t.getWidth()}, height: ${t.getHeight()} }`}if(Wa(e)){const t=e;return`{ entityId: ${t.getEntityId()}, id: ${t.getId()} }`}if(Jr(e)){const t=e;return`{ width: ${t.getWidth()}, height: ${t.getHeight()} }`}if(P.$isLinkNode(e)){const t=e;const s=t.getURL();const i=s.length===0?"(empty)":`"${Cn(s)}"`;const r=Tn(t);return[i,r.length>0?`{ ${r} }`:null].filter(Boolean).join(" ").trim()}return""}function Cn(e){return Object.entries(M).reduce(((e,[t,s])=>e.replace(new RegExp(t,"g"),String(s))),e)}function On(e){return[Hn(e),Mn(e),Dn(e)].filter(Boolean).join(", ")}function Tn(e){return[En(e),Nn(e),_n(e)].filter(Boolean).join(", ")}function En(e){let t=e.getTarget();if(!F.Type.isNil(t)){t=`target: ${t}`}return t}function Nn(e){let t=e.getRel();if(!F.Type.isNil(t)){t=`rel: ${t}`}return t}function _n(e){let t=e.getTitle();if(!F.Type.isNil(t)){t=`title: ${t}`}return t}function Mn(e){let t=I.map((t=>t(e))).filter(Boolean).join(", ").toLocaleLowerCase();if(t!==""){t=`detail: ${t}`}return t}function Dn(e){let t=x.map((t=>t(e))).filter(Boolean).join(", ").toLocaleLowerCase();if(t!==""){t=`mode: ${t}`}return t}function Sn(e){if(!L.$isNodeSelection(e)){return""}return`: node\n  \u2514 [${[...e._nodes].join(", ")}]`}function Rn(e){let t="";const s=Hn(e);t+=`: range ${s!==""?`{ ${s} }`:""} ${e.style!==""?`{ style: ${e.style} } `:""}`;const i=e.anchor;const r=e.focus;const a=i.offset;const o=r.offset;t+=`\n  \u251c anchor { key: ${i.key}, offset: ${a===null?"null":a}, type: ${i.type} }`;t+=`\n  \u2514 focus { key: ${r.key}, offset: ${o===null?"null":o}, type: ${r.type} }`;return t}function In(e){return`: table\n  \u2514 { table: ${e.tableKey}, anchorCell: ${e.anchor.key}, focusCell: ${e.focus.key} }`}function xn(e,t,s=[]){const i=e.getChildren();const r=i.length;i.forEach(((e,i)=>{t(e,s.concat(i===r-1?S.isLastChild:S.hasNextSibling));if(L.$isElementNode(e)){xn(e,t,s.concat(i===r-1?S.ancestorIsLastChild:S.ancestorHasNextSibling))}}))}function wn(e){const t=e.getEditorState();let s=" root\n";const i=t.read((()=>{const e=L.$getSelection();xn(L.$getRoot(),((t,i)=>{const r=t.getKey();const a=`(${r})`;const o=t.getType()||"";const l=t.isSelected();s+=`${l?S.selectedLine:" "} ${i.join(" ")} ${a} ${o} ${Bn(t)}\n`;s+=An({indent:i,isSelected:l,node:t,nodeKeyDisplay:a,selection:e,typeDisplay:o})}));if(e===null){return": null"}if(L.$isRangeSelection(e)){return Rn(e)}if(h.$isTableSelection(e)){return In(e)}return Sn(e)}));s+=`\n selection${i}`;return s}function An({indent:e,isSelected:t,node:s,nodeKeyDisplay:i,selection:r,typeDisplay:a}){if(!L.$isTextNode(s)||!L.$isRangeSelection(r)||!t||L.$isElementNode(s)){return""}const o=r.anchor;const l=r.focus;if(s.getTextContent()===""||o.getNode()===r.focus.getNode()&&o.offset===l.offset){return""}const[n,d]=$n(s,r);if(n===d){return""}const c=e[e.length-1]===S.hasNextSibling?S.ancestorHasNextSibling:S.ancestorIsLastChild;const h=[...e.slice(0,-1),c];const b=Array.from({length:n+1}).fill(" ");const u=Array.from({length:d-n}).fill(S.selectedChar);const p=a.length+3;const g=Array.from({length:i.length+p}).fill(" ");return`${[S.selectedLine,h.join(" "),[...g,...b,...u].join("")].join(" ")}\n`}function $n(e,t){const s=t.getStartEndPoints();if(L.$isNodeSelection(t)||s===null){return[-1,-1]}const[i,r]=s;const a=e.getTextContent();const o=a.length;let l=-1;let n=-1;if(i.type==="text"&&r.type==="text"){const t=i.getNode();const s=r.getNode();if(t===s&&e===t&&i.offset!==r.offset){[l,n]=i.offset<r.offset?[i.offset,r.offset]:[r.offset,i.offset]}else if(e===t){[l,n]=t.isBefore(s)?[i.offset,o]:[0,i.offset]}else if(e===s){[l,n]=s.isBefore(t)?[r.offset,o]:[0,r.offset]}else{[l,n]=[0,o]}}const d=(a.slice(0,l).match(D)||[]).length;const c=(a.slice(l,n).match(D)||[]).length;return[l+d,n+d+c]}function Kn(e){return[...e].reduce(((e,t)=>Math.trunc(Math.imul(31,e)+t.codePointAt(0))),0)}function jn(e=true){const t=L.$getRoot();let s=t.getTextContent();if(e){s=s.trim()}if(s!==""){return false}const i=t.getChildren();const r=i.length;if(r>1){return false}for(let e=0;e<r;e++){const t=i[e];if(L.$isDecoratorNode(t)){return false}if(L.$isElementNode(t)){if(!L.$isParagraphNode(t)){return false}if(t.__indent!==0){return false}const s=t.getChildren();const i=s.length;for(let t=0;t<i;t++){const t=s[e];if(!L.$isTextNode(t)){return false}}}}return true}const kn={blockCursor:"ui-text-editor__block-cursor",indent:"ui-text-editor__indent",ltr:"ui-text-editor__ltr",rtl:"ui-text-editor__rtl",heading:{h1:"ui-typography-heading-h1",h2:"ui-typography-heading-h2",h3:"ui-typography-heading-h3",h4:"ui-typography-heading-h4",h5:"ui-typography-heading-h5",h6:"ui-typography-heading-h6"},hashtag:"ui-typography-hashtag",link:"ui-typography-link",list:{listitem:"ui-typography-li",nested:{list:"--nested",listitem:"ui-text-editor__nestedListItem --nested"},olDepth:["ui-typography-ol ui-text-editor__ol1","ui-typography-ol ui-text-editor__ol2","ui-typography-ol ui-text-editor__ol3","ui-typography-ol ui-text-editor__ol4","ui-typography-ol ui-text-editor__ol5"],ul:"ui-typography-ul"},paragraph:"ui-typography-paragraph ui-text-editor__paragraph",text:{bold:"ui-typography-text-bold",code:"ui-typography-text-code",italic:"ui-typography-text-italic",strikethrough:"ui-typography-text-strikethrough",subscript:"ui-typography-text-subscript",superscript:"ui-typography-text-superscript",underline:"ui-typography-text-underline",underlineStrikethrough:"ui-typography-text-underline-strikethrough"},mention:"ui-typography-mention",quote:"ui-typography-quote",spoiler:{container:"ui-typography-spoiler",title:"ui-typography-spoiler-title ui-icon-set__scope",content:"ui-typography-spoiler-content"},smiley:"ui-typography-smiley",code:"ui-typography-code",codeHighlight:{operator:"ui-typography-token-operator",punctuation:"ui-typography-token-punctuation",comment:"ui-typography-token-comment",word:"ui-typography-token-word",keyword:"ui-typography-token-keyword",boolean:"ui-typography-token-boolean",regex:"ui-typography-token-regex",string:"ui-typography-token-string",number:"ui-typography-token-number",semicolon:"ui-typography-token-semicolon",bracket:"ui-typography-token-bracket",brace:"ui-typography-token-brace",parentheses:"ui-typography-token-parentheses"},table:"ui-typography-table",tableRow:"ui-typography-table-row",tableCell:"ui-typography-table-cell",tableCellHeader:"ui-typography-table-cell-header",tableSelection:"ui-typography-table-selection",image:{container:"ui-typography-image-container ui-text-editor__image-container",img:"ui-typography-image"},video:{container:"ui-typography-video-container ui-text-editor__video-container",object:"ui-typography-video-object ui-text-editor__video-object"},file:"ui-text-editor__file"};let Un;var Wn=babelHelpers.classPrivateFieldLooseKey("pluginConstructors");var Yn=babelHelpers.classPrivateFieldLooseKey("plugins");var zn=babelHelpers.classPrivateFieldLooseKey("availablePlugins");Un=Symbol.iterator;class Xn{constructor(e=[],t=[],s=[]){Object.defineProperty(this,Wn,{writable:true,value:new Map});Object.defineProperty(this,Yn,{writable:true,value:new Map});Object.defineProperty(this,zn,{writable:true,value:new Map});for(const t of e){if(t.getName()){babelHelpers.classPrivateFieldLooseBase(this,zn)[zn].set(t.getName(),t)}}for(const e of t){if(F.Type.isFunction(e)&&e.getName()&&!babelHelpers.classPrivateFieldLooseBase(this,zn)[zn].has(e.getName())){babelHelpers.classPrivateFieldLooseBase(this,zn)[zn].set(e.getName(),e)}}const i=t.filter((e=>{if(s.includes(e)){return false}if(F.Type.isFunction(e)&&s.includes(e.getName())){return false}return!s.includes(babelHelpers.classPrivateFieldLooseBase(this,zn)[zn].get(e))}));i.map((e=>F.Type.isFunction(e)?e:babelHelpers.classPrivateFieldLooseBase(this,zn)[zn].get(e))).forEach((e=>{if(F.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,Wn)[Wn].set(e.getName(),e)}}))}init(e){const t=[];for(const[,s]of babelHelpers.classPrivateFieldLooseBase(this,Wn)[Wn]){const i=new s(e);if(!(i instanceof ie)){throw new TypeError("TextEditor: a plugin must be an instance of TextEditor.BasePlugin.")}babelHelpers.classPrivateFieldLooseBase(this,Yn)[Yn].set(s.getName(),i);t.push(i)}t.forEach((e=>{e.afterInit()}))}getConstructors(){return[...babelHelpers.classPrivateFieldLooseBase(this,Wn)[Wn].values()]}getPlugins(){return babelHelpers.classPrivateFieldLooseBase(this,Yn)[Yn]}[Un](){return babelHelpers.classPrivateFieldLooseBase(this,Yn)[Yn][Symbol.iterator]()}get(e){const t=F.Type.isFunction(e)?e.getName():e;return babelHelpers.classPrivateFieldLooseBase(this,Yn)[Yn].get(t)||null}has(e){const t=F.Type.isFunction(e)?e.getName():e;return babelHelpers.classPrivateFieldLooseBase(this,Yn)[Yn].has(t)}}var Gn=babelHelpers.classPrivateFieldLooseKey("components");var Vn=babelHelpers.classPrivateFieldLooseKey("normalizeName");class Jn{constructor(){Object.defineProperty(this,Gn,{writable:true,value:new Map})}register(e,t){babelHelpers.classPrivateFieldLooseBase(this,Gn)[Gn].set(babelHelpers.classPrivateFieldLooseBase(this.constructor,Vn)[Vn](e),{callback:t})}create(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Gn)[Gn].get(babelHelpers.classPrivateFieldLooseBase(this.constructor,Vn)[Vn](e));return t?t.callback():null}}function qn(e){return String(e).toLowerCase()}Object.defineProperty(Jn,Vn,{value:qn});var Qn=babelHelpers.classPrivateFieldLooseKey("editor");var Zn=babelHelpers.classPrivateFieldLooseKey("nodeTypeToBBCodeType");var ed=babelHelpers.classPrivateFieldLooseKey("nodeValidation");var td=babelHelpers.classPrivateFieldLooseKey("initNodeValidation");var sd=babelHelpers.classPrivateFieldLooseKey("handleNodeTransform");class id{constructor(e){Object.defineProperty(this,sd,{value:ad});Object.defineProperty(this,td,{value:rd});Object.defineProperty(this,Qn,{writable:true,value:null});Object.defineProperty(this,Zn,{writable:true,value:new Map});Object.defineProperty(this,ed,{writable:true,value:new Map});babelHelpers.classPrivateFieldLooseBase(this,Qn)[Qn]=e;babelHelpers.classPrivateFieldLooseBase(this,td)[td]()}isNodeAllowed(e,t){const s=F.Type.isString(e)?e:babelHelpers.classPrivateFieldLooseBase(this,Zn)[Zn].get(e.getType());const i=F.Type.isString(t)?t:babelHelpers.classPrivateFieldLooseBase(this,Zn)[Zn].get(t.getType());if(!s){console.warn(`TextEditor: parent node (${e.getType()}) doesn't have a bbcode tag.`)}if(!i){console.warn(`TextEditor: child node (${t.getType()}) doesn't have a bbcode tag.`)}return babelHelpers.classPrivateFieldLooseBase(this,Qn)[Qn].getBBCodeScheme().isChildAllowed(s,i)}findAllowedParent(e){let t=e.getParent();while(t!==null){if(this.isNodeAllowed(t,e)){return t}t=t.getParent()}return null}moveToNextParent(e,t=true){let s=e.getParent();let i=null;while(s.getParent()!==null){if(this.isNodeAllowed(s.getParent(),e)){i=s;break}s=s.getParent()}if(i===null){if(t){e.remove()}return false}if(L.$isRootNode(i.getParent())&&(L.$isTextNode(e)||L.$isElementNode(e)&&e.isInline())){i.insertBefore(L.$createParagraphNode().append(e));return true}i.insertBefore(e);return true}}function rd(){const e=babelHelpers.classPrivateFieldLooseBase(this,sd)[sd].bind(this);for(const[,t]of babelHelpers.classPrivateFieldLooseBase(this,Qn)[Qn].getPlugins()){const s=t.validateScheme();if(!F.Type.isPlainObject(s)){continue}if(F.Type.isArrayFilled(s.nodes)){s.nodes.forEach((t=>{babelHelpers.classPrivateFieldLooseBase(this,Qn)[Qn].registerNodeTransform(t.nodeClass,e);if(F.Type.isFunction(t.validate)){babelHelpers.classPrivateFieldLooseBase(this,ed)[ed].set(t.nodeClass.getType(),{validate:t.validate})}}))}if(F.Type.isPlainObject(s.bbcodeMap)){for(const[e,t]of Object.entries(s.bbcodeMap)){babelHelpers.classPrivateFieldLooseBase(this,Zn)[Zn].set(e,t)}}}}function ad(e){const{validate:t=null}=babelHelpers.classPrivateFieldLooseBase(this,ed)[ed].get(e.getType())||{};if(t!==null&&t(e,this)===true){return}const s=e.getParent();if(this.isNodeAllowed(s,e)){return}console.warn(`TextEditor: ${e.getType()} is not allowed in ${s.getType()}`);this.moveToNextParent(e)}class od extends ie{constructor(e){super(e);this.cleanUpRegister(c.registerRichText(e.getLexicalEditor()))}static getName(){return"RichText"}}class ld extends L.ElementNode{static getType(){return"plain-table-node"}static clone(e){throw new Error("Not implemented")}static importJSON(e){throw new Error("Not implemented")}exportJSON(){throw new Error("Not implemented")}static importDOM(){return{table:()=>({conversion:nd,priority:0}),tr:()=>({conversion:()=>({node:null}),priority:0}),td:()=>({conversion:()=>({node:null}),priority:0}),th:()=>({conversion:()=>({node:null}),priority:0})}}}function nd(e){const t=[];const s=[...e.rows];for(const e of s){if(t.length>0){t.push(L.$createLineBreakNode())}const s=[];for(const t of e.cells){if(s.length>0){s.push(L.$createTextNode(" "))}s.push(L.$createTextNode(t.textContent.trim()))}t.push(...s)}return{node:t}}class dd extends ie{static getName(){return"Clipboard"}static getNodes(e){const t=[];const s=e.getPlugins().getConstructors().some((e=>e.getName()==="Table"));if(!s){t.push(ld)}return t}}var cd=babelHelpers.classPrivateFieldLooseKey("registerComponents");class hd extends ie{constructor(e){super(e);Object.defineProperty(this,cd,{value:bd});babelHelpers.classPrivateFieldLooseBase(this,cd)[cd]()}static getName(){return"Bold"}importBBCode(){return{b:()=>({conversion:$,priority:0}),color:()=>({conversion:$,priority:0}),background:()=>({conversion:$,priority:0}),size:()=>({conversion:$,priority:0})}}exportBBCode(){return{"text:bold":(e,t)=>{if(e.hasFormat("bold")){return Z(t,"b",this.getEditor())}return null}}}}function bd(){this.getEditor().getComponentRegistry().register("bold",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --bold"></span>');e.setFormat("bold");e.disableInsideUnformatted();e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_BOLD",{"#keystroke#":F.Browser.isMac()?"\u2318B":"Ctrl+B"}));e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{this.getEditor().dispatchCommand(L.FORMAT_TEXT_COMMAND,"bold")}))}));return e}))}var ud=Object.freeze({BoldPlugin:hd});var pd=babelHelpers.classPrivateFieldLooseKey("registerComponents");class gd extends ie{constructor(e){super(e);Object.defineProperty(this,pd,{value:vd});babelHelpers.classPrivateFieldLooseBase(this,pd)[pd]()}static getName(){return"Italic"}importBBCode(){return{i:()=>({conversion:$,priority:0})}}exportBBCode(){return{"text:italic":(e,t)=>{if(e.hasFormat("italic")){return Z(t,"i",this.getEditor())}return null}}}}function vd(){this.getEditor().getComponentRegistry().register("italic",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --italic"></span>');e.setFormat("italic");e.disableInsideUnformatted();e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_ITALIC",{"#keystroke#":F.Browser.isMac()?"\u2318I":"Ctrl+I"}));e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{this.getEditor().dispatchCommand(L.FORMAT_TEXT_COMMAND,"italic")}))}));return e}))}var fd=Object.freeze({ItalicPlugin:gd});var Pd=babelHelpers.classPrivateFieldLooseKey("registerKeyModifierCommand");var md=babelHelpers.classPrivateFieldLooseKey("registerComponents");class Ld extends ie{constructor(e){super(e);Object.defineProperty(this,md,{value:Fd});Object.defineProperty(this,Pd,{value:yd});babelHelpers.classPrivateFieldLooseBase(this,md)[md]();babelHelpers.classPrivateFieldLooseBase(this,Pd)[Pd]()}static getName(){return"Strikethrough"}importBBCode(){return{s:()=>({conversion:$,priority:0}),del:()=>({conversion:$,priority:0})}}exportBBCode(){return{"text:strikethrough":(e,t)=>{if(e.hasFormat("strikethrough")){return Z(t,"s",this.getEditor())}return null}}}}function yd(){this.cleanUpRegister(this.getEditor().registerCommand(L.KEY_MODIFIER_COMMAND,(e=>{const t=e;const{code:s,ctrlKey:i,metaKey:r,shiftKey:a}=t;if(s==="KeyX"&&(i||r)&&a){t.preventDefault();this.getEditor().dispatchCommand(L.FORMAT_TEXT_COMMAND,"strikethrough");return true}return false}),L.COMMAND_PRIORITY_NORMAL))}function Fd(){this.getEditor().getComponentRegistry().register("strikethrough",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --strikethrough"></span>');e.setFormat("strikethrough");e.disableInsideUnformatted();e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_STRIKETHROUGH",{"#keystroke#":F.Browser.isMac()?"\u2318\u21e7X":"Ctrl+Shift+X"}));e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{this.getEditor().dispatchCommand(L.FORMAT_TEXT_COMMAND,"strikethrough")}))}));return e}))}var Hd=Object.freeze({StrikethroughPlugin:Ld});var Bd=babelHelpers.classPrivateFieldLooseKey("registerComponents");class Cd extends ie{constructor(e){super(e);Object.defineProperty(this,Bd,{value:Od});babelHelpers.classPrivateFieldLooseBase(this,Bd)[Bd]()}static getName(){return"Underline"}importBBCode(){return{u:()=>({conversion:$,priority:0})}}exportBBCode(){return{"text:underline":(e,t)=>{if(e.hasFormat("underline")){return Z(t,"u",this.getEditor())}return null}}}}function Od(){this.getEditor().getComponentRegistry().register("underline",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --underline"></span>');e.setFormat("underline");e.disableInsideUnformatted();e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_UNDERLINE",{"#keystroke#":F.Browser.isMac()?"\u2318U":"Ctrl+U"}));e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{this.getEditor().dispatchCommand(L.FORMAT_TEXT_COMMAND,"underline")}))}));return e}))}var Td=Object.freeze({UnderlinePlugin:Cd});const Ed=L.createCommand("CLEAR_FORMATTING_COMMAND");var Nd=babelHelpers.classPrivateFieldLooseKey("registerCommands");var _d=babelHelpers.classPrivateFieldLooseKey("registerComponents");class Md extends ie{constructor(e){super(e);Object.defineProperty(this,_d,{value:Sd});Object.defineProperty(this,Nd,{value:Dd});babelHelpers.classPrivateFieldLooseBase(this,Nd)[Nd]();babelHelpers.classPrivateFieldLooseBase(this,_d)[_d]()}static getName(){return"ClearFormat"}}function Dd(){this.cleanUpRegister(this.getEditor().registerCommand(Ed,(()=>{const e=L.$getSelection();if(!L.$isRangeSelection(e)&&!h.$isTableSelection(e)){return false}const t=e.anchor;const s=e.focus;const i=e.getNodes();const r=e.extract();if(t.key===s.key&&t.offset===s.offset){return false}i.forEach(((e,a)=>{if(L.$isTextNode(e)){let o=e;if(a===0&&t.offset!==0){o=o.splitText(t.offset)[1]||o}if(a===i.length-1){o=o.splitText(s.offset)[0]||o}const l=r[0];if(i.length===1&&L.$isTextNode(l)){o=l}if(o.__style!==""){o.setStyle("")}if(o.__format!==0){o.setFormat(0);y.$getNearestBlockElementAncestorOrThrow(o).setFormat("")}}}));return true}),L.COMMAND_PRIORITY_EDITOR))}function Sd(){this.getEditor().getComponentRegistry().register("clear-format",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --remove-formatting"></span>');e.disableInsideUnformatted();e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_CLEAR_FORMATTING"));e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{this.getEditor().dispatchCommand(Ed)}))}));return e}))}let Rd=e=>e,Id,xd,wd;var Ad=babelHelpers.classPrivateFieldLooseKey("popup");var $d=babelHelpers.classPrivateFieldLooseKey("editMode");var Kd=babelHelpers.classPrivateFieldLooseKey("autoLinkMode");var jd=babelHelpers.classPrivateFieldLooseKey("linkUrl");var kd=babelHelpers.classPrivateFieldLooseKey("targetContainer");var Ud=babelHelpers.classPrivateFieldLooseKey("refs");var Wd=babelHelpers.classPrivateFieldLooseKey("handleSaveBtnClick");var Yd=babelHelpers.classPrivateFieldLooseKey("handleLinkTextBoxKeyDown");var zd=babelHelpers.classPrivateFieldLooseKey("handleCancelBtnClick");var Xd=babelHelpers.classPrivateFieldLooseKey("handleEditBtnClick");var Gd=babelHelpers.classPrivateFieldLooseKey("handleUnlinkBtnClick");class Vd extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,Gd,{value:ec});Object.defineProperty(this,Xd,{value:Zd});Object.defineProperty(this,zd,{value:Qd});Object.defineProperty(this,Yd,{value:qd});Object.defineProperty(this,Wd,{value:Jd});Object.defineProperty(this,Ad,{writable:true,value:null});Object.defineProperty(this,$d,{writable:true,value:null});Object.defineProperty(this,Kd,{writable:true,value:null});Object.defineProperty(this,jd,{writable:true,value:""});Object.defineProperty(this,kd,{writable:true,value:null});Object.defineProperty(this,Ud,{writable:true,value:new g.MemoryCache});this.setEventNamespace("BX.UI.TextEditor.LinkEditor");const t=F.Type.isPlainObject(e)?e:{};this.setTargetContainer(t.targetContainer);this.setLinkUrl(t.linkUrl);if(F.Type.isBoolean(t.editMode)){this.setEditMode(t.editMode)}else{this.setEditMode(babelHelpers.classPrivateFieldLooseBase(this,jd)[jd]==="")}this.setAutoLinkMode(e.autoLinkMode);this.subscribeFromOptions(t.events)}show(e={}){var t;const s=(t=e.target)!=null?t:undefined;const i=F.Type.isPlainObject(e.targetOptions)?e.targetOptions:{};if(!F.Type.isUndefined(s)){this.getPopup().setBindElement(s)}this.getPopup().adjustPosition({...i,forceBindPosition:true});this.getPopup().show()}isShown(){return babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad].isShown()}hide(){this.getPopup().close()}destroy(){this.getPopup().destroy()}setAutoLinkMode(e=true){if(e===babelHelpers.classPrivateFieldLooseBase(this,Kd)[Kd]){return}if(e){F.Dom.addClass(this.getContainer(),"--auto-link-mode")}else{F.Dom.removeClass(this.getContainer(),"--auto-link-mode")}if(babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad]!==null){babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad].adjustPosition()}babelHelpers.classPrivateFieldLooseBase(this,Kd)[Kd]=e}setEditMode(e=true){if(e===babelHelpers.classPrivateFieldLooseBase(this,$d)[$d]){return}if(e){F.Dom.addClass(this.getContainer(),"--edit-mode")}else{F.Dom.removeClass(this.getContainer(),"--edit-mode")}if(babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad]!==null){babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad].adjustPosition()}babelHelpers.classPrivateFieldLooseBase(this,$d)[$d]=e}setLinkUrl(e){if(F.Type.isString(e)){babelHelpers.classPrivateFieldLooseBase(this,jd)[jd]=da(e);this.getLinkTextBox().value=babelHelpers.classPrivateFieldLooseBase(this,jd)[jd];this.getLinkLabel().textContent=babelHelpers.classPrivateFieldLooseBase(this,jd)[jd];this.getLinkLabel().href=babelHelpers.classPrivateFieldLooseBase(this,jd)[jd]}}getLinkUrl(){return babelHelpers.classPrivateFieldLooseBase(this,jd)[jd]}setTargetContainer(e){if(F.Type.isElementNode(e)){babelHelpers.classPrivateFieldLooseBase(this,kd)[kd]=e}}getTargetContainer(){return babelHelpers.classPrivateFieldLooseBase(this,kd)[kd]}getPopup(){if(babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad]===null){babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad]=new p.Popup({autoHide:true,cacheable:false,padding:0,closeByEsc:true,targetContainer:this.getTargetContainer(),content:this.getContainer(),events:{onClose:()=>{this.emit("onClose")},onDestroy:()=>{this.emit("onDestroy")},onShow:()=>{this.emit("onShow")},onAfterShow:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,$d)[$d]){this.getLinkTextBox().focus()}}}})}return babelHelpers.classPrivateFieldLooseBase(this,Ad)[Ad]}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Ud)[Ud].remember("container",(()=>F.Tag.render(Id||(Id=Rd`
				<div class="ui-text-editor-link-editor">
					<div class="ui-text-editor-link-form">
						<div class="ui-ctl ui-ctl-textbox ui-ctl-s ui-ctl-inline ui-ctl-w100 ui-text-editor-link-textbox">
							<div class="ui-ctl-tag">${0}</div>
							${0}
						</div>
						<button type="button" 
							class="ui-text-editor-link-form-button" 
							onclick="${0}"
							data-testid="save-link-btn"
						>
							<span class="ui-icon-set --check"></span>
						</button>
						<button 
							type="button" 
							class="ui-text-editor-link-form-button"
							onclick="${0}"
							data-testid="cancel-link-btn"
						>
							<span class="ui-icon-set --cross-60"></span>
						</button>
					</div>
					<div class="ui-text-editor-link-preview">
						${0}
						<button 
							type="button" 
							class="ui-text-editor-link-form-button"
							onclick="${0}"
							data-testid="edit-link-btn"
						>
							<span class="ui-icon-set --pencil-60"></span>
						</button>
						<button 
							type="button" 
							class="ui-text-editor-link-form-button ui-text-editor-link-form-delete-btn"
							onclick="${0}"
							data-testid="unlink-btn"
						>
							<span class="ui-icon-set --delete-hyperlink"></span>
						</button>
					</div>
				</div>
			`),F.Loc.getMessage("TEXT_EDITOR_LINK_URL"),this.getLinkTextBox(),babelHelpers.classPrivateFieldLooseBase(this,Wd)[Wd].bind(this),babelHelpers.classPrivateFieldLooseBase(this,zd)[zd].bind(this),this.getLinkLabel(),babelHelpers.classPrivateFieldLooseBase(this,Xd)[Xd].bind(this),babelHelpers.classPrivateFieldLooseBase(this,Gd)[Gd].bind(this))))}getLinkTextBox(){return babelHelpers.classPrivateFieldLooseBase(this,Ud)[Ud].remember("link-textbox",(()=>F.Tag.render(xd||(xd=Rd`
				<input 
					type="text"
					class="ui-ctl-element"
					placeholder="https://"
					value="${0}"
					onkeydown="${0}"
					data-testid="link-textbox-input"
				>
			`),this.getLinkUrl(),babelHelpers.classPrivateFieldLooseBase(this,Yd)[Yd].bind(this))))}getLinkLabel(){return babelHelpers.classPrivateFieldLooseBase(this,Ud)[Ud].remember("link-label",(()=>F.Tag.render(wd||(wd=Rd`
				<a href="" target="_blank" class="ui-text-editor-link-label"></a>
			`))))}}function Jd(){const e=this.getLinkTextBox().value.trim();if(e.length>0){this.setLinkUrl(e);this.emit("onSave")}else{this.getLinkTextBox().focus()}}function qd(e){if(e.key==="Enter"){e.preventDefault();babelHelpers.classPrivateFieldLooseBase(this,Wd)[Wd]()}}function Qd(){this.emit("onCancel")}function Zd(){this.setEditMode(true);this.getLinkTextBox().focus();this.getLinkTextBox().select()}function ec(){this.emit("onUnlink")}class tc extends P.LinkNode{constructor(e="",t={},s=null){super(e,t,s)}static getType(){return"custom-link"}static clone(e){return new tc(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}static importJSON(e){return super.importJSON(e)}exportJSON(){return{...super.exportJSON(),type:"custom-link",version:1}}createDOM(e){const t=super.createDOM(e);t.setAttribute("data-slider-ignore-autobinding","true");return t}}function sc(e="",t={}){return L.$applyNodeReplacement(new tc(e,t))}function ic(e,t=true){if(t){return/^(http:|https:|mailto:|tel:|sms:|\/)/i.test(e)}return/^(http:|https:|mailto:|tel:|sms:)/i.test(e)}const rc=/^((https?:\/\/(www\.)?)|(www\.))[\w#%+.:=@~-]{1,256}\.[\d()A-Za-z]{1,6}\b([\w#%&()+./:=?@[\]~-]*)(?<![%()+.:\]-])$/;const ac=L.createCommand("INSERT_LINK_DIALOG_COMMAND");var oc=babelHelpers.classPrivateFieldLooseKey("linkEditor");var lc=babelHelpers.classPrivateFieldLooseKey("onEditorScroll");var nc=babelHelpers.classPrivateFieldLooseKey("lastSelection");var dc=babelHelpers.classPrivateFieldLooseKey("registerListeners");var cc=babelHelpers.classPrivateFieldLooseKey("registerCommands");var hc=babelHelpers.classPrivateFieldLooseKey("registerToggleLinkCommand");var bc=babelHelpers.classPrivateFieldLooseKey("registerInsertLinkCommand");var uc=babelHelpers.classPrivateFieldLooseKey("restoreSelection");var pc=babelHelpers.classPrivateFieldLooseKey("handleDialogDestroy");var gc=babelHelpers.classPrivateFieldLooseKey("handleEditorScroll");var vc=babelHelpers.classPrivateFieldLooseKey("registerKeyModifierCommand");var fc=babelHelpers.classPrivateFieldLooseKey("registerPasteCommand");var Pc=babelHelpers.classPrivateFieldLooseKey("insertLink");var mc=babelHelpers.classPrivateFieldLooseKey("isLinkSelected");var Lc=babelHelpers.classPrivateFieldLooseKey("convertAutoLinkToLink");var yc=babelHelpers.classPrivateFieldLooseKey("registerComponents");class Fc extends ie{constructor(e){super(e);Object.defineProperty(this,yc,{value:Ic});Object.defineProperty(this,Lc,{value:Rc});Object.defineProperty(this,mc,{value:Sc});Object.defineProperty(this,Pc,{value:Dc});Object.defineProperty(this,fc,{value:Mc});Object.defineProperty(this,vc,{value:_c});Object.defineProperty(this,gc,{value:Nc});Object.defineProperty(this,pc,{value:Ec});Object.defineProperty(this,uc,{value:Tc});Object.defineProperty(this,bc,{value:Oc});Object.defineProperty(this,hc,{value:Cc});Object.defineProperty(this,cc,{value:Bc});Object.defineProperty(this,dc,{value:Hc});Object.defineProperty(this,oc,{writable:true,value:null});Object.defineProperty(this,lc,{writable:true,value:babelHelpers.classPrivateFieldLooseBase(this,gc)[gc].bind(this)});Object.defineProperty(this,nc,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,cc)[cc]();babelHelpers.classPrivateFieldLooseBase(this,dc)[dc]();babelHelpers.classPrivateFieldLooseBase(this,yc)[yc]()}static getName(){return"Link"}static getNodes(e){return[P.LinkNode,tc,{replace:P.LinkNode,with:e=>sc(e.__url,{rel:e.__rel,target:e.__target,title:e.__title}),withClass:tc}]}importBBCode(){return{url:()=>({conversion:e=>{let t=e.getValue();if(!ic(t)){t=e.toPlainText();if(!ic(t)){return{node:null}}}return{node:P.$createLinkNode(da(t),{target:"_blank"})}},priority:0})}}exportBBCode(){return{link:e=>xc(e,this.getEditor()),"custom-link":e=>xc(e,this.getEditor())}}validateScheme(){return{nodes:[{nodeClass:tc}],bbcodeMap:{link:"url","custom-link":"url"}}}destroy(){super.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,oc)[oc]!==null){babelHelpers.classPrivateFieldLooseBase(this,oc)[oc].destroy()}}}function Hc(){this.cleanUpRegister(this.getEditor().registerEventListener(P.LinkNode,"click",((e,t)=>{const s=L.$getNodeByKey(t);if(P.$isLinkNode(s)){this.getEditor().dispatchCommand(ac,s)}})))}function Bc(){this.cleanUpRegister(babelHelpers.classPrivateFieldLooseBase(this,hc)[hc](),babelHelpers.classPrivateFieldLooseBase(this,bc)[bc](),babelHelpers.classPrivateFieldLooseBase(this,vc)[vc](),babelHelpers.classPrivateFieldLooseBase(this,fc)[fc]())}function Cc(){return this.getEditor().registerCommand(P.TOGGLE_LINK_COMMAND,(e=>{if(e===null){P.$toggleLink(e);return true}const t=L.$getSelection();if(!L.$isRangeSelection(t)){return false}let s=null;let i=null;let r={};if(F.Type.isStringFilled(e)){s=e}else if(F.Type.isPlainObject(e)){const{target:t,rel:a,title:o}=e;r={rel:a,target:t,title:o};s=e.url;i=e.originalUrl||null}if(F.Type.isStringFilled(s)){if(!F.Type.isStringFilled(r.target)){r.target="_blank"}if(ic(s)){if(t.isCollapsed()&&!babelHelpers.classPrivateFieldLooseBase(this,mc)[mc](t)){babelHelpers.classPrivateFieldLooseBase(this,Pc)[Pc](t,s,r,i)}else{P.$toggleLink(s,r)}return true}return false}return false}),L.COMMAND_PRIORITY_LOW)}function Oc(){return y.mergeRegister(this.getEditor().registerCommand(ac,(e=>{const t=L.$getSelection();if(!L.$isRangeSelection(t)||!this.getEditor().isEditable()){return false}babelHelpers.classPrivateFieldLooseBase(this,nc)[nc]=t.clone();if(babelHelpers.classPrivateFieldLooseBase(this,oc)[oc]!==null){babelHelpers.classPrivateFieldLooseBase(this,oc)[oc].destroy()}let s=null;let i=null;if(P.$isLinkNode(e)){s=e;i=s.getURL()}else{const e=y.$findMatchingParent(t.anchor.getNode(),(e=>(e.__flags&E)!==0));if(e){return false}const r=w(t);const a=y.$findMatchingParent(r,P.$isLinkNode);if(a){s=a;i=s.getURL();s.select()}else if(P.$isLinkNode(r)){s=r;i=s.getURL();s.select()}}this.getEditor().dispatchCommand(H,{sender:"link-dialog"});babelHelpers.classPrivateFieldLooseBase(this,oc)[oc]=new Vd({linkUrl:i,autoLinkMode:P.$isAutoLinkNode(s),targetContainer:document.body,events:{onSave:e=>{const t=e.getTarget();let i=t.getLinkUrl();if(!F.Type.isStringFilled(i)){t.hide();return}const r=F.Validation.isEmail(i)?"mailto:":"https://";const a=i;if(!ic(i)){i=`${r}${i}`;t.setLinkUrl(i)}if(s===null){this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,uc)[uc]();this.getEditor().dispatchCommand(P.TOGGLE_LINK_COMMAND,{url:i,originalUrl:a,rel:null});t.setEditMode(false);const e=L.$getSelection();if(L.$isRangeSelection(e)){babelHelpers.classPrivateFieldLooseBase(this,nc)[nc]=e.clone()}if(!L.$isRangeSelection(e)||e.isCollapsed()){t.hide()}babelHelpers.classPrivateFieldLooseBase(this,Lc)[Lc](e)}))}else{this.getEditor().update((()=>{s.setURL(i);babelHelpers.classPrivateFieldLooseBase(this,Lc)[Lc](L.$getSelection());t.setAutoLinkMode(false)}));t.setEditMode(false)}this.getEditor().resetHighlightSelection()},onCancel:e=>{const t=e.getTarget();t.hide()},onUnlink:e=>{if(s===null){this.getEditor().dispatchCommand(P.TOGGLE_LINK_COMMAND,null)}else{this.getEditor().update((()=>{const e=s.getChildren();for(const t of e){s.insertBefore(t)}s.remove()}))}const t=e.getTarget();t.hide()},onShow:()=>{if(ra(babelHelpers.classPrivateFieldLooseBase(this,oc)[oc].getPopup(),this.getEditor())){F.Event.bind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,lc)[lc]);this.getEditor().highlightSelection()}},onClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,pc)[pc]()},onDestroy:()=>{babelHelpers.classPrivateFieldLooseBase(this,pc)[pc]()}}});babelHelpers.classPrivateFieldLooseBase(this,oc)[oc].show();return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(H,(e=>{if((e==null?void 0:e.sender)==="link-dialog"){return false}babelHelpers.classPrivateFieldLooseBase(this,nc)[nc]=null;if(babelHelpers.classPrivateFieldLooseBase(this,oc)[oc]!==null){babelHelpers.classPrivateFieldLooseBase(this,oc)[oc].destroy()}return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(B,(()=>babelHelpers.classPrivateFieldLooseBase(this,oc)[oc]!==null&&babelHelpers.classPrivateFieldLooseBase(this,oc)[oc].isShown()),L.COMMAND_PRIORITY_LOW))}function Tc(){oa(babelHelpers.classPrivateFieldLooseBase(this,nc)[nc]);babelHelpers.classPrivateFieldLooseBase(this,nc)[nc]=null}function Ec(){if(babelHelpers.classPrivateFieldLooseBase(this,oc)[oc]===null){return}babelHelpers.classPrivateFieldLooseBase(this,oc)[oc]=null;F.Event.unbind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,lc)[lc]);this.getEditor().resetHighlightSelection();this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,uc)[uc]()}))}function Nc(){this.getEditor().update((()=>{ra(babelHelpers.classPrivateFieldLooseBase(this,oc)[oc].getPopup(),this.getEditor())}))}function _c(){return this.getEditor().registerCommand(L.KEY_MODIFIER_COMMAND,(e=>{const t=e;const{code:s,ctrlKey:i,metaKey:r}=t;if(s==="KeyK"&&(i||r)){t.preventDefault();this.getEditor().dispatchCommand(ac);return true}return false}),L.COMMAND_PRIORITY_NORMAL)}function Mc(){return this.getEditor().registerCommand(L.PASTE_COMMAND,(e=>{const t=L.$getSelection();if(!L.$isRangeSelection(t)||!(e instanceof ClipboardEvent)||e.clipboardData===null){return false}const s=e.clipboardData.getData("text");if(!rc.test(s)){return false}const i=s.startsWith("http")?s:`https://${s}`;if(t.isCollapsed()){const t=this.getEditor().dispatchCommand(P.TOGGLE_LINK_COMMAND,{url:i});if(t){e.preventDefault();return true}}else if(!t.getNodes().some((e=>L.$isElementNode(e)))){P.$toggleLink(i);e.preventDefault();return true}return false}),L.COMMAND_PRIORITY_NORMAL)}function Dc(e,t,s,i){const r=da(t);const a=P.$createLinkNode(r,s);a.append(L.$createTextNode(F.Type.isStringFilled(i)?i:r));const o=e.anchor;if(o.type==="text"&&o.getNode().isSimpleText()){const e=o.getNode();const t=o.offset;const s=e.splitText(t);if(t===0){s[0].insertBefore(a);a.select()}else{s[0].insertAfter(a);a.select()}}else{L.$insertNodes([a]);if(L.$isRootOrShadowRoot(a.getParentOrThrow())){y.$wrapNodeInElement(a,L.$createParagraphNode).selectEnd()}}}function Sc(e){const t=w(e);const s=t.getParent();return P.$isLinkNode(s)||P.$isLinkNode(t)}function Rc(e){if(L.$isRangeSelection(e)){const t=w(e).getParent();if(P.$isAutoLinkNode(t)){const e=P.$createLinkNode(t.getURL(),{rel:t.getRel(),target:F.Type.isStringFilled(t.getTarget())?t.getTarget():"_blank",title:t.getTitle()});t.replace(e,true);return true}}return false}function Ic(){this.getEditor().getComponentRegistry().register("link",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --link-3"></span>');e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_LINK"));e.setBlockType("link");e.disableInsideUnformatted();e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_LINK",{"#keystroke#":F.Browser.isMac()?"\u2318K":"Ctrl+K"}));e.subscribe("onClick",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,oc)[oc]!==null&&babelHelpers.classPrivateFieldLooseBase(this,oc)[oc].isShown()){return}this.getEditor().focus((()=>{this.getEditor().dispatchCommand(ac)}))}));return e}))}function xc(e,t){const s=e.getURL();const i=e.getChildren();const r=i.length===1&&L.$isTextNode(i[0])&&i[0].getFormat()===0;const a=t.getBBCodeScheme();if(r&&i[0].getTextContent()===s){return{node:a.createElement({name:"url"})}}return{node:a.createElement({name:"url",value:s})}}var wc=Object.freeze({INSERT_LINK_DIALOG_COMMAND:ac,LinkPlugin:Fc,exportLinkNode:xc});class Ac extends P.AutoLinkNode{constructor(e="",t={},s=null){super(e,t,s)}static getType(){return"custom-autolink"}static clone(e){return new Ac(e.__url,{isUnlinked:e.__isUnlinked,rel:e.__rel,target:e.__target,title:e.__title},e.__key)}static importJSON(e){return super.importJSON(e)}exportJSON(){return{...super.exportJSON(),type:"custom-autolink",version:1}}createDOM(e){const t=super.createDOM(e);t.setAttribute("data-slider-ignore-autobinding","true");return t}}function $c(e="",t={}){return L.$applyNodeReplacement(new Ac(e,t))}const Kc=/((https?:\/\/(www\.)?)|(www\.))[\w#%+.:=@~-]{1,256}\.[\d()A-Za-z]{1,6}\b([\w#%&()+./:=?@[\]~-]*)(?<![%()+.:\]-])/;const jc=/(([^\s"(),.:;<>@[\\\]]+(\.[^\s"(),.:;<>@[\\\]]+)*)|(".+"))@((\[(?:\d{1,3}\.){3}\d{1,3}])|(([\dA-Za-z-]+\.)+[A-Za-z]{2,}))/;const kc=[zc(Kc,(e=>e.startsWith("http")?e:`https://${e}`)),zc(jc,(e=>`mailto:${e}`))];var Uc=babelHelpers.classPrivateFieldLooseKey("registerListeners");class Wc extends ie{constructor(e){super(e);Object.defineProperty(this,Uc,{value:Yc});babelHelpers.classPrivateFieldLooseBase(this,Uc)[Uc]()}static getName(){return"AutoLink"}static getNodes(e){return[P.AutoLinkNode,Ac,{replace:P.AutoLinkNode,with:e=>$c(e.__url,{isUnlinked:e.__isUnlinked,rel:e.__rel,target:e.__target,title:e.__title}),withClass:Ac}]}exportBBCode(){return{autolink:e=>xc(e,this.getEditor()),"custom-autolink":e=>xc(e,this.getEditor())}}validateScheme(){return{nodes:[{nodeClass:Ac}],bbcodeMap:{autolink:"url","custom-autolink":"url"}}}}function Yc(){const e=(e,t)=>{};this.cleanUpRegister(this.getEditor().registerNodeTransform(L.TextNode,(t=>{const s=t.getParentOrThrow();const i=t.getPreviousSibling();if(P.$isAutoLinkNode(s)){ih(s,kc,e)}else if(!P.$isLinkNode(s)){if(t.isSimpleText()&&(qc(t.getTextContent())||!P.$isAutoLinkNode(i))){const s=y.$findMatchingParent(t,(e=>(e.__flags&E)!==0));if(!s){sh(t,kc,e)}}rh(t,kc,e)}})))}function zc(e,t=e=>e){return s=>{const i=e.exec(s);if(i===null){return null}return{index:i.index,length:i[0].length,text:i[0],url:t(s)}}}function Xc(e,t){for(const s of t){const t=s(e);if(t){return t}}return null}const Gc=/[\s(),.;[\]]/;function Vc(e){return Gc.test(e)}function Jc(e){return Vc(e[e.length-1])}function qc(e){return Vc(e[0])}function Qc(e){return/^\.[\dA-Za-z]+/.test(e)}function Zc(e){let t=e.getPreviousSibling();if(L.$isElementNode(t)){t=t.getLastDescendant()}return t===null||L.$isLineBreakNode(t)||L.$isTextNode(t)&&Jc(t.getTextContent())}function eh(e){let t=e.getNextSibling();if(L.$isElementNode(t)){t=t.getFirstDescendant()}return t===null||L.$isLineBreakNode(t)||L.$isTextNode(t)&&qc(t.getTextContent())}function th(e,t,s,i){const r=e>0?Vc(s[e-1]):Zc(i);if(!r){return false}return t<s.length?Vc(s[t]):eh(i)}function sh(e,t,s){const i=e.getTextContent();let r=i;let a=0;let o=e;let l=Xc(r,t);while(l!==null){const n=l.index;const d=l.length;const c=n+d;const h=th(a+n,a+c,i,e);if(h){let e=null;if(a+n===0){[e,o]=o.splitText(a+d)}else{[,e,o]=o.splitText(a+n,a+n+d)}const t=F.Type.isPlainObject(l.attributes)?{...l.attributes}:{};if(!F.Type.isStringFilled(t.target)){t.target="_blank"}const i=P.$createAutoLinkNode(l.url,t);const r=L.$createTextNode(l.text);r.setFormat(e.getFormat());r.setDetail(e.getDetail());i.append(r);e.replace(i);s(l.url,null);a=0}else{a+=c}r=r.slice(Math.max(0,c));l=Xc(r,t)}}function ih(e,t,s){const i=e.getChildren();const r=i.length;for(let t=0;t<r;t++){const r=i[t];if(!L.$isTextNode(r)||!r.isSimpleText()){ah(e);s(null,e.getURL());return}}const a=e.getTextContent();const o=Xc(a,t);if(o===null||o.text!==a){ah(e);s(null,e.getURL());return}if(!Zc(e)||!eh(e)){ah(e);s(null,e.getURL());return}const l=e.getURL();if(l!==o.url){e.setURL(o.url);s(o.url,l)}if(o.attributes){const t=e.getRel();if(t!==o.attributes.rel){e.setRel(o.attributes.rel||null);s(o.attributes.rel||null,t)}const i=e.getTarget();if(i!==o.attributes.target){e.setTarget(o.attributes.target||null);s(o.attributes.target||null,i)}}}function rh(e,t,s){const i=e.getPreviousSibling();const r=e.getNextSibling();const a=e.getTextContent();if(P.$isAutoLinkNode(i)&&(!qc(a)||Qc(a))){i.append(e);ih(i,t,s);s(null,i.getURL())}if(P.$isAutoLinkNode(r)&&!Jc(a)){ah(r);ih(r,t,s);s(null,r.getURL())}}function ah(e){const t=e.getChildren();const s=t.length;for(let i=s-1;i>=0;i--){e.insertAfter(t[i])}e.remove();return t.map((e=>e.getLatest()))}var oh=Object.freeze({AutoLinkPlugin:Wc});var lh=babelHelpers.classPrivateFieldLooseKey("registerListeners");class nh extends ie{constructor(e){super(e);Object.defineProperty(this,lh,{value:dh});babelHelpers.classPrivateFieldLooseBase(this,lh)[lh]()}static getName(){return"TabIndent"}}function dh(){this.cleanUpRegister(this.getEditor().registerCommand(L.KEY_TAB_COMMAND,(e=>{const t=L.$getSelection();if(!L.$isRangeSelection(t)){return false}return this.getEditor().dispatchCommand(e.shiftKey?L.OUTDENT_CONTENT_COMMAND:L.INDENT_CONTENT_COMMAND,{event:e,triggerByTab:true})}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(L.INDENT_CONTENT_COMMAND,(e=>{const t=L.$getSelection();if(ch(t)){e==null?void 0:e.event.preventDefault();return false}return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.OUTDENT_CONTENT_COMMAND,(e=>{const t=L.$getSelection();if(ch(t)){e==null?void 0:e.event.preventDefault();return false}return true}),L.COMMAND_PRIORITY_LOW))}function ch(e){if(!L.$isRangeSelection(e)){return false}const t=e.isBackward();const s=t?e.focus:e.anchor;const i=s.getNode();if(f.$isListItemNode(i)){return true}const r=y.$findMatchingParent(i,(e=>L.$isElementNode(e)&&!e.isInline()));return f.$isListItemNode(r)}var hh=Object.freeze({TabIndentPlugin:nh});var bh=babelHelpers.classPrivateFieldLooseKey("maxIndent");var uh=babelHelpers.classPrivateFieldLooseKey("registerListeners");var ph=babelHelpers.classPrivateFieldLooseKey("registerComponents");var gh=babelHelpers.classPrivateFieldLooseKey("getTotalListDepth");var vh=babelHelpers.classPrivateFieldLooseKey("getElementNodesInSelection");class fh extends ie{constructor(e){super(e);Object.defineProperty(this,vh,{value:yh});Object.defineProperty(this,gh,{value:Lh});Object.defineProperty(this,ph,{value:mh});Object.defineProperty(this,uh,{value:Ph});Object.defineProperty(this,bh,{writable:true,value:5});babelHelpers.classPrivateFieldLooseBase(this,bh)[bh]=e.getOption("list.maxIndent",babelHelpers.classPrivateFieldLooseBase(this,bh)[bh]);babelHelpers.classPrivateFieldLooseBase(this,uh)[uh]();babelHelpers.classPrivateFieldLooseBase(this,ph)[ph]()}static getName(){return"List"}static getNodes(e){return[f.ListNode,f.ListItemNode]}importBBCode(){return{list:()=>({conversion:e=>({node:e.getValue()==="1"?f.$createListNode("number",1):f.$createListNode("bullet")}),priority:0}),"*":()=>({conversion:e=>({node:f.$createListItemNode()}),priority:0})}}exportBBCode(){return{list:e=>{const t=this.getEditor().getBBCodeScheme();const s=t.createElement({name:"list"});if(e.getListType()==="number"){s.setValue("1")}return{node:s}},listitem:e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createElement({name:"*"})}}}}validateScheme(){return{nodes:[{nodeClass:f.ListNode}],bbcodeMap:{list:"list",listitem:"*"}}}}function Ph(){this.cleanUpRegister(this.getEditor().registerCommand(f.INSERT_ORDERED_LIST_COMMAND,(()=>{f.insertList(this.getLexicalEditor(),"number");return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(f.INSERT_UNORDERED_LIST_COMMAND,(()=>{f.insertList(this.getLexicalEditor(),"bullet");return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(f.REMOVE_LIST_COMMAND,(()=>{f.removeList(this.getLexicalEditor());return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.INSERT_PARAGRAPH_COMMAND,(()=>f.$handleListInsertParagraph()),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.INDENT_CONTENT_COMMAND,(e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,gh)[gh]();if(t>0){e==null?void 0:e.event.preventDefault();return t>babelHelpers.classPrivateFieldLooseBase(this,bh)[bh]}return false}),L.COMMAND_PRIORITY_CRITICAL))}function mh(){this.getEditor().getComponentRegistry().register("bulleted-list",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --bulleted-list"></span>');e.setBlockType("bullet");e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_BULLETED_LIST"));e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{if(e.isActive()){this.getEditor().dispatchCommand(f.REMOVE_LIST_COMMAND)}else{this.getEditor().dispatchCommand(f.INSERT_UNORDERED_LIST_COMMAND)}}))}));return e}));this.getEditor().getComponentRegistry().register("numbered-list",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --numbered-list"></span>');e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_NUMBERED_LIST"));e.setBlockType("number");e.subscribe("onClick",(()=>{this.getEditor().focus();this.getEditor().update((()=>{if(e.isActive()){this.getEditor().dispatchCommand(f.REMOVE_LIST_COMMAND)}else{this.getEditor().dispatchCommand(f.INSERT_ORDERED_LIST_COMMAND)}}))}));return e}))}function Lh(){const e=L.$getSelection();if(!L.$isRangeSelection(e)){return 0}const t=babelHelpers.classPrivateFieldLooseBase(this,vh)[vh](e);let s=0;for(const e of t){if(f.$isListNode(e)){s=Math.max(f.$getListDepth(e)+1,s)}else if(f.$isListItemNode(e)){const t=e.getParent();if(!f.$isListNode(t)){throw new Error("TextEditor: A ListItemNode must have a ListNode for a parent.")}s=Math.max(f.$getListDepth(t)+1,s)}}return s}function yh(e){const t=e.getNodes();const s=e=>L.$isElementNode(e)&&!e.isInline();if(t.length===0){return new Set([y.$findMatchingParent(e.anchor.getNode(),s),y.$findMatchingParent(e.focus.getNode(),s)])}return new Set(t.map((e=>L.$isElementNode(e)?e:y.$findMatchingParent(e,s))))}var Fh=Object.freeze({ListPlugin:fh});let Hh=e=>e,Bh,Ch,Oh,Th;var Eh=babelHelpers.classPrivateFieldLooseKey("popup");var Nh=babelHelpers.classPrivateFieldLooseKey("targetNode");var _h=babelHelpers.classPrivateFieldLooseKey("refs");var Mh=babelHelpers.classPrivateFieldLooseKey("lastSelectedBox");var Dh=babelHelpers.classPrivateFieldLooseKey("handleMouseMove");var Sh=babelHelpers.classPrivateFieldLooseKey("handleClick");var Rh=babelHelpers.classPrivateFieldLooseKey("highlightBoxes");class Ih extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,Rh,{value:Ah});Object.defineProperty(this,Sh,{value:wh});Object.defineProperty(this,Dh,{value:xh});Object.defineProperty(this,Eh,{writable:true,value:null});Object.defineProperty(this,Nh,{writable:true,value:null});Object.defineProperty(this,_h,{writable:true,value:new g.MemoryCache});Object.defineProperty(this,Mh,{writable:true,value:null});this.setEventNamespace("BX.UI.TextEditor.TableDialog");const t=F.Type.isPlainObject(e)?e:{};this.setTargetNode(t.targetNode);this.subscribeFromOptions(t.events)}show(){this.getPopup().adjustPosition({forceBindPosition:true});this.getPopup().show()}hide(){this.getPopup().close()}isShown(){return babelHelpers.classPrivateFieldLooseBase(this,Eh)[Eh]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Eh)[Eh].isShown()}destroy(){this.getPopup().destroy()}setTargetNode(e){if(F.Type.isElementNode(e)){babelHelpers.classPrivateFieldLooseBase(this,Nh)[Nh]=e}}getTargetNode(){return babelHelpers.classPrivateFieldLooseBase(this,Nh)[Nh]}getPopup(){if(babelHelpers.classPrivateFieldLooseBase(this,Eh)[Eh]===null){const e=this.getTargetNode();const t=e.getBoundingClientRect();const s=t.width;babelHelpers.classPrivateFieldLooseBase(this,Eh)[Eh]=new p.Popup({autoHide:true,closeByEsc:true,padding:0,content:F.Tag.render(Bh||(Bh=Hh`
					<div class="ui-text-editor-table-dialog" onclick="${0}">
						${0}
						${0}
					</div>
				`),babelHelpers.classPrivateFieldLooseBase(this,Sh)[Sh].bind(this),this.getGridContainer(),this.getCaptionContainer()),bindElement:this.getTargetNode(),events:{onClose:()=>{this.emit("onClose")},onDestroy:()=>{this.emit("onDestroy")},onShow:e=>{const t=e.getTarget();const i=t.getPopupContainer().offsetWidth;const r=s/2-i/2;const a=p.Popup.getOption("angleLeftOffset")-p.Popup.getOption("angleMinTop");t.setAngle({offset:i/2-a});t.setOffset({offsetLeft:r+p.Popup.getOption("angleLeftOffset")});babelHelpers.classPrivateFieldLooseBase(this,Mh)[Mh]=null;babelHelpers.classPrivateFieldLooseBase(this,Rh)[Rh](1,1)}}})}return babelHelpers.classPrivateFieldLooseBase(this,Eh)[Eh]}getGridContainer(){return babelHelpers.classPrivateFieldLooseBase(this,_h)[_h].remember("grid",(()=>{const e=[];for(let t=0;t<100;t++){const s=Math.floor(t/10);const i=t%10;e.push(F.Tag.render(Ch||(Ch=Hh`
					<button
						class="ui-text-editor-table-dialog-box"
						data-column="${0}"
						data-row="${0}"
					></button>
				`),i+1,s+1))}return F.Tag.render(Oh||(Oh=Hh`
				<div 
					class="ui-text-editor-table-dialog-grid" 
					onmousemove="${0}"
				>${0}</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,Dh)[Dh].bind(this),e)}))}getCaptionContainer(){return babelHelpers.classPrivateFieldLooseBase(this,_h)[_h].remember("caption",(()=>F.Tag.render(Th||(Th=Hh`<div class="ui-text-editor-table-dialog-caption"></div>`))))}}function xh(e){if(babelHelpers.classPrivateFieldLooseBase(this,Mh)[Mh]!==e.target&&F.Dom.hasClass(e.target,"ui-text-editor-table-dialog-box")){const{row:t,column:s}=e.target.dataset;babelHelpers.classPrivateFieldLooseBase(this,Rh)[Rh](t,s);babelHelpers.classPrivateFieldLooseBase(this,Mh)[Mh]=e.target}}function wh(e){if(babelHelpers.classPrivateFieldLooseBase(this,Mh)[Mh]){const{row:e,column:t}=babelHelpers.classPrivateFieldLooseBase(this,Mh)[Mh].dataset;this.emit("onSelect",{rows:e,columns:t})}}function Ah(e,t){let s=0;for(const i of this.getGridContainer().children){const r=Math.floor(s/10);const a=s%10;const o=r<e&&a<t;if(o){F.Dom.addClass(i,"--selected")}else{F.Dom.removeClass(i,"--selected")}s++}this.getCaptionContainer().textContent=e&&t?`${e} x ${t}`:""}const $h=L.createCommand("INSERT_TABLE_DIALOG_COMMAND");var Kh=babelHelpers.classPrivateFieldLooseKey("tableDialog");var jh=babelHelpers.classPrivateFieldLooseKey("registerComponents");var kh=babelHelpers.classPrivateFieldLooseKey("registerCommands");var Uh=babelHelpers.classPrivateFieldLooseKey("registerListeners");class Wh extends ie{constructor(e){super(e);Object.defineProperty(this,Uh,{value:Xh});Object.defineProperty(this,kh,{value:zh});Object.defineProperty(this,jh,{value:Yh});Object.defineProperty(this,Kh,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,kh)[kh]();babelHelpers.classPrivateFieldLooseBase(this,Uh)[Uh]();babelHelpers.classPrivateFieldLooseBase(this,jh)[jh]()}static getName(){return"Table"}static getNodes(e){return[h.TableNode,h.TableCellNode,h.TableRowNode]}importBBCode(){return{table:()=>({conversion:e=>({node:h.$createTableNode()}),priority:0}),tr:()=>({conversion:e=>({node:h.$createTableRowNode()}),priority:0}),td:()=>({conversion:e=>({node:h.$createTableCellNode(),after:e=>U(e)}),priority:0}),th:()=>({conversion:e=>({node:h.$createTableCellNode(h.TableCellHeaderStates.ROW),after:e=>U(e)}),priority:0})}}exportBBCode(){return{table:()=>{const e=this.getEditor().getBBCodeScheme();return{node:e.createElement({name:"table"})}},tablerow:()=>{const e=this.getEditor().getBBCodeScheme();return{node:e.createElement({name:"tr"})}},tablecell:e=>{const t=this.getEditor().getBBCodeScheme();return{node:t.createElement({name:e.hasHeader()?"th":"td"})}}}}validateScheme(){return{nodes:[{nodeClass:h.TableNode,validate:e=>{if(e.getChildrenSize()===0){e.remove();return true}return false}},{nodeClass:h.TableCellNode,validate:e=>{e.getChildren().forEach((e=>{if(k(e)){const t=L.$createParagraphNode();e.replace(t);t.append(e)}}));return false}}],bbcodeMap:{table:"table",tablerow:"tr",tablecell:"td"}}}destroy(){super.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh]!==null){babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh].destroy()}}}function Yh(){this.getEditor().getComponentRegistry().register("table",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --table-editor"></span>');e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_TABLE"));e.subscribe("onClick",(()=>{this.getEditor().dispatchCommand($h,{targetNode:e.getContainer()})}));return e}))}function zh(){this.cleanUpRegister(this.getEditor().registerCommand(h.INSERT_TABLE_COMMAND,(({columns:e,rows:t})=>{const s=Math.max(1,F.Text.toNumber(t));const i=Math.max(1,F.Text.toNumber(e));const r=h.$createTableNodeWithDimensions(s,i,false);y.$insertNodeToNearestRoot(r);const a=r.getFirstDescendant();if(L.$isTextNode(a)){a.select()}return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand($h,(e=>{if(!F.Type.isPlainObject(e)||!F.Type.isElementNode(e.targetNode)){return false}if(babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh]!==null){if(babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh].getTargetNode()===e.targetNode){babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh].show();return true}babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh].destroy()}babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh]=new Ih({targetNode:e.targetNode,events:{onSelect:e=>{this.getEditor().dispatchCommand(h.INSERT_TABLE_COMMAND,e.getData());babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh].hide()},onDestroy:()=>{babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh]=null}}});babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh].show();return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(H,(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh]!==null){babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh].hide()}return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(B,(()=>babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Kh)[Kh].isShown()),L.COMMAND_PRIORITY_LOW))}function Xh(){const e=new Map;const t=t=>{const s=t.getKey();const i=this.getEditor().getElementByKey(s);if(i&&!e.has(s)){const r=h.applyTableHandlers(t,i,this.getLexicalEditor(),true);e.set(s,r)}};this.cleanUpRegister(this.getEditor().registerMutationListener(h.TableNode,(s=>{for(const[i,r]of s){if(r==="created"){this.getEditor().getEditorState().read((()=>{const e=L.$getNodeByKey(i);if(h.$isTableNode(e)){t(e)}}))}else if(r==="destroyed"){const t=e.get(i);if(t!==undefined){t.removeListeners();e.delete(i)}}}})))}var Gh=Object.freeze({INSERT_TABLE_DIALOG_COMMAND:$h,TablePlugin:Wh});class Vh extends L.TextNode{static getType(){return"hashtag"}static clone(e){return new Vh(e.__text,e.__key)}constructor(e,t){super(e,t)}createDOM(e){var t;const s=super.createDOM(e);if(F.Type.isStringFilled(e==null?void 0:(t=e.theme)==null?void 0:t.hashtag)){F.Dom.addClass(s,e.theme.hashtag)}return s}static importJSON(e){const t=Jh(e.text);t.setFormat(e.format);t.setDetail(e.detail);t.setMode(e.mode);t.setStyle(e.style);return t}exportJSON(){return{...super.exportJSON(),type:"hashtag"}}canInsertTextBefore(){return false}isTextEntity(){return true}}function Jh(e=""){return L.$applyNodeReplacement(new Vh(e))}function qh(e){return e instanceof Vh}var Qh=babelHelpers.classPrivateFieldLooseKey("registerListeners");class Zh extends ie{constructor(e){super(e);Object.defineProperty(this,Qh,{value:eb});babelHelpers.classPrivateFieldLooseBase(this,Qh)[Qh]()}static getName(){return"Hashtag"}static getNodes(e){return[Vh]}importBBCode(){return null}exportBBCode(){return{hashtag:(e,t)=>{const s=this.getEditor().getBBCodeScheme();return{node:s.createText(e.getTextContent())}}}}validateScheme(){return{bbcodeMap:{hashtag:"#text"}}}}function eb(){const e=e=>Jh(e.getTextContent());const t=e=>{const t=/(?<=\s+|^)#([^\s,.<>[\]]+)/is.exec(e);if(t===null){return null}const s=t[0].length;const i=t.index;const r=i+s;return{end:r,start:i}};this.cleanUpRegister(...m.registerLexicalTextEntity(this.getLexicalEditor(),t,Vh,e))}var tb=Object.freeze({HashtagNode:Vh,$createHashtagNode:Jh,$isHashtagNode:qh,HashtagPlugin:Zh});function sb(e){if(!F.Type.isStringFilled(e)){return[]}const t=[];const s=e.split(/(\r?\n|\t)/);const i=s.length;for(let e=0;e<i;e++){const i=s[e];if(i==="\n"||i==="\r\n"){t.push(L.$createLineBreakNode())}else if(i==="\t"){t.push(L.$createTabNode())}else{t.push(L.$createTextNode(i))}}return t}let ib=e=>e,rb;const ab=L.createCommand("INSERT_COPILOT_DIALOG_COMMAND");const ob={INIT:"init",LOADING:"loading",LOADED:"loaded"};var lb=babelHelpers.classPrivateFieldLooseKey("copilot");var nb=babelHelpers.classPrivateFieldLooseKey("copilotStatus");var db=babelHelpers.classPrivateFieldLooseKey("copilotOptions");var cb=babelHelpers.classPrivateFieldLooseKey("targetParagraph");var hb=babelHelpers.classPrivateFieldLooseKey("lastSelection");var bb=babelHelpers.classPrivateFieldLooseKey("onEditorScroll");var ub=babelHelpers.classPrivateFieldLooseKey("triggerBySpace");var pb=babelHelpers.classPrivateFieldLooseKey("registerListeners");var gb=babelHelpers.classPrivateFieldLooseKey("registerParagraphNodeTransform");var vb=babelHelpers.classPrivateFieldLooseKey("registerComponents");var fb=babelHelpers.classPrivateFieldLooseKey("show");var Pb=babelHelpers.classPrivateFieldLooseKey("hide");var mb=babelHelpers.classPrivateFieldLooseKey("createCopilot");var Lb=babelHelpers.classPrivateFieldLooseKey("resetLoader");var yb=babelHelpers.classPrivateFieldLooseKey("adjustDialogPosition");var Fb=babelHelpers.classPrivateFieldLooseKey("handleEditorScroll");var Hb=babelHelpers.classPrivateFieldLooseKey("restoreSelection");var Bb=babelHelpers.classPrivateFieldLooseKey("handleCopilotSave");var Cb=babelHelpers.classPrivateFieldLooseKey("handleCopilotAddBelow");var Ob=babelHelpers.classPrivateFieldLooseKey("handleCopilotHide");class Tb extends ie{constructor(e){super(e);Object.defineProperty(this,Ob,{value:Kb});Object.defineProperty(this,Cb,{value:$b});Object.defineProperty(this,Bb,{value:Ab});Object.defineProperty(this,Hb,{value:wb});Object.defineProperty(this,Fb,{value:xb});Object.defineProperty(this,yb,{value:Ib});Object.defineProperty(this,Lb,{value:Rb});Object.defineProperty(this,mb,{value:Sb});Object.defineProperty(this,Pb,{value:Db});Object.defineProperty(this,fb,{value:Mb});Object.defineProperty(this,vb,{value:_b});Object.defineProperty(this,gb,{value:Nb});Object.defineProperty(this,pb,{value:Eb});Object.defineProperty(this,lb,{writable:true,value:null});Object.defineProperty(this,nb,{writable:true,value:ob.INIT});Object.defineProperty(this,db,{writable:true,value:null});Object.defineProperty(this,cb,{writable:true,value:null});Object.defineProperty(this,hb,{writable:true,value:null});Object.defineProperty(this,bb,{writable:true,value:babelHelpers.classPrivateFieldLooseBase(this,Fb)[Fb].bind(this)});Object.defineProperty(this,ub,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,db)[db]=e.getOption("copilot.copilotOptions");if(F.Type.isPlainObject(babelHelpers.classPrivateFieldLooseBase(this,db)[db])){babelHelpers.classPrivateFieldLooseBase(this,pb)[pb]();babelHelpers.classPrivateFieldLooseBase(this,vb)[vb]()}}static getName(){return"Copilot"}shouldTriggerBySpace(){return babelHelpers.classPrivateFieldLooseBase(this,ub)[ub]}isCopilotLoaded(){return babelHelpers.classPrivateFieldLooseBase(this,nb)[nb]===ob.LOADED}isCopilotLoading(){return babelHelpers.classPrivateFieldLooseBase(this,nb)[nb]===ob.LOADING}isCopilotShown(){return babelHelpers.classPrivateFieldLooseBase(this,lb)[lb]!==null&&babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].isShown()}show({onShow:e,onError:t}={}){if(this.isCopilotLoaded()){babelHelpers.classPrivateFieldLooseBase(this,fb)[fb]({onShow:e})}else if(!this.isCopilotLoading()){babelHelpers.classPrivateFieldLooseBase(this,mb)[mb]().then((()=>{babelHelpers.classPrivateFieldLooseBase(this,fb)[fb]({onShow:e})})).catch((()=>{if(F.Type.isFunction(t)){t()}}))}}destroy(){super.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,lb)[lb]!==null){babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].hide();babelHelpers.classPrivateFieldLooseBase(this,lb)[lb]=null}}}function Eb(){babelHelpers.classPrivateFieldLooseBase(this,ub)[ub]=this.getEditor().getOption("copilot.triggerBySpace",false);this.cleanUpRegister(this.getEditor().registerCommand(ab,(e=>{const t=F.Type.isPlainObject(e)?e:{};this.show(t);return true}),L.COMMAND_PRIORITY_EDITOR),this.getEditor().registerCommand(H,(e=>{if((e==null?void 0:e.sender)==="copilot"){return false}babelHelpers.classPrivateFieldLooseBase(this,hb)[hb]=null;babelHelpers.classPrivateFieldLooseBase(this,Pb)[Pb]();return false}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(B,(()=>this.isCopilotShown()),L.COMMAND_PRIORITY_LOW),babelHelpers.classPrivateFieldLooseBase(this,ub)[ub]?babelHelpers.classPrivateFieldLooseBase(this,gb)[gb]():()=>{})}function Nb(){return this.getEditor().registerNodeTransform(vt,(e=>{if(e.getChildrenSize()!==1||!L.$isRootNode(e.getParent())){return}if(!L.$isTextNode(e.getFirstChild())||e.getFirstChild().getTextContent()!==" "){babelHelpers.classPrivateFieldLooseBase(this,Lb)[Lb]();return}const t=L.$getSelection();if(!L.$isRangeSelection(t)||!t.isCollapsed()){return}const s=t.anchor.getNode();if(s!==e.getFirstChild()){return}if(!this.isCopilotLoaded()&&!this.isCopilotLoading()){babelHelpers.classPrivateFieldLooseBase(this,Lb)[Lb]();babelHelpers.classPrivateFieldLooseBase(this,cb)[cb]=this.getEditor().getElementByKey(e.getKey());if(babelHelpers.classPrivateFieldLooseBase(this,cb)[cb]){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,cb)[cb],"ui-text-editor-loading-ellipsis")}}e.getFirstChild().remove();e.select();this.show({onShow:()=>babelHelpers.classPrivateFieldLooseBase(this,Lb)[Lb](),onError:()=>babelHelpers.classPrivateFieldLooseBase(this,Lb)[Lb]()})}))}function _b(){this.getEditor().getComponentRegistry().register("copilot",(()=>{const e=new ge;const t="--copilot-ai";const s="--refresh-5 ui-text-editor-copilot-loading";const i=F.Tag.render(rb||(rb=ib`
				<span class="ui-icon-set ${0}" style="--ui-icon-set__icon-color: #8e52ec"></span>
			`),t);e.setContent(i);e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_COPILOT"));e.subscribe("onClick",(()=>{this.getEditor().focus();if(this.isCopilotLoading()){return}const e=()=>{if(!F.Dom.hasClass(i,t)){F.Dom.removeClass(i,s);F.Dom.addClass(i,t)}};this.getEditor().dispatchCommand(ab,{onShow:e,onError:e});if(!this.isCopilotLoaded()){setTimeout((()=>{if(!this.isCopilotLoaded()){F.Dom.removeClass(i,t);F.Dom.addClass(i,s)}}),500)}}));return e}))}function Mb({onShow:e}={}){this.getEditor().update((()=>{const t=L.$getSelection();if(!L.$isRangeSelection(t)||!this.getEditor().isEditable()){return}this.getEditor().dispatchCommand(H,{sender:"copilot"});const s=t.getTextContent();const i=F.Dom.getPosition(this.getEditor().getScrollerContainer());const r=Math.min(i.width,600);babelHelpers.classPrivateFieldLooseBase(this,hb)[hb]=t.clone();const a=s.trim();if(a.length>0){babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].setSelectedText(a)}else{const e=L.$getRoot().getTextContent().trim();if(e.length>0){babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].setContext(e)}}babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].show({width:r});babelHelpers.classPrivateFieldLooseBase(this,yb)[yb]();F.Event.bind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,bb)[bb]);if(!t.isCollapsed()){this.getEditor().highlightSelection()}if(F.Type.isFunction(e)){e()}}))}function Db(){if(this.isCopilotLoaded()&&babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].isShown()){babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].hide()}}function Sb(){if(this.isDestroyed()){return Promise.reject(new Error("Copilot plugin was destroyed."))}babelHelpers.classPrivateFieldLooseBase(this,nb)[nb]=ob.LOADING;return new Promise(((e,t)=>{F.Runtime.loadExtension("ai.copilot").then((({Copilot:s,CopilotEvents:i})=>{if(this.isDestroyed()){t(new Error("Copilot plugin was destroyed."));return}babelHelpers.classPrivateFieldLooseBase(this,lb)[lb]=new s({showResultInCopilot:true,...babelHelpers.classPrivateFieldLooseBase(this,db)[db],autoHide:true});babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].subscribe(i.FINISH_INIT,(()=>{if(this.isDestroyed()){t(new Error("Copilot plugin was destroyed."));return}babelHelpers.classPrivateFieldLooseBase(this,nb)[nb]=ob.LOADED;e()}));babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].subscribe(i.TEXT_SAVE,babelHelpers.classPrivateFieldLooseBase(this,Bb)[Bb].bind(this));babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].subscribe(i.TEXT_PLACE_BELOW,babelHelpers.classPrivateFieldLooseBase(this,Cb)[Cb].bind(this));babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].subscribe(i.HIDE,babelHelpers.classPrivateFieldLooseBase(this,Ob)[Ob].bind(this));babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].init()})).catch((()=>{t()}))}))}function Rb(){if(babelHelpers.classPrivateFieldLooseBase(this,cb)[cb]){F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,cb)[cb],"ui-text-editor-loading-ellipsis")}}function Ib(){this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,Hb)[Hb]();const e=L.$getSelection();const t=Zr(this.getEditor(),e,document.body);if(t===null){return}babelHelpers.classPrivateFieldLooseBase(this,hb)[hb]=e.clone();const{top:s,left:i,bottom:r}=t;const a=F.Dom.getPosition(this.getEditor().getScrollerContainer());const o=Math.min(a.width,600);const l=Qr(this.getEditor());let n=o/2;if(i-n<a.left){const e=a.left-(i-n);n-=e+l.left}else if(a.right<i+o-n){n+=i+o-n-a.right+l.right}if(r<a.top||s>a.bottom){babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].adjust({hide:true})}else{babelHelpers.classPrivateFieldLooseBase(this,lb)[lb].adjust({hide:false,position:{left:i-n,top:r}})}}))}function xb(){babelHelpers.classPrivateFieldLooseBase(this,yb)[yb]()}function wb(){const e=oa(babelHelpers.classPrivateFieldLooseBase(this,hb)[hb]);babelHelpers.classPrivateFieldLooseBase(this,hb)[hb]=null;return e}function Ab(e){const{result:t}=e.getData();this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,Hb)[Hb]();const e=L.$getSelection();if(L.$isRangeSelection(e)){e.insertRawText(t)}babelHelpers.classPrivateFieldLooseBase(this,Pb)[Pb]()}))}function $b(e){const{result:t}=e.getData();this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,Hb)[Hb]();const e=L.$getSelection();if(L.$isRangeSelection(e)){const s=e.focus;const i=s.getNode();if(!e.isCollapsed()){i.selectEnd()}const r=i.getParent();if(L.$isParagraphNode(r)){const e=L.$createParagraphNode();e.append(...sb(t));r.insertAfter(e)}else{e.insertLineBreak();e.insertRawText(t)}}babelHelpers.classPrivateFieldLooseBase(this,Pb)[Pb]()}))}function Kb(){F.Event.unbind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,bb)[bb]);this.getEditor().resetHighlightSelection();this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,Hb)[Hb]()}))}var jb=Object.freeze({INSERT_COPILOT_DIALOG_COMMAND:ab,CopilotPlugin:Tb});var kb=babelHelpers.classPrivateFieldLooseKey("registerComponents");class Ub extends ie{constructor(e){super(e);Object.defineProperty(this,kb,{value:Wb});const t=u.createEmptyHistoryState();this.cleanUpRegister(u.registerHistory(e.getLexicalEditor(),t,1e3));babelHelpers.classPrivateFieldLooseBase(this,kb)[kb]()}static getName(){return"History"}}function Wb(){let e=false;this.getEditor().getComponentRegistry().register("undo",(()=>{const t=new ge;t.setContent('<span class="ui-icon-set --undo"></span>');t.setDisabled(!e);t.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_UNDO",{"#keystroke#":F.Browser.isMac()?"\u2318Z":"Ctrl+Z"}));t.subscribe("onClick",(()=>{this.getEditor().dispatchCommand(L.UNDO_COMMAND)}));t.setDisableCallback((()=>!e||!this.getEditor().isEditable()));this.getEditor().registerCommand(L.CAN_UNDO_COMMAND,(s=>{e=s;t.setDisabled(!e);return false}),L.COMMAND_PRIORITY_CRITICAL);return t}));let t=false;this.getEditor().getComponentRegistry().register("redo",(()=>{const e=new ge;e.setContent('<span class="ui-icon-set --redo"></span>');e.setDisabled(!t);e.setTooltip(F.Loc.getMessage("TEXT_EDITOR_BTN_REDO",{"#keystroke#":F.Browser.isMac()?"\u2318\u21e7Z":"Ctrl+Y"}));e.subscribe("onClick",(()=>{this.getEditor().dispatchCommand(L.REDO_COMMAND)}));e.setDisableCallback((()=>!t||!this.getEditor().isEditable()));this.getEditor().registerCommand(L.CAN_REDO_COMMAND,(s=>{t=s;e.setDisabled(!t);return false}),L.COMMAND_PRIORITY_CRITICAL);return e}))}var Yb=Object.freeze({HistoryPlugin:Ub});let zb=e=>e,Xb,Gb;const Vb={DOWNWARD:1,UPWARD:-1,INDETERMINATE:0};const Jb="application/x-ui-text-editor-drag-block";var qb=babelHelpers.classPrivateFieldLooseKey("draggableBlockElement");var Qb=babelHelpers.classPrivateFieldLooseKey("lastBlockElementIndex");var Zb=babelHelpers.classPrivateFieldLooseKey("lastTargetElement");var eu=babelHelpers.classPrivateFieldLooseKey("container");var tu=babelHelpers.classPrivateFieldLooseKey("dropLine");var su=babelHelpers.classPrivateFieldLooseKey("isDragging");var iu=babelHelpers.classPrivateFieldLooseKey("bodyDragDropHandler");var ru=babelHelpers.classPrivateFieldLooseKey("bodyDragOverHandler");var au=babelHelpers.classPrivateFieldLooseKey("registerEvents");var ou=babelHelpers.classPrivateFieldLooseKey("registerListeners");var lu=babelHelpers.classPrivateFieldLooseKey("handleMouseMove");var nu=babelHelpers.classPrivateFieldLooseKey("handleMouseLeave");var du=babelHelpers.classPrivateFieldLooseKey("findBlockElement");var cu=babelHelpers.classPrivateFieldLooseKey("getCurrentIndex");var hu=babelHelpers.classPrivateFieldLooseKey("updatePosition");var bu=babelHelpers.classPrivateFieldLooseKey("setDraggableBlockElement");var uu=babelHelpers.classPrivateFieldLooseKey("handleDragStart");var pu=babelHelpers.classPrivateFieldLooseKey("handleDragEnd");var gu=babelHelpers.classPrivateFieldLooseKey("handleDragOver");var vu=babelHelpers.classPrivateFieldLooseKey("handleDragDrop");var fu=babelHelpers.classPrivateFieldLooseKey("showDropLine");var Pu=babelHelpers.classPrivateFieldLooseKey("hideDropLine");class mu extends ie{constructor(e){super(e);Object.defineProperty(this,Pu,{value:Su});Object.defineProperty(this,fu,{value:Du});Object.defineProperty(this,vu,{value:Mu});Object.defineProperty(this,gu,{value:_u});Object.defineProperty(this,pu,{value:Nu});Object.defineProperty(this,uu,{value:Eu});Object.defineProperty(this,bu,{value:Tu});Object.defineProperty(this,hu,{value:Ou});Object.defineProperty(this,cu,{value:Cu});Object.defineProperty(this,du,{value:Bu});Object.defineProperty(this,nu,{value:Hu});Object.defineProperty(this,lu,{value:Fu});Object.defineProperty(this,ou,{value:yu});Object.defineProperty(this,au,{value:Lu});Object.defineProperty(this,qb,{writable:true,value:null});Object.defineProperty(this,Qb,{writable:true,value:Infinity});Object.defineProperty(this,Zb,{writable:true,value:null});Object.defineProperty(this,eu,{writable:true,value:null});Object.defineProperty(this,tu,{writable:true,value:null});Object.defineProperty(this,su,{writable:true,value:false});Object.defineProperty(this,iu,{writable:true,value:null});Object.defineProperty(this,ru,{writable:true,value:null});this.cleanUpRegister(babelHelpers.classPrivateFieldLooseBase(this,au)[au](),babelHelpers.classPrivateFieldLooseBase(this,ou)[ou]());babelHelpers.classPrivateFieldLooseBase(this,iu)[iu]=e=>{this.getEditor().dispatchCommand(L.DROP_COMMAND,e)};babelHelpers.classPrivateFieldLooseBase(this,ru)[ru]=e=>{e.preventDefault()};F.Dom.append(this.getContainer(),this.getEditor().getScrollerContainer());F.Dom.append(this.getDropLine(),this.getEditor().getScrollerContainer())}static getName(){return"BlockToolbar"}getContainer(){if(babelHelpers.classPrivateFieldLooseBase(this,eu)[eu]===null){babelHelpers.classPrivateFieldLooseBase(this,eu)[eu]=F.Tag.render(Xb||(Xb=zb`
				<div class="ui-text-editor-block-toolbar">
					<div 
						class="ui-text-editor-block-drag-icon" 
						draggable="true"
						ondragstart="${0}" 
						ondragend="${0}"
					>
						<div 
							class="ui-icon-set --more-points" 
							style="--ui-icon-set__icon-size: 24px; margin-left: -4px"
						></div>
					</div>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,uu)[uu].bind(this),babelHelpers.classPrivateFieldLooseBase(this,pu)[pu].bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,eu)[eu]}getDropLine(){if(babelHelpers.classPrivateFieldLooseBase(this,tu)[tu]===null){babelHelpers.classPrivateFieldLooseBase(this,tu)[tu]=F.Tag.render(Gb||(Gb=zb`
				<div class="ui-text-editor-block-drop-line"></div>
			`))}return babelHelpers.classPrivateFieldLooseBase(this,tu)[tu]}destroy(){super.destroy();F.Dom.remove(this.getContainer());F.Dom.remove(this.getDropLine())}}function Lu(){const e=this.getEditor().getScrollerContainer();const t=babelHelpers.classPrivateFieldLooseBase(this,lu)[lu].bind(this);const s=babelHelpers.classPrivateFieldLooseBase(this,nu)[nu].bind(this);F.Event.bind(e,"mousemove",t);F.Event.bind(e,"mouseleave",s);return()=>{F.Event.unbind(e,"mousemove",t);F.Event.unbind(e,"mouseleave",s)}}function yu(){return y.mergeRegister(this.getEditor().registerCommand(L.DRAGOVER_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,gu)[gu].bind(this),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(L.DROP_COMMAND,babelHelpers.classPrivateFieldLooseBase(this,vu)[vu].bind(this),L.COMMAND_PRIORITY_HIGH),this.getEditor().registerTextContentListener((()=>{babelHelpers.classPrivateFieldLooseBase(this,bu)[bu](null);babelHelpers.classPrivateFieldLooseBase(this,hu)[hu]()})))}function Fu(e){if(!this.getEditor().isEditable()){return}const t=e.target;if(!(t instanceof HTMLElement)){babelHelpers.classPrivateFieldLooseBase(this,bu)[bu](null);return}if(t.closest(".ui-text-editor-block-toolbar")!==null){return}const s=babelHelpers.classPrivateFieldLooseBase(this,du)[du](e);babelHelpers.classPrivateFieldLooseBase(this,bu)[bu](s)}function Hu(){babelHelpers.classPrivateFieldLooseBase(this,bu)[bu](null)}function Bu(e){const t=this.getEditor().getScrollerContainer();const s=t.getBoundingClientRect();let i=null;this.getEditor().getEditorState().read((()=>{const t=L.$getRoot();const r=t.getChildrenKeys();let a=babelHelpers.classPrivateFieldLooseBase(this,cu)[cu](r.length);let o=Vb.INDETERMINATE;while(a>=0&&a<r.length){const t=r[a];const l=this.getEditor().getElementByKey(t);if(l===null){break}const n=l.getBoundingClientRect();const{marginLeft:d,marginRight:c,marginTop:h,marginBottom:b}=window.getComputedStyle(l);const u=new DOMRect(s.left+parseFloat(d),n.y-parseFloat(h),n.width+parseFloat(c),n.height+parseFloat(b));const{x:p,y:g}=e;const v=g<u.top;const f=g>u.bottom;const P=p<u.left;const m=p>u.right;const L=!v&&!f&&!P&&!m;if(L){i=l;babelHelpers.classPrivateFieldLooseBase(this,Qb)[Qb]=a;break}if(o===Vb.INDETERMINATE){if(v){o=Vb.UPWARD}else if(f){o=Vb.DOWNWARD}else{o=Infinity}}a+=o}}));return i}function Cu(e){if(e===0){return Infinity}if(babelHelpers.classPrivateFieldLooseBase(this,Qb)[Qb]>=0&&babelHelpers.classPrivateFieldLooseBase(this,Qb)[Qb]<e){return babelHelpers.classPrivateFieldLooseBase(this,Qb)[Qb]}return Math.floor(e/2)}function Ou(){if(babelHelpers.classPrivateFieldLooseBase(this,qb)[qb]===null){F.Dom.style(this.getContainer(),{opacity:0,transform:"translateY(-10000px)"})}else{const e=F.Text.toNumber(F.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,qb)[qb],"margin-top"));const t=babelHelpers.classPrivateFieldLooseBase(this,qb)[qb].offsetTop+e;F.Dom.style(this.getContainer(),{opacity:1,transform:`translateY(${t}px)`})}}function Tu(e){const t=babelHelpers.classPrivateFieldLooseBase(this,qb)[qb]!==e;babelHelpers.classPrivateFieldLooseBase(this,qb)[qb]=e;if(t){babelHelpers.classPrivateFieldLooseBase(this,hu)[hu]()}}function Eu(e){const t=e.dataTransfer;if(!t||babelHelpers.classPrivateFieldLooseBase(this,qb)[qb]===null){return}this.getEditor().dispatchCommand(H);t.setDragImage(babelHelpers.classPrivateFieldLooseBase(this,qb)[qb],0,0);let s="";this.getEditor().update((()=>{const e=L.$getNearestNodeFromDOMNode(babelHelpers.classPrivateFieldLooseBase(this,qb)[qb]);if(e){s=e.getKey()}}));t.setData(Jb,s);babelHelpers.classPrivateFieldLooseBase(this,su)[su]=true;F.Event.bind(document.body,"drop",babelHelpers.classPrivateFieldLooseBase(this,iu)[iu]);F.Event.bind(document.body,"dragover",babelHelpers.classPrivateFieldLooseBase(this,ru)[ru])}function Nu(e){babelHelpers.classPrivateFieldLooseBase(this,su)[su]=false;babelHelpers.classPrivateFieldLooseBase(this,Pu)[Pu]();F.Event.unbind(document.body,"drop",babelHelpers.classPrivateFieldLooseBase(this,iu)[iu]);F.Event.unbind(document.body,"dragover",babelHelpers.classPrivateFieldLooseBase(this,ru)[ru])}function _u(e){if(babelHelpers.classPrivateFieldLooseBase(this,su)[su]===false){return false}const t=e.dataTransfer.types.includes("Files");if(t||!(e.target instanceof HTMLElement)){return false}const s=babelHelpers.classPrivateFieldLooseBase(this,du)[du](e);if(s===null){return false}babelHelpers.classPrivateFieldLooseBase(this,Zb)[Zb]=s;babelHelpers.classPrivateFieldLooseBase(this,fu)[fu](s,e);e.preventDefault();return true}function Mu(e){var t;if(babelHelpers.classPrivateFieldLooseBase(this,su)[su]===false){return false}const s=e.dataTransfer.types.includes("Files");const i=((t=e.dataTransfer)==null?void 0:t.getData(Jb))||"";if(s||!(e.target instanceof HTMLElement)||!F.Type.isStringFilled(i)){return false}const r=L.$getNodeByKey(i);if(!r||!(e.target instanceof HTMLElement)){return false}const a=babelHelpers.classPrivateFieldLooseBase(this,du)[du](e)||babelHelpers.classPrivateFieldLooseBase(this,Zb)[Zb];if(!a){return false}const o=L.$getNearestNodeFromDOMNode(a);if(!o){return false}F.Event.unbind(document.body,"drop",babelHelpers.classPrivateFieldLooseBase(this,iu)[iu]);F.Event.unbind(document.body,"dragover",babelHelpers.classPrivateFieldLooseBase(this,ru)[ru]);if(o===r){return true}const{top:l,height:n}=a.getBoundingClientRect();const d=e.clientY-l>n/2;if(d){o.insertAfter(r)}else{o.insertBefore(r)}babelHelpers.classPrivateFieldLooseBase(this,bu)[bu](null);return true}function Du(e,t){const{top:s,height:i}=e.getBoundingClientRect();const r=window.getComputedStyle(e);const a=F.Dom.getRelativePosition(e,e.offsetParent);let o=a.top;const l=t.clientY-s>i/2;if(l){o+=i+parseFloat(r.marginBottom)*1.5}else{o+=parseFloat(r.marginTop)/2}const n=2;const d=16;const c=o-n;F.Dom.style(this.getDropLine(),{opacity:.4,left:`${d}px`,right:`${d}px`,transform:`translateY(${c}px)`})}function Su(){F.Dom.style(this.getDropLine(),{opacity:0,transform:"translate(-10000px, -10000px)"})}var Ru=Object.freeze({BlockToolbarPlugin:mu});let Iu=e=>e,xu;var wu=babelHelpers.classPrivateFieldLooseKey("container");class Au extends re{constructor(...e){super(...e);Object.defineProperty(this,wu,{writable:true,value:null})}getContainer(){if(babelHelpers.classPrivateFieldLooseBase(this,wu)[wu]===null){babelHelpers.classPrivateFieldLooseBase(this,wu)[wu]=F.Tag.render(xu||(xu=Iu`<span class="ui-text-editor-toolbar-separator"></span>`))}return babelHelpers.classPrivateFieldLooseBase(this,wu)[wu]}render(){return this.getContainer()}}let $u=e=>e,Ku,ju,ku;var Uu=babelHelpers.classPrivateFieldLooseKey("textEditor");var Wu=babelHelpers.classPrivateFieldLooseKey("items");var Yu=babelHelpers.classPrivateFieldLooseKey("rendered");var zu=babelHelpers.classPrivateFieldLooseKey("moreBtn");var Xu=babelHelpers.classPrivateFieldLooseKey("refs");var Gu=babelHelpers.classPrivateFieldLooseKey("resizeObserver");var Vu=babelHelpers.classPrivateFieldLooseKey("timeoutId");var Ju=babelHelpers.classPrivateFieldLooseKey("removeListeners");var qu=babelHelpers.classPrivateFieldLooseKey("registerListeners");var Qu=babelHelpers.classPrivateFieldLooseKey("fillFromOptions");var Zu=babelHelpers.classPrivateFieldLooseKey("handleResize");var ep=babelHelpers.classPrivateFieldLooseKey("getSelectionBlockTypes");var tp=babelHelpers.classPrivateFieldLooseKey("getBlockType");class sp{constructor(e,t){Object.defineProperty(this,tp,{value:lp});Object.defineProperty(this,ep,{value:op});Object.defineProperty(this,Zu,{value:ap});Object.defineProperty(this,Qu,{value:rp});Object.defineProperty(this,qu,{value:ip});Object.defineProperty(this,Uu,{writable:true,value:null});Object.defineProperty(this,Wu,{writable:true,value:[]});Object.defineProperty(this,Yu,{writable:true,value:false});Object.defineProperty(this,zu,{writable:true,value:null});Object.defineProperty(this,Xu,{writable:true,value:new g.MemoryCache});Object.defineProperty(this,Gu,{writable:true,value:null});Object.defineProperty(this,Vu,{writable:true,value:null});Object.defineProperty(this,Ju,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu]=e;const s=F.Type.isArray(t)?t:[];babelHelpers.classPrivateFieldLooseBase(this,Qu)[Qu](s);if(babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu].length>0){babelHelpers.classPrivateFieldLooseBase(this,Ju)[Ju]=babelHelpers.classPrivateFieldLooseBase(this,qu)[qu]();babelHelpers.classPrivateFieldLooseBase(this,Gu)[Gu]=new ResizeObserver(babelHelpers.classPrivateFieldLooseBase(this,Zu)[Zu].bind(this))}}renderTo(e){if(this.isRendered()){return}if(F.Type.isElementNode(e)){babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu].forEach((e=>{F.Dom.append(e.render(),this.getItemsContainer())}));F.Dom.append(this.getContainer(),e);if(babelHelpers.classPrivateFieldLooseBase(this,Gu)[Gu]!==null){babelHelpers.classPrivateFieldLooseBase(this,Gu)[Gu].observe(this.getContainer())}babelHelpers.classPrivateFieldLooseBase(this,Yu)[Yu]=true}}isEmpty(){return babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu].length===0}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Xu)[Xu].remember("container",(()=>F.Tag.render(Ku||(Ku=$u`
				<div class="ui-text-editor-toolbar-container">
					${0}
					${0}
				</div>
			`),this.getItemsContainer(),this.getMoreBtnContainer())))}getItemsContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Xu)[Xu].remember("items-container",(()=>F.Tag.render(ju||(ju=$u`
				<div class="ui-text-editor-toolbar-items"></div>
			`))))}getMoreBtnContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Xu)[Xu].remember("more-btn-container",(()=>F.Tag.render(ku||(ku=$u`
				<div class="ui-text-editor-toolbar-more-btn">
				${0}
				</div>
			`),this.getMoreBtn().render())))}getMoreBtn(){if(babelHelpers.classPrivateFieldLooseBase(this,zu)[zu]===null){const e=()=>{F.Event.unbind(this.getItemsContainer(),"transitionend",e);F.Dom.style(this.getItemsContainer(),{height:null});F.Dom.removeClass(this.getItemsContainer(),"--animating")};babelHelpers.classPrivateFieldLooseBase(this,zu)[zu]=new ge;babelHelpers.classPrivateFieldLooseBase(this,zu)[zu].setContent('<span class="ui-text-editor-toolbar-more-btn-icon"></span>');babelHelpers.classPrivateFieldLooseBase(this,zu)[zu].subscribe("onClick",(()=>{F.Event.unbind(this.getItemsContainer(),"transitionend",e);if(F.Dom.hasClass(this.getContainer(),"--expanded")){F.Dom.style(this.getItemsContainer(),{height:`${this.getItemsContainer().scrollHeight}px`});requestAnimationFrame((()=>{F.Dom.removeClass(this.getContainer(),"--expanded");F.Dom.addClass(this.getItemsContainer(),"--animating");F.Dom.style(this.getItemsContainer(),{height:null})}))}else{F.Dom.addClass(this.getItemsContainer(),"--animating");F.Dom.style(this.getItemsContainer(),{height:`${this.getItemsContainer().scrollHeight}px`});F.Dom.addClass(this.getContainer(),"--expanded")}F.Event.bind(this.getItemsContainer(),"transitionend",e)}))}return babelHelpers.classPrivateFieldLooseBase(this,zu)[zu]}getItems(){return babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu]}isRendered(){return babelHelpers.classPrivateFieldLooseBase(this,Yu)[Yu]}destroy(){if(babelHelpers.classPrivateFieldLooseBase(this,Ju)[Ju]!==null){babelHelpers.classPrivateFieldLooseBase(this,Ju)[Ju]()}if(babelHelpers.classPrivateFieldLooseBase(this,Gu)[Gu]!==null){babelHelpers.classPrivateFieldLooseBase(this,Gu)[Gu].disconnect();babelHelpers.classPrivateFieldLooseBase(this,Gu)[Gu]=null}if(this.isRendered()){F.Dom.remove(this.getContainer())}if(babelHelpers.classPrivateFieldLooseBase(this,Vu)[Vu]){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,Vu)[Vu])}babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu]=null;babelHelpers.classPrivateFieldLooseBase(this,Xu)[Xu]=null}update(){babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].getEditorState().read((()=>{let e=L.$getSelection();if(!L.$isRangeSelection(e)){e=null}let t=null;if(e!==null){t=y.$findMatchingParent(e.anchor.getNode(),(e=>(e.__flags&E)!==0))}const s=e===null?new Set:babelHelpers.classPrivateFieldLooseBase(this,ep)[ep](e);const i=!babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].isEditable();babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu].forEach((r=>{if(!(r instanceof ge)){return}if(r.hasOwnDisableCallback()){r.setDisabled(r.invokeDisableCallback())}else if(i){r.disable()}else if(t!==null&&r.shouldDisableInsideUnformatted()){r.disable()}else{r.enable()}if(r.isDisabled()){r.setActive(false)}else if(r.hasFormat()){const t=r.getFormat();r.setActive(e===null?false:e.hasFormat(t))}else if(r.getBlockType()!==null){r.setActive(s.has(r.getBlockType()))}}))}))}reset(){babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu].forEach((e=>{if(e instanceof ge){e.setActive(false)}}))}}function ip(){return y.mergeRegister(babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].registerCommand(L.SELECTION_CHANGE_COMMAND,(()=>{this.update();return false}),L.COMMAND_PRIORITY_CRITICAL),babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].registerCommand(L.FOCUS_COMMAND,(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,Vu)[Vu]){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,Vu)[Vu]);babelHelpers.classPrivateFieldLooseBase(this,Vu)[Vu]=null}return false}),L.COMMAND_PRIORITY_CRITICAL),babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].registerCommand(L.BLUR_COMMAND,(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,Vu)[Vu]){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,Vu)[Vu])}babelHelpers.classPrivateFieldLooseBase(this,Vu)[Vu]=setTimeout((()=>{const e=document.activeElement;const t=babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].getScrollerContainer();if(e===null||!t.contains(e)){this.reset()}}),400);return false}),L.COMMAND_PRIORITY_CRITICAL),babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].registerUpdateListener((()=>{this.update()})),babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].registerEditableListener((()=>{this.update()})))}function rp(e){e.forEach((e=>{if(e==="|"){babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu].push(new Au)}else{const t=babelHelpers.classPrivateFieldLooseBase(this,Uu)[Uu].getComponentRegistry().create(e);if(t===null){console.warn(`TextEditor Toolbar: "${e}" component doesn't exist.`)}else{babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu].push(t)}}}))}function ap(e){if(this.getContainer().offsetWidth===0||F.Dom.hasClass(this.getItemsContainer(),"--animating")){return}const t=babelHelpers.classPrivateFieldLooseBase(this,Wu)[Wu].at(-1);if(!t||t.getContainer().offsetTop>=t.getContainer().offsetHeight){F.Dom.addClass(this.getContainer(),"--overflowed")}else{F.Dom.removeClass(this.getContainer(),["--overflowed","--expanded"])}}function op(e){const t=e.anchor.getNode();const s=new Set;let i=t;while(i!==L.$getRoot()&&i!==null){const e=babelHelpers.classPrivateFieldLooseBase(this,tp)[tp](i);s.add(e);i=i.getParent()}return s}function lp(e){if(f.$isListNode(e)){const t=e;const s=y.$getNearestNodeOfType(t,f.ListNode);return s?s.getListType():t.getListType()}if(P.$isLinkNode(e)||P.$isAutoLinkNode(e)){return"link"}if(wt(e)){return"code"}return e.getType()}let np=e=>e,dp;var cp=babelHelpers.classPrivateFieldLooseKey("popup");var hp=babelHelpers.classPrivateFieldLooseKey("toolbar");var bp=babelHelpers.classPrivateFieldLooseKey("showDebounced");var up=babelHelpers.classPrivateFieldLooseKey("onEditorScroll");var pp=babelHelpers.classPrivateFieldLooseKey("registerListeners");var gp=babelHelpers.classPrivateFieldLooseKey("show");var vp=babelHelpers.classPrivateFieldLooseKey("adjustDialogPosition");var fp=babelHelpers.classPrivateFieldLooseKey("initDialogPosition");var Pp=babelHelpers.classPrivateFieldLooseKey("handleEditorScroll");var mp=babelHelpers.classPrivateFieldLooseKey("shouldShowDialog");class Lp extends ie{constructor(e){super(e);Object.defineProperty(this,mp,{value:Op});Object.defineProperty(this,Pp,{value:Cp});Object.defineProperty(this,fp,{value:Bp});Object.defineProperty(this,vp,{value:Hp});Object.defineProperty(this,gp,{value:Fp});Object.defineProperty(this,pp,{value:yp});Object.defineProperty(this,cp,{writable:true,value:null});Object.defineProperty(this,hp,{writable:true,value:null});Object.defineProperty(this,bp,{writable:true,value:null});Object.defineProperty(this,up,{writable:true,value:babelHelpers.classPrivateFieldLooseBase(this,Pp)[Pp].bind(this)});babelHelpers.classPrivateFieldLooseBase(this,bp)[bp]=F.Runtime.debounce((()=>{this.getEditor().update((()=>{if(babelHelpers.classPrivateFieldLooseBase(this,mp)[mp]()){babelHelpers.classPrivateFieldLooseBase(this,gp)[gp]()}}))}),700)}static getName(){return"FloatingToolbar"}afterInit(){const e=this.getEditor().getOption("floatingToolbar",[]);babelHelpers.classPrivateFieldLooseBase(this,hp)[hp]=new sp(this.getEditor(),e);if(!babelHelpers.classPrivateFieldLooseBase(this,hp)[hp].isEmpty()){this.cleanUpRegister(babelHelpers.classPrivateFieldLooseBase(this,pp)[pp]())}}update(){if(babelHelpers.classPrivateFieldLooseBase(this,mp)[mp]()){if(this.getPopup().isShown()){babelHelpers.classPrivateFieldLooseBase(this,gp)[gp]()}else{babelHelpers.classPrivateFieldLooseBase(this,bp)[bp]()}}else{this.getPopup().close()}}getPopup(){if(babelHelpers.classPrivateFieldLooseBase(this,cp)[cp]===null){const e=F.Tag.render(dp||(dp=np`<div class="ui-text-editor-floating-toolbar"></div>`));babelHelpers.classPrivateFieldLooseBase(this,cp)[cp]=new p.Popup({closeByEsc:true,targetContainer:document.body,autoHide:true,content:e,autoHideHandler:e=>{let t=true;const s=window.getSelection();if(s.isCollapsed){return true}this.getEditor().update((()=>{const e=L.$getSelection();t=e===null||e.isCollapsed()}));return t},events:{onShow:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,vp)[vp]()){F.Event.bind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,up)[up])}},onClose:()=>{F.Event.unbind(this.getEditor().getScrollerContainer(),"scroll",babelHelpers.classPrivateFieldLooseBase(this,up)[up]);aa(this.getPopup())}}});babelHelpers.classPrivateFieldLooseBase(this,hp)[hp].renderTo(e)}return babelHelpers.classPrivateFieldLooseBase(this,cp)[cp]}hide(){if(babelHelpers.classPrivateFieldLooseBase(this,cp)[cp]===null){return}this.getPopup().close()}destroy(){super.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,cp)[cp]!==null){babelHelpers.classPrivateFieldLooseBase(this,cp)[cp].destroy();babelHelpers.classPrivateFieldLooseBase(this,cp)[cp]=null}babelHelpers.classPrivateFieldLooseBase(this,hp)[hp].destroy();babelHelpers.classPrivateFieldLooseBase(this,hp)[hp]=null}}function yp(){return y.mergeRegister(this.getEditor().registerCommand(L.SELECTION_CHANGE_COMMAND,(()=>{this.update();return false}),L.COMMAND_PRIORITY_CRITICAL),this.getEditor().registerUpdateListener((({editorState:e})=>{e.read((()=>{this.update()}))})),this.getEditor().registerCommand(H,(()=>{this.hide();return false}),L.COMMAND_PRIORITY_LOW))}function Fp(){this.getPopup().show();aa(this.getPopup());babelHelpers.classPrivateFieldLooseBase(this,vp)[vp]()}function Hp(){return ra(this.getPopup(),this.getEditor(),babelHelpers.classPrivateFieldLooseBase(this,fp)[fp])}function Bp(e){const{isBackward:t,isMultiline:s}=e;return t||!s?"top":"bottom"}function Cp(){this.getEditor().update((()=>{babelHelpers.classPrivateFieldLooseBase(this,vp)[vp]()}))}function Op(){if(this.getEditor().isComposing()||!this.getEditor().isEditable()){return false}const e=L.$getSelection();if(!L.$isRangeSelection(e)||e.isCollapsed()){return false}const t=window.getSelection();if(t===null||t.isCollapsed){return false}const s=this.getEditor().getScrollerContainer();if(!s.contains(t.anchorNode)){return false}const i=y.$findMatchingParent(e.anchor.getNode(),(e=>(e.__flags&E)!==0));if(i||e.getTextContent()===""){return false}const r=e.getTextContent().replaceAll("\n","");if(!e.isCollapsed()&&r===""){return false}const a=this.getEditor().dispatchCommand(B);if(a){return false}const o=w(e);return L.$isTextNode(o)}var Tp=Object.freeze({FloatingToolbarPlugin:Lp});const Ep=L.createCommand("TOGGLE_TOOLBAR_COMMAND");const Np=L.createCommand("SHOW_TOOLBAR_COMMAND");const _p=L.createCommand("HIDE_TOOLBAR_COMMAND");var Mp=babelHelpers.classPrivateFieldLooseKey("toolbar");var Dp=babelHelpers.classPrivateFieldLooseKey("registerCommands");class Sp extends ie{constructor(...e){super(...e);Object.defineProperty(this,Dp,{value:Rp});Object.defineProperty(this,Mp,{writable:true,value:null})}static getName(){return"Toolbar"}getToolbar(){return babelHelpers.classPrivateFieldLooseBase(this,Mp)[Mp]}isRendered(){return babelHelpers.classPrivateFieldLooseBase(this,Mp)[Mp]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Mp)[Mp].isRendered()}show(){if(this.isRendered()){F.Dom.removeClass(this.getEditor().getToolbarContainer(),"--hidden")}}hide(){if(this.isRendered()){F.Dom.addClass(this.getEditor().getToolbarContainer(),"--hidden")}}isShown(){return this.isRendered()&&!F.Dom.hasClass(this.getEditor().getToolbarContainer(),"--hidden")}toggle(){if(this.isShown()){this.hide()}else{this.show()}}afterInit(){babelHelpers.classPrivateFieldLooseBase(this,Mp)[Mp]=new sp(this.getEditor(),this.getEditor().getOption("toolbar"));if(!babelHelpers.classPrivateFieldLooseBase(this,Mp)[Mp].isEmpty()){babelHelpers.classPrivateFieldLooseBase(this,Dp)[Dp]();babelHelpers.classPrivateFieldLooseBase(this,Mp)[Mp].renderTo(this.getEditor().getToolbarContainer());const e=this.getEditor().getOption("hideToolbar",false);if(e){this.hide()}}}destroy(){super.destroy();babelHelpers.classPrivateFieldLooseBase(this,Mp)[Mp].destroy()}}function Rp(){this.cleanUpRegister(this.getEditor().registerCommand(Ep,(()=>{this.toggle();return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(Np,(()=>{this.show();return true}),L.COMMAND_PRIORITY_LOW),this.getEditor().registerCommand(_p,(()=>{this.hide();return true}),L.COMMAND_PRIORITY_LOW))}var Ip=Object.freeze({TOGGLE_TOOLBAR_COMMAND:Ep,SHOW_TOOLBAR_COMMAND:Np,HIDE_TOOLBAR_COMMAND:_p,ToolbarPlugin:Sp});let xp=e=>e,wp;var Ap=babelHelpers.classPrivateFieldLooseKey("placeholder");var $p=babelHelpers.classPrivateFieldLooseKey("placeholderNode");var Kp=babelHelpers.classPrivateFieldLooseKey("paragraphPlaceholder");var jp=babelHelpers.classPrivateFieldLooseKey("registerPlaceholderListeners");var kp=babelHelpers.classPrivateFieldLooseKey("togglePlaceholder");var Up=babelHelpers.classPrivateFieldLooseKey("hasFocus");var Wp=babelHelpers.classPrivateFieldLooseKey("hidePlaceholder");var Yp=babelHelpers.classPrivateFieldLooseKey("registerParagraphListeners");class zp extends ie{constructor(...e){super(...e);Object.defineProperty(this,Yp,{value:qp});Object.defineProperty(this,Wp,{value:Jp});Object.defineProperty(this,Up,{value:Vp});Object.defineProperty(this,kp,{value:Gp});Object.defineProperty(this,jp,{value:Xp});Object.defineProperty(this,Ap,{writable:true,value:null});Object.defineProperty(this,$p,{writable:true,value:null});Object.defineProperty(this,Kp,{writable:true,value:null})}afterInit(){const e=this.getEditor().getOption("placeholder");if(F.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,Ap)[Ap]=e;babelHelpers.classPrivateFieldLooseBase(this,$p)[$p]=F.Tag.render(wp||(wp=xp`
				<div class="ui-text-editor-placeholder">${0}</div>
			`),F.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,Ap)[Ap]));F.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,$p)[$p],this.getEditor().getScrollerContainer());babelHelpers.classPrivateFieldLooseBase(this,jp)[jp]()}let t=this.getEditor().getOption("paragraphPlaceholder");if(F.Type.isStringFilled(t)){if(t==="auto"){const e=this.getEditor().getPlugin("Copilot");const s=e!==null&&e.shouldTriggerBySpace();const i=this.getEditor().getPlugin("Mention");const r=i!==null&&i.shouldTriggerByAtSign();if(s&&r){t=F.Loc.getMessage("TEXT_EDITOR_PLACEHOLDER_MENTION_COPILOT")}else if(s){t=F.Loc.getMessage("TEXT_EDITOR_PLACEHOLDER_COPILOT")}else if(r){t=F.Loc.getMessage("TEXT_EDITOR_PLACEHOLDER_MENTION")}}if(t!=="auto"){babelHelpers.classPrivateFieldLooseBase(this,Kp)[Kp]=t;babelHelpers.classPrivateFieldLooseBase(this,Yp)[Yp]()}}}static getName(){return"Placeholder"}}function Xp(){this.cleanUpRegister(this.getEditor().registerUpdateListener((()=>{this.getEditor().getEditorState().read((()=>{babelHelpers.classPrivateFieldLooseBase(this,kp)[kp]()}))})))}function Gp(){if(babelHelpers.classPrivateFieldLooseBase(this,Ap)[Ap]===null){return}let e=m.$canShowPlaceholder(this.getLexicalEditor().isComposing());if(e&&babelHelpers.classPrivateFieldLooseBase(this,Kp)[Kp]!==null&&babelHelpers.classPrivateFieldLooseBase(this,Up)[Up]()){e=false}if(e){F.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,$p)[$p],"--shown")}else{F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,$p)[$p],"--shown")}}function Vp(){const e=document.activeElement;const t=this.getEditor().getRootElement();return t!==null&&e!==null&&t.contains(e)}function Jp(){if(babelHelpers.classPrivateFieldLooseBase(this,$p)[$p]!==null){F.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,$p)[$p],"--shown")}}function qp(){let e=null;const t=()=>{if(e){const t=this.getEditor().getElementByKey(e.getKey());if(t){delete t.dataset.placeholder}}};this.cleanUpRegister(this.getEditor().registerCommand(L.SELECTION_CHANGE_COMMAND,(()=>{if(!this.getEditor().isEditable()){return false}const s=L.$getSelection();let i=null;if(L.$isRangeSelection(s)&&s.isCollapsed()){const e=s.anchor.getNode();if(L.$isParagraphNode(e)&&L.$isRootNode(e.getParent())&&e.isEmpty()){const t=this.getEditor().getElementByKey(e.getKey());if(t&&babelHelpers.classPrivateFieldLooseBase(this,Up)[Up]()){t.dataset.placeholder=babelHelpers.classPrivateFieldLooseBase(this,Kp)[Kp];i=e;babelHelpers.classPrivateFieldLooseBase(this,Wp)[Wp]()}}}if(e&&e!==i){t()}e=i;return false}),L.COMMAND_PRIORITY_CRITICAL),this.getEditor().registerCommand(L.PASTE_COMMAND,(()=>{t();return false}),L.COMMAND_PRIORITY_CRITICAL),this.getEditor().registerCommand(L.BLUR_COMMAND,(()=>{t();babelHelpers.classPrivateFieldLooseBase(this,kp)[kp]();return false}),L.COMMAND_PRIORITY_CRITICAL))}let Qp=e=>e,Zp,eg,tg,sg,ig,rg,ag,og,lg,ng;const dg={COLLAPSED:"collapsed",COLLAPSING:"collapsing",EXPANDED:"expanded",EXPANDING:"expanding"};var cg=babelHelpers.classPrivateFieldLooseKey("lexicalEditor");var hg=babelHelpers.classPrivateFieldLooseKey("componentRegistry");var bg=babelHelpers.classPrivateFieldLooseKey("refs");var ug=babelHelpers.classPrivateFieldLooseKey("options");var pg=babelHelpers.classPrivateFieldLooseKey("plugins");var gg=babelHelpers.classPrivateFieldLooseKey("newLineMode");var vg=babelHelpers.classPrivateFieldLooseKey("bbcodeScheme");var fg=babelHelpers.classPrivateFieldLooseKey("schemeValidation");var Pg=babelHelpers.classPrivateFieldLooseKey("bbcodeImportMap");var mg=babelHelpers.classPrivateFieldLooseKey("bbcodeExportMap");var Lg=babelHelpers.classPrivateFieldLooseKey("themeClasses");var yg=babelHelpers.classPrivateFieldLooseKey("decoratorNodes");var Fg=babelHelpers.classPrivateFieldLooseKey("decoratorComponents");var Hg=babelHelpers.classPrivateFieldLooseKey("removeListeners");var Bg=babelHelpers.classPrivateFieldLooseKey("highlightContainer");var Cg=babelHelpers.classPrivateFieldLooseKey("autoFocus");var Og=babelHelpers.classPrivateFieldLooseKey("minHeight");var Tg=babelHelpers.classPrivateFieldLooseKey("maxHeight");var Eg=babelHelpers.classPrivateFieldLooseKey("collapsingMode");var Ng=babelHelpers.classPrivateFieldLooseKey("collapsingState");var _g=babelHelpers.classPrivateFieldLooseKey("collapsingTransitionEnd");var Mg=babelHelpers.classPrivateFieldLooseKey("paragraphHeight");var Dg=babelHelpers.classPrivateFieldLooseKey("resizeObserver");var Sg=babelHelpers.classPrivateFieldLooseKey("destroying");var Rg=babelHelpers.classPrivateFieldLooseKey("rendered");var Ig=babelHelpers.classPrivateFieldLooseKey("prevEmptyStatus");var xg=babelHelpers.classPrivateFieldLooseKey("initEditorState");var wg=babelHelpers.classPrivateFieldLooseKey("initDecorateNodes");var Ag=babelHelpers.classPrivateFieldLooseKey("registerCommands");var $g=babelHelpers.classPrivateFieldLooseKey("createNamespace");var Kg=babelHelpers.classPrivateFieldLooseKey("initBBCodeImportMap");var jg=babelHelpers.classPrivateFieldLooseKey("initBBCodeExportMap");var kg=babelHelpers.classPrivateFieldLooseKey("initBBCodeScheme");var Ug=babelHelpers.classPrivateFieldLooseKey("initCollapsingMode");var Wg=babelHelpers.classPrivateFieldLooseKey("collapse");var Yg=babelHelpers.classPrivateFieldLooseKey("handleCollapsingTransition");class zg extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,Yg,{value:sv});Object.defineProperty(this,Wg,{value:tv});Object.defineProperty(this,Ug,{value:ev});Object.defineProperty(this,kg,{value:Zg});Object.defineProperty(this,jg,{value:Qg});Object.defineProperty(this,Kg,{value:qg});Object.defineProperty(this,$g,{value:Jg});Object.defineProperty(this,Ag,{value:Vg});Object.defineProperty(this,wg,{value:Gg});Object.defineProperty(this,xg,{value:Xg});Object.defineProperty(this,cg,{writable:true,value:null});Object.defineProperty(this,hg,{writable:true,value:new Jn});Object.defineProperty(this,bg,{writable:true,value:new F.Cache.MemoryCache});Object.defineProperty(this,ug,{writable:true,value:null});Object.defineProperty(this,pg,{writable:true,value:null});Object.defineProperty(this,gg,{writable:true,value:N.MIXED});Object.defineProperty(this,vg,{writable:true,value:null});Object.defineProperty(this,fg,{writable:true,value:null});Object.defineProperty(this,Pg,{writable:true,value:void 0});Object.defineProperty(this,mg,{writable:true,value:void 0});Object.defineProperty(this,Lg,{writable:true,value:{}});Object.defineProperty(this,yg,{writable:true,value:new Set});Object.defineProperty(this,Fg,{writable:true,value:new Map});Object.defineProperty(this,Hg,{writable:true,value:null});Object.defineProperty(this,Bg,{writable:true,value:F.Tag.render(Zp||(Zp=Qp`<div class="ui-text-editor-selection-highlighting"></div>`))});Object.defineProperty(this,Cg,{writable:true,value:false});Object.defineProperty(this,Og,{writable:true,value:null});Object.defineProperty(this,Tg,{writable:true,value:null});Object.defineProperty(this,Eg,{writable:true,value:false});Object.defineProperty(this,Ng,{writable:true,value:dg.EXPANDED});Object.defineProperty(this,_g,{writable:true,value:babelHelpers.classPrivateFieldLooseBase(this,Yg)[Yg].bind(this)});Object.defineProperty(this,Mg,{writable:true,value:null});Object.defineProperty(this,Dg,{writable:true,value:null});Object.defineProperty(this,Sg,{writable:true,value:false});Object.defineProperty(this,Rg,{writable:true,value:false});Object.defineProperty(this,Ig,{writable:true,value:true});this.setEventNamespace("BX.UI.TextEditor.Editor");const t=this.constructor.getDefaultOptions();const s=F.Type.isPlainObject(e)?e:{};babelHelpers.classPrivateFieldLooseBase(this,ug)[ug]=new l.SettingsCollection({...t,...s});const i=[...this.constructor.getBuiltinPlugins()];const r=babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("plugins",i);const a=babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("extraPlugins",[]);const o=babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("removePlugins",[]);const n=babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("newLineMode");if([N.LINE_BREAK,N.PARAGRAPH].includes(n)){babelHelpers.classPrivateFieldLooseBase(this,gg)[gg]=n}babelHelpers.classPrivateFieldLooseBase(this,Lg)[Lg]=kn;babelHelpers.classPrivateFieldLooseBase(this,pg)[pg]=new Xn(i,[...r,...a],o);const d=babelHelpers.classPrivateFieldLooseBase(this,pg)[pg].getConstructors();const c=d.map((e=>e.getNodes(this)));babelHelpers.classPrivateFieldLooseBase(this,cg)[cg]=L.createEditor({namespace:F.Type.isStringFilled(s.namespace)?s.namespace:babelHelpers.classPrivateFieldLooseBase(this,$g)[$g](d),nodes:c.flat(),onError:e=>{console.error(e)},theme:babelHelpers.classPrivateFieldLooseBase(this,Lg)[Lg],editable:babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("editable")!==false});this.setMinHeight(s.minHeight);this.setMaxHeight(s.maxHeight);this.setAutoFocus(s.autoFocus);this.setVisualOptions(s.visualOptions);babelHelpers.classPrivateFieldLooseBase(this,Hg)[Hg]=y.mergeRegister(babelHelpers.classPrivateFieldLooseBase(this,Ag)[Ag](),babelHelpers.classPrivateFieldLooseBase(this,wg)[wg](c.flat()));babelHelpers.classPrivateFieldLooseBase(this,pg)[pg].init(this);babelHelpers.classPrivateFieldLooseBase(this,Pg)[Pg]=babelHelpers.classPrivateFieldLooseBase(this,Kg)[Kg]();babelHelpers.classPrivateFieldLooseBase(this,mg)[mg]=babelHelpers.classPrivateFieldLooseBase(this,jg)[jg]();babelHelpers.classPrivateFieldLooseBase(this,vg)[vg]=babelHelpers.classPrivateFieldLooseBase(this,kg)[kg]();babelHelpers.classPrivateFieldLooseBase(this,fg)[fg]=new id(this);this.subscribeFromOptions(s.events)}static getBuiltinPlugins(){return[od,Ct,dd,hd,Cd,gd,Ld,Md,nh,ds,Me,fh,So,Fc,Wc,Ra,vn,vl,qe,Wh,Zh,Tb,Ub,mu,Lp,Sp,zp,Cr]}static getDefaultOptions(){return{}}getComponentRegistry(){return babelHelpers.classPrivateFieldLooseBase(this,hg)[hg]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,ug)[ug]}getOption(e,t=null){return babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get(e,t)}getThemeClasses(){return babelHelpers.classPrivateFieldLooseBase(this,Lg)[Lg]}getThemeClass(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Lg)[Lg][e];if(t!==undefined){return t}return""}getNewLineMode(){return babelHelpers.classPrivateFieldLooseBase(this,gg)[gg]}getBBCodeScheme(){return babelHelpers.classPrivateFieldLooseBase(this,vg)[vg]}getSchemeValidation(){return babelHelpers.classPrivateFieldLooseBase(this,fg)[fg]}setText(e,t){if(F.Type.isString(e)){const s={discrete:F.Type.isPlainObject(t)&&t.discrete===true};babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].update((()=>{const t=K(e,this);const s=L.$getRoot();s.clear();s.append(...t);L.$setSelection(null)}),s)}}clear(e){const t={discrete:F.Type.isPlainObject(e)&&e.discrete===true};babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].update((()=>{const e=L.$getRoot();const t=L.$createParagraphNode();e.clear();e.append(t);L.$setSelection(null)}),t)}clearHistory(){this.dispatchCommand(L.CLEAR_HISTORY_COMMAND)}getText(){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].getEditorState().read((()=>{const e=V(L.$getRoot(),this);return e.toString()}))}isEmpty(e=true){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].getEditorState().read((()=>jn(e)))}setAutoFocus(e){if(F.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Cg)[Cg]=e}}hasAutoFocus(){return babelHelpers.classPrivateFieldLooseBase(this,Cg)[Cg]}setMinHeight(e){if(F.Type.isNumber(e)&&e>0||e===null){const t=babelHelpers.classPrivateFieldLooseBase(this,Og)[Og]!==e;babelHelpers.classPrivateFieldLooseBase(this,Og)[Og]=e;if(t){F.Dom.style(this.getScrollerContainer(),"--ui-text-editor-min-height",e>0?`${e}px`:null)}}}getMinHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Og)[Og]}setMaxHeight(e){if(F.Type.isNumber(e)&&e>0||e===null){const t=babelHelpers.classPrivateFieldLooseBase(this,Tg)[Tg]!==e;babelHelpers.classPrivateFieldLooseBase(this,Tg)[Tg]=e;if(t){F.Dom.style(this.getScrollerContainer(),"--ui-text-editor-max-height",e>0?`${e}px`:null)}}}getMaxHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Tg)[Tg]}setVisualOptions(e){if(!F.Type.isPlainObject(e)){return}for(const[t,s]of Object.entries(e)){const e=F.Text.toKebabCase(t);F.Dom.style(this.getRootContainer(),`--ui-text-editor-${e}`,s)}}isCollapsingModeEnabled(){return babelHelpers.classPrivateFieldLooseBase(this,Eg)[Eg]}isCollapsed(){return babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.COLLAPSED}collapse(e=true){babelHelpers.classPrivateFieldLooseBase(this,Wg)[Wg]("hide",e)}expand(e=true){babelHelpers.classPrivateFieldLooseBase(this,Wg)[Wg]("show",e)}toggle(e=true){babelHelpers.classPrivateFieldLooseBase(this,Wg)[Wg]("toggle",e)}getParagraphHeight(){if(babelHelpers.classPrivateFieldLooseBase(this,Mg)[Mg]!==null){return babelHelpers.classPrivateFieldLooseBase(this,Mg)[Mg]}const e=this.getThemeClasses().paragraph||"";const t=F.Tag.render(eg||(eg=Qp`<p class="${0}"><br /></p>`),e);F.Dom.style(t,{position:"absolute",transform:"translateY(-1000px)"});F.Dom.append(t,this.getScrollerContainer());babelHelpers.classPrivateFieldLooseBase(this,Mg)[Mg]=t.offsetHeight+F.Text.toNumber(F.Dom.style(t,"margin-top"))+F.Text.toNumber(F.Dom.style(t,"margin-bottom"));F.Dom.remove(t);return babelHelpers.classPrivateFieldLooseBase(this,Mg)[Mg]}getLexicalEditor(){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg]}setRootElement(e){if(F.Type.isElementNode(e)||e===null){babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].setRootElement(e)}}getBBCodeExportMap(){return babelHelpers.classPrivateFieldLooseBase(this,mg)[mg]}getBBCodeImportMap(){return babelHelpers.classPrivateFieldLooseBase(this,Pg)[Pg]}getEditorState(){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].getEditorState()}getPlugins(){return babelHelpers.classPrivateFieldLooseBase(this,pg)[pg]}getPlugin(e){return babelHelpers.classPrivateFieldLooseBase(this,pg)[pg].get(e)}getElementByKey(e){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].getElementByKey(e)}setEditorState(e,t){babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].setEditorState(e,t)}setEditable(e){if(F.Type.isBoolean(e)){this.dispatchCommand(H);if(!e){this.blur()}babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].setEditable(e)}}isEditable(){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].isEditable()}registerUpdateListener(e){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerUpdateListener(e)}registerEditableListener(e){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerEditableListener(e)}registerCommand(e,t,s){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerCommand(e,t,s)}dispatchCommand(e,t){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].dispatchCommand(e,t)}registerMutationListener(e,t){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerMutationListener(e,t)}registerNodeTransform(e,t){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerNodeTransform(e,t)}registerTextContentListener(e){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerTextContentListener(e)}registerDecoratorListener(e){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerDecoratorListener(e)}registerRootListener(e){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerRootListener(e)}registerEventListener(e,t,s){const i=["mouseenter","mouseleave"].includes(t);const r=t=>{this.update((()=>{const r=L.$getNearestNodeFromDOMNode(t.target);if(r!==null){const a=i?r instanceof e?r:null:y.$findMatchingParent(r,(t=>t instanceof e));if(a!==null){s(t,a.getKey())}}}))};return this.registerRootListener(((e,s)=>{if(e){F.Event.bind(e,t,r,i)}if(s){F.Event.unbind(s,t,r,i)}}))}update(e,t){babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].update(e,t)}focus(e,t){if(!document.hasFocus()){window.focus()}babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].focus(F.Type.isFunction(e)?e:null,F.Type.isPlainObject(t)?t:{defaultSelection:"rootStart"})}hasFocus(){return this.getRootElement().contains(document.activeElement)}blur(){babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].blur()}isComposing(){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].isComposing()}getRootElement(){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].getRootElement()}hasNodes(e){return babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].hasNodes(e)}getRootContainer(){return babelHelpers.classPrivateFieldLooseBase(this,bg)[bg].remember("root",(()=>{const e=[this.isEditable()?"--editable":"--read-only"];return F.Tag.render(tg||(tg=Qp`
				<div class="ui-text-editor ${0}">
					${0}
				</div>
			`),e.join(" "),this.getInnerContainer())}))}getInnerContainer(){return babelHelpers.classPrivateFieldLooseBase(this,bg)[bg].remember("inner",(()=>F.Tag.render(sg||(sg=Qp`
				<div class="ui-text-editor-inner">
					${0}
					${0}
					${0}
					${0}
				</div>
			`),this.getHeaderContainer(),this.getToolbarContainer(),this.getScrollerContainer(),this.getFooterContainer())))}getToolbarContainer(){return babelHelpers.classPrivateFieldLooseBase(this,bg)[bg].remember("toolbar",(()=>F.Tag.render(ig||(ig=Qp`
				<div class="ui-text-editor-toolbar" tabindex="-1"></div>
			`))))}getScrollerContainer(){return babelHelpers.classPrivateFieldLooseBase(this,bg)[bg].remember("scroller",(()=>F.Tag.render(rg||(rg=Qp`
				<div class="ui-text-editor-scroller">
					${0}
				</div>
			`),this.getEditableContainer())))}getEditableContainer(){return babelHelpers.classPrivateFieldLooseBase(this,bg)[bg].remember("editable",(()=>F.Tag.render(ag||(ag=Qp`
				<div 
					class="ui-text-editor-editable" 
					contenteditable="${0}" 
					spellcheck="true"
				></div>
			`),this.isEditable()?"true":"false")))}getFooterContainer(){return babelHelpers.classPrivateFieldLooseBase(this,bg)[bg].remember("footer",(()=>F.Tag.render(og||(og=Qp`
				<div class="ui-text-editor-slot ui-text-editor-footer" tabindex="-1"></div>
			`))))}getHeaderContainer(){return babelHelpers.classPrivateFieldLooseBase(this,bg)[bg].remember("header",(()=>F.Tag.render(lg||(lg=Qp`
				<div class="ui-text-editor-slot ui-text-editor-header" tabindex="-1"></div>
			`))))}renderTo(e,t=false){if(!F.Type.isElementNode(e)){return}if(!this.isRendered()){if(F.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("content"))){this.setText(babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("content"))}else{babelHelpers.classPrivateFieldLooseBase(this,xg)[xg](babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("editorState"))}}if(t){F.Dom.replace(e,this.getRootContainer())}else{F.Dom.append(this.getRootContainer(),e)}babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].setRootElement(this.getEditableContainer());if(this.hasAutoFocus()){this.focus(null,{defaultSelection:"rootStart"})}if(!babelHelpers.classPrivateFieldLooseBase(this,Rg)[Rg]){babelHelpers.classPrivateFieldLooseBase(this,Dg)[Dg]=new ResizeObserver((()=>{this.emit("onResize");this.dispatchCommand(H,{context:"resize"})}));babelHelpers.classPrivateFieldLooseBase(this,Dg)[Dg].observe(this.getScrollerContainer())}babelHelpers.classPrivateFieldLooseBase(this,Rg)[Rg]=true}isRendered(){return babelHelpers.classPrivateFieldLooseBase(this,Rg)[Rg]}highlightSelection(){this.getEditorState().read((()=>{const e=L.$getSelection();if(!L.$isRangeSelection(e)||e.isCollapsed()){return}const t=e.anchor;const s=e.focus;const i=d.createDOMRange(babelHelpers.classPrivateFieldLooseBase(this,cg)[cg],t.getNode(),t.offset,s.getNode(),s.offset);if(i!==null){const e=this.getScrollerContainer();const t=e.getBoundingClientRect();const s=d.createRectsFromDOMRange(babelHelpers.classPrivateFieldLooseBase(this,cg)[cg],i);const r=s.length;babelHelpers.classPrivateFieldLooseBase(this,Bg)[Bg].innerHTML="";for(let i=0;i<r;i++){const r=s[i];const a=F.Tag.render(ng||(ng=Qp`<span class="ui-text-editor-selection-part"></span>`));const o=r.top-t.top+e.scrollTop;const l=r.left-t.left+e.scrollLeft;F.Dom.style(a,{top:`${o}px`,left:`${l}px`,height:`${r.height}px`,width:`${r.width}px`});F.Dom.append(a,babelHelpers.classPrivateFieldLooseBase(this,Bg)[Bg])}F.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Bg)[Bg],this.getScrollerContainer())}}))}resetHighlightSelection(){F.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,Bg)[Bg])}destroy(){if(babelHelpers.classPrivateFieldLooseBase(this,Sg)[Sg]){return}babelHelpers.classPrivateFieldLooseBase(this,Sg)[Sg]=true;this.emit("onDestroy");for(const[,e]of babelHelpers.classPrivateFieldLooseBase(this,pg)[pg]){e.destroy()}babelHelpers.classPrivateFieldLooseBase(this,Hg)[Hg]();if(this.isRendered()){babelHelpers.classPrivateFieldLooseBase(this,Dg)[Dg].disconnect();this.setRootElement(null);F.Dom.remove(this.getRootContainer())}babelHelpers.classPrivateFieldLooseBase(this,Dg)[Dg]=null;babelHelpers.classPrivateFieldLooseBase(this,pg)[pg]=null;babelHelpers.classPrivateFieldLooseBase(this,cg)[cg]=null;this.$refs=null;babelHelpers.classPrivateFieldLooseBase(this,fg)[fg]=null;babelHelpers.classPrivateFieldLooseBase(this,Pg)[Pg]=null;babelHelpers.classPrivateFieldLooseBase(this,mg)[mg]=null;babelHelpers.classPrivateFieldLooseBase(this,yg)[yg]=null;babelHelpers.classPrivateFieldLooseBase(this,Fg)[Fg]=null;Object.setPrototypeOf(this,null)}}function Xg(e,t){if(F.Type.isNil(e)){babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].update((()=>{const e=L.$getRoot();if(e.isEmpty()){const t=L.$createParagraphNode();e.append(t)}}),t)}else if(F.Type.isPlainObject(e)||F.Type.isStringFilled(e)){const t=babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].parseEditorState(e);babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].setEditorState(t)}else if(F.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].update((()=>{const t=L.$getRoot();if(t.isEmpty()){e(babelHelpers.classPrivateFieldLooseBase(this,cg)[cg])}}),t)}}function Gg(e){const t=[];e.forEach((e=>{if(e.useDecoratorComponent){const s=this.registerMutationListener(e,((e,t)=>{for(const[t,s]of e){if(s==="destroyed"){const e=babelHelpers.classPrivateFieldLooseBase(this,Fg)[Fg].get(t);if(e){e.destroy()}babelHelpers.classPrivateFieldLooseBase(this,Fg)[Fg].delete(t)}else{babelHelpers.classPrivateFieldLooseBase(this,yg)[yg].add(t)}}}));t.push(s)}}));const s=babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].registerDecoratorListener((e=>{babelHelpers.classPrivateFieldLooseBase(this,yg)[yg].forEach((t=>{const s=e[t];const{componentClass:i,options:r}=s;const a=babelHelpers.classPrivateFieldLooseBase(this,Fg)[Fg].get(t);const o=babelHelpers.classPrivateFieldLooseBase(this,cg)[cg].getElementByKey(t);if(o!=null&&o.innerHTML&&a){a.update(r)}else if(o){babelHelpers.classPrivateFieldLooseBase(this,Fg)[Fg].set(t,new i({textEditor:this,target:o,nodeKey:t,options:r}))}}));babelHelpers.classPrivateFieldLooseBase(this,yg)[yg].clear()}));t.push(s);return y.mergeRegister(...t)}function Vg(){return y.mergeRegister(this.registerCommand(L.FOCUS_COMMAND,(()=>{if(this.isCollapsingModeEnabled()&&babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.COLLAPSED&&this.isEmpty(false)){this.expand();return true}this.emit("onFocus");return false}),L.COMMAND_PRIORITY_CRITICAL),this.registerCommand(L.BLUR_COMMAND,(e=>{if(this.isCollapsingModeEnabled()&&(babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.COLLAPSING||babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.EXPANDING)){return true}this.emit("onBlur");return false}),L.COMMAND_PRIORITY_CRITICAL),this.registerUpdateListener((({dirtyElements:e,dirtyLeaves:t,prevEditorState:s,tags:i})=>{const r=this.isComposing();const a=t.size>0||e.size>0;if(r||!a){return}const o=s.isEmpty();if(babelHelpers.classPrivateFieldLooseBase(this,ug)[ug].get("collapsingMode")===true){if(o){babelHelpers.classPrivateFieldLooseBase(this,Ug)[Ug]()}else if(this.isCollapsed()&&!this.isEmpty()){this.expand(false)}}if(!o&&i.has("history-merge")){return}this.emit("onChange",{isInitialChange:o,tags:i});const l=this.isEmpty();if(babelHelpers.classPrivateFieldLooseBase(this,Ig)[Ig]!==l){babelHelpers.classPrivateFieldLooseBase(this,Ig)[Ig]=l;this.emit("onEmptyContentToggle",{isEmpty:l,isInitialChange:o})}})),this.registerCommand(L.KEY_ENTER_COMMAND,(e=>{const{code:t,ctrlKey:s,metaKey:i}=e;if(F.Browser.isMac()&&i||s){this.emit("onMetaEnter");return true}if(t==="Escape"){this.emit("onEscape");return true}return false}),L.COMMAND_PRIORITY_LOW),this.registerEditableListener((e=>{this.getEditableContainer().contentEditable=e;if(e){F.Dom.removeClass(this.getRootContainer(),"--read-only");F.Dom.addClass(this.getRootContainer(),"--editable")}else{F.Dom.removeClass(this.getRootContainer(),"--editable");F.Dom.addClass(this.getRootContainer(),"--read-only")}this.emit("onEditable",{isEditable:e})})))}function Jg(e){const t=Kn(e.map((e=>e.getName())).sort().join("-"));return String(t)}function qg(){const e=new Map;for(const[,t]of babelHelpers.classPrivateFieldLooseBase(this,pg)[pg]){const s=t.importBBCode();if(s!==null){Object.keys(s).forEach((t=>{let i=e.get(t);if(i===undefined){i=[];e.set(t,i)}i.push(s[t])}))}}return e}function Qg(){const e=new Map;for(const[,t]of babelHelpers.classPrivateFieldLooseBase(this,pg)[pg]){const s=t.exportBBCode();if(s!==null){Object.keys(s).forEach((t=>{if(F.Type.isFunction(s[t])){e.set(t,s[t])}}))}}return e}function Zg(){const e=this.getPlugin("File");const t=e!=null&&e.isEnabled()?e.getMode():"none";return new n.DefaultBBCodeScheme({fileTag:t})}function ev(){babelHelpers.classPrivateFieldLooseBase(this,Eg)[Eg]=true;if(this.isEmpty()){babelHelpers.classPrivateFieldLooseBase(this,Wg)[Wg]("hide",false,true)}else{this.expand(false)}}function tv(e="hide",t=true,s=false){if(!this.isCollapsingModeEnabled()){return}const i=babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.COLLAPSED||babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.COLLAPSING;const r=babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.EXPANDED||babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.EXPANDING;if(e==="hide"&&i||e==="show"&&r){return}if(t===false){if(i){babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]=dg.EXPANDED;F.Dom.removeClass(this.getRootContainer(),"--collapsed");this.emit("onCollapsingToggle",{isOpen:true});this.focus()}else{babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]=dg.COLLAPSED;F.Dom.addClass(this.getRootContainer(),"--collapsed");this.emit("onCollapsingToggle",{isOpen:false});this.clear();this.clearHistory();if(!s){this.blur()}}return}F.Event.unbind(this.getRootContainer(),"transitionend",babelHelpers.classPrivateFieldLooseBase(this,_g)[_g]);if(i){babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]=dg.EXPANDING;this.blur();const e=this.getRootContainer().offsetHeight;F.Dom.removeClass(this.getRootContainer(),["--collapsed","--collapsing"]);F.Dom.style(this.getRootContainer(),{height:`${e}px`,overflow:"hidden"});F.Dom.style(this.getInnerContainer(),{opacity:0});requestAnimationFrame((()=>{F.Dom.addClass(this.getRootContainer(),"--expanding");F.Dom.style(this.getRootContainer(),{height:`${this.getRootContainer().scrollHeight}px`});F.Dom.style(this.getInnerContainer(),{opacity:1});this.emit("onCollapsingToggle",{isOpen:true})}))}else{babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]=dg.COLLAPSING;const e=this.getRootContainer().offsetHeight;F.Dom.removeClass(this.getRootContainer(),["--expanding"]);F.Dom.style(this.getRootContainer(),{height:`${e}px`,overflow:"hidden"});F.Dom.style(this.getInnerContainer(),{opacity:1});this.blur();const t=this.getParagraphHeight();requestAnimationFrame((()=>{F.Dom.addClass(this.getRootContainer(),"--collapsing");F.Dom.style(this.getRootContainer(),{height:`${t}px`});F.Dom.style(this.getInnerContainer(),{opacity:0});this.emit("onCollapsingToggle",{isOpen:false})}))}F.Event.bind(this.getRootContainer(),"transitionend",babelHelpers.classPrivateFieldLooseBase(this,_g)[_g])}function sv(){F.Event.unbind(this.getRootContainer(),"transitionend",babelHelpers.classPrivateFieldLooseBase(this,_g)[_g]);F.Dom.style(this.getRootContainer(),{height:null,overflow:null});F.Dom.style(this.getInnerContainer(),{opacity:null});F.Dom.removeClass(this.getRootContainer(),["--expanding","--collapsing"]);if(babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]===dg.COLLAPSING){F.Dom.addClass(this.getRootContainer(),"--collapsed");babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]=dg.COLLAPSED;this.clear();this.clearHistory();this.blur()}else{this.focus();babelHelpers.classPrivateFieldLooseBase(this,Ng)[Ng]=dg.EXPANDED}}const iv={name:"TextEditorComponent",props:{editorOptions:{type:Object},editorInstance:{type:zg,default:null},events:{type:Object,default:{}},editable:{type:Boolean,default:null}},setup(){return{editorClass:zg}},provide(){return{editor:this.editor}},beforeCreate(){if(this.editorInstance===null){this.hasOwnEditor=true;const e=this.editorClass;this.editor=new e(this.editorOptions)}else{this.hasOwnEditor=false;this.editor=this.editorInstance}if(F.Type.isPlainObject(this.events)){for(const[e,t]of Object.entries(this.events)){this.editor.subscribe(e,t)}}},computed:{headerContainer(){return this.editor.getHeaderContainer()},footerContainer(){return this.editor.getFooterContainer()}},watch:{editable(e){this.editor.setEditable(e)}},mounted(){this.editor.renderTo(this.$refs.container,true)},unmounted(){if(this.hasOwnEditor){this.editor.destroy();this.editor=null}},template:`\n\t\t<div ref="container"></div>\n\t\t<Teleport :to="headerContainer">\n\t\t\t<slot name="header"></slot>\n\t\t</Teleport>\n\t\t<Teleport :to="footerContainer">\n\t\t\t<slot name="footer"></slot>\n\t\t</Teleport>\n\t`};class rv extends zg{static getDefaultOptions(){return{plugins:["RichText","Paragraph","Clipboard","Bold","Underline","Italic","Strikethrough","TabIndent","List","Mention","Link","AutoLink","Image","Copilot","History","BlockToolbar","FloatingToolbar","Toolbar","Placeholder","File"],toolbar:["bold","italic","underline","strikethrough","|","numbered-list","bulleted-list","|","link","copilot"],newLineMode:N.MIXED}}}const av={name:"BasicEditorComponent",extends:iv,setup(){return{editorClass:rv}}};const ov={Paragraph:St,AutoLink:oh,BlockToolbar:Ru,Bold:ud,Code:Cs,FloatingToolbar:Tp,History:Yb,Image:Ka,Italic:fd,Link:wc,List:Fh,Mention:sl,Quote:Re,Strikethrough:Hd,TabIndent:hh,Toolbar:Ip,Underline:Td,Video:Fn,Spoiler:gt,Smiley:Ll,Table:Gh,Hashtag:tb,File:Tr,Copilot:jb};const lv={...T};const nv={..._};const dv={generateContent:wn};e.TextEditor=zg;e.BasicEditor=rv;e.TextEditorComponent=iv;e.BasicEditorComponent=av;e.BasePlugin=ie;e.Button=ge;e.Plugins=ov;e.Commands=lv;e.Constants=nv;e.Debug=dv})(this.BX.UI.TextEditor=this.BX.UI.TextEditor||{},BX.UI.CodeParser,BX.UI.BBCode,BX.UI.TextEditor,BX.UI.Lexical.Clipboard,BX.UI.Smiley,BX.UI.VideoService,BX.Collections,BX.UI.BBCode,BX.UI.Lexical.Selection,BX.UI.Lexical.RichText,BX.UI.Lexical.Table,BX.Event,BX.UI.Lexical.History,BX.Main,BX.Cache,BX,BX.UI.Lexical.List,BX.UI.Lexical.Link,BX.UI.Lexical.Text,BX.UI.Lexical.Core,BX.UI.Lexical.Utils,BX);
//# sourceMappingURL=text-editor.bundle.map.js