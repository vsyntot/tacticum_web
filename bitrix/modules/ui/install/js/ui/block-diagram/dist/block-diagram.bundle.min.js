this.BX=this.BX||{};(function(t,e,o,n,a,s){"use strict";function l(){return{blockDiagramRef:null,blockDiagramTop:0,blockDiagramLeft:0,cursorType:"default",isResizing:false,isDisabled:false,blocks:[],connections:[],portsElMap:s.markRaw(new Map),portsRectMap:{},newConnection:null,isValidNewConnection:true,movingBlock:null,movingConnections:[],resizingBlock:null,canvasRef:null,transformLayoutRef:null,canvasInstance:null,canvasWidth:0,canvasHeight:0,transformX:0,transformY:0,viewportX:0,viewportY:0,zoom:1,minZoom:.2,maxZoom:4,contextMenuLayerRef:null,targetContainerRef:null,isOpenContextMenu:false,contextMenuInstance:null,positionContextMenu:{top:0,left:0},historyCurrentState:s.markRaw({blocks:[],connections:[]}),headSnapshot:null,tailSnapshot:null,currentSnapshot:null,maxCountSnapshots:20,snapshotHandler:null,revertHandler:null,highlitedBlockIds:[],animationQueue:null,currentAnimationItem:null,isPauseAnimation:false,isStopAnimation:false}}const i=46;const r=14;const c=5;const u={CHANGED_BLOCKS:"changedBlocks",CHANGED_CONNECTIONS:"changedConnections",START_DRAG_BLOCK:"startDragBlock",MOVE_DRAG_BLOCK:"moveDragBlock",END_DRAG_BLOCK:"endDragBlock",ADD_BLOCK:"addBlock",UPDATE_BLOCK:"updateBlock",DELETE_BLOCK:"deleteBlock",CREATE_CONNECTION:"createConnection",DELETE_CONNECTION:"deleteConnection",BLOCK_TRANSITION_START:"blockTransitionStart",BLOCK_TRANSITION_END:"blockTransitionEnd",CONNECTION_TRANSITION_START:"connectionTransitionStart",CONNECTION_TRANSITION_END:"connectionTransitionEnd",DROP_NEW_BLOCK:"dropNewBlock"};const d={SIMPLE:"simple",TRIGGER:"trigger",COMPLEX:"complex"};const b="default";const p="default";const v={TOP:"top",BOTTOM:"bottom",RIGHT:"right",LEFT:"left"};const m={BLOCK:"block",CONNECTION:"connection",REMOVE_BLOCK:"remove_block",REMOVE_CONNECTION:"remove_connection"};const h={EW_RESIZE:"ew-resize",NS_RESIZE:"ns-resize",NWSE_RESIZE:"nwse-resize",NESW_RESIZE:"nesw-resize"};const f={HIGHLITED:4,MOVABLE:3,STANDING:2,RESIZABLE:1};const g="x";const B="y";const P={[v.LEFT]:{x:-1,y:0},[v.RIGHT]:{x:1,y:0},[v.TOP]:{x:0,y:-1},[v.BOTTOM]:{x:0,y:1}};const y={VERTICAL:"vertical",HORIZONTAL:"horizontal"};function k(t,e,o=y.VERTICAL){const n=(t.x+e.x)/2;const a=(t.y+e.y)/2;const[s,l]=V({sourceX:t.x,sourceY:t.y,targetX:e.x,targetY:e.y});return{path:o===y.HORIZONTAL?`M ${t.x} ${t.y} C ${n} ${t.y}, ${n} ${e.y}, ${e.x} ${e.y}`:`M ${t.x} ${t.y} C ${t.x} ${a}, ${e.x} ${a}, ${e.x} ${e.y}`,center:{x:s,y:l}}}function L(t,e,o){let n=Math.round((t.x-e.x)/e.zoom);let a=Math.round((t.y-e.y)/e.zoom);n-=Math.round(o.left/e.zoom);a-=Math.round(o.top/e.zoom);return{x:n,y:a}}function V({sourceX:t,sourceY:e,targetX:o,targetY:n}){const a=Math.abs(o-t)/2;const s=o<t?o+a:o-a;const l=Math.abs(n-e)/2;const i=n<e?n+l:n-l;return[s,i,a,l]}function H({source:t,sourcePosition:e=v.BOTTOM,target:o}){if(e===v.LEFT||e===v.RIGHT){return t.x<o.x?{x:1,y:0}:{x:-1,y:0}}return t.y<o.y?{x:0,y:1}:{x:0,y:-1}}function C(t,e){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function F({source:t,sourcePosition:e=v.BOTTOM,target:o,targetPosition:n=v.TOP,center:a,offset:s}){const l=P[e];const i=P[n];const r={x:t.x+l.x*s,y:t.y+l.y*s};const c={x:o.x+i.x*s,y:o.y+i.y*s};const u=H({source:r,sourcePosition:e,target:c});const d=u.x!==0?g:B;const b=u[d];let p=[];let m=0;let h=0;const f={x:0,y:0};const y={x:0,y:0};const[k,L,C,F]=V({sourceX:t.x,sourceY:t.y,targetX:o.x,targetY:o.y});if(l[d]*i[d]===-1){var x,S;m=(x=a.x)!=null?x:k;h=(S=a.y)!=null?S:L;const t=[{x:m,y:r.y},{x:m,y:c.y}];const e=[{x:r.x,y:h},{x:c.x,y:h}];if(l[d]===b){p=d===g?t:e}else{p=d===g?e:t}}else{const a=[{x:r.x,y:c.y}];const u=[{x:c.x,y:r.y}];if(d===g){p=l.x===b?u:a}else{p=l.y===b?a:u}if(e===n){const e=Math.abs(t[d]-o[d]);if(e<=s){const n=Math.min(s-1,s-e);if(l[d]===b){const e=r[d]>t[d]?-1:1;f[d]=e*n}else{const t=c[d]>o[d]?-1:1;y[d]=t*n}}}if(e!==n){const t=d===g?B:g;const e=l[d]===i[t];const o=r[t]>c[t];const n=r[t]<c[t];const s=l[d]===1&&(!e&&o||e&&n)||l[d]!==1&&(!e&&n||e&&o);if(s){p=d===g?a:u}}const v={x:r.x+f.x,y:r.y+f.y};const P={x:c.x+y.x,y:c.y+y.y};const k=Math.max(Math.abs(v.x-p[0].x),Math.abs(P.x-p[0].x));const L=Math.max(Math.abs(v.y-p[0].y),Math.abs(P.y-p[0].y));if(k>=L){m=(v.x+P.x)/2;h=p[0].y}else{m=p[0].x;h=(v.y+P.y)/2}}const E=[t,{x:r.x+f.x,y:r.y+f.y},...p,{x:c.x+y.x,y:c.y+y.y},o];return{points:E,offsetX:C,offsetY:F,centerX:m,centerY:h}}function x(t,e,o,n){const a=Math.min(C(t,e)/2,C(e,o)/2,n);const{x:s,y:l}=e;if(t.x===s&&s===o.x||t.y===l&&l===o.y){return`L${s} ${l}`}if(t.y===l){const e=t.x<o.x?-1:1;const n=t.y<o.y?1:-1;return`L ${s+a*e},${l}Q ${s},${l} ${s},${l+a*n}`}const i=t.x<o.x?1:-1;const r=t.y<o.y?-1:1;return`L ${s},${l+a*r}Q ${s},${l} ${s+a*i},${l}`}function S(t){const{sourceX:e,sourceY:o,sourcePosition:n=v.BOTTOM,targetX:a,targetY:s,targetPosition:l=v.TOP,borderRadius:i=5,centerX:r,centerY:c,offset:u=20}=t;const{points:d,centerX:b,centerY:p}=F({source:{x:e,y:o},sourcePosition:n,target:{x:a,y:s},targetPosition:l,center:{x:r,y:c},offset:u});const m=d.reduce(((t,e,o)=>{let n="";if(o>0&&o<d.length-1){n=x(d[o-1],e,d[o+1],i)}else{n=`${o===0?"M":"L"}${e.x} ${e.y}`}t+=n;return t}),"");return{path:m,points:d,center:{x:b,y:p}}}const E=Object.freeze({REPLACE:"replace",PUSH:"push",UPDATE_BY_INDEX:"updateByIndex",DELETE_BY_INDEX:"deleteByIndex"});const w={[E.REPLACE]:({payload:t})=>[...t],[E.PUSH]:({source:t,payload:e})=>{const o=[...t];o.push(e);return o},[E.UPDATE_BY_INDEX]:({source:t,payload:e,index:o})=>{const n=[...t];n[o]={...n[o],...e};return n},[E.DELETE_BY_INDEX]:({source:t,index:e})=>{const o=[...t];o.splice(e,1);return o}};function I(t,e){return{commandType:t,...e}}function _(t){return I(E.REPLACE,{payload:t})}function M(t){return I(E.PUSH,{payload:t})}function T(t,e){return I(E.UPDATE_BY_INDEX,{index:t,payload:e})}function O(t){return I(E.DELETE_BY_INDEX,{index:t})}function D(t,e,o){const{commandType:n,payload:a,index:s}=e;const l=w[n]({source:t,payload:a,index:s});o(l)}function N(){const t=new Set;const e=e=>{if(a.Type.isFunction(e)&&!t.has(e)){t.add(e)}};const o=e=>{t.delete(e)};const n=(...e)=>{for(const o of t){o(...e)}};return{on:e,off:o,trigger:n}}function R(t){return`block:${t}`}function z(t){return`connection:${t}`}var A=1e-6;var j=typeof Float32Array!=="undefined"?Float32Array:Array;var K=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var t=0,e=arguments.length;while(e--){t+=arguments[e]*arguments[e]}return Math.sqrt(t)};function G(){var t=new j(9);if(j!=Float32Array){t[1]=0;t[2]=0;t[3]=0;t[5]=0;t[6]=0;t[7]=0}t[0]=1;t[4]=1;t[8]=1;return t}function $(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function X(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=1;t[5]=0;t[6]=0;t[7]=0;t[8]=1;return t}function Y(t,e){var o=e[0],n=e[1],a=e[2];var s=e[3],l=e[4],i=e[5];var r=e[6],c=e[7],u=e[8];var d=u*l-i*c;var b=-u*s+i*r;var p=c*s-l*r;var v=o*d+n*b+a*p;if(!v){return null}v=1/v;t[0]=d*v;t[1]=(-u*n+a*c)*v;t[2]=(i*n-a*l)*v;t[3]=b*v;t[4]=(u*o-a*r)*v;t[5]=(-i*o+a*s)*v;t[6]=p*v;t[7]=(-c*o+n*r)*v;t[8]=(l*o-n*s)*v;return t}function Z(t,e,o){var n=e[0],a=e[1],s=e[2];var l=e[3],i=e[4],r=e[5];var c=e[6],u=e[7],d=e[8];var b=o[0],p=o[1],v=o[2];var m=o[3],h=o[4],f=o[5];var g=o[6],B=o[7],P=o[8];t[0]=b*n+p*l+v*c;t[1]=b*a+p*i+v*u;t[2]=b*s+p*r+v*d;t[3]=m*n+h*l+f*c;t[4]=m*a+h*i+f*u;t[5]=m*s+h*r+f*d;t[6]=g*n+B*l+P*c;t[7]=g*a+B*i+P*u;t[8]=g*s+B*r+P*d;return t}function U(t,e,o){var n=e[0],a=e[1],s=e[2],l=e[3],i=e[4],r=e[5],c=e[6],u=e[7],d=e[8],b=o[0],p=o[1];t[0]=n;t[1]=a;t[2]=s;t[3]=l;t[4]=i;t[5]=r;t[6]=b*n+p*l+c;t[7]=b*a+p*i+u;t[8]=b*s+p*r+d;return t}function W(t,e,o){var n=e[0],a=e[1],s=e[2],l=e[3],i=e[4],r=e[5],c=e[6],u=e[7],d=e[8],b=Math.sin(o),p=Math.cos(o);t[0]=p*n+b*l;t[1]=p*a+b*i;t[2]=p*s+b*r;t[3]=p*l-b*n;t[4]=p*i-b*a;t[5]=p*r-b*s;t[6]=c;t[7]=u;t[8]=d;return t}function q(t,e,o){var n=o[0],a=o[1];t[0]=n*e[0];t[1]=n*e[1];t[2]=n*e[2];t[3]=a*e[3];t[4]=a*e[4];t[5]=a*e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Q(t,e,o){t[0]=2/e;t[1]=0;t[2]=0;t[3]=0;t[4]=-2/o;t[5]=0;t[6]=-1;t[7]=1;t[8]=1;return t}function J(){var t=new j(3);if(j!=Float32Array){t[0]=0;t[1]=0;t[2]=0}return t}function tt(t){var e=t[0];var o=t[1];var n=t[2];return Math.hypot(e,o,n)}function et(t,e,o){var n=new j(3);n[0]=t;n[1]=e;n[2]=o;return n}function ot(t,e){var o=e[0];var n=e[1];var a=e[2];var s=o*o+n*n+a*a;if(s>0){s=1/Math.sqrt(s)}t[0]=e[0]*s;t[1]=e[1]*s;t[2]=e[2]*s;return t}function nt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function at(t,e,o){var n=e[0],a=e[1],s=e[2];var l=o[0],i=o[1],r=o[2];t[0]=a*r-s*i;t[1]=s*l-n*r;t[2]=n*i-a*l;return t}var st=tt;var lt=function(){var t=J();return function(e,o,n,a,s,l){var i,r;if(!o){o=3}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(i=n;i<r;i+=o){t[0]=e[i];t[1]=e[i+1];t[2]=e[i+2];s(t,t,l);e[i]=t[0];e[i+1]=t[1];e[i+2]=t[2]}return e}}();function it(){var t=new j(4);if(j!=Float32Array){t[0]=0;t[1]=0;t[2]=0;t[3]=0}return t}function rt(t,e){var o=e[0];var n=e[1];var a=e[2];var s=e[3];var l=o*o+n*n+a*a+s*s;if(l>0){l=1/Math.sqrt(l)}t[0]=o*l;t[1]=n*l;t[2]=a*l;t[3]=s*l;return t}var ct=function(){var t=it();return function(e,o,n,a,s,l){var i,r;if(!o){o=4}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(i=n;i<r;i+=o){t[0]=e[i];t[1]=e[i+1];t[2]=e[i+2];t[3]=e[i+3];s(t,t,l);e[i]=t[0];e[i+1]=t[1];e[i+2]=t[2];e[i+3]=t[3]}return e}}();function ut(){var t=new j(4);if(j!=Float32Array){t[0]=0;t[1]=0;t[2]=0}t[3]=1;return t}function dt(t,e,o){o=o*.5;var n=Math.sin(o);t[0]=n*e[0];t[1]=n*e[1];t[2]=n*e[2];t[3]=Math.cos(o);return t}function bt(t,e,o,n){var a=e[0],s=e[1],l=e[2],i=e[3];var r=o[0],c=o[1],u=o[2],d=o[3];var b,p,v,m,h;p=a*r+s*c+l*u+i*d;if(p<0){p=-p;r=-r;c=-c;u=-u;d=-d}if(1-p>A){b=Math.acos(p);v=Math.sin(b);m=Math.sin((1-n)*b)/v;h=Math.sin(n*b)/v}else{m=1-n;h=n}t[0]=m*a+h*r;t[1]=m*s+h*c;t[2]=m*l+h*u;t[3]=m*i+h*d;return t}function pt(t,e){var o=e[0]+e[4]+e[8];var n;if(o>0){n=Math.sqrt(o+1);t[3]=.5*n;n=.5/n;t[0]=(e[5]-e[7])*n;t[1]=(e[6]-e[2])*n;t[2]=(e[1]-e[3])*n}else{var a=0;if(e[4]>e[0])a=1;if(e[8]>e[a*3+a])a=2;var s=(a+1)%3;var l=(a+2)%3;n=Math.sqrt(e[a*3+a]-e[s*3+s]-e[l*3+l]+1);t[a]=.5*n;n=.5/n;t[3]=(e[s*3+l]-e[l*3+s])*n;t[s]=(e[s*3+a]+e[a*3+s])*n;t[l]=(e[l*3+a]+e[a*3+l])*n}return t}var vt=rt;var mt=function(){var t=J();var e=et(1,0,0);var o=et(0,1,0);return function(n,a,s){var l=nt(a,s);if(l<-.999999){at(t,e,a);if(st(t)<1e-6)at(t,o,a);ot(t,t);dt(n,t,Math.PI);return n}else if(l>.999999){n[0]=0;n[1]=0;n[2]=0;n[3]=1;return n}else{at(t,a,s);n[0]=t[0];n[1]=t[1];n[2]=t[2];n[3]=1+l;return vt(n,n)}}}();var ht=function(){var t=ut();var e=ut();return function(o,n,a,s,l,i){bt(t,n,l,i);bt(e,a,s,i);bt(o,t,e,2*i*(1-i));return o}}();var ft=function(){var t=G();return function(e,o,n,a){t[0]=n[0];t[3]=n[1];t[6]=n[2];t[1]=a[0];t[4]=a[1];t[7]=a[2];t[2]=-o[0];t[5]=-o[1];t[8]=-o[2];return vt(e,pt(e,t))}}();function gt(){var t=new j(2);if(j!=Float32Array){t[0]=0;t[1]=0}return t}function Bt(t,e,o){var n=e[0],a=e[1];t[0]=o[0]*n+o[3]*a+o[6];t[1]=o[1]*n+o[4]*a+o[7];return t}var Pt=function(){var t=gt();return function(e,o,n,a,s,l){var i,r;if(!o){o=2}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(i=n;i<r;i+=o){t[0]=e[i];t[1]=e[i+1];s(t,t,l);e[i]=t[0];e[i+1]=t[1]}return e}}();var yt=babelHelpers.classPrivateFieldLooseKey("x");var kt=babelHelpers.classPrivateFieldLooseKey("y");var Lt=babelHelpers.classPrivateFieldLooseKey("rotation");var Vt=babelHelpers.classPrivateFieldLooseKey("zoom");var Ht=babelHelpers.classPrivateFieldLooseKey("width");var Ct=babelHelpers.classPrivateFieldLooseKey("height");var Ft=babelHelpers.classPrivateFieldLooseKey("matrix");var xt=babelHelpers.classPrivateFieldLooseKey("projectionMatrix");var St=babelHelpers.classPrivateFieldLooseKey("viewMatrix");var Et=babelHelpers.classPrivateFieldLooseKey("viewProjectionMatrix");var wt=babelHelpers.classPrivateFieldLooseKey("viewProjectionMatrixInv");var It=babelHelpers.classPrivateFieldLooseKey("changeCallback");var _t=babelHelpers.classPrivateFieldLooseKey("onChangedTransformParams");class Mt{constructor(t){Object.defineProperty(this,_t,{value:Tt});Object.defineProperty(this,yt,{writable:true,value:0});Object.defineProperty(this,kt,{writable:true,value:0});Object.defineProperty(this,Lt,{writable:true,value:0});Object.defineProperty(this,Vt,{writable:true,value:1});Object.defineProperty(this,Ht,{writable:true,value:0});Object.defineProperty(this,Ct,{writable:true,value:0});Object.defineProperty(this,Ft,{writable:true,value:G()});Object.defineProperty(this,xt,{writable:true,value:G()});Object.defineProperty(this,St,{writable:true,value:G()});Object.defineProperty(this,Et,{writable:true,value:G()});Object.defineProperty(this,wt,{writable:true,value:G()});Object.defineProperty(this,It,{writable:true,value:null});const{width:e,height:o,onChangeCallback:n}=t;babelHelpers.classPrivateFieldLooseBase(this,It)[It]=n;this.projection(e,o);this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]({width:e,height:o})}get projectionMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]}get viewMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,St)[St]}get viewProjectionMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]}get viewProjectionMatrixInv(){return babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]}get matrix(){return babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]}get zoom(){return babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]}set zoom(t){if(babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]!==t){babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=t;babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]({zoom:t});this.updateMatrix()}}get x(){return babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]}set x(t){if(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]!==t){babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]=t;babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]({x:t});this.updateMatrix()}}get y(){return babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]}set y(t){if(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]!==t){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=t;babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]({y:t});this.updateMatrix()}}get rotation(){return babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]}set rotation(t){if(babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]!==t){babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=t;this.updateMatrix()}}get width(){return babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]}get height(){return babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]}setChangeTransformCallback(t){babelHelpers.classPrivateFieldLooseBase(this,It)[It]=t}clone(t=null,e=null){const o=new Mt({width:t||babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht],height:e||babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],onChangeCallback:babelHelpers.classPrivateFieldLooseBase(this,It)[It]});babelHelpers.classPrivateFieldLooseBase(o,yt)[yt]=babelHelpers.classPrivateFieldLooseBase(this,yt)[yt];babelHelpers.classPrivateFieldLooseBase(o,kt)[kt]=babelHelpers.classPrivateFieldLooseBase(this,kt)[kt];babelHelpers.classPrivateFieldLooseBase(o,Vt)[Vt]=babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt];babelHelpers.classPrivateFieldLooseBase(o,Lt)[Lt]=babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt];o.updateMatrix();return o}projection(t,e){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]=t;babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=e;Q(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt],t,e);this.updateViewProjectionMatrix()}updateMatrix(){const t=1/babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt];X(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]);U(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],[babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]]);W(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]);q(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],[t,t]);Y(babelHelpers.classPrivateFieldLooseBase(this,St)[St],babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]);this.updateViewProjectionMatrix()}updateViewProjectionMatrix(){Z(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et],babelHelpers.classPrivateFieldLooseBase(this,xt)[xt],babelHelpers.classPrivateFieldLooseBase(this,St)[St]);Y(babelHelpers.classPrivateFieldLooseBase(this,wt)[wt],babelHelpers.classPrivateFieldLooseBase(this,Et)[Et])}createLandmark(t={}){return{zoom:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt],x:babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],y:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt],rotation:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],...t}}viewportToCanvas({x:t,y:e},o){const{width:n,height:a,viewProjectionMatrixInv:s}=o||this;const l=Bt(gt(),[t/n*2-1,(1-e/a)*2-1],s);return{x:l[0],y:l[1]}}applyLandmark(t){const{x:e,y:o,zoom:n,rotation:a,viewportX:s,viewportY:l}=t;const i=s||l;let r=0;let c=0;if(i){const t=this.viewportToCanvas({x:s,y:l});r=t.x;c=t.y}babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=n;babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=a;babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]=e;babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=o;this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]({x:babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],y:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]});if(i){const{x:t,y:e}=this.viewportToCanvas({x:s,y:l});babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]+=r-t;babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]+=c-e;this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]({x:babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],y:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]})}}}function Tt(t){babelHelpers.classPrivateFieldLooseBase(this,It)[It]({x:babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],y:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt],width:babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht],height:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],...t})}var Ot=babelHelpers.classPrivateFieldLooseKey("canvas");var Dt=babelHelpers.classPrivateFieldLooseKey("dpr");var Nt=babelHelpers.classPrivateFieldLooseKey("width");var Rt=babelHelpers.classPrivateFieldLooseKey("height");var zt=babelHelpers.classPrivateFieldLooseKey("minZoom");var At=babelHelpers.classPrivateFieldLooseKey("maxZoom");var jt=babelHelpers.classPrivateFieldLooseKey("camera");var Kt=babelHelpers.classPrivateFieldLooseKey("canvasStyleInstance");var Gt=babelHelpers.classPrivateFieldLooseKey("startInvertViewProjectionMatrix");var $t=babelHelpers.classPrivateFieldLooseKey("startCameraX");var Xt=babelHelpers.classPrivateFieldLooseKey("startCameraY");var Yt=babelHelpers.classPrivateFieldLooseKey("startPos");var Zt=babelHelpers.classPrivateFieldLooseKey("resizeObserver");var Ut=babelHelpers.classPrivateFieldLooseKey("initCanvas");var Wt=babelHelpers.classPrivateFieldLooseKey("initCamera");var qt=babelHelpers.classPrivateFieldLooseKey("initCanvasStyle");var Qt=babelHelpers.classPrivateFieldLooseKey("initResizeObserver");var Jt=babelHelpers.classPrivateFieldLooseKey("setCameraZoom");var te=babelHelpers.classPrivateFieldLooseKey("getClipSpaceMousePosition");class ee{constructor(t){Object.defineProperty(this,te,{value:ie});Object.defineProperty(this,Jt,{value:le});Object.defineProperty(this,Qt,{value:se});Object.defineProperty(this,qt,{value:ae});Object.defineProperty(this,Wt,{value:ne});Object.defineProperty(this,Ut,{value:oe});Object.defineProperty(this,Ot,{writable:true,value:null});Object.defineProperty(this,Dt,{writable:true,value:window.devicePixelRatio||1});Object.defineProperty(this,Nt,{writable:true,value:0});Object.defineProperty(this,Rt,{writable:true,value:0});Object.defineProperty(this,zt,{writable:true,value:.02});Object.defineProperty(this,At,{writable:true,value:4});Object.defineProperty(this,jt,{writable:true,value:null});Object.defineProperty(this,Kt,{writable:true,value:null});Object.defineProperty(this,Gt,{writable:true,value:G()});Object.defineProperty(this,$t,{writable:true,value:0});Object.defineProperty(this,Xt,{writable:true,value:0});Object.defineProperty(this,Yt,{writable:true,value:gt()});Object.defineProperty(this,Zt,{writable:true,value:null});this.transform=s.ref({x:0,y:0,zoom:0});const{canvas:e,canvasStyle:o,minZoom:n,maxZoom:a}=t;babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]=n;babelHelpers.classPrivateFieldLooseBase(this,At)[At]=a;babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](e);babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]();babelHelpers.classPrivateFieldLooseBase(this,qt)[qt](o);babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]()}get viewMatrix(){var t,e;return(t=(e=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt])==null?void 0:e.viewMatrix)!=null?t:[]}get camera(){return babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]}clientToViewport({x:t,y:e}){const{left:o,top:n}=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].getBoundingClientRect();return{x:t-o,y:e-n}}viewportToClient({x:t,y:e}){const{left:o,top:n}=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].getBoundingClientRect();return{x:t+o,y:e+n}}render(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt])==null?void 0:t.render({projectionMatrix:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].projectionMatrix,viewMatrix:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].viewMatrix,viewProjectionMatrixInv:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].viewProjectionMatrixInv,zoomScale:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom})}setCamera(t){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].createLandmark({...t}))}zoomIn(t){babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](t)}zoomOut(t){babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](t*-1)}setCameraZoomByWheel(t,e=0){const o=Math.max(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt],Math.min(babelHelpers.classPrivateFieldLooseBase(this,At)[At],(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom+e)*2**(t.deltaY*-.01)));const n=this.clientToViewport({x:t.clientX,y:t.clientY});babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].createLandmark({viewportX:n.x,viewportY:n.y,zoom:o}))}setCameraPositionByWheel(t){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].x+=t.deltaX/babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom;babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].y+=t.deltaY/babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom}setCameraPositionByMouseDown(t){$(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt],babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].viewProjectionMatrixInv);babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].x;babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].y;Bt(babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt],babelHelpers.classPrivateFieldLooseBase(this,te)[te](t),babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt])}setCameraPositionByMouseMove(t){const e=Bt(gt(),babelHelpers.classPrivateFieldLooseBase(this,te)[te](t),babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]);babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].x=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]+babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt][0]-e[0];babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].y=babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]+babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt][1]-e[1]}destroy(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt])==null?void 0:t.destroy();babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt].unobserve(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot])}}function oe(t){const{width:e,height:o}=t.getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=t;babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].width=e*babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt];babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].height=o*babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt];babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].width;babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].height}function ne(){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]=new Mt({width:babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]/babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt],height:babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]/babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt],onChangeCallback:({x:t,y:e,zoom:o})=>{this.transform.x=t;this.transform.y=e;this.transform.zoom=o}})}function ae(t){if(t){const e=t.instance;babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]=new e(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot],t.options)}}function se(){babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=new ResizeObserver((t=>{for(const e of t){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].clone(e.contentRect.width,e.contentRect.height)}}));babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt].observe(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot])}function le(t){const e=Number((babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom+t).toFixed(1));if(e<babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]||e>babelHelpers.classPrivateFieldLooseBase(this,At)[At]){return}babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].createLandmark({x:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].x,y:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].y,viewportX:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].width/2,viewportY:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].height/2,zoom:e}))}function ie(t){const{left:e,top:o}=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].getBoundingClientRect();const n=t.clientX-e;const a=t.clientY-o;const s=n/babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].clientWidth||babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].width/babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt];const l=a/babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].clientHeight||babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].height/babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt];const i=s*2-1;const r=l*-2+1;return[i,r]}const re=`\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  attribute vec2 a_Position;\n  uniform mat3 u_ViewProjectionInvMatrix;\n  varying vec2 v_Position;\n\n  vec2 project_clipspace(vec2 p) {\n  \treturn (u_ViewProjectionInvMatrix * vec3(p, 1)).xy;\n  }\n\n  void main() {\n  \tv_Position = project_clipspace(a_Position);\n  \tgl_Position = vec4(a_Position, 0, 1);\n  }\n`;const ce=`\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  uniform vec4 u_BackgroundColor;\n  uniform vec4 u_GridColor;\n  uniform float u_GridSize;\n  uniform float u_ZoomStep;\n  uniform float u_ZoomScale;\n  varying vec2 v_Position;\n\n  vec4 render_grid(vec2 coord) {\n  \tfloat alpha = 0.0;\n  \tfloat gridSize1 = u_GridSize;\n  \tfloat gridSize2 = gridSize1 / 4.0;\n\n  \tvec2 grid1 = abs(fract(coord / gridSize1 - 0.5) - 0.5) / fwidth(coord) * gridSize1 / 0.95;\n  \tvec2 grid2 = abs(fract(coord / gridSize2 - 0.5) - 0.5) / fwidth(coord) * gridSize2 / 0.75;\n  \tfloat v1 = 1.0 - min(min(grid1.x, grid1.y), 1.0);\n  \tfloat v2 = 1.0 - min(min(grid2.x, grid2.y), 1.0);\n\n  \tif (v1 > 0.0) {\n  \t\talpha = clamp(v1, 0.0, 0.222);\n  \t} else {\n  \t\talpha = v2 * clamp(u_ZoomScale / u_ZoomStep, 0.0, 1.0);\n  \t}\n\n  \treturn mix(u_BackgroundColor, u_GridColor, alpha);\n  }\n\n  void main() {\n  \tgl_FragColor = render_grid(v_Position);\n  }\n`;function ue(t,e,o){const n=t.createShader(o);t.shaderSource(n,e);t.compileShader(n);const a=t.getShaderParameter(n,t.COMPILE_STATUS);if(!a){throw new Error(`Error shader compilation: ${t.getShaderInfoLog(n)}`)}return n}function de(t,e,o){const n=t.createProgram();t.attachShader(n,e);t.attachShader(n,o);t.linkProgram(n);const a=t.getProgramParameter(n,t.LINK_STATUS);if(!a){throw new Error(`Error initializing shader program: ${t.getProgramInfoLog(n)}`)}return n}function be(t,e,o,n){const a=o||t.ARRAY_BUFFER;const s=t.createBuffer();t.bindBuffer(a,s);t.bufferData(a,e,n||t.STATIC_DRAW);return s}function pe(t){const e=t.replace(/^#/,"");const o=parseInt(e.slice(0,2),16);const n=parseInt(e.slice(2,4),16);const a=parseInt(e.slice(4,6),16);return[o/255,n/255,a/255]}var ve=babelHelpers.classPrivateFieldLooseKey("gl");var me=babelHelpers.classPrivateFieldLooseKey("program");var he=babelHelpers.classPrivateFieldLooseKey("positionAttributeLocation");var fe=babelHelpers.classPrivateFieldLooseKey("vertexShader");var ge=babelHelpers.classPrivateFieldLooseKey("fragmentShader");var Be=babelHelpers.classPrivateFieldLooseKey("projectionMatrixLink");var Pe=babelHelpers.classPrivateFieldLooseKey("viewMatrixLink");var ye=babelHelpers.classPrivateFieldLooseKey("viewProjectionInvMatrixLink");var ke=babelHelpers.classPrivateFieldLooseKey("backgroundColorLink");var Le=babelHelpers.classPrivateFieldLooseKey("backgroundColor");var Ve=babelHelpers.classPrivateFieldLooseKey("gridColorLink");var He=babelHelpers.classPrivateFieldLooseKey("gridColor");var Ce=babelHelpers.classPrivateFieldLooseKey("gridColorAlpha");var Fe=babelHelpers.classPrivateFieldLooseKey("gridSizeLink");var xe=babelHelpers.classPrivateFieldLooseKey("gridSize");var Se=babelHelpers.classPrivateFieldLooseKey("zoomScaleLink");var Ee=babelHelpers.classPrivateFieldLooseKey("gridPosition");var we=babelHelpers.classPrivateFieldLooseKey("gridPositionBuffer");var Ie=babelHelpers.classPrivateFieldLooseKey("zoomStepLink");var _e=babelHelpers.classPrivateFieldLooseKey("zoomStep");var Me=babelHelpers.classPrivateFieldLooseKey("zoomSteps");var Te=babelHelpers.classPrivateFieldLooseKey("initGrid");var Oe=babelHelpers.classPrivateFieldLooseKey("getPreparedZoomSteps");var De=babelHelpers.classPrivateFieldLooseKey("initParams");var Ne=babelHelpers.classPrivateFieldLooseKey("getParamsByZoom");class Re{constructor(t,e){Object.defineProperty(this,Ne,{value:Ke});Object.defineProperty(this,De,{value:je});Object.defineProperty(this,Oe,{value:Ae});Object.defineProperty(this,Te,{value:ze});Object.defineProperty(this,ve,{writable:true,value:void 0});Object.defineProperty(this,me,{writable:true,value:null});Object.defineProperty(this,he,{writable:true,value:null});Object.defineProperty(this,fe,{writable:true,value:null});Object.defineProperty(this,ge,{writable:true,value:null});Object.defineProperty(this,Be,{writable:true,value:null});Object.defineProperty(this,Pe,{writable:true,value:null});Object.defineProperty(this,ye,{writable:true,value:null});Object.defineProperty(this,ke,{writable:true,value:null});Object.defineProperty(this,Le,{writable:true,value:null});Object.defineProperty(this,Ve,{writable:true,value:null});Object.defineProperty(this,He,{writable:true,value:null});Object.defineProperty(this,Ce,{writable:true,value:null});Object.defineProperty(this,Fe,{writable:true,value:null});Object.defineProperty(this,xe,{writable:true,value:null});Object.defineProperty(this,Se,{writable:true,value:null});Object.defineProperty(this,Ee,{writable:true,value:[-1,-1,-1,1,1,-1,1,1]});Object.defineProperty(this,we,{writable:true,value:null});Object.defineProperty(this,Ie,{writable:true,value:null});Object.defineProperty(this,_e,{writable:true,value:4});Object.defineProperty(this,Me,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,De)[De](e);babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](t)}render({projectionMatrix:t,viewMatrix:e,viewProjectionMatrixInv:o,zoomScale:n}){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].clearColor(1,1,1,1);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].clear(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].COLOR_BUFFER_BIT);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].useProgram(babelHelpers.classPrivateFieldLooseBase(this,me)[me]);const{gridColor:a,zoomStep:s,size:l}=babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](n);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,Be)[Be],false,t);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe],false,e);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,ye)[ye],false,o);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform4f(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke],...babelHelpers.classPrivateFieldLooseBase(this,Le)[Le],1);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform4f(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],...a,1);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe],l);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie],s);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,Se)[Se],n);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].enableVertexAttribArray(babelHelpers.classPrivateFieldLooseBase(this,he)[he]);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bindBuffer(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].ARRAY_BUFFER,babelHelpers.classPrivateFieldLooseBase(this,we)[we]);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].vertexAttribPointer(babelHelpers.classPrivateFieldLooseBase(this,he)[he],2,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].FLOAT,false,0,0);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].drawArrays(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].TRIANGLE_STRIP,0,4)}destroy(){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].deleteProgram(babelHelpers.classPrivateFieldLooseBase(this,me)[me]);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].deleteShader(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].deleteShader(babelHelpers.classPrivateFieldLooseBase(this,ge)[ge])}}function ze(t){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=t.getContext("webgl");babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getExtension("OES_standard_derivatives");babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].viewport(0,0,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].canvas.width,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].canvas.height);babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]=ue(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],re,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].VERTEX_SHADER);babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=ue(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],ce,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].FRAGMENT_SHADER);babelHelpers.classPrivateFieldLooseBase(this,me)[me]=de(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]);babelHelpers.classPrivateFieldLooseBase(this,he)[he]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getAttribLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"a_Position");babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ProjectionMatrix");babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ViewMatrix");babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ViewProjectionInvMatrix");babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_BackgroundColor");babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_GridColor");babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_GridSize");babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ZoomStep");babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ZoomScale");babelHelpers.classPrivateFieldLooseBase(this,we)[we]=be(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],new Float32Array(babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]))}function Ae(t){return t.sort(((t,e)=>e.zoomStep-t.zoomStep)).map((t=>({zoomStep:babelHelpers.classPrivateFieldLooseBase(this,_e)[_e],...t,size:"size"in t?t.size:babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],gridColor:"gridColor"in t?pe(t.gridColor):babelHelpers.classPrivateFieldLooseBase(this,He)[He]})))}function je(t){const{size:e,gridColor:o,gridColorAlpha:n,backgroundColor:a,zoomStep:s,zoomSteps:l}=t;babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=e;babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]=s;babelHelpers.classPrivateFieldLooseBase(this,He)[He]=new Float32Array(pe(o));babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=n;babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]=new Float32Array(pe(a));babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]=babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe](l)}function Ke(t){for(const e of babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]){if(e.zoom<=t){return e}}return{gridColor:babelHelpers.classPrivateFieldLooseBase(this,He)[He],size:babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],zoomStep:babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]}}function Ge(t={}){const e=t=>s.markRaw({blocks:s.markRaw(JSON.parse(JSON.stringify(t.blocks))),connections:s.markRaw(JSON.parse(JSON.stringify(t.connections)))});const o=t=>{u.changedBlocks.trigger(_(t.blocks));u.changedConnections.trigger(_(t.connections))};const n={blocks:[],connections:[]};const a=Ze();const{headSnapshot:l,tailSnapshot:i,currentSnapshot:r,maxCountSnapshots:c,hooks:u,snapshotHandler:d,revertHandler:b,setHistoryHandlers:p,historyCurrentState:v}=a;const{snapshotHandler:m=null,revertHandler:h=null,emptyHistorySnapshot:f=n,maxCount:g}=t;y({newSnapshotHandler:m,newRevertHandler:h});c.value=g||s.toValue(c);const B=s.computed((()=>s.toValue(r)&&s.toValue(r).next!==null));const P=s.computed((()=>s.toValue(r)&&s.toValue(r).prev!==null));function y(t){var n,a,l,i;const r={snapshotHandler:(n=(a=t.snapshotHandler)!=null?a:s.toValue(d))!=null?n:e,revertHandler:(l=(i=t.revertHandler)!=null?i:s.toValue(b))!=null?l:o};p(r)}function k(){let t=0;let e=s.toValue(l);while(e){e=e.next;t+=1}return t}function L(t={}){var e;const{snapshotHandler:o=null,revertHandler:n=null,emptySnapshot:a=null}=t;const u=o||s.toValue(d);const p=n||s.toValue(b);const m=a||f;const h=s.markRaw({snapshot:u(s.toValue(v)),revertHandler:p,emptySnapshot:m,next:null,prev:i.value});if(s.toValue(r)&&((e=s.toValue(r))==null?void 0:e.next)!==null){r.value.next=h;h.prev=r.value;i.value.prev=null;i.value.next=null;i.value=h}else if(s.toValue(l)===null){l.value=h;i.value=h}else{i.value.next=h;i.value=h}r.value=h;if(k()<=s.toValue(c)+1){return}const g=l.value;l.value=g.next;l.value.prev=null;g.next=null}async function V({revertHandler:t,snapshot:e,emptySnapshot:o}){t(o);await s.nextTick();t(e)}async function H(){if(s.toValue(r)===null||s.toValue(r).next===null){return}await V(s.toValue(r).next);r.value=s.toValue(r).next}async function C(){if(s.toValue(r)===null||s.toValue(r).prev===null){return}await V(s.toValue(r).prev);r.value=s.toValue(r).prev}function F(){l.value=null;i.value=null;r.value=null}return{hasNext:B,hasPrev:P,setHandlers:y,makeSnapshot:()=>s.nextTick((()=>L())),next:H,prev:C,clear:F,commonSnapshotHandler:e,commonRevertHandler:o}}function $e({state:t,getters:e,hooks:o}){function n(e){t.blocks=s.toValue(e.blocks);t.connections=s.toValue(e.connections);t.transformX=e.transform.x;t.transformY=e.transfrom.y;t.zoom=s.toValue(e.zoom)}function l(e){const{x:o=0,y:n=0,zoom:a=1,viewportX:s=0,viewportY:l=0}=e;t.transformX=o;t.transformY=n;t.viewportX=s;t.viewportY=l;t.zoom=a}const u=e=>{const{sourceBlockId:o,sourcePortId:n,targetBlockId:a,targetPortId:s}=e;return t.connections.some((({sourceBlockId:t,sourcePortId:e,targetBlockId:l,targetPortId:i})=>{const r=t===o&&e===n&&l===a&&i===s;const c=t===a&&e===s&&l===o&&i===n;return r||c}))};const b=t=>{if(!u(t)){o.changedConnections.trigger(M({id:a.Text.getRandom(),...t}));o.createConnection.trigger(t)}};const p=e=>{const n=t.connections.filter((t=>t.id!==e));o.changedConnections.trigger(_(n));o.deleteConnection.trigger(e)};const v=(e,n)=>{var a,s,l,i;const r=t.blocks.find((t=>t.id===e));if(!r){return}const c=new Set([...(a=(s=r.ports)==null?void 0:s.input)!=null?a:[],...(l=(i=r.ports)==null?void 0:i.output)!=null?l:[]].map((t=>t.id)));const u=t.connections.filter((t=>{const{sourceBlockId:o,sourcePortId:n,targetBlockId:a,targetPortId:s}=t;const l=o===e&&c.has(n);const i=a===e&&c.has(s);return!l&&!i}));o.changedConnections.trigger(_(u))};const m=e=>{const n=t.blocks.findIndex((t=>t.id===e));if(n===-1){return}v(e);o.changedBlocks.trigger(O(n));o.deleteBlock.trigger(e)};const h=t=>{o.changedBlocks.trigger(M(t));o.addBlock.trigger(t)};const f=(e,o,n)=>{t.blocks[e].position.x=o;t.blocks[e].position.y=n};const g=e=>{const n=t.blocks.findIndex((t=>t.id===e.id));if(n===-1){return}o.changedBlocks.trigger(T(n,e));o.updateBlock.trigger(e)};const B=(t,e)=>{const{position:{x:o,y:n},dimensions:{width:a},ports:{output:s},node:{type:l}}=t;const{position:c,id:u}=e;let b=c*i/2;if(l===d.COMPLEX){b+=r+i}let p=o;const v=s.some((t=>t.id===u));if(v){p=Number(o)+Number(a)}return{x:p,y:Number(n)+b}};const P=(e,o)=>{let n=null;let a=Infinity;t.blocks.forEach((t=>{const s=[...t.ports.input,...t.ports.output];s.forEach((s=>{const{x:l,y:i}=B(t,s);const r=e-l;const u=o-i;const d=Math.hypot(r,u);if(d<c&&d<a){n={block:t,port:s};a=d}}))}));return n};const y=e=>{var o,n;let a=Math.round(e.clientX/s.toValue(t.zoom));let l=Math.round(e.clientY/s.toValue(t.zoom));const{top:i,left:r}=(o=(n=s.toValue(t.blockDiagramRef))==null?void 0:n.getBoundingClientRect())!=null?o:{top:0,left:0};a-=Math.round(r/s.toValue(t.zoom));l-=Math.round(i/s.toValue(t.zoom));return{x:a,y:l}};const k=e=>{t.movingBlock=s.toRaw({...e});const o=[];const n=[...e.ports.input,...e.ports.output];n.forEach((n=>{const a=t.connections.filter((t=>{const{targetBlockId:o,targetPortId:a,sourceBlockId:s,sourcePortId:l}=t;const i=o===e.id&&a===n.id;const r=s===e.id&&l===n.id;return i||r}));o.push(...a)}));t.movingConnections=o};const L=(e,o)=>{t.movingBlock.position.x=e;t.movingBlock.position.y=o};const V=()=>{t.movingBlock=null;t.movingConnections=[]};const H=({snapshotHandler:e=null,revertHandler:o=null})=>{t.snapshotHandler=e||t.snapshotHandler;t.revertHandler=o||t.revertHandler};const C=(e,o)=>{var n,a;const l=(n=(a=s.toValue(t.portsRectMap))==null?void 0:a[e])!=null?n:{};Object.entries(l).forEach((([t,e])=>{l[t].x=e.x-o.x;l[t].y=e.y-o.y}))};const F=(e,o)=>{var n,a,l;const{portsElMap:i,blockDiagramLeft:r,blockDiagramTop:c,zoom:u,transformX:d,transformY:b}=t;const p=s.toValue(i).has(e);const v=p&&s.toValue(i).get(e).has(o);if(!p||!v){return}const{x:m=0,y:h=0,width:f=0,height:g=0}=(n=(a=i.get(e))==null?void 0:(l=a.get(o))==null?void 0:l.getBoundingClientRect())!=null?n:{};t.portsRectMap[e][o].x=m/u+s.toValue(d)-s.toValue(r)/u;t.portsRectMap[e][o].y=h/u+s.toValue(b)-s.toValue(c)/u;t.portsRectMap[e][o].width=f;t.portsRectMap[e][o].height=g};return{setState:n,updateCanvasTransform:l,isExistConnection:u,addConnection:b,deleteConnectionById:p,addBlock:h,updateBlockPositionByIndex:f,updateBlock:g,deleteBlockById:m,getPortAbsolutePosition:B,findNearestPort:P,transformEventToPoint:y,setMovingBlock:k,updateMovingBlockPosition:L,resetMovingBlock:V,setHistoryHandlers:H,setPortOffsetByBlockId:C,updatePortPosition:F}}function Xe(t){const e=s.computed((()=>({x:t.transformX,y:t.transformY,zoom:t.zoom,viewportX:t.viewportX,viewportY:t.viewportY})));const o=s.computed((()=>{var e,o;return(e=(o=t.canvasRef)==null?void 0:o.canvasId)!=null?e:null}));const n=s.computed((()=>t.blocks.reduce(((t,e)=>{var o;const n=(o=e==null?void 0:e.type)!=null?o:b;if(n in t){t[n]=[...t[n],e]}else{t[n]=[e]}return t}),{[b]:[]})));const a=s.computed((()=>Object.keys(s.toValue(n))));const l=s.computed((()=>t.connections.reduce(((t,e)=>{var o;const n=(o=e==null?void 0:e.type)!=null?o:p;if(n in t){t[n]=[...t[n],e]}else{t[n]=[e]}return t}),{[p]:[]})));const i=s.computed((()=>Object.keys(s.toValue(l))));const r=s.computed((()=>t.animationQueue!==null));const c=s.computed((()=>t.isDisabled||s.toValue(r)));return{transform:e,canvasId:o,groupedBlocks:n,blockGroupNames:a,groupedConnections:l,connectionGroupNames:i,isAnimate:r,isDisabledBlockDiagram:c}}function Ye(){return{[u.START_DRAG_BLOCK]:N(),[u.MOVE_DRAG_BLOCK]:N(),[u.END_DRAG_BLOCK]:N(),[u.ADD_BLOCK]:N(),[u.UPDATE_BLOCK]:N(),[u.DELETE_BLOCK]:N(),[u.CREATE_CONNECTION]:N(),[u.DELETE_CONNECTION]:N(),[u.CHANGED_BLOCKS]:N(),[u.CHANGED_CONNECTIONS]:N(),[u.BLOCK_TRANSITION_START]:N(),[u.BLOCK_TRANSITION_END]:N(),[u.CONNECTION_TRANSITION_START]:N(),[u.CONNECTION_TRANSITION_END]:N(),[u.DROP_NEW_BLOCK]:N()}}function Ze(t){var e,o,n,a,i;const r=(e=s.getCurrentInstance())==null?void 0:e.appContext.app;const c=(o=r==null?void 0:(n=r.config)==null?void 0:(a=n.globalProperties)==null?void 0:a.$blockDiagram)!=null?o:null;if(c!==null){return c}const u=l(t);const d=s.reactive(u);const b=Xe(d);const p=Ye();const v=$e({state:d,getters:b,hooks:p});if(t){v.setState(t)}r.config.globalProperties.$blockDiagram={...s.toRefs(d),...b,...v,hooks:p};r.config.globalProperties.$blockDiagramTestId=(t,...e)=>{if(!t){throw new Error("ui.block-diagram not found test id")}const o=e.reduce(((t,e)=>`${t}-${e}`),"");return`${t}${o}`};return(i=r.config.globalProperties)==null?void 0:i.$blockDiagram}function Ue(t=[]){const{contextMenuLayerRef:o,targetContainerRef:n,isOpenContextMenu:l,positionContextMenu:i,contextMenuInstance:r,zoom:c}=Ze();r.value=s.toValue(r)||s.shallowRef(e.MenuManager.create(v()));const u=s.ref(false);let d={items:t};function b(t){d=v(t)}function p(t=[]){return t.map((t=>({...t,onclick:()=>{if(a.Type.isFunction(t.onclick)){t.onclick()}f()}})))}function v(t){var e;return{id:"block-diagram-context-menu",bindElement:{left:0,top:0},minWidth:200,autoHide:true,draggable:false,cacheable:false,targetContainer:s.toValue(n),...t,items:p((e=t==null?void 0:t.items)!=null?e:[])}}function m(t){var e,o;(e=s.toValue(r))==null?void 0:(o=e.popupWindow)==null?void 0:o.subscribeOnce("onDestroy",t)}function h(t){var o;(o=s.toValue(r))==null?void 0:o.destroy();r.value=s.shallowRef(e.MenuManager.create(v(t)));s.toValue(r).show()}function f(){var t;(t=s.toValue(r))==null?void 0:t.close()}function g(t){var e,n;const{clientX:a=0,clientY:r=0}=t;const{left:b,top:p}=(e=(n=s.toValue(o))==null?void 0:n.getBoundingClientRect())!=null?e:{top:0,left:0};i.value.top=(r-p)/s.toValue(c);i.value.left=(a-b)/s.toValue(c);h(d);m((()=>{u.value=false}));u.value=true;l.value=true}function B(){u.value=false;l.value=false;f()}return{isOpen:u,showContextMenu:g,closeContextMenu:B,setOptions:b}}function We(t){const{isDisabledBlockDiagram:e,newConnection:o,isValidNewConnection:n,portsRectMap:l,blockDiagramTop:i,blockDiagramLeft:r,zoom:c,transformX:u,transformY:d,addConnection:b}=Ze();const{block:p,port:v,position:m,validationRules:h=null,normalyzeConnectionFn:f=null}=t;const g=s.ref(false);const B=s.computed((()=>{if(s.toValue(o)===null){return true}const{sourceBlockId:t,sourcePortId:e,targetBlockId:a,targetPortId:l}=s.toValue(o);if(l===null){return true}const i=s.toValue(p).id===t&&s.toValue(v).id===e;const r=s.toValue(p).id===a&&s.toValue(v).id===l;if(i||r){return s.toValue(n)}return true}));function P(t){if(t===null){return true}if(a.Type.isArray(t)){return t.every((t=>t(s.toValue(o))))}if(!a.Type.isFunction(t)){return true}return t(s.toValue(o))}function y(t,e=null){if(a.Type.isFunction(e)){return e(t)}return{sourceBlockId:t.sourceBlockId,sourcePortId:t.sourcePortId,targetBlockId:t.targetBlockId,targetPortId:t.targetPortId}}function k(t){var n,i;t.stopPropagation();if(s.toValue(e)){return}g.value=true;const r=(n=s.toValue(l))==null?void 0:(i=n[s.toValue(p).id])==null?void 0:i[s.toValue(v).id];const c={x:r.x+r.width/2,y:r.y+r.height/2};o.value={sourceBlockId:s.toValue(p).id,sourcePortId:s.toValue(v).id,sourcePort:{...s.toValue(v)},sourcePortPosition:m,targetBlockId:null,targetPortId:null,targetPort:null,start:c,end:c};a.Event.bind(document,"mousemove",L);a.Event.bind(document,"mouseup",V)}function L(t){if(!s.toValue(o)||s.toValue(e)){return}const n=t.clientX/s.toValue(c);const a=t.clientY/s.toValue(c);o.value.end={x:n+s.toValue(u)-s.toValue(r)/s.toValue(c),y:a+s.toValue(d)-s.toValue(i)/s.toValue(c)}}function V(t){if(s.toValue(o)===null||s.toValue(e)){return}const{sourceBlockId:l=null,sourcePortId:i=null,targetBlockId:r=null,targetPortId:c=null}=s.toValue(o);const u=l===r&&i===c;const d=l!==null&&i!==null;const p=r!==null&&c!==null;if(!u&&d&&p&&s.toValue(n)){b(y(s.toValue(o),f))}o.value=null;g.value=false;a.Event.unbind(document,"mousemove",L);a.Event.unbind(document,"mouseup",V)}function H(){if(s.toValue(e)){return}if(s.toValue(o)!==null){o.value.targetBlockId=s.toValue(p).id;o.value.targetPortId=s.toValue(v).id;o.value.targetPort={...s.toValue(v)};n.value=P(s.toValue(h))}}function C(){if(s.toValue(e)){return}if(s.toValue(o)!==null){o.value.targetBlockId=null;o.value.targetPortId=null;o.value.targetPort=null;n.value=true}}return{isSourcePort:g,isValid:B,onMouseDownPort:k,onMouseOverPort:H,onMouseLeavePort:C}}function qe(t){const{highlitedBlockIds:e,isDisabledBlockDiagram:o,movingBlock:n,updatePortPosition:a}=Ze();const l=s.computed((()=>e.value.includes(s.toValue(t).id)));const i=s.computed((()=>s.toValue(o)));const r=s.computed((()=>{var e;if(((e=s.toValue(n))==null?void 0:e.id)===s.toValue(t).id){return{zIndex:f.MOVABLE}}if(s.toValue(l)){return{zIndex:f.HIGHLITED}}return{zIndex:f.STANDING}}));function c(){[...s.toValue(t).ports.input,...s.toValue(t).ports.output].forEach((e=>{a(s.toValue(t).id,e.id)}))}return{isHiglitedBlock:l,isDisabled:i,blockZindex:r,updatePortsPositions:c}}function Qe(t,e){const o=s.ref(false);const{isDisabledBlockDiagram:n,zoom:l,updateBlock:i,hooks:r,setMovingBlock:c,updateMovingBlockPosition:u,resetMovingBlock:d,setPortOffsetByBlockId:b}=Ze();let p=0;let v=0;const m=s.ref(0);const h=s.ref(0);const f=s.ref(s.toValue(e).position.x);const g=s.ref(s.toValue(e).position.y);s.watchEffect((()=>{f.value=s.toValue(e).position.x;g.value=s.toValue(e).position.y}));const B=s.computed((()=>({top:`${g.value}px`,left:`${f.value}px`})));s.onMounted((()=>{a.Event.bind(s.toValue(t),"mousedown",P)}));s.onBeforeUnmount((()=>{a.Event.unbind(s.toValue(t),"mousedown",P)}));const P=t=>{if(t.button!==0||s.toValue(n)){return}t.stopPropagation();c(s.toValue(e));r.startDragBlock.trigger(e);p=s.toValue(e).position.x;v=s.toValue(e).position.y;m.value=Math.round(t.clientX-s.toValue(e).position.x*s.toValue(l));h.value=Math.round(t.clientY-s.toValue(e).position.y*s.toValue(l));o.value=true;a.Event.bind(document,"mousemove",y);a.Event.bind(document,"mouseup",k)};const y=t=>{if(!s.toValue(o)||s.toValue(n)){return}t.stopPropagation();r.moveDragBlock.trigger(e);f.value=Math.round((t.clientX-s.toValue(m))/s.toValue(l));g.value=Math.round((t.clientY-s.toValue(h))/s.toValue(l));u(f.value,g.value);b(s.toValue(e).id,{x:p-f.value,y:v-g.value});p=f.value;v=g.value};const k=t=>{t.stopPropagation();if(!s.toValue(o)||s.toValue(n)){return}const c=Math.round((t.clientX-s.toValue(m))/s.toValue(l));const u=Math.round((t.clientY-s.toValue(h))/s.toValue(l));const f={...s.toValue(e),position:{...s.toValue(e).position,x:c,y:u}};b(s.toValue(e).id,{x:p-c,y:v-u});i(f);if(s.toValue(e).position.x!==f.position.x||s.toValue(e).position.y!==f.position.y){r.endDragBlock.trigger(f)}d();m.value=0;h.value=0;o.value=false;a.Event.unbind(document,"mousemove",y);a.Event.unbind(document,"mouseup",k)};return{isDragged:o,blockPositionStyle:B}}function Je(t){const{blocks:e,connections:o,historyCurrentState:n,hooks:a}=Ze();const l={[u.CHANGED_BLOCKS]:i,[u.CHANGED_CONNECTIONS]:r};Object.entries(l).forEach((([t,e])=>{a[t].on(e)}));function i(e){D(s.toValue(n.value.blocks),e,(e=>{n.value.blocks=e;t("update:blocks",e)}))}function r(e){D(s.toValue(n.value.connections),e,(e=>{n.value.connections=e;t("update:connections",e)}))}function c(){Object.entries(l).forEach((([t,e])=>{a[t].off(e)}))}return{dispose:c}}function to(t){const{blocks:e,connections:o,historyCurrentState:n,zoom:a,isDisabled:l}=Ze();const i=s.effectScope(true);i.run((()=>{s.watch([()=>t.blocks,()=>t.blocks.length],(([t])=>{if(t&&Array.isArray(t)){n.value.blocks=s.markRaw(JSON.parse(JSON.stringify(t)));e.value=t}}),{immediate:true,deep:true});s.watch([()=>t.connections,()=>t.connections.length],(([t])=>{n.value.connections=s.markRaw(JSON.parse(JSON.stringify(t)));o.value=[...t]}),{immediate:true,deep:true});s.watch((()=>t.zoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.minZoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.maxZoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.disabled),(t=>{l.value=t}),{immediate:true})}));function r(){i.stop()}return{dispose:r}}function eo(...t){const{hooks:e}=Ze();const o=[...t].reduce(((t,e)=>{const o={...t};Object.entries(e).forEach((([e,n])=>{if(e in t){o[e].push(...a.Type.isFunction(n)?[n]:n)}else{o[e]=[...a.Type.isFunction(n)?[n]:n]}}));return o}),{});Object.entries(o).forEach((([t,o])=>{o.forEach((o=>{var n;e==null?void 0:(n=e[t])==null?void 0:n.on(o)}))}));function n(){Object.entries(o).forEach((([t,o])=>{o.forEach((o=>{var n;e==null?void 0:(n=e[t])==null?void 0:n.off(o)}))}))}return{dispose:n}}const oo={searchCallback:()=>false,delay:300};function no(t){const{blocks:e}=Ze();const o={...oo,...t};const n=s.ref("");const l=s.ref([]);function i(t){n.value=t;l.value=[];if(s.toValue(n).trim()===""){return}e.value.forEach((t=>{if(o.searchCallback(t,s.toValue(n))){l.value.push(t)}}))}function r(){n.value="";l.value=[]}return{seachText:n,foundBlocks:l,onSearchBlocks:a.debounce(i,o.delay),onClearSearch:r}}function ao(){const{zoom:t,blocks:e,canvasWidth:o,canvasHeight:n,blockDiagramTop:a,blockDiagramLeft:l,canvasInstance:i}=Ze();function r(t){var e;(e=s.toValue(i))==null?void 0:e.zoomIn(t)}function c(t){var e;(e=s.toValue(i))==null?void 0:e.zoomOut(t)}function u(t){var e;(e=s.toValue(i))==null?void 0:e.setCamera(t)}function d(i){const r=s.toValue(e).find((t=>t.id===i));if(!r){return}const{x:c,y:d}=r.position;const{width:b,height:p}=r.dimensions;const v=c+b/2;const m=d+p/2;u({x:v-s.toValue(o)/2/s.toValue(t)-s.toValue(l)/s.toValue(t),y:m-s.toValue(n)/2/s.toValue(t)-s.toValue(a)/s.toValue(t)})}return{zoomIn:r,zoomOut:c,setCamera:u,goToBlockById:d}}function so(){const{highlitedBlockIds:t}=Ze();function e(e){s.toValue(t).push(...e)}function o(e){s.toValue(t).push(e)}function n(e){const o=t.value.indexOf(e);if(o>-1){t.value.splice(o,1)}}function a(){t.value=[]}return{highlitedBlockIds:t,set:e,add:o,remove:n,clear:a}}function lo(){var t,e,o,n;const a=(t=s.getCurrentInstance())==null?void 0:t.appContext.app;const l=(e=a==null?void 0:(o=a.config)==null?void 0:(n=o.globalProperties)==null?void 0:n.$bitrix)!=null?e:null;return{getMessage:(t,e)=>{var o;return l==null?void 0:(o=l.Loc)==null?void 0:o.getMessage(t,e)}}}function io(t){const{portRef:e,block:o,port:n,position:a=v.LEFT}=t;const{portsElMap:l,portsRectMap:i,zoom:r,transformX:c,transformY:u,blockDiagramTop:d,blockDiagramLeft:b,isDisabledBlockDiagram:p}=Ze();const m=s.computed((()=>s.toValue(p)));function h(t,e,o){if(!s.toValue(l).has(t)){s.toValue(l).set(t,new Map)}s.toValue(l).get(t).set(e,s.toValue(o))}function f(t,e){if(!s.toValue(l).has(t)){return}s.toValue(l).get(t).delete(e)}function g(t,e,o){var n,l;if(!(t in s.toValue(i))){s.toValue(i)[t]={}}const{x:p=0,y:v=0,width:m=0,height:h=0}=(n=(l=s.toValue(o))==null?void 0:l.getBoundingClientRect())!=null?n:{};s.toValue(i)[t][e]={x:p/s.toValue(r)+s.toValue(c)-s.toValue(b)/s.toValue(r),y:v/s.toValue(r)+s.toValue(u)-s.toValue(d)/s.toValue(r),width:m,height:h,position:a}}function B(t,e){if(!(t in s.toValue(i))){return}const o=s.toValue(i)[t];if(Object.keys(o).length===1){delete s.toValue(i)[t]}else{delete s.toValue(o)[e]}}function P(){h(s.toValue(o).id,s.toValue(n).id,e);g(s.toValue(o).id,s.toValue(n).id,e)}function y(){f(s.toValue(o).id,s.toValue(n).id);B(s.toValue(o).id,s.toValue(n).id)}return{isDisabled:m,onMountedPort:P,onUnmountedPort:y}}const ro={path:"",center:{x:0,y:0}};const co=30;const uo=10;function bo(t){const{portsRectMap:e,isDisabledBlockDiagram:o}=Ze();const n=s.computed((()=>{const{sourceBlockId:o,sourcePortId:n,targetBlockId:a,targetPortId:l}=s.toValue(t);const i=o in s.toValue(e);const r=i&&n in s.toValue(e)[o];const c=a in s.toValue(e);const u=c&&l in s.toValue(e)[a];if(!i||!r||!c||!u){return null}const{x:d,y:b,width:p,height:v,position:m}=s.toValue(e)[o][n];const{x:h,y:f,width:g,height:B,position:P}=s.toValue(e)[a][l];return{sourcePort:{x:d+p/2,y:b+v/2,position:m},targetPort:{x:h+g/2,y:f+B/2,position:P}}}));const a=s.computed((()=>{if(s.toValue(n)===null){return ro}const t=s.toValue(n).sourcePort.position;const e=s.toValue(n).targetPort.position;const o=t!==e&&[v.TOP,v.BOTTOM].includes(t)&&[v.TOP,v.BOTTOM].includes(e);const a=t!==e&&[v.LEFT,v.RIGHT].includes(t)&&[v.LEFT,v.RIGHT].includes(e);const{path:l,center:i,points:r}=S({sourceX:s.toValue(n).sourcePort.x,sourceY:s.toValue(n).sourcePort.y,sourcePosition:t,targetX:s.toValue(n).targetPort.x,targetY:s.toValue(n).targetPort.y,targetPosition:e,borderRadius:uo,offset:co});const[c,u,d,b,p,m]=r;const h=c.x===u.x&&c.x===d.x&&b.x===p.x&&b.x===m.x;const f=c.y===u.y&&c.y===d.y&&b.y===p.y&&b.y===m.y;if(h&&o||f&&a){return k(s.toValue(n).sourcePort,s.toValue(n).targetPort,o?y.VERTICAL:y.HORIZONTAL)}return{path:l,center:i}}));const l=s.computed((()=>s.toValue(o)));return{connectionPortsPosition:n,connectionPathInfo:a,isDisabled:l}}function po(t){const{blockDiagramRef:e}=t;const{blockDiagramRef:o,blockDiagramTop:n,blockDiagramLeft:a}=Ze();let l=null;function i(t){t.forEach((t=>{const{top:e,left:o}=t.boundingClientRect;n.value=e;a.value=o}))}function r(){o.value=s.toValue(e);const{left:t,top:r}=s.toValue(e).getBoundingClientRect();n.value=r;a.value=t;l=new IntersectionObserver(i);l.observe(s.toValue(o))}function c(){l.unobserve(s.toValue(o))}return{onMountedAppElements:r,onUnmountedAppElements:c}}function vo(){const{newConnection:t,isValidNewConnection:e}=Ze();const o=s.computed((()=>s.toValue(t)!==null));const n=s.computed((()=>{if(!s.toValue(o)){return{path:"",center:{x:0,y:0}}}const e=[v.LEFT,v.RIGHT].includes(s.toValue(t).sourcePortPosition);return k(s.toValue(t).start,s.toValue(t).end,e?y.HORIZONTAL:y.VERTICAL)}));const a=s.computed((()=>{if(s.toValue(t)===null){return true}return s.toValue(e)}));return{hasNewConnection:o,newConnectionPathInfo:n,isValid:a}}function mo(){const{zoom:t,isPauseAnimation:e,isStopAnimation:o,animationQueue:n,currentAnimationItem:a,addConnection:l,deleteConnectionById:i,addBlock:r,deleteBlockById:c}=Ze();function u(t){switch(t.type){case m.BLOCK:{r(t.item);break}case m.CONNECTION:{l(t.item);break}case m.REMOVE_BLOCK:{c(t.item.id);break}case m.REMOVE_CONNECTION:{i(t.item.id);break}default:break}}function*d(t){for(const n of t){if(s.toValue(e)){yield}if(s.toValue(o)){break}a.value=n;if(n.type&&n.item){u(n);yield n}}h()}function b(e){const{items:a=[]}=e!=null?e:{};t.value=1;o.value=false;n.value=d(a);if(a.length>0){setTimeout((()=>v()),100)}else{h()}}function p(){e.value=true}function v(){var t;e.value=false;(t=n.value)==null?void 0:t.next()}function h(){o.value=true;e.value=false;a.value=null;n.value=null}return{start:b,pause:p,play:v,stop:h}}const ho={grid:{options:{size:64,gridColor:"#A1B8D9",backgroundColor:"#ECF0F2",zoomStep:4,zoomSteps:[{zoom:1.1,size:64,zoomStep:4},{zoom:1,size:64,zoomStep:4},{zoom:.99,size:64,zoomStep:4},{zoom:.5,size:64*5,zoomStep:.5},{zoom:.25,size:64*25,zoomStep:.25},{zoom:.125,size:64*125,zoomStep:.125}]},instance:Re}};function fo(t){const{canvasRef:e,transformLayoutRef:o,canvasStyle:n,zoomSensitivity:l,zoomSensitivityMouse:i}=t;const{isDisabledBlockDiagram:r,transformX:c,transformY:u,zoom:d,minZoom:b,maxZoom:p,canvasRef:v,transformLayoutRef:m,canvasWidth:h,canvasHeight:f,canvasInstance:g}=Ze();const B=s.ref(false);const P=s.ref(false);const y=s.ref(false);let k=null;function L(t){if(t&&t.style in ho){return{instance:ho[t.style].instance,options:{...ho[t.style].options,...t}}}return null}function V(){v.value=e;m.value=o;g.value=s.markRaw(new ee({canvas:s.toValue(e),canvasStyle:L(n),minZoom:s.toValue(b),maxZoom:s.toValue(p)}));s.toValue(g).camera.setChangeTransformCallback((t=>{c.value=t.x;u.value=t.y;d.value=t.zoom;h.value=t.width;f.value=t.height}));E()}function H(){var t;(t=s.toValue(g))==null?void 0:t.destroy();cancelAnimationFrame(k)}function C(t){var e;if(s.toValue(r)){return}B.value=true;(e=s.toValue(g))==null?void 0:e.setCameraPositionByMouseDown(t)}function F(t){var e;if(!s.toValue(B)||s.toValue(r)){return}if(t.buttons!==1){B.value=false;P.value=false;return}P.value=true;(e=s.toValue(g))==null?void 0:e.setCameraPositionByMouseMove(t)}function x(){B.value=false;P.value=false}function S(t){t.preventDefault();if(s.toValue(r)){return}const e=t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY:t.deltaMode===0;if(t.ctrlKey){var o;const n=e?-t.deltaY*s.toValue(l):-Math.sign(t.deltaY)*s.toValue(i);y.value=true;(o=s.toValue(g))==null?void 0:o.setCameraZoomByWheel(t,n);setTimeout((()=>{y.value=false}),200)}else{var n;(n=s.toValue(g))==null?void 0:n.setCameraPositionByWheel(t)}}function E(){if(g){var t;(t=s.toValue(g))==null?void 0:t.render();const e=s.toValue(g).viewMatrix;a.Dom.style(s.toValue(m),"transform",`\n\t\t\t\t\tmatrix(\n\t\t\t\t\t\t${e[0]}, 0, 0, ${e[4]}, ${e[6]}, ${e[7]}\n\t\t\t\t\t)\n\t\t\t\t`)}k=requestAnimationFrame(E)}return{isDragging:P,onMounted:V,onUnmounted:H,onMouseDown:C,onMouseMove:F,onMouseUp:x,onWheel:S}}function go(){const{zoom:t,blockDiagramTop:e,blockDiagramLeft:o,transformX:n,transformY:a,addBlock:l,hooks:i}=Ze();function r(r){r.preventDefault();const c=r.dataTransfer.getData("text/plain");const u=JSON.parse(c);const{width:d,height:b}=u.dimensions;u.position.x=(r.clientX-d*s.toValue(t)/2)/s.toValue(t);u.position.y=(r.clientY-b*s.toValue(t)/2)/s.toValue(t);u.position.x+=s.toValue(n);u.position.y+=s.toValue(a);u.position.x-=s.toValue(o)/s.toValue(t);u.position.y-=s.toValue(e)/s.toValue(t);l(u);i.dropNewBlock.trigger(u)}function c(t,e){t.dataTransfer.setData("text/plain",JSON.stringify(e))}return{setBlockData:c,onDrop:r}}function Bo(t){const{cursorType:e,resizingBlock:o,blockDiagramTop:n,blockDiagramLeft:l,transformX:i,transformY:r,zoom:c,updateBlock:u}=Ze();const{block:d,minWidth:b,minHeight:p,leftSideRef:v,topSideRef:m,rightSideRef:f,bottomSideRef:g,leftTopCornerRef:B,rightTopCornerRef:P,rightBottomCornerRef:y,leftBottomCornerRef:k}=t;const L=s.ref(false);let V=0;let H=0;let C=0;let F=0;const x=s.computed((()=>{if(s.toValue(L)){return{width:`${s.toValue(o).dimensions.width}px`,height:`${s.toValue(o).dimensions.height}px`,cursor:s.toValue(e)}}return{width:`${s.toValue(d).dimensions.width}px`,height:`${s.toValue(d).dimensions.height}px`,cursor:s.toValue(e)}}));function S(){u({...s.toValue(d),position:{x:s.toValue(o).position.x,y:s.toValue(o).position.y},dimensions:{width:s.toValue(o).dimensions.width,height:s.toValue(o).dimensions.height}})}function E(){a.Event.bind(s.toValue(f),"mousedown",N);a.Event.bind(s.toValue(g),"mousedown",A);a.Event.bind(s.toValue(v),"mousedown",G);a.Event.bind(s.toValue(m),"mousedown",Y);a.Event.bind(s.toValue(P),"mousedown",J);a.Event.bind(s.toValue(y),"mousedown",W);a.Event.bind(s.toValue(B),"mousedown",st);a.Event.bind(s.toValue(k),"mousedown",ot)}function w(){a.Event.unbind(s.toValue(f),"mousedown",N);a.Event.unbind(s.toValue(g),"mousedown",A);a.Event.unbind(s.toValue(v),"mousedown",G);a.Event.unbind(s.toValue(m),"mousedown",Y);a.Event.unbind(s.toValue(P),"mousedown",J);a.Event.unbind(s.toValue(y),"mousedown",W);a.Event.unbind(s.toValue(B),"mousedown",st);a.Event.unbind(s.toValue(k),"mousedown",ot)}function I(t,n){t.stopPropagation();e.value=n;o.value={...s.toValue(d)};V=s.toValue(d).position.x;H=s.toValue(d).position.y;C=s.toValue(d).dimensions.width;F=s.toValue(d).dimensions.height;L.value=true}function _(t){t.stopPropagation();e.value="default";S();L.value=false;o.value=null}function M(t){let e=t.clientY/s.toValue(c);e+=s.toValue(r);e-=s.toValue(n)/s.toValue(c);let a=t.clientY/s.toValue(c);a+=s.toValue(r);a-=s.toValue(n)/s.toValue(c);a-=H+F;a=Math.abs(a);const l=H+F-s.toValue(p);o.value.position.y=a<s.toValue(p)||e>=l?l:e;o.value.dimensions.height=a<s.toValue(p)||e>=l?s.toValue(p):a}function T(t){let e=t.clientX/s.toValue(c);e+=s.toValue(i);e-=s.toValue(l)/s.toValue(c);let n=V;n-=t.clientX/s.toValue(c);n-=s.toValue(i);n-=s.toValue(l)/s.toValue(c);n=Math.abs(n);o.value.dimensions.width=n<s.toValue(b)||e<=V?s.toValue(b):n}function O(t){let e=t.clientY/s.toValue(c);e+=s.toValue(r);e-=s.toValue(n)/s.toValue(c);let a=t.clientY/s.toValue(c);a-=H;a+=s.toValue(r);a-=s.toValue(n)/s.toValue(c);a=Math.abs(a);o.value.dimensions.height=a<s.toValue(p)||e<=H?s.toValue(p):a}function D(t){let e=t.clientX/s.toValue(c);e+=s.toValue(i);e-=s.toValue(l)/s.toValue(c);let n=t.clientX/s.toValue(c);n+=s.toValue(i);n-=s.toValue(l)/s.toValue(c);n-=V+C;n=Math.abs(n);const a=V+C-s.toValue(b);o.value.position.x=n<s.toValue(b)||e>=a?a:e;o.value.dimensions.width=n<s.toValue(b)||e>=a?s.toValue(b):n}function N(t){I(t,h.EW_RESIZE);a.Event.bind(document,"mousemove",R);a.Event.bind(document,"mouseup",z)}function R(t){t.stopPropagation();if(!s.toValue(L)){return}T(t)}function z(t){_(t);a.Event.unbind(document,"mousemove",R);a.Event.unbind(document,"mouseup",z)}function A(t){I(t,h.NS_RESIZE);a.Event.bind(document,"mousemove",j);a.Event.bind(document,"mouseup",K)}function j(t){t.stopPropagation();if(!s.toValue(L)){return}O(t)}function K(t){_(t);a.Event.unbind(document,"mousemove",j);a.Event.unbind(document,"mouseup",K)}function G(t){I(t,h.EW_RESIZE);a.Event.bind(document,"mousemove",$);a.Event.bind(document,"mouseup",X)}function $(t){t.stopPropagation();if(!s.toValue(L)){return}D(t)}function X(t){_(t);a.Event.unbind(document,"mousemove",$);a.Event.unbind(document,"mouseup",X)}function Y(t){I(t,h.NS_RESIZE);a.Event.bind(document,"mousemove",Z);a.Event.bind(document,"mouseup",U)}function Z(t){t.stopPropagation();if(!s.toValue(L)){return}M(t)}function U(t){_(t);a.Event.unbind(document,"mousemove",Z);a.Event.unbind(document,"mouseup",U)}function W(t){I(t,h.NWSE_RESIZE);a.Event.bind(document,"mousemove",q);a.Event.bind(document,"mouseup",Q)}function q(t){t.stopPropagation();if(!s.toValue(L)){return}T(t);O(t)}function Q(t){_(t);a.Event.unbind(document,"mousemove",q);a.Event.unbind(document,"mouseup",Q)}function J(t){I(t,h.NESW_RESIZE);a.Event.bind(document,"mousemove",tt);a.Event.bind(document,"mouseup",et)}function tt(t){t.stopPropagation();if(!s.toValue(L)){return}M(t);T(t)}function et(t){_(t);a.Event.unbind(document,"mousemove",tt);a.Event.unbind(document,"mouseup",et)}function ot(t){I(t,h.NESW_RESIZE);a.Event.bind(document,"mousemove",nt);a.Event.bind(document,"mouseup",at)}function nt(t){t.stopPropagation();if(!s.toValue(L)){return}D(t);O(t)}function at(t){_(t);a.Event.unbind(document,"mousemove",nt);a.Event.unbind(document,"mouseup",at)}function st(t){I(t,h.NWSE_RESIZE);a.Event.bind(document,"mousemove",lt);a.Event.bind(document,"mouseup",it)}function lt(t){t.stopPropagation();if(!s.toValue(L)){return}D(t);M(t)}function it(t){_(t);a.Event.unbind(document,"mousemove",lt);a.Event.unbind(document,"mouseup",it)}return{isResize:L,sizeBlockStyle:x,onMounted:E,onUnmounted:w}}const Po={base:"ui-block-diagram-canvas-transform",dragging:"--dragging"};const yo={name:"canvas-transform",props:{canvasStyle:{type:Object,required:true},zoomSensitivity:{type:Number,default:.01},zoomSensitivityMouse:{type:Number,default:.04}},setup(t){const{isDragging:e,onMounted:o,onUmounted:n,onMouseDown:a,onMouseMove:l,onMouseUp:i,onWheel:r}=fo({canvasRef:s.useTemplateRef("canvasLayout"),transformLayoutRef:s.useTemplateRef("transformLayout"),canvasStyle:t.canvasStyle,zoomSensitivity:t.zoomSensitivity,zoomSensitivityMouse:t.zoomSensitivityMouse});const c=s.computed((()=>({[Po.base]:true,[Po.dragging]:s.toValue(e)})));s.onMounted((()=>{o()}));s.onUnmounted((()=>{n()}));return{canvasTransformClassNames:c,onMouseDown:a,onMouseMove:l,onMouseUp:i,onWheel:r}},template:`\n\t\t<div\n\t\t\t:class="canvasTransformClassNames"\n\t\t\t@mousedown="onMouseDown"\n\t\t\t@mousemove="onMouseMove"\n\t\t\t@mouseup="onMouseUp"\n\t\t\t@wheel="onWheel"\n\t\t\t@contextmenu.prevent\n\t\t>\n\t\t\t<canvas\n\t\t\t\tref="canvasLayout"\n\t\t\t\tclass="ui-block-diagram-canvas-transform__canvas"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tref="transformLayout"\n\t\t\t\tclass="ui-block-diagram-canvas-transform__transform"\n\t\t\t>\n\t\t\t\t<slot/>\n\t\t\t</div>\n\t\t</div>\n\t`};const ko={base:"ui-block-diagram-connection__target",active:"--active"};const Lo={name:"diagram-connection",props:{connection:{type:Object,required:true},barWidth:{type:Number,default:22},barHeight:{type:Number,default:22},contextMenuItems:{type:Array,default:()=>[]},disabled:{type:Boolean,default:false}},setup(t){const{connectionPathInfo:e,isDisabled:o}=bo(t.connection);const{deleteConnectionById:n}=Ze();const a=lo();const{isOpen:l,showContextMenu:i}=Ue([{id:"deleteConnection",text:a.getMessage("UI_BLOCK_DIAGRAM_DELETE_CONNECTION_CONTEXT_MENU_ITEM"),onclick:()=>{n(t.connection.id)}}]);const r=s.computed((()=>({[ko.base]:true,[ko.active]:s.toValue(l)})));const c=s.computed((()=>{var o;const{x:n=0,y:a=0}=(o=s.toValue(e).center)!=null?o:{};return{x:n-t.barWidth/2,y:a-t.barHeight/2}}));function u(e){if(s.toValue(o)||t.disabled){return}e.preventDefault();i(e)}return{isDisabled:o,connectionPathInfo:e,targetConnectionClasses:r,barPosition:c,onOpenContextMenu:u}},template:`\n\t\t<svg class="ui-block-diagram-connection">\n\t\t\t<g class="ui-block-diagram-connection__group">\n\t\t\t\t<path\n\t\t\t\t\t:d="connectionPathInfo.path"\n\t\t\t\t\t:class="targetConnectionClasses"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('connectionLine', connection.id)"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\t:d="connectionPathInfo.path"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('connectionHoveredLine', connection.id)"\n\t\t\t\t\tclass="ui-block-diagram-connection__hovered"\n\t\t\t\t\tstroke="transparent"\n\t\t\t\t\tfill="transparent"\n\t\t\t\t\t@contextmenu="onOpenContextMenu"\n\t\t\t\t/>\n\t\t\t\t<foreignObject\n\t\t\t\t\t:x="barPosition.x"\n\t\t\t\t\t:y="barPosition.y"\n\t\t\t\t\t:width="barWidth"\n\t\t\t\t\t:height="barHeight"\n\t\t\t\t\tclass="ui-block-diagram-connection__bar"\n\t\t\t\t>\n\t\t\t\t\t<slot :isDisabled="isDisabled || disabled" />\n\t\t\t\t</foreignObject>\n\t\t\t</g>\n\t\t</svg>\n\t`};const Vo={name:"delete-connection-btn",components:{BIcon:n.BIcon},props:{connectionId:{type:String,required:true},disabled:{type:Boolean,default:false}},setup(t){const{deleteConnectionById:e}=Ze();function o(){if(t.disabled){return}e(t.connectionId)}return{iconSet:n.Outline,onDeleteConnection:o}},template:`\n\t\t<button\n\t\t\tclass="ui-block-diagram-delete-connection-btn"\n\t\t\t:data-test-id="$blockDiagramTestId('connectionDeleteBtn', connectionId)"\n\t\t\t@click="onDeleteConnection"\n\t\t>\n\t\t\t<div class="ui-block-diagram-delete-connection-btn__icon-wrap">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="iconSet.TRASHCAN"\n\t\t\t\t\t:size="14"\n\t\t\t\t\tclass="ui-block-diagram-delete-connection-btn__icon"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</button>\n\t`};const Ho={name:"ContextMenuLayout",setup(){const t=Ze();const e=s.computed((()=>({top:`${s.toValue(t.positionContextMenu).top}px`,left:`${s.toValue(t.positionContextMenu).left}px`})));return{instance:t,targetContainerStyle:e}},template:`\n\t\t<div\n\t\t\t:ref="instance.contextMenuLayerRef"\n\t\t\tclass="ui-block-diagram-context-menu__layout"\n\t\t>\n\t\t\t<slot/>\n\t\t\t<div\n\t\t\t\t:ref="instance.targetContainerRef"\n\t\t\t\t:style="targetContainerStyle"\n\t\t\t\tclass="ui-block-diagram-context-menu__target-container"\n\t\t\t/>\n\t\t</div>\n\t`};const Co={name:"blocks-queue-transition",setup(){const{isAnimate:t,currentAnimationItem:e,animationQueue:o,hooks:n}=Ze();const a=ao();const l=Ge();const i=so();function r(){var t,e;const{done:n=false}=(t=(e=s.toValue(o))==null?void 0:e.next())!=null?t:{};if(n){o.value=null}else{l.makeSnapshot()}}function c(){var t;n.blockTransitionStart.trigger((t=s.toValue(e))==null?void 0:t.item)}function u(){i.clear();i.add(s.toValue(e).item.id);a.goToBlockById(s.toValue(e).item.id)}function d(){var t;n.blockTransitionEnd.trigger((t=s.toValue(e))==null?void 0:t.item);r()}function b(){r()}return{isAnimate:t,onBeforeEnter:c,onEnter:u,onAfterEnter:d,onAfterLeave:b}},template:`\n\t\t<TransitionGroup\n\t\t\tv-if="isAnimate"\n\t\t\tname="ui-block-diagram-blocks-queue-transition"\n\t\t\t@before-enter="onBeforeEnter"\n\t\t\t@enter="onEnter"\n\t\t\t@after-enter="onAfterEnter"\n\t\t\t@after-leave="onAfterLeave"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`};const Fo={name:"grouped-blocks",components:{BlocksQueueTransition:Co},setup(){const{groupedBlocks:t,blockGroupNames:e}=Ze();return{blockGroupNames:e,groupedBlocks:t,getGroupBlockSlotName:R}},template:`\n\t\t<BlocksQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for="group in blockGroupNames"\n\t\t\t\t:key="group"\n\t\t\t\t:name="getGroupBlockSlotName(group)"\n\t\t\t\t:blocks="groupedBlocks[group]"\n\t\t\t/>\n\t\t</BlocksQueueTransition>\n\t`};const xo={base:"ui-block-diagram-new-connection__path",error:"--error"};const So={name:"NewConnection",setup(t){const{hasNewConnection:e,newConnectionPathInfo:o,isValid:n}=vo();const a=s.computed((()=>({[xo.base]:true,[xo.error]:!s.toValue(n)})));return{hasNewConnection:e,newConnectionPathInfo:o,pathClassNames:a}},template:`\n\t\t<svg\n\t\t\tv-if="hasNewConnection"\n\t\t\tclass="ui-block-diagram-new-connection"\n\t\t>\n\t\t\t<path\n\t\t\t\t:d="newConnectionPathInfo.path"\n\t\t\t\t:class="pathClassNames"\n\t\t\t/>\n\t\t</svg>\n\t`};const Eo={name:"connections-queue-transition",setup(){const{isAnimate:t,currentAnimationItem:e,animationQueue:o,updatePortPosition:n,hooks:a}=Ze();const l=Ge();function i(){var t;const{item:o}=(t=s.toValue(e))!=null?t:{};a.connectionTransitionStart.trigger(o);const{sourceBlockId:l,sourcePortId:i,targetBlockId:r,targetPortId:c}=o;n(l,i);n(r,c)}function r(){var t,e;const{done:n=false}=(t=(e=s.toValue(o))==null?void 0:e.next())!=null?t:{};if(n){o.value=null}else{l.makeSnapshot()}}function c(){var t;a.connectionTransitionEnd.trigger((t=s.toValue(e))==null?void 0:t.item);r()}function u(){r()}return{isAnimate:t,onBeforeEnter:i,onAfterEnter:c,onAfterLeave:u}},template:`\n\t\t<TransitionGroup\n\t\t\tv-if="isAnimate"\n\t\t\tname="ui-block-diagram-connections-queue-transition"\n\t\t\t@before-enter="onBeforeEnter"\n\t\t\t@after-enter="onAfterEnter"\n\t\t\t@after-leave="onAfterLeave"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`};const wo={name:"grouped-connections",components:{Connection:Lo,NewConnection:So,ConnectionsQueueTransition:Eo},setup(){const{groupedConnections:t,connectionGroupNames:e}=Ze();return{groupedConnections:t,connectionGroupNames:e,getGroupConnectionSlotName:z}},template:`\n\t\t<ConnectionsQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for="connection in connectionGroupNames"\n\t\t\t\t:key="connection"\n\t\t\t\t:name="getGroupConnectionSlotName(connection)"\n\t\t\t\t:connections="groupedConnections[connection]"\n\t\t\t/>\n\t\t\t<NewConnection/>\n\t\t</ConnectionsQueueTransition>\n\t`};const Io={name:"moveable-block",props:{block:{type:Object,required:true},highlighted:{type:Boolean,default:false}},setup(t){const{block:e}=s.toRefs(t);const{blockZindex:o,isHiglitedBlock:n,isDisabled:a}=qe(e);const l=so();const{isDragged:i,blockPositionStyle:r}=Qe(s.useTemplateRef("blockEl"),e);s.watch((()=>t.highlighted),(e=>{if(e){l.add(t.block.id)}else{l.remove(t.block.id)}}));const c=s.computed((()=>({...s.toValue(r),...s.toValue(o)})));s.onUnmounted((()=>{l.remove(t.block.id)}));function u(){l.clear();l.add(t.block.id)}return{isHiglitedBlock:n,isDisabled:a,isDragged:i,blockStyle:c,blockZindex:o,blockPositionStyle:r,onMouseDownSelectBlock:u}},template:`\n\t\t<div\n\t\t\tclass="ui-block-diagram-moveable-block"\n\t\t\t:style="blockStyle"\n\t\t\tref="blockEl"\n\t\t\t:data-test-id="$blockDiagramTestId('block', block.id)"\n\t\t\t@mousedown="onMouseDownSelectBlock"\n\t\t>\n\t\t\t<slot\n\t\t\t\t:block="block"\n\t\t\t\t:isHighlighted="isHiglitedBlock"\n\t\t\t\t:isDragged="isDragged"\n\t\t\t\t:isDisabled="isDisabled"\n\t\t\t/>\n\t\t</div>\n\t`};const _o={base:"ui-block-diagram-port",disabled:"--disabled",active:"--active",error:"--error"};const Mo={name:"DiagramPort",props:{block:{type:Object,required:true},port:{type:Object,required:true},position:{type:String,required:true,validator(t){return Object.values(v).includes(t)}},validationRules:{type:Array,default:()=>[]},normalyzeConnectionFn:{type:Function,default:null},disabled:{type:Boolean,default:false}},setup(t){const{isDisabled:e,onMountedPort:o,onUnmountedPort:n}=io({portRef:s.useTemplateRef("port"),block:t.block,port:t.port,position:t.position});const{isSourcePort:a,isValid:l,onMouseDownPort:i,onMouseOverPort:r,onMouseLeavePort:c}=We({block:t.block,port:t.port,position:t.position,validationRules:t.validationRules,normalyzeConnectionFn:t.normalyzeConnectionFn});const u=s.computed((()=>({[_o.base]:true,[_o.active]:s.toValue(a),[_o.disabled]:s.toValue(e),[_o.error]:!s.toValue(l)})));s.onMounted((()=>{o()}));s.onUnmounted((()=>{n()}));return{portClassNames:u,onMouseDownPort:i,onMouseOverPort:r,onMouseLeavePort:c}},template:`\n\t\t<div\n\t\t\tref="port"\n\t\t\t:class="portClassNames"\n\t\t\t:data-test-id="$blockDiagramTestId('port', port.id)"\n\t\t\t@mousedown="onMouseDownPort"\n\t\t\t@mouseover="onMouseOverPort"\n\t\t\t@mouseleave="onMouseLeavePort"\n\t\t/>\n\t`};const To={base:"ui-block-diagram-block-content-stub",highlighted:"--highlighted"};const Oo={name:"block-content-stub",components:{Port:Mo},props:{block:{type:Object,required:true},highlighted:{type:Boolean,default:false},dragged:{type:Boolean,default:false},disabled:{type:Boolean,default:false}},setup(t){const{deleteBlockById:e}=Ze();const o=lo();const{showContextMenu:n}=Ue([{id:"deleteConnection",text:o.getMessage("UI_BLOCK_DIAGRAM_DELETE_BLOCK_CONTEXT_MENU_ITEM"),onclick:()=>{e(t.block.id)}}]);const a=s.computed((()=>({[To.base]:true,[To.highlighted]:t.highlighted})));function l(e){e.preventDefault();if(t.disabled){return}const{clientX:o,clientY:a}=e;n({clientX:o,clientY:a})}return{blockContentClassNames:a,onShowContextMenu:l}},template:`\n\t\t<div\n\t\t\t:class="blockContentClassNames"\n\t\t\t@contextmenu="onShowContextMenu"\n\t\t>\n\t\t\t<div class="ui-block-diagram-block-content-stub__id">\n\t\t\t\t{{ block.id }}\n\t\t\t</div>\n\n\t\t\t<div class="ui-block-diagram-block-content-stub__left-column">\n\t\t\t\t<div\n\t\t\t\t\tv-for="port in block.ports.input"\n\t\t\t\t\t:key="port.id"\n\t\t\t\t\tclass="ui-block-diagram-block-content-stub__port-line"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-block-diagram-block-content-stub__port --left">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t:styled="false"\n\t\t\t\t\t\t\t:portsToShow="null"\n\t\t\t\t\t\t\tposition="left"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="ui-block-diagram-block-content-stub__right-column">\n\t\t\t\t<div\n\t\t\t\t\tv-for="port in block.ports.output"\n\t\t\t\t\t:key="port.id"\n\t\t\t\t\tclass="ui-block-diagram-block-content-stub__port-line"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-block-diagram-block-content-stub__port --right">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t:styled="false"\n\t\t\t\t\t\t\t:portsToShow="null"\n\t\t\t\t\t\t\tposition="right"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Do="#A1B8D9";const No="#ECF0F2";const Ro={base:"ui-block-diagram",ewResize:"--cursor-ew-resize",nsResize:"--cursor-ns-resize",nwSeResize:"--cursor-nwse-resize",neSwResize:"--cursor-nesw-resize",grabbing:"--grabbing",disabled:"--disabled"};const zo={name:"block-diagram",components:{CanvasTransform:yo,ContextMenuLayout:Ho,GroupedBlocks:Fo,GroupedConnections:wo,Connection:Lo,DeleteConnectionBtn:Vo,MoveableBlock:Io,BlockContentStub:Oo},props:{blocks:{type:Array,required:true},connections:{type:Array,required:true},canvasStyle:{type:Object,default:()=>({style:"grid",size:64,gridColor:Do,backgroundColor:No})},zoomSensitivity:{type:Number,default:.01},zoomSensitivityMouse:{type:Number,default:.04},zoom:{type:Number,default:1},minZoom:{type:Number,default:.2},maxZoom:{type:Number,default:4},historyHooks:{type:Array,default:()=>[u.END_DRAG_BLOCK,u.ADD_BLOCK,u.DELETE_BLOCK,u.CREATE_CONNECTION,u.DELETE_CONNECTION]},snapshotHandler:{type:Function,default:null},revertHandler:{type:Function,default:null},disabled:{type:Boolean,default:false}},emits:["update:blocks","update:connections",u.CHANGED_BLOCKS,u.CHANGED_CONNECTIONS,u.START_DRAG_BLOCK,u.MOVE_DRAG_BLOCK,u.END_DRAG_BLOCK,u.ADD_BLOCK,u.UPDATE_BLOCK,u.DELETE_BLOCK,u.CREATE_CONNECTION,u.DELETE_CONNECTION,u.BLOCK_TRANSITION_START,u.BLOCK_TRANSITION_END,u.CONNECTION_TRANSITION_START,u.CONNECTION_TRANSITION_END,u.DROP_NEW_BLOCK],setup(t,{emit:e}){const{blockGroupNames:o,connectionGroupNames:n,cursorType:a}=Ze(t);const l=po({blockDiagramRef:s.useTemplateRef("blockDiagram")});const{makeSnapshot:i}=Ge();const{dispose:r}=Je(e);const{dispose:c}=to(t);const{dispose:d}=eo({...Object.entries(u).reduce(((t,[o,n])=>{t[n]=(...t)=>{e(n,...t)};return t}),{})},{...t.historyHooks.reduce(((t,e)=>{t[e]=()=>i();return t}),{})});const{onDrop:b}=go();const p=s.ref(false);const v=s.computed((()=>({[Ro.base]:true,[Ro.grabbing]:p.value,[Ro.disabled]:t.disabled,[Ro.ewResize]:s.toValue(a)===h.EW_RESIZE,[Ro.nsResize]:s.toValue(a)===h.NS_RESIZE,[Ro.nwSeResize]:s.toValue(a)===h.NWSE_RESIZE,[Ro.neSwResize]:s.toValue(a)===h.NESW_RESIZE})));s.onMounted((()=>{l.onMountedAppElements()}));s.onUnmounted((()=>{r();c();d();l.onUnmountedAppElements()}));function m(t){p.value=true}function f(t){p.value=false}function g(t){p.value=false;b(t)}return{blockDiagramClassNames:v,blockGroupNames:o,connectionGroupNames:n,getGroupBlockSlotName:R,getGroupConnectionSlotName:z,onDragDrop:g,onDragEnter:m,onDragLeave:f}},template:`\n\t\t<div\n\t\t\t:class="blockDiagramClassNames"\n\t\t\tref="blockDiagram"\n\t\t\t@dragover.prevent\n\t\t\t@dragenter="onDragEnter"\n\t\t\t@dragleave="onDragLeave"\n\t\t\t@drop="onDragDrop"\n\t\t>\n\t\t\t<CanvasTransform\n\t\t\t\t:canvasStyle="canvasStyle"\n\t\t\t\t:zoomSensitivity="zoomSensitivity"\n\t\t\t\t:zoomSensitivityMouse="zoomSensitivityMouse"\n\t\t\t>\n\t\t\t\t<ContextMenuLayout>\n\t\t\t\t\t<GroupedConnections>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for="groupName in connectionGroupNames"\n\t\t\t\t\t\t\t#[getGroupConnectionSlotName(groupName)]="{ connections }"\n\t\t\t\t\t\t\t:key="groupName"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for="connection in connections"\n\t\t\t\t\t\t\t\t:name="getGroupConnectionSlotName(groupName)"\n\t\t\t\t\t\t\t\t:key="connection.id"\n\t\t\t\t\t\t\t\t:connection="connection"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Connection\n\t\t\t\t\t\t\t\t\t:connection="connection"\n\t\t\t\t\t\t\t\t\t:key="connection.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default="{ isDisabled }">\n\t\t\t\t\t\t\t\t\t\t<DeleteConnectionBtn \n\t\t\t\t\t\t\t\t\t\t\t:connectionId="connection.id"\n\t\t\t\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</Connection>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #new-connection>\n\t\t\t\t\t\t\t<slot name="new-connection"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedConnections>\n\t\t\t\t\t<GroupedBlocks>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for="groupName in blockGroupNames"\n\t\t\t\t\t\t\t#[getGroupBlockSlotName(groupName)]="{ blocks }"\n\t\t\t\t\t\t\t:key="groupName"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for="block in blocks"\n\t\t\t\t\t\t\t\t:name="getGroupBlockSlotName(groupName)"\n\t\t\t\t\t\t\t\t:key="block.id"\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<MoveableBlock\n\t\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t\t:key="block.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default="{ isHighlighted, isDragged, isDisabled }">\n\t\t\t\t\t\t\t\t\t\t<BlockContentStub\n\t\t\t\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t\t\t\t\t\t\t:dragged="isDragged"\n\t\t\t\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</MoveableBlock>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedBlocks>\n\t\t\t\t</ContextMenuLayout>\n\t\t\t</CanvasTransform>\n\t\t</div>\n\t`};const Ao={name:"icon-button",components:{BIcon:n.BIcon},props:{iconName:{type:String,default:""},size:{type:[Number,String],default:16},color:{type:String,default:"#959CA4"},active:{type:Boolean,default:false},activeColor:{type:String,default:"#4A9DFF"},disabled:{type:Boolean,default:false}},setup(t){const{size:e,active:o,disabled:n}=s.toRefs(t);const a=s.computed((()=>({"ui-block-diagram-icon-button":true,"--disabled":s.toValue(n)})));const l=s.computed((()=>({width:`${s.toValue(e)}px`,height:`${s.toValue(e)}px`})));const i=s.computed((()=>({"ui-block-diagram-icon-button__icon":true,"--active":s.toValue(o)})));return{buttonClassNames:a,buttonStyle:l,iconClassNames:i}},template:`\n\t\t<button\n\t\t\t:class="buttonClassNames"\n\t\t\t:style="buttonStyle"\n\t\t>\n\t\t\t<slot>\n\t\t\t\t<BIcon\n\t\t\t\t\t:class="iconClassNames"\n\t\t\t\t\t:name="iconName"\n\t\t\t\t\t:color="color"\n\t\t\t\t\t:size="size"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</button>\n\t`};const jo={name:"history-bar",components:{IconButton:Ao},props:{disabled:{type:Boolean,default:false}},setup(t){const{isDisabledBlockDiagram:e}=Ze();const{hasNext:o,hasPrev:a,next:l,prev:i}=Ge();function r(){if(t.disabled||s.toValue(e)){return}l()}function c(){if(t.disabled||s.toValue(e)){return}i()}return{hasNext:o,hasPrev:a,onNext:r,onPrev:c,Outline:n.Outline}},template:`\n\t\t<div class="ui-block-diagram-histoy-bar">\n\t\t\t<slot>\n\t\t\t\t<IconButton\n\t\t\t\t\tclass="ui-block-diagram-histoy-bar__prev-button"\n\t\t\t\t\t:icon-name="Outline.FORWARD"\n\t\t\t\t\t:size="22"\n\t\t\t\t\t:disabled="!hasPrev"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('historyPrevBtn')"\n\t\t\t\t\t@click="onPrev"\n\t\t\t\t/>\n\t\t\t\t<IconButton\n\t\t\t\t\t:icon-name="Outline.FORWARD"\n\t\t\t\t\t:size="22"\n\t\t\t\t\t:disabled="!hasNext"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('historyNextBtn')"\n\t\t\t\t\t@click="onNext"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</div>\n\t`};const Ko={in:"in",out:"out"};const Go={name:"zoom-btn",components:{BIcon:n.BIcon},props:{stepZoom:{type:Number,default:.2},typeZoom:{type:String,default:Ko.in,validator(t){return t===Ko.in||t===Ko.out}},disabled:{type:Boolean,default:false}},emits:["zoom-change"],setup(t,{emit:e}){const{isDisabledBlockDiagram:o}=Ze();const{zoomIn:a,zoomOut:l}=ao();const{stepZoom:i,typeZoom:r}=s.toRefs(t);function c(){if(t.disabled||s.toValue(o)){return}if(s.toValue(r)===Ko.in){a(s.toValue(i))}else if(s.toValue(r)===Ko.out){l(s.toValue(i))}}return{iconSet:n.Outline,zoomTypes:Ko,onZoom:c}},template:`\n\t\t<button\n\t\t\tclass="ui-block-diagram-control-btn__btn"\n\t\t\t@click="onZoom"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tv-if="typeZoom === zoomTypes.in"\n\t\t\t\t:name="iconSet.PLUS_M"\n\t\t\t\t:size="22"\n\t\t\t\tclass="ui-block-diagram-control-btn__icon"\n\t\t\t/>\n\t\t\t<BIcon\n\t\t\t\tv-else\n\t\t\t\t:name="iconSet.MINUS_M"\n\t\t\t\t:size="22"\n\t\t\t\tclass="ui-block-diagram-control-btn__icon"\n\t\t\t/>\n\t\t</button>\n\t`};const $o={name:"zoom-percent",setup(t){const{zoom:e}=Ze();const o=s.computed((()=>{var t;return(((t=s.toValue(e))!=null?t:0)*100).toFixed(0)}));return{percent:o}},template:`\n\t\t<span class="ui-block-diagram-percent">{{ percent }}</span>\n\t`};const Xo=2;const Yo="firstCanvasBlock";const Zo="lastCanvasBlock";const Uo={name:"canvas-map",props:{mapWidth:{type:Number,default:310},mapHeight:{type:Number,default:183}},setup(t,{emit:e}){const{blocks:o,canvasWidth:n,canvasHeight:l,transformX:i,transformY:r,zoom:c}=Ze();const{setCamera:u}=ao();const{mapWidth:d,mapHeight:b}=s.toRefs(t);const p=s.useTemplateRef("map");let v=0;let m=0;const h=s.ref(false);const f=s.computed((()=>({width:`${s.toValue(d)}px`,height:`${s.toValue(b)}px`})));const g=s.computed((()=>{if(s.toValue(o).length===1){return[{id:Yo,position:{x:0,y:0},dimensions:{width:0,height:0}},{...s.toValue(o)[0]},{id:Zo,position:{x:t.mapWidth,y:t.mapHeight},dimensions:{width:0,height:0}}]}return s.toValue(o)}));const B=s.computed((()=>s.toValue(g).reduce(((t,e)=>Math.min(t,e.position.x)),Infinity)));const P=s.computed((()=>s.toValue(g).reduce(((t,e)=>Math.min(t,e.position.y)),Infinity)));const y=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(o))){return t.mapWidth}const e=s.toValue(g).reduce(((t,e)=>Math.max(t,e.position.x+e.dimensions.width)),-Infinity);return e-s.toValue(B)}));const k=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(o))){return t.mapHeight}const e=s.toValue(g).reduce(((t,e)=>Math.max(t,e.position.y+e.dimensions.height)),-Infinity);return e-s.toValue(P)}));const L=s.computed((()=>Math.min(s.toValue(d)/s.toValue(y),s.toValue(b)/s.toValue(k))));const V=s.computed((()=>s.toValue(n)*s.toValue(L)/s.toValue(c)));const H=s.computed((()=>s.toValue(l)*s.toValue(L)/s.toValue(c)));const C=s.computed((()=>{let t=s.toValue(V);let e=s.toValue(H);let o=(s.toValue(i)-s.toValue(B))*s.toValue(L);let n=(s.toValue(r)-s.toValue(P))*s.toValue(L);[o,t]=t>s.toValue(d)?[1,s.toValue(d)-Xo]:[o,t];[n,e]=e>s.toValue(b)?[1,s.toValue(b)-Xo]:[n,e];o=o<0?1:o;n=n<0?1:n;o=o+t>s.toValue(d)?s.toValue(d)-t-Xo:o;n=n+e>s.toValue(b)?s.toValue(b)-e-Xo:n;return{x:o,y:n,width:t,height:e}}));function F(t){const e=t.clientX-v;const o=t.clientY-m;const a=e/s.toValue(L)+s.toValue(B);const i=o/s.toValue(L)+s.toValue(P);u({x:a-s.toValue(n)/s.toValue(c)/2,y:i-s.toValue(l)/s.toValue(c)/2,zoom:s.toValue(c),viewportX:0,viewportY:0})}function x(t){h.value=true;if(s.toValue(p)){const{left:t,top:e}=s.toValue(p).getBoundingClientRect();[v,m]=[t,e]}F(t)}function S(t){if(!s.toValue(h)){return}F(t)}function E(t){h.value=false;F(t)}return{preparedBlock:g,canvasMapStyle:f,startDiagramX:B,startDiagramY:P,scaleMap:L,cursorRectPosition:C,onMapMouseDown:x,onMapMouseMove:S,onMapMouseUp:E}},template:`\n\t\t<div :style="canvasMapStyle">\n\t\t\t<svg\n\t\t\t\t:width="mapWidth"\n\t\t\t\t:height="mapHeight"\n\t\t\t\tref="map"\n\t\t\t\tclass="ui-block-diagram-canvas-map"\n\t\t\t\t@mousedown="onMapMouseDown"\n\t\t\t\t@mousemove="onMapMouseMove"\n\t\t\t\t@mouseup="onMapMouseUp"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for="block in preparedBlock"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\t:x="(block.position.x - startDiagramX) * scaleMap"\n\t\t\t\t\t:y="(block.position.y - startDiagramY) * scaleMap"\n\t\t\t\t\t:width="block.dimensions.width * scaleMap"\n\t\t\t\t\t:height="block.dimensions.height * scaleMap"\n\t\t\t\t\t:rx="2"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map__block"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\t:x="cursorRectPosition.x"\n\t\t\t\t\t:y="cursorRectPosition.y"\n\t\t\t\t\t:width="cursorRectPosition.width"\n\t\t\t\t\t:height="cursorRectPosition.height"\n\t\t\t\t\t:rx="3"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map__cursor"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</div>\n\t`};const Wo={name:"canvas-map-btn",props:{width:{type:Number,default:75},height:{type:Number,default:32}},setup(t){const{blocks:e}=Ze();const o=s.computed((()=>({width:`${t.width}px`,height:`${t.height}px`})));const n=s.computed((()=>s.toValue(e).reduce(((t,e)=>Math.min(t,e.position.x)),Infinity)));const l=s.computed((()=>s.toValue(e).reduce(((t,e)=>Math.min(t,e.position.y)),Infinity)));const i=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(e))){return t.width}const o=s.toValue(e).reduce(((t,e)=>Math.max(t,e.position.x+e.dimensions.width)),-Infinity);return o-s.toValue(n)}));const r=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(e))){return t.height}const o=s.toValue(e).reduce(((t,e)=>Math.max(t,e.position.y+e.dimensions.height)),-Infinity);return o-s.toValue(l)}));const c=s.computed((()=>Math.min(t.width/s.toValue(i),t.height/s.toValue(r))));return{blocks:e,btnStyle:o,startDiagramX:n,startDiagramY:l,scaleButton:c}},template:`\n\t\t<button\n\t\t\t:style="btnStyle"\n\t\t\tclass="ui-block-diagram-canvas-map-btn"\n\t\t>\n\t\t\t<svg\n\t\t\t\t:width="width"\n\t\t\t\t:height="height"\n\t\t\t\tclass="ui-block-diagram-canvas-map-btn__icon"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for="block in blocks"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\t:x="(block.position.x - startDiagramX) * scaleButton"\n\t\t\t\t\t:y="(block.position.y - startDiagramY) * scaleButton"\n\t\t\t\t\t:width="block.dimensions.width * scaleButton"\n\t\t\t\t\t:height="block.dimensions.height * scaleButton"\n\t\t\t\t\t:rx="1"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map-btn__rect"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</button>\n\t`};const qo={left:"left",right:"right"};const Qo={top:"top",bottom:"bottom"};const Jo={base:"ui-block-diagram-canvas-zoom-bar__map",top:"--top",bottom:"--bottom",left:"--left",right:"--right"};const tn="top right";const en={name:"zoom-bar",components:{BIcon:n.BIcon,ZoomBtn:Go,ZoomPercent:$o,CanvasMap:Uo,CanvasMapBtn:Wo},props:{stepZoom:{type:Number,default:.2},positionMap:{type:String,default:tn},disabled:{type:Boolean,default:false}},emits:["update:modelValue"],setup(t){const e=s.ref(false);const o=s.computed((()=>{const e=t.positionMap.toLowerCase().includes(Qo.top);const o=t.positionMap.toLowerCase().includes(qo.left);return{[Jo.base]:true,[Jo.top]:e,[Jo.bottom]:!e,[Jo.left]:o,[Jo.right]:!o}}));function a(){if(t.disabled){e.value=false;return}e.value=!s.toValue(e)}return{iconSet:n.Outline,mapPositionClasses:o,isShowMap:e,onToggleMap:a}},template:`\n\t\t<div class="ui-block-diagram-canvas-zoom-bar">\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__locate">\n\t\t\t\t<CanvasMapBtn\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomOpenMapBtn')"\n\t\t\t\t\t@click="onToggleMap"\n\t\t\t\t/>\n\t\t\t\t<transition name="editor-large-map-fade" mode="in-out">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isShowMap"\n\t\t\t\t\t\tclass="ui-block-diagram-canvas-zoom-bar__map"\n\t\t\t\t\t\t:class="mapPositionClasses"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__map-header">\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t:name="iconSet.CROSS_M"\n\t\t\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomCloseMapBtn')"\n\t\t\t\t\t\t\t\tclass="ui-block-diagram-canvas-zoom-bar__map-close-icon"\n\t\t\t\t\t\t\t\tcolor="#2FC6F6"\n\t\t\t\t\t\t\t\t@click="onToggleMap"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<CanvasMap\n\t\t\t\t\t\t\t:mapSize="310"\n\t\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomCanvasMap')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__separator"/>\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__zoom">\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom="stepZoom"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomOutBtn')"\n\t\t\t\t\ttypeZoom="out"\n\t\t\t\t/>\n\t\t\t\t<ZoomPercent/>\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom="stepZoom"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomInBtn')"\n\t\t\t\t\ttypeZoom="in"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const on={name:"search-result",props:{title:{type:String,required:true},count:{type:String,required:true}},template:`\n\t\t<div class="ui-block-diagram-search-result">\n\t\t\t<div class="ui-block-diagram-search-result__left-col">\n\t\t\t\t<p class="ui-block-diagram-search-result__title">{{ title }}</p>\n\t\t\t</div>\n\t\t\t<div class="ui-block-diagram-search-result__right-col">\n\t\t\t\t<span class="ui-block-diagram-search-result__count">{{ count }}</span>\n\t\t\t\t<div class="ui-block-diagram-search-result__nav">\n\t\t\t\t\t<slot/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const nn={name:"search-nav-btn",template:`\n\t\t<button class="ui-block-diagram-search-nav-btn">\n\t\t\t<slot/>\n\t\t</button>\n\t`};const an={name:"open-search-btn",components:{BIcon:n.BIcon},setup(){return{iconSet:n.Outline}},template:`\n\t\t<button class="ui-block-diagram-open-search-btn">\n\t\t\t<BIcon\n\t\t\t\t:name="iconSet.SEARCH"\n\t\t\t\t:size="24"\n\t\t\t\tclass="ui-block-diagram-open-search-btn__icon"\n\t\t\t/>\n\t\t</button>\n\t`};const sn={base:"ui-block-diagram-search-input",open:"--open"};const ln={name:"SearchInput",components:{BIcon:n.BIcon,OpenSearchBtn:an},props:{value:{type:String,default:""},placeholder:{type:String,default:""},disabled:{type:Boolean,default:false}},emits:["update:value","clear"],setup(t,{emit:e}){const o=lo();const a=s.useTemplateRef("searchInput");const l=s.ref(true);const i=s.ref(false);const r=s.computed((()=>{if(t.placeholder){return t.placeholder}return o.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER")}));const c=s.computed((()=>({[sn.base]:true,[sn.open]:s.toValue(i)})));function u(o){if(t.disabled){return}e("update:value",o.target.value)}function d(){if(t.disabled){return}i.value=false;e("clear")}function b(){s.nextTick((()=>{var t;return(t=s.toValue(a))==null?void 0:t.focus()}))}function p(){l.value=true}function v(){i.value=true;l.value=false}function m(){i.value=false}return{iconSet:n.Outline,showSearchBar:i,showSearchBtn:l,placeholderOrDefaultValue:r,searchInputClassNames:c,onInput:u,onClear:d,onAfterEnterTransition:b,onLeaveTransition:p,onOpenSearchBar:v,collapseSearchBar:m}},template:`\n\t\t<OpenSearchBtn\n\t\t\tv-show="showSearchBtn"\n\t\t\t:data-test-id="$blockDiagramTestId('searchOpenBtn')"\n\t\t\t@click="onOpenSearchBar"\n\t\t/>\n\t\t<transition\n\t\t\tname="ui-block-diagram-search-bar-fade"\n\t\t\tenter-active-class="ui-block-diagram-open-search-bar"\n\t\t\tleave-active-class="ui-block-diagram-close-search-bar"\n\t\t\t@after-enter="onAfterEnterTransition"\n\t\t\t@after-leave="onLeaveTransition"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-show="showSearchBar"\n\t\t\t\t:class="searchInputClassNames"\n\t\t\t\tref="searchBar"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="iconSet.SEARCH"\n\t\t\t\t\t:size="24"\n\t\t\t\t\tclass="ui-block-diagram-search-input__icon"\n\t\t\t\t/>\n\t\t\t\t<input\n\t\t\t\t\t:value="value"\n\t\t\t\t\t:placeholder="placeholderOrDefaultValue"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchInput')"\n\t\t\t\t\tref="searchInput"\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-block-diagram-search-input__input"\n\t\t\t\t\t@input="onInput"\n\t\t\t\t/>\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-block-diagram-search-input__clear-btn"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchClearInputBtn')"\n\t\t\t\t\t@click="onClear"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="iconSet.CROSS_L"\n\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\tclass="ui-block-diagram-search-input__clear-btn-icon"\n\t\t\t\t\t/>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</transition>\n\t`};const rn={name:"SearchBar",components:{BIcon:n.BIcon,SearchResult:on,SearchNavBtn:nn,SearchInput:ln,OpenSearchBtn:an},props:{searchResultTitle:{type:String,default:""},placeholder:{type:String,default:""},searchCallback:{type:Function,required:true,default:(t,e)=>t.node.title.toLowerCase().includes(e.toLowerCase())},searchDelay:{type:Number,default:300},disabled:{type:Boolean,default:false}},setup(t){const{seachText:e,foundBlocks:o,onSearchBlocks:l,onClearSearch:i}=no({searchCallback:t.searchCallback,delay:t.searchDelay});const{isDisabledBlockDiagram:r}=Ze();const c=so();const u=lo();const{goToBlockById:d}=ao();const b=s.useTemplateRef("searchPanel");const p=s.useTemplateRef("searchInput");const v=s.ref(0);const m=s.computed((()=>t.disabled||s.toValue(r)));const h=s.computed((()=>`${v.value+1} / ${s.toValue(o).length}`));const f=s.computed((()=>{if(t.placeholder){return t.placeholder}return u.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER")}));const g=s.computed((()=>{if(t.searchResultTitle){return t.searchResultTitle}return u.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_RESULT_TITLE")}));s.watch(o,(t=>{v.value=0;if(s.toValue(t).length>0){const e=s.toValue(t)[0].id;c.clear();c.add(e);d(e)}else{c.clear()}}));s.onMounted((()=>{a.Event.bind(document,"mousedown",k)}));s.onUnmounted((()=>{a.Event.unbind(document,"mousedown",k)}));function B(){if(s.toValue(m)){return}v.value+=1;if(s.toValue(v)>s.toValue(o).length-1){v.value=0}const t=s.toValue(o)[s.toValue(v)].id;c.clear();c.add(t);d(t)}function P(){if(s.toValue(m)){return}v.value-=1;if(s.toValue(v)<0){v.value=s.toValue(o).length-1}const t=s.toValue(o)[s.toValue(v)].id;c.clear();c.add(t);d(s.toValue(o)[s.toValue(v)].id)}function y(){c.clear();i();v.value=0}function k(t){if(s.toValue(b)&&!s.toValue(b).contains(t.target)){var e;y();(e=s.toValue(p))==null?void 0:e.collapseSearchBar()}}return{iconSet:n.Outline,isDisabled:m,placeholderOrDefaultValue:f,searchResultTitleOrDefaultValue:g,seachText:e,labelResult:h,foundBlocks:o,onSearchBlocks:l,onClearSearch:i,closeAndResetSearch:y,onGoToNextBlock:B,onGoToPrevBlock:P}},template:`\n\t\t<div\n\t\t\tclass="ui-block-diagram-search-bar"\n\t\t\tref="searchPanel"\n\t\t>\n\t\t\t<SearchInput\n\t\t\t\t:value="seachText"\n\t\t\t\t:placeholder="placeholderOrDefaultValue"\n\t\t\t\t:disabled="isDisabled"\n\t\t\t\tref="searchInput"\n\t\t\t\t@update:value="onSearchBlocks"\n\t\t\t\t@clear="closeAndResetSearch"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tv-if="foundBlocks.length > 0"\n\t\t\t\tclass="ui-block-diagram-search-bar__search-result"\n\t\t\t>\n\t\t\t\t<SearchResult\n\t\t\t\t\t:title="searchResultTitleOrDefaultValue"\n\t\t\t\t\t:count="labelResult"\n\t\t\t\t>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchResultPrevBtn')"\n\t\t\t\t\t\t@click="onGoToPrevBlock"\n\t\t\t\t\t>\n\t\t\t\t\t\t&lt;\n\t\t\t\t\t</SearchNavBtn>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchResultNextBtn')"\n\t\t\t\t\t\t@click="onGoToNextBlock"\n\t\t\t\t\t>\n\t\t\t\t\t\t&gt;\n\t\t\t\t\t</SearchNavBtn>\n\t\t\t\t</SearchResult>\n\t\t\t</div>\n\t\t</div>\n\t`};const cn={name:"resizable-block",props:{block:{type:Object,required:true},minWidth:{type:Number,default:100},minHeight:{type:Number,default:100},highlighted:{type:Boolean,default:false}},setup(t){const{block:e,minWidth:o,minHeight:n}=s.toRefs(t);const{isHiglitedBlock:a,isDisabled:l}=qe(e);const i=so();const{isDragged:r,blockPositionStyle:c}=Qe(s.useTemplateRef("blockEl"),e);const{isResize:u,sizeBlockStyle:d,onMounted:b,onUnmounted:p}=Bo({block:e,minWidth:o,minHeight:n,leftSideRef:s.useTemplateRef("leftSide"),topSideRef:s.useTemplateRef("topSide"),rightSideRef:s.useTemplateRef("rightSide"),bottomSideRef:s.useTemplateRef("bottomSide"),leftTopCornerRef:s.useTemplateRef("leftTopCorner"),rightTopCornerRef:s.useTemplateRef("rightTopCorner"),rightBottomCornerRef:s.useTemplateRef("rightBottomCorner"),leftBottomCornerRef:s.useTemplateRef("leftBottomCorner")});const v=s.computed((()=>({...s.toValue(c),...s.toValue(d)})));s.watch((()=>t.highlighted),(e=>{if(e){i.add(t.block.id)}else{i.remove(t.block.id)}}));s.onMounted((()=>{b()}));s.onUnmounted((()=>{i.remove(t.block.id);p()}));function m(){i.clear();i.add(t.block.id)}return{isHiglitedBlock:a,isDisabled:l,isResize:u,isDragged:r,blockStyle:v,onMouseDownSelectBlock:m}},template:`\n\t\t<div\n\t\t\t:style="blockStyle"\n\t\t\tref="blockEl"\n\t\t\tclass="ui-block-diagram-resizable-block"\n\t\t\t@mousedown="onMouseDownSelectBlock"\n\t\t>\n\t\t\t<div class="ui-block-diagram-resizable-block__container">\n\t\t\t\t<div\n\t\t\t\t\tref="leftSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__left-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="topSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__right-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="bottomSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="leftTopCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-left-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightTopCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-right-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightBottomCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-right-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="leftBottomCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-left-corner"\n\t\t\t\t/>\n\n\t\t\t\t<slot\n\t\t\t\t\t:block="block"\n\t\t\t\t\t:isHighlighted="isHiglitedBlock"\n\t\t\t\t\t:isDragged="isDragged"\n\t\t\t\t\t:isResize="isResize"\n\t\t\t\t\t:isDisabled="isDisabled"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};let un=t=>t,dn;let bn=null;function pn(t,e){const{dragData:o,dragImage:n}=a.Type.isFunction(e)?e():e;bn=s.toValue(n).cloneNode(true).children[0];const l=document.getElementById("blockDiagramDragWrapper");a.Dom.append(bn,l);a.Dom.style(bn,{display:"block",position:"absolute",top:0,left:0});const{width:i,height:r}=bn.getBoundingClientRect();t.dataTransfer.setDragImage(bn,i/2,r/2);t.dataTransfer.setData("text/plain",JSON.stringify({...s.toValue(o),dimensions:{width:i,height:r}}))}function vn(t){a.Dom.remove(bn);bn=null}function mn(){const t=document.getElementById("blockDiagramDragWrapper");if(t){return}const e=a.Tag.render(dn||(dn=un`
		<div>
			<div
				id="blockDiagramDragWrapper"
				style="position: relative; width: 100%; height: 100%;"
			>
			</div>
		</div>
	`));a.Dom.append(e,document.body);a.Dom.style(e,{position:"absolute",transform:"translate(-100%, -100%)",top:0,right:0})}const hn={mounted(t,{arg:e,value:o}){mn();a.Dom.attr(t,"draggable","true");a.Event.bind(t,"dragstart",(t=>pn(t,o)));a.Event.bind(t,"dragend",(t=>vn()))},unmounted(t,{arg:e,value:o}){a.Event.unbind(t,"dragstart",(t=>pn(t,o)));a.Event.unbind(t,"dragend",(t=>vn(t)))}};t.BlockDiagram=zo;t.HistoryBar=jo;t.ZoomBar=en;t.SearchBar=rn;t.MoveableBlock=Io;t.ResizableBlock=cn;t.Port=Mo;t.Connection=Lo;t.DeleteConnectionBtn=Vo;t.transformPoint=L;t.useBlockDiagram=Ze;t.useContextMenu=Ue;t.useHistory=Ge;t.useSearchBlocks=no;t.useCanvas=ao;t.useBlockState=qe;t.useMoveableBlock=Qe;t.useResizableBlock=Bo;t.useHighlightedBlocks=so;t.useAnimationQueue=mo;t.usePortState=io;t.useConnectionState=bo;t.useNewConnectionState=vo;t.useDragAndDrop=go;t.DragBlock=hn})(this.BX.UI=this.BX.UI||{},BX.Main,BX,BX.UI.IconSet,BX,BX.Vue3);
//# sourceMappingURL=block-diagram.bundle.map.js