this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};(function(e,t,n){"use strict";var a,i;var s=function(){function e(s){var o=this;babelHelpers.classCallCheck(this,e);this.siteId=s.siteId;this.landingId=s.landingId;this.type=s.type;this.tool=s.tool;this.pages=s.pages;this.container=document.getElementById(s.containerId);this.menu=document.getElementById(s.menuId);for(var r in this.pages){this.pages[r].container=t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="landing-settings-page-container"></div>'])));t.Dom.append(this.pages[r].container,this.container)}this.loadingPages=[];this.loaderContainer=t.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<div class="landing-settings-loader-container"></div>'])));t.Dom.insertAfter(this.loaderContainer,this.container);this.loader=new n.Loader({target:this.loaderContainer});this.links=[].slice.call(this.menu.querySelectorAll(e.PAGE_LINK_SELECTOR));var d=this.links[0];this.links.forEach((function(e){o.bindMenuLink(e);if(e.dataset.page&&o.pages[e.dataset.page]&&o.pages[e.dataset.page].current===true){d=e}}));if(d){this.onMenuLinkClick(d,false)}this.saveButton=document.getElementById(s.saveButtonId);this.cancelButton=document.getElementById(s.cancelButtonId);this.onSave=this.onSave.bind(this);this.onCancel=this.onCancel.bind(this);t.Event.bind(this.saveButton,"click",this.onSave);BX.Event.EventEmitter.subscribe("SidePanel.Slider:onClose",(function(){o.onCancel()}))}babelHelpers.createClass(e,[{key:"showLoader",value:function e(){this.loader.show();t.Dom.show(this.loaderContainer)}},{key:"hideLoader",value:function e(){this.loader.hide();t.Dom.hide(this.loaderContainer)}},{key:"bindMenuLink",value:function e(n){var a=this;t.Event.bind(n,"click",(function(e){e.preventDefault();e.stopPropagation();a.onMenuLinkClick(n)}))}},{key:"bindPageLink",value:function e(n){if(n.dataset.page){var a=this.links.find((function(e){return e.dataset.page===n.dataset.page}));if(a){t.Event.bind(n,"click",(function(e){e.preventDefault();e.stopPropagation();a.click()}))}}}},{key:"onMenuLinkClick",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.currentLink=t;if(t.dataset.page){this.onPageChange(t.dataset.page);if(n){BX.UI.Analytics.sendData({tool:this.tool,category:"settings",event:"click_on_section",p1:this.getTypePageForMetrika(t.dataset.page),p3:"siteID_".concat(this.siteId)})}}else if(t.dataset.placement){if(typeof BX.rest!=="undefined"&&typeof BX.rest.Marketplace!=="undefined"){BX.rest.Marketplace.bindPageAnchors({})}BX.rest.AppLayout.openApplication(t.dataset.appId,{SITE_ID:this.siteId,LID:this.landingId},{PLACEMENT:t.dataset.placement,PLACEMENT_ID:t.dataset.placementId})}}},{key:"onPageChange",value:function n(a){var i=this;var s=this.pages[a];if(s){if(s.container.childNodes.length===0){this.showLoader();this.loadingPages.push(a);t.ajax.get(s.link,(function(t){s.container.innerHTML=t;i.loadingPages.splice(i.loadingPages.indexOf(a),1);if(i.loadingPages.length===0){i.hideLoader()}var n=s.container.querySelector("form.landing-form");if(n){s.form=n}var o=s.container.querySelectorAll(e.PAGE_LINK_SELECTOR);if(o.length>0){o.forEach((function(e){return i.bindPageLink(e)}))}if(i.currentPage){i.currentPage.container.hidden=true}i.currentPage=s;i.currentPage.container.hidden=false}))}else{if(this.currentPage){this.currentPage.container.hidden=true}this.currentPage=s;this.currentPage.container.hidden=false}}}},{key:"onSave",value:function e(){var n=this;BX.UI.Analytics.sendData({tool:this.tool,category:"settings",event:"save",p1:this.getTypePageForMetrika(this.currentLink.dataset.page),p3:"siteID_".concat(this.siteId)});this.showLoader();var a=[];for(var i in this.pages){var s=this.pages[i];if(s.form){a.push(fetch(s.linkToSave,{method:"POST",body:new FormData(s.form),headers:{"Bx-ajax":true}}))}}Promise.all(a).then((function(e){var a=true;e.forEach((function(e){a=a&&e.ok}));if(a){top.window["landingSettingsSaved"]=true;top.BX.onCustomEvent("BX.Landing.Filter:apply");n.hideLoader();t.Dom.removeClass(n.saveButton,"ui-btn-wait");var i=BX.SidePanel.Instance.getPreviousSlider();if(i){i.reload();BX.SidePanel.Instance.close()}else{top.window.location.reload();BX.SidePanel.Instance.close()}}}))["catch"]((function(e){console.error(e)}))}},{key:"onCancel",value:function e(){BX.UI.Analytics.sendData({tool:this.tool,category:"settings",event:"close",p1:this.getTypePageForMetrika(this.currentLink.dataset.page),p3:"siteID_".concat(this.siteId)})}},{key:"getTypePageForMetrika",value:function e(t){var n="";switch(t){case"SITE_EDIT":n="site_settings";break;case"SITE_DESIGN":n="site_design";break;case"LANDING_EDIT":n="page_settings";break;case"LANDING_DESIGN":n="page_design";break;case"CATALOG_EDIT":n="catalog_settings";break;default:n=t;break}return n}}]);return e}();babelHelpers.defineProperty(s,"PAGE_LINK_SELECTOR","a[data-page], a[data-placement]");e.LandingSettings=s})(this.BX.Landing.Component=this.BX.Landing.Component||{},BX,BX);
//# sourceMappingURL=script.map.js